"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[693],{991(e,i,t){t.d(i,{IM:()=>s,fH:()=>u,zj:()=>a});var n=t(5043),r=t(5685);const l="fizizbilite";function o(e,i){try{const t=window.localStorage.getItem(e);return null==t?i:JSON.parse(t)}catch(t){return i}}function a(e,i){let{prefix:t=l,scope:a}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const s=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l,i=arguments.length>1?arguments[1]:void 0;const t=(0,r.zy)();return(0,n.useMemo)(()=>{const n=("string"===typeof i?i.trim():"")||t.pathname+(t.search||"");return e+":"+n},[e,i,t.pathname,t.search])}(t,a),u=(0,n.useMemo)(()=>"".concat(s,":ui:").concat(e),[s,e]),d=(0,n.useRef)(null),[c,m]=(0,n.useState)(()=>o(u,i));return(0,n.useEffect)(()=>{d.current=u,m(o(u,i))},[u]),(0,n.useEffect)(()=>{d.current===u&&function(e,i){try{window.localStorage.setItem(e,JSON.stringify(i))}catch(t){}}(u,c)},[u,c]),[c,m,u]}function s(e){let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],t=arguments.length>2?arguments[2]:void 0;const[n,r]=a(e,!!i,t);return[!!n,e=>r(!!("function"===typeof e?e(n):e))]}function u(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",t=arguments.length>2?arguments[2]:void 0;const[n,r]=a(e,String(null!==i&&void 0!==i?i:""),t);return[String(null!==n&&void 0!==n?n:""),e=>r(String("function"===typeof e?e(n):e))]}},2693(e,i,t){t.r(i),t.d(i,{default:()=>x});var n=t(2555),r=t(5043),l=t(5685),o=t(2115),a=t(7559),s=t(4405),u=t(1298),d=t(6037),c=t(3492);function m(){let{inputs:e,norm:i,config:t,scenario:n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const r=(0,c.Rn)({inputs:e,norm:i,scenario:n}),l=function(e){const i=(0,c.bO)(),t=e&&"object"===typeof e?e:{},n=t.sections&&"object"===typeof t.sections?t.sections:{},r={version:i.version,sections:{}};return Object.keys(i.sections).forEach(e=>{const t=i.sections[e]||{},l=n[e]&&"object"===typeof n[e]?n[e]:{};r.sections[e]={enabled:"boolean"===typeof l.enabled?l.enabled:!1!==t.enabled,mode:"string"===typeof l.mode&&l.mode?l.mode:t.mode,min:null!=l.min?Number(l.min):t.min,selectedFields:l.selectedFields&&"object"===typeof l.selectedFields?l.selectedFields:{}}}),r}(t),o=new Map(r.sections.map(e=>[e.id,e])),a=new Map;let s=0,u=0;r.sections.forEach(t=>{var o;const d=l.sections[t.id]||{};if(!1===d.enabled)return void a.set(t.id,{enabled:!1});const m=!0===t.requiresKademe,f=null===(o=r.context)||void 0===o?void 0:o.hasKademeSelection;if(m&&!f)return a.set(t.id,{enabled:!0,done:!1,doneUnits:0,totalUnits:1,missingReasons:["Kademeler secilmedi"]}),void(s+=1);const v=(Array.isArray(t.fields)?t.fields:[]).filter(e=>{var i;return!1!==(null===(i=d.selectedFields)||void 0===i?void 0:i[e])});if(0===v.length)return void a.set(t.id,{enabled:!0,done:!0,doneUnits:0,totalUnits:0,missingReasons:[]});const y=v.map(e=>r.fieldsById[e]).filter(Boolean).filter(t=>{if("function"!==typeof t.appliesIf)return!0;try{return!1!==t.appliesIf(e,i,n)}catch(r){return!0}}),p=[],g=[];y.forEach(t=>{let n=null;try{n=t.getValue?t.getValue(e,i):null}catch(l){n=null}const r=function(e,i){return"string"===i?(0,c.uI)(e):"boolean"===i?"boolean"===typeof e:(0,c.ac)(e)>0}(n,t.type);r?p.push(t):g.push(t)});const b=p.length,h=String(d.mode||t.modeDefault||"ALL").toUpperCase(),k=Number.isFinite(Number(d.min))?Number(d.min):t.minDefault;if("MIN"===h){const e=Math.max(1,Number.isFinite(k)?k:1),i=b>=e,n=Math.min(b,e);return a.set(t.id,{enabled:!0,done:i,doneUnits:n,totalUnits:e,missingReasons:i?[]:["En az ".concat(e," alan")]}),s+=e,void(u+=n)}const _=y.length;if(0===_)return void(!1===t.allowEmpty?(a.set(t.id,{enabled:!0,done:!1,doneUnits:0,totalUnits:1,missingReasons:[t.label||"Eksik"]}),s+=1):a.set(t.id,{enabled:!0,done:!0,doneUnits:0,totalUnits:0,missingReasons:[]}));const S=b===_,N=S?[]:g.map(e=>e.label).filter(Boolean);a.set(t.id,{enabled:!0,done:S,doneUnits:b,totalUnits:_,missingReasons:N}),s+=_,u+=b});const d=r.tabs.map(e=>{const i=(e.sectionIds||[]).map(e=>({id:e,result:a.get(e),def:o.get(e)})).filter(e=>e.result&&!1!==e.result.enabled);let t=0,n=0;const r=[];let l=!0;i.forEach(e=>{const i=e.result||{};i.done||(l=!1);const o=Number(i.totalUnits||0),a=Number(i.doneUnits||0);o>0&&(t+=o,n+=a),Array.isArray(i.missingReasons)&&i.missingReasons.length&&r.push(...i.missingReasons)});const s=t?Math.round(n/t*100):l?100:0,u=r.length?r.join(" / "):"";return{key:e.key,label:e.label,pct:s,done:l,missingPreview:u,missingLines:r}}),m=s?Math.round(u/s*100):100,f=d.filter(e=>!e.done).map(e=>{const i=e.missingPreview||"Eksik alanlar";return"".concat(e.label,": ").concat(i)});return{pct:m,completedCount:d.filter(e=>e.done).length,totalCount:d.length,tabs:d,missingDetailsLines:f}}var f=t(991),v=t(3204),y=t(5534),p=t(9322),g=t(579);function b(e){const i=[];if(!e)return i;const t=String(e).split(".");if(t.length>0&&"inputs"===t[0]&&t.shift(),0===t.length)return i;let n=t[0].replace(/([a-z0-9])([A-Z])/g,"$1_$2").toLowerCase();const r={grades_years:"grades_plan",grades_current:"grades_plan",grades:"grades_plan"};if(Object.prototype.hasOwnProperty.call(r,n)&&(n=r[n]),!n)return i;if(t.length>=2){const e=t[1].replace(/([a-z0-9])([A-Z])/g,"$1_$2").toLowerCase(),r={temel_bilgiler:{inflation:"inflation",ucret_artis_oranlari:"inflation",okul_ucretleri_hesaplama:"inflation",ik_mevcut:"ik_mevcut",burs_indirim_ogrenci_sayilari:"burs_ogr",burs_ogr:"burs_ogr",rakip_analizi:"rakip",rakip:"rakip",performans:"performans",degerlendirme:"performans",okul_egitim_bilgileri:"okul_egitim",yetkililer:null,kademeler:null,program_type:null},gelirler:{"*":"unit_fee"},giderler:{"*":"isletme"},ik:{"*":"local_staff"},discounts:{"*":"discounts"},norm:{"*":"ders_dagilimi"},grades_plan:{"*":"plan"},kapasite:{"*":"caps"}}[n];let l=null;if(l=r?Object.prototype.hasOwnProperty.call(r,e)?r[e]:Object.prototype.hasOwnProperty.call(r,"*")?r["*"]:e:e,l)return i.push("section.".concat(n,".").concat(l)),i}return i.push("page.".concat(n)),i}const h=new Set(["basics","kapasite","income","expenses","norm","hr","detailedReport","report"]),k={basics:"temel-bilgiler",kapasite:"kapasite",norm:"norm",hr:"ik",income:"gelirler",expenses:"giderler",detailedReport:"detayli-rapor",report:"rapor"},_=Object.fromEntries(Object.entries(k).map(e=>{let[i,t]=e;return[t,i]})),S={basics:"temel_bilgiler",kapasite:"kapasite",norm:"norm.ders_dagilimi",hr:"ik.local_staff",income:"gelirler.unit_fee",expenses:"giderler.isletme"};function N(e){const i=String(e||"").trim(),t=i.match(/(\d{4})\s*-\s*(\d{4})/);if(t){const e=Number(t[1]),i=Number(t[2]);if(Number.isFinite(e)&&Number.isFinite(i))return{startYear:e,endYear:i}}const n=i.match(/^(\d{4})$/);if(n){const e=Number(n[1]);if(Number.isFinite(e))return{startYear:e,endYear:e}}return{startYear:null,endYear:null}}function w(e){const i=Number(null===e||void 0===e?void 0:e.pct);return Number.isFinite(i)?i:0}function C(e,i){const t=[],n=new Set;return[e,i].forEach(e=>{Array.isArray(e)&&e.forEach(e=>{const i=String(e||"").trim();i&&!n.has(i)&&(n.add(i),t.push(i))})}),t.slice(0,15)}function j(e,i){if(!Array.isArray(e))return-1;const t=e.findIndex(e=>e&&"object"===typeof e&&"key"in e&&String(e.key)===i);if(-1!==t)return t;const n=e.findIndex(e=>e&&"object"===typeof e&&"name"in e&&String(e.name)===i);if(-1!==n)return n;const r=e.findIndex(e=>e&&"object"===typeof e&&"grade"in e&&String(e.grade)===i);if(-1!==r)return r;const l=Number(i);return Number.isInteger(l)&&String(l)===i&&l>=0&&l<e.length?l:-1}function x(){var e,i;const{id:t}=(0,l.g)(),c=(0,l.zy)(),x=(0,l.Zp)(),A=(0,l.KC)(),M=Number(t),[O,I]=(0,r.useState)(null),[E,F]=(0,r.useState)(""),[R,L]=(0,r.useState)(null);(0,r.useEffect)(()=>{const e="Feasibility Studio";document.title=null!==O&&void 0!==O&&O.name?"".concat(O.name," \xb7 ").concat(e):"School \xb7 ".concat(e)},[null===O||void 0===O?void 0:O.name]);const[H,Y]=(0,r.useState)(null),[B,z]=(0,r.useState)(null),[P,K]=(0,r.useState)(null),[D,T]=(0,r.useState)([]),[W,U]=(0,r.useState)(!1),[G,Z]=(0,r.useState)(!1),[$,V]=(0,r.useState)(!1),[q,J]=(0,r.useState)([]),[X,Q]=(0,r.useState)(()=>(0,y.Rj)(M)),[ee,ie]=(0,r.useState)(null),te=(0,r.useCallback)(async()=>{const e=null===H||void 0===H?void 0:H.id;if(!e||!M)return T([]),void U(!1);try{const i=await a.FH.listWorkItems(M,e);T(Array.isArray(null===i||void 0===i?void 0:i.workItems)?i.workItems:[]),U(!0)}catch(i){U(!0)}},[M,null===H||void 0===H?void 0:H.id]),ne=(0,r.useCallback)(async()=>{if(M){Z(!1);try{const e=await a.FH.listScenarios(M,{limit:50,offset:0,fields:"brief",order:"created_at:desc"}),i=Array.isArray(null===e||void 0===e?void 0:e.items)?e.items:[];J(i);const t=null!==X&&void 0!==X?X:null===H||void 0===H?void 0:H.id;if(null!=t){const e=i.find(e=>String(null===e||void 0===e?void 0:e.id)===String(t));e&&Y(i=>i?(0,n.A)((0,n.A)({},i),e):e)}Z(!0)}catch(e){Z(!1)}}},[M,X,null===H||void 0===H?void 0:H.id]),re=(0,r.useCallback)(async e=>{const i=null===H||void 0===H?void 0:H.id;if(i&&M&&e)try{await a.FH.submitWorkItem(M,i,e),await te(),await ne(),o.oR.success("Mod\xfcl g\xf6nderildi.")}catch(t){o.oR.error(t.message||"G\xf6nderme ba\u015far\u0131s\u0131z")}},[M,null===H||void 0===H?void 0:H.id,te,ne]);(0,r.useEffect)(()=>{if(null===H||void 0===H||!H.id)return T([]),U(!1),void Z(!1);U(!1),Z(!1),te()},[null===H||void 0===H?void 0:H.id,te]);const[le,oe]=(0,r.useState)(null),[ae,se]=(0,r.useState)(null),[ue,de]=(0,r.useState)(null),[ce,me]=(0,r.useState)(!1),[fe,ve]=(0,r.useState)(()=>new Set),[ye,pe]=(0,r.useState)(null),[ge,be]=(0,r.useState)(null),he=(0,r.useCallback)(e=>{ve(i=>{if(!i.size)return i;let t=!1;const n=new Set;for(const r of i)r.startsWith(e)?t=!0:n.add(r);return t?n:i})},[]),ke=(0,r.useCallback)(e=>{for(const i of fe)if(i===e||i.startsWith(e))return!0;return!1},[fe]),[_e,Se]=(0,r.useState)(null),[Ne,we]=(0,r.useState)(!1),[Ce,je]=(0,r.useState)(null),[xe,Ae]=(0,r.useState)(null),[Me,Oe]=(0,r.useState)(0),[Ie,Ee]=(0,r.useState)(!1),Fe=(0,r.useRef)(null),Re=(0,r.useRef)(null),[Le,He]=(0,r.useState)(!1),[Ye,Be]=(0,r.useState)(!0),[ze,Pe]=(0,r.useState)("Okul a\xe7iliyor...");(0,r.useEffect)(()=>{Q((0,y.Rj)(M))},[M]);const Ke=(0,r.useMemo)(()=>"school:".concat(M,":scenario:").concat(null!==X&&void 0!==X?X:"none"),[M,X]),[De,Te]=(0,f.zj)("report.currency","usd",{scope:Ke}),We=(0,r.useRef)(null),[Ue,Ge]=(0,f.zj)("report.mode","original",{scope:Ke}),[Ze,$e]=(0,r.useState)(!1),[Ve,qe]=(0,f.fH)("school.detailedReportMode","detailed",{scope:Ke}),Je=(0,r.useMemo)(()=>{const e="/schools/".concat(M,"/");return c.pathname.startsWith(e)&&c.pathname.slice(e.length).split("/")[0]||""},[c.pathname,M]),Xe=_[Je]||"",Qe=S[Xe]||null,ei=(0,r.useMemo)(()=>Qe&&Array.isArray(D)&&D.find(e=>String(null===e||void 0===e?void 0:e.work_id)===String(Qe))||null,[Qe,D]),ii=null!==ei&&void 0!==ei&&ei.state?String(ei.state):"not_started",ti=["submitted","approved"].includes(ii),ni=r.useCallback(e=>{const i=k[e];i&&x("/schools/".concat(M,"/").concat(i))},[x,M]);(0,r.useEffect)(()=>{_[Je]&&(0,y.BM)(M,X,Je)},[Je,M,X]),(0,r.useEffect)(()=>{_[Je]&&(0,y.dW)(Je)},[Je]),(0,r.useEffect)(()=>{const e="/schools/".concat(M);if(c.pathname!==e&&c.pathname!=="".concat(e,"/"))return;const i=(0,y.Wz)(M,X)||k.basics,t="".concat(e,"/").concat(i);x(t,{replace:!0})},[c.pathname,x,M,X]),(0,r.useEffect)(()=>{Be(!0),Pe("Okul a\xe7iliyor...")},[M]),(0,r.useEffect)(()=>{ee&&X&&String(X)===String(ee.scenarioId)&&(ni(ee.tab),ie(null))},[ee,X,ni]),(0,r.useEffect)(()=>{const e=setInterval(()=>Oe(Date.now()),3e4);return()=>clearInterval(e)},[]),(0,r.useEffect)(()=>{if(!Ie)return;const e=e=>{const i=Fe.current;i&&!i.contains(e.target)&&Ee(!1)},i=e=>{"Escape"===e.key&&Ee(!1)};return document.addEventListener("mousedown",e),document.addEventListener("keydown",i),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("keydown",i)}},[Ie]);const ri=N(null===H||void 0===H?void 0:H.academic_year).startYear,li="LOCAL"===(null===H||void 0===H?void 0:H.input_currency)?H.local_currency_code||"LOCAL":"USD",oi="LOCAL"===(null===H||void 0===H?void 0:H.input_currency),ai=Number((null===ue||void 0===ue||null===(e=ue.temelBilgiler)||void 0===e||null===(i=e.performans)||void 0===i?void 0:i.prevYearRealizedFxUsdToLocal)||0),si=oi&&!(Number.isFinite(ai)&&ai>0),ui=(0,r.useMemo)(()=>(0,p.ZG)(ue,H),[ue,H]),di=(0,r.useMemo)(()=>{var e,i;const t=null!==(e=null!==(i=null===O||void 0===O?void 0:O.country_id)&&void 0!==i?i:null===R||void 0===R?void 0:R.country_id)&&void 0!==e?e:null;return{schoolId:M,countryId:t}},[M,null===O||void 0===O?void 0:O.country_id,null===R||void 0===R?void 0:R.country_id]),ci=(0,r.useMemo)(()=>{try{return(0,u.$3)(R,"page.norm","read",di)}catch(e){return!1}},[R,di]),mi=(0,r.useMemo)(()=>{try{return!!(0,u.$3)(R,"section.giderler.isletme","write",di)||(0,u.$3)(R,"page.giderler","write",di)}catch(e){return!1}},[R,di]),fi=!le&&!ci,vi=(0,r.useMemo)(()=>m({inputs:ue,norm:le,config:ae,scenario:H}),[ue,le,ae,H]),yi=(0,r.useMemo)(()=>Object.fromEntries(((null===vi||void 0===vi?void 0:vi.tabs)||[]).map(e=>[e.key,e])),[vi]),pi=(0,r.useMemo)(()=>{const e=w(yi.gradesPlan),i=fi?e:w(yi.norm);return Math.round((e+i)/2)},[yi,fi]),gi=(0,r.useMemo)(()=>{const e=w(yi.giderler),i=w(yi.discounts);return Math.round((e+i)/2)},[yi]),bi=(0,r.useMemo)(()=>{var e,i;return C(null===(e=yi.gradesPlan)||void 0===e?void 0:e.missingLines,null===(i=yi.norm)||void 0===i?void 0:i.missingLines)},[yi]),hi=(0,r.useMemo)(()=>{var e,i;return C(null===(e=yi.giderler)||void 0===e?void 0:e.missingLines,null===(i=yi.discounts)||void 0===i?void 0:i.missingLines)},[yi]),ki=(0,r.useCallback)(async e=>{if(!X)return;const i=String(e||"original");$e(!0),F("");try{const e=await a.FH.getScenarioReport(M,X,i);Se((null===e||void 0===e?void 0:e.results)||null)}catch(t){F(t.message||"Report fetch failed")}finally{$e(!1)}},[M,X]),_i=(0,r.useCallback)(async e=>{const i=String(e||"original");i===Ue&&_e||(Ge(i),await ki(i))},[ki,Ue,_e,Ge]);(0,r.useEffect)(()=>{if(null!==A&&void 0!==A&&A.setHeaderMeta)return A.setHeaderMeta({title:null!==O&&void 0!==O&&O.name?O.name:"Okul",subtitle:H?"".concat(H.name).concat(H.academic_year?" \u2022 ".concat(H.academic_year):""):"Senaryo se\xe7in",hideDefault:!1,centered:!0}),()=>{var e;null===(e=A.clearHeaderMeta)||void 0===e||e.call(A)}},[A,H,null===O||void 0===O?void 0:O.name]);const Si=(0,r.useCallback)(e=>{var i,t,n;const r=e||{},l=r.ik||{},o=null!==l&&void 0!==l&&null!==(i=l.years)&&void 0!==i&&i.y1?l.years.y1:l,a=(null===o||void 0===o?void 0:o.unitCosts)||{},s=(null===o||void 0===o?void 0:o.headcountsByLevel)||{},u=["turk_mudur","turk_mdyard","turk_egitimci","turk_temsil","yerel_yonetici_egitimci","yerel_destek","yerel_ulke_temsil_destek","int_yonetici_egitimci"],d=["okulOncesi","ilkokulYerel","ilkokulInt","ortaokulYerel","ortaokulInt","liseYerel","liseInt"],c={};for(const b of u){let e=0;for(const i of d){var m;e+=Number((null===s||void 0===s||null===(m=s[i])||void 0===m?void 0:m[b])||0)}c[b]=Number((null===a||void 0===a?void 0:a[b])||0)*e}const f={turkPersonelMaas:(c.turk_mudur||0)+(c.turk_mdyard||0)+(c.turk_egitimci||0),turkDestekPersonelMaas:c.turk_temsil||0,yerelPersonelMaas:c.yerel_yonetici_egitimci||0,yerelDestekPersonelMaas:(c.yerel_destek||0)+(c.yerel_ulke_temsil_destek||0),internationalPersonelMaas:c.int_yonetici_egitimci||0},v=(null===r||void 0===r||null===(t=r.giderler)||void 0===t||null===(n=t.isletme)||void 0===n?void 0:n.items)||{},y=Object.keys(f);let p=!1;for(const b of y){const e=Number((null===v||void 0===v?void 0:v[b])||0),i=Number((null===f||void 0===f?void 0:f[b])||0);if(Math.abs(e-i)>1e-6){p=!0;break}}if(!p)return r;const g=structuredClone(r);g.giderler=g.giderler||{},g.giderler.isletme=g.giderler.isletme||{},g.giderler.isletme.items=g.giderler.isletme.items||{};for(const b of y)g.giderler.isletme.items[b]=Number(f[b]||0);return g},[]),Ni=(0,r.useCallback)(e=>{var i,t,r;const l=e=>{const i=Number(e);return Number.isFinite(i)?i:0},o=e||{},a=l(o.schoolCapacity),s=o.kapasite&&"object"===typeof o.kapasite?o.kapasite:{},u=s.years&&"object"===typeof s.years?s.years:{},d=l(null!=u.y1?u.y1:a),c=l(null!=u.y2?u.y2:d),m=l(null!=u.y3?u.y3:d),f=l(s.currentStudents),v=s.byKademe&&"object"===typeof s.byKademe?s.byKademe:{};if(!("schoolCapacity"in o||!o.kapasite||"object"!==typeof o.kapasite||!s.years||"object"!==typeof s.years||l(null===s||void 0===s||null===(i=s.years)||void 0===i?void 0:i.y1)!==d||l(null===s||void 0===s||null===(t=s.years)||void 0===t?void 0:t.y2)!==c||l(null===s||void 0===s||null===(r=s.years)||void 0===r?void 0:r.y3)!==m||l(null===s||void 0===s?void 0:s.currentStudents)!==f||!s.byKademe||"object"!==typeof s.byKademe))return o;const y=structuredClone(o);return y.kapasite=(0,n.A)((0,n.A)({},s||{}),{},{currentStudents:f,years:{y1:d,y2:c,y3:m},byKademe:v}),"schoolCapacity"in y&&delete y.schoolCapacity,y},[]),wi=(0,r.useCallback)(e=>{const i=e||{},t=(0,d.oP)().map(e=>({grade:e,branchCount:0,studentsPerBranch:0})),n=Array.isArray(i.grades)?i.grades:t,r=i.gradesYears&&"object"===typeof i.gradesYears?i.gradesYears:{},l=Array.isArray(r.y1)?r.y1:n,o=Array.isArray(r.y2)?r.y2:l,a=Array.isArray(r.y3)?r.y3:l,s=e=>{const i=new Map;return(Array.isArray(e)?e:[]).forEach(e=>{const t=(e=>{var i,t,n;return{grade:String(null!==(i=null===e||void 0===e?void 0:e.grade)&&void 0!==i?i:""),branchCount:Number(null!==(t=null===e||void 0===e?void 0:e.branchCount)&&void 0!==t?t:0),studentsPerBranch:Number(null!==(n=null===e||void 0===e?void 0:e.studentsPerBranch)&&void 0!==n?n:0)}})(e);t.grade&&i.set(t.grade,t)}),i};if(!(!i.gradesYears||!Array.isArray(i.grades)||!Array.isArray(r.y1)||!Array.isArray(r.y2)||!Array.isArray(r.y3)||!((e,i)=>{if(!Array.isArray(e)||!Array.isArray(i))return!1;const t=s(e),n=s(i);if(t.size!==n.size)return!1;for(const[r,l]of t.entries()){const e=n.get(r);if(!e)return!1;if(Number(l.branchCount)!==Number(e.branchCount))return!1;if(Number(l.studentsPerBranch)!==Number(e.studentsPerBranch))return!1}return!0})(i.grades,l)))return i;const u=structuredClone(i);return u.gradesYears={y1:structuredClone(l),y2:structuredClone(o),y3:structuredClone(a)},u.grades=structuredClone(u.gradesYears.y1),u},[]),Ci=(0,r.useCallback)(e=>{var i,t,r,l;const o=e&&"object"===typeof e?e:{},a=(null===o||void 0===o||null===(i=o.gradesYears)||void 0===i?void 0:i.y1)||(null===o||void 0===o?void 0:o.grades)||[],s=(0,d.qV)(a,null===o||void 0===o||null===(t=o.temelBilgiler)||void 0===t?void 0:t.kademeler),u=(0,p.ZG)(o),c={okulOncesi:Number(s.okulOncesi||0),ilkokulYerel:0,ilkokulInt:0,ortaokulYerel:0,ortaokulInt:0,liseYerel:0,liseInt:0};c[(0,p.Z4)("ilkokul",u)]=Number(s.ilkokul||0),c[(0,p.Z4)("ortaokul",u)]=Number(s.ortaokul||0),c[(0,p.Z4)("lise",u)]=Number(s.lise||0);const m=((e,i)=>{if(!Array.isArray(e))return{rows:e,changed:!1};let t=!1;const r=e.map(e=>{var r,l;const o=String(null!==(r=null===e||void 0===e?void 0:e.key)&&void 0!==r?r:""),a=i(o);if(null==a)return e;const s=Number(null!==(l=null===e||void 0===e?void 0:e.studentCount)&&void 0!==l?l:0);return Math.abs(s-a)<1e-6?e:(t=!0,(0,n.A)((0,n.A)({},e),{},{studentCount:a}))});return{rows:t?r:e,changed:t}})(null===o||void 0===o||null===(r=o.gelirler)||void 0===r||null===(l=r.tuition)||void 0===l?void 0:l.rows,e=>Object.prototype.hasOwnProperty.call(c,e)?c[e]:null);if(!m.changed)return o;const f=structuredClone(o);return f.gelirler=f.gelirler||{},m.changed&&(f.gelirler.tuition=f.gelirler.tuition||{},f.gelirler.tuition.rows=m.rows),f},[]);(0,r.useEffect)(()=>{let e=!0;return async function(){try{const i=await a.FH.getProgressRequirements();if(!e)return;se((null===i||void 0===i?void 0:i.config)||i||null)}catch(i){if(!e)return;se(null)}}(),()=>{e=!1}},[]),(0,r.useEffect)(()=>{!async function(){F(""),Be(!0),Pe("Okul a\xe7iliyor...");try{const i=await a.FH.getSchool(M);I(i);try{const e=await a.FH.getMe();L(e)}catch(e){}Pe("Senaryolar kontrol ediliyor...");const t=await a.FH.listScenarios(M,{limit:50,offset:0,fields:"brief",order:"created_at:desc"}),n=Array.isArray(null===t||void 0===t?void 0:t.items)?t.items:[];J(n),null!=X&&(n.some(e=>String(e.id)===String(X))||((0,y.sE)(M,null),Q(null))),Be(!1)}catch(i){F(i.message||"Failed to load school"),Be(!1)}}()},[M]),(0,r.useEffect)(()=>{!async function(){if(!X)return Y(null),de(null),pe(null),Se(null),z(null),K(null),oe(null),be(null),he("inputs."),void he("norm.");F(""),Se(null),je(null),Ae(null);try{var e;const i=await a.FH.getScenarioContext(M,X);Y((null===i||void 0===i?void 0:i.scenario)||null);const t=null===i||void 0===i?void 0:i.inputs,r=t&&"object"===typeof t?wi((e=>{const i=e||{},t=i.temelBilgiler&&"object"===typeof i.temelBilgiler?i.temelBilgiler:{},r=structuredClone(i),l=t.inflation&&"object"===typeof t.inflation?t.inflation:{},o=e=>Number.isFinite(Number(e))?Number(e):0;return r.temelBilgiler={inflation:(0,n.A)((0,n.A)({},l),{},{expenseDeviationPct:o(l.expenseDeviationPct),y2023:o(l.y2023),y2024:o(l.y2024),y2025:o(l.y2025),y1:o(l.y1),y2:o(l.y2),y3:o(l.y3),currentSeasonAvgFee:o(l.currentSeasonAvgFee)}),yetkililer:t.yetkililer||{mudur:"",ulkeTemsilcisi:"",raporuHazirlayan:""},okulEgitimBilgileri:t.okulEgitimBilgileri||{egitimBaslamaTarihi:"",zorunluEgitimDonemleri:"",birDersSuresiDakika:0,gunlukDersSaati:0,haftalikDersSaatiToplam:0,sabahciOglenci:"",ogretmenHaftalikDersOrt:0,gecisSinaviBilgisi:"",uygulananProgram:""},kademeler:(0,d.Ds)(t.kademeler),programType:(0,p.wN)(t.programType),okulUcretleriHesaplama:"boolean"!==typeof t.okulUcretleriHesaplama||t.okulUcretleriHesaplama,ucretArtisOranlari:t.ucretArtisOranlari||{okulOncesi:0,ilkokulYerel:0,ilkokulInt:0,ortaokulYerel:0,ortaokulInt:0,liseYerel:0,liseInt:0},ikMevcut:t.ikMevcut||{turkPersonelYoneticiEgitimci:0,turkPersonelTemsilcilik:0,yerelKadroluEgitimci:0,yerelUcretliVakaterEgitimci:0,yerelDestek:0,yerelTemsilcilik:0,international:0},bursIndirimOgrenciSayilari:t.bursIndirimOgrenciSayilari||{magisBasariBursu:0,maarifYetenekBursu:0,ihtiyacBursu:0,okulBasariBursu:0,tamEgitimBursu:0,barinmaBursu:0,turkceBasariBursu:0,uluslararasiYukumlulukIndirimi:0,vakifCalisaniIndirimi:0,kardesIndirimi:0,erkenKayitIndirimi:0,pesinOdemeIndirimi:0,kademeGecisIndirimi:0,temsilIndirimi:0,kurumIndirimi:0,istisnaiIndirim:0,yerelMevzuatIndirimi:0},rakipAnalizi:t.rakipAnalizi||{okulOncesi:{a:0,b:0,c:0},ilkokul:{a:0,b:0,c:0},ortaokul:{a:0,b:0,c:0},lise:{a:0,b:0,c:0}},performans:t.performans||{gerceklesen:{ogrenciSayisi:0,gelirler:0,giderler:0,karZarar:0,bursVeIndirimler:0}},degerlendirme:"string"===typeof t.degerlendirme?t.degerlendirme:""},r})(Ni(t))):t;de(r),pe(r&&"object"===typeof r?structuredClone(r):r),he("inputs.");const l=null!==(e=null===i||void 0===i?void 0:i.norm)&&void 0!==e?e:null;oe(l),be(l?structuredClone(l):null),he("norm.")}catch(i){F(i.message||"Failed to load scenario inputs")}}()},[M,X,he,Ni,wi]),(0,r.useEffect)(()=>{if(!X)return void(We.current=null);const e=null===H||void 0===H?void 0:H.id;if(!e||String(e)!==String(X))return;const i="LOCAL"===(null===H||void 0===H?void 0:H.input_currency)&&Number(null===H||void 0===H?void 0:H.fx_usd_to_local)>0&&(null===H||void 0===H?void 0:H.local_currency_code),t=String(e);if(We.current!==t)return Te(i?"local":"usd"),void(We.current=t);i||"usd"===De||Te("usd")},[X,null===H||void 0===H?void 0:H.id,null===H||void 0===H?void 0:H.input_currency,null===H||void 0===H?void 0:H.fx_usd_to_local,null===H||void 0===H?void 0:H.local_currency_code,De,Te]),(0,r.useEffect)(()=>{!async function(){try{z(null),K(null);const e=null===H||void 0===H?void 0:H.academic_year;if(!e||null===q||void 0===q||!q.length)return;const{startYear:i,endYear:t}=N(e);if(!i)return;const n=i-1,r=(null!==t&&void 0!==t?t:i)-1,l=q.find(e=>{const i=N(null===e||void 0===e?void 0:e.academic_year);return i.startYear===n&&i.endYear===r});if(!l)return;K(l);const o=await a.FH.calculateScenario(M,l.id);z((null===o||void 0===o?void 0:o.results)||null)}catch(e){z(null)}}()},[M,null===H||void 0===H?void 0:H.academic_year,q]);const ji=function(e){const i=String((null===e||void 0===e?void 0:e.status)||"draft"),t=null!=(null===e||void 0===e?void 0:e.submitted_at),n=null!=(null===e||void 0===e?void 0:e.sent_at);return"sent_for_approval"===i||"submitted"===i||"approved"===i&&n||"in_review"===i&&t}(H),xi=ji||ti,Ai=(0,r.useCallback)(async()=>{if(!le||!X)return;const e=null!==le&&void 0!==le&&le.years?{years:le.years}:{teacherWeeklyMaxHours:le.teacherWeeklyMaxHours,curriculumWeeklyHours:le.curriculumWeeklyHours};await a.FH.saveNormConfig(M,X,e);const i=await a.FH.getNormConfig(M,X);oe(i),be(i?structuredClone(i):null),he("norm.")},[le,X,M,he]),Mi=(0,r.useCallback)(async()=>{if(!X||!ue)return!1;if(xi)return F(ji?"Senaryo kilitli. Inceleme bekleniyor.":"Modul kilitli. Inceleme bekleniyor."),!1;const e=ke("inputs."),i=ke("norm.");if(!e&&!i)return!0;me(!0),F("");try{if(e){let e=Si(ue);e=Ni(e),e=wi(e),e=Ci(e),e!==ue&&de(e);const i=new Set,t=[];for(const r of fe){const e=String(r||"");if(e.startsWith("inputs.")){t.push(e);for(const t of b(e))i.add(t)}}const n=Array.from(i);await a.FH.saveScenarioInputs(M,X,e,n,t),pe(e&&"object"===typeof e?structuredClone(e):e),he("inputs.")}return i&&await Ai(),je(Date.now()),!0}catch(t){const n=e&&i?"Save failed":i?"Save norm failed":"Save inputs failed";return F(t.message||n),!1}finally{me(!1)}},[Si,Ci,Ni,wi,X,ue,xi,ji,ke,fe,M,he,Ai]);function Oi(e){const i=Array.isArray(e)?e:[];let t=0;for(const r of i){var n;const e=Number(null!==(n=null===r||void 0===r?void 0:r.studentsPerBranch)&&void 0!==n?n:0);Number.isFinite(e)&&(t+=e)}return t}function Ii(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"blocking-toast";o.oR.warn(e,{toastId:i,position:"bottom-right",autoClose:!1,closeOnClick:!1,draggable:!0,icon:"??",style:{background:"rgba(15, 23, 42, 0.96)",color:"#f8fafc",border:"1px solid rgba(251, 191, 36, 0.35)",boxShadow:"0 18px 40px rgba(0,0,0,.28)",borderRadius:14}})}function Ei(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Islem";if(!ue)return!0;const i=function(e){const i=e&&"object"===typeof e?e:{},t=i.gradesYears&&"object"===typeof i.gradesYears?i.gradesYears:{};return{y1:Oi(Array.isArray(t.y1)?t.y1:i.grades),y2:Oi(t.y2),y3:Oi(t.y3)}}(ue),t=[];if(i.y2>0||t.push("Y2"),i.y3>0||t.push("Y3"),!t.length)return!0;const n="".concat(e," yapilamaz: Norm > Planlanan Donem Bilgileri bolumunde ")+"".concat(t.join(" ve ")," toplam ogrenci 0 gorunuyor. Lutfen Y2/Y3 ogrenci sayilarini girin.");return F(""),Ii(n,"norm-y2y3-missing"),"norm"!==Xe&&ni("norm"),!1}function Fi(){if(!ue)return!0;if(!oi)return!0;if(!si)return!0;const e="".concat(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Islem"," yapilamaz: Temel Bilgiler > Performans alanindaki ")+'"Onceki Donem Ortalama Kur (Gerceklesen)" girilmelidir.';return F(""),Ii(e,"prev-realized-fx-missing"),"basics"!==Xe&&ni("basics"),!1}async function Ri(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!X)return!1;if(!Fi("Hesaplama"))return!1;if(!e.skipPlanValidation&&!Ei("Hesaplama"))return!1;we(!0),F("");let i=!1;try{const t=await a.FH.calculateScenario(M,X);"distributed"===Ue?await ki("distributed"):Se(t.results),e.keepTab||ni("report"),Ae(Date.now()),"undefined"!==typeof window&&console.log("[kpi] calculate ok",{scenarioId:X,hasResults:Boolean(null===t||void 0===t?void 0:t.results)}),i=!0}catch(t){F(t.message||"Calculation failed"),"undefined"!==typeof window&&console.log("[kpi] calculate failed",{scenarioId:X,error:(null===t||void 0===t?void 0:t.message)||t})}finally{we(!1)}return i}function Li(e,i){return null==e&&null==i||("number"===typeof e||"number"===typeof i?Number(e)===Number(i):"boolean"===typeof e||"boolean"===typeof i?Boolean(e)===Boolean(i):Object.is(e,i))}function Hi(e,i){let t=e;for(const n of i){if(null==t)return;if(Array.isArray(t)){const e=t.find(e=>e&&"object"===typeof e&&"key"in e&&String(e.key)===n);if(e){t=e;continue}const i=t.find(e=>e&&"object"===typeof e&&"name"in e&&String(e.name)===n);if(i){t=i;continue}const r=t.find(e=>e&&"object"===typeof e&&"grade"in e&&String(e.grade)===n);if(r){t=r;continue}const l=Number(n);if(Number.isInteger(l)&&String(l)===n){t=t[l];continue}return}if("object"!==typeof t)return;t=t[n]}return t}const Yi=(0,r.useCallback)(e=>{if(!e)return;const i=e.split(".");if(i.length){if("inputs"===i[0]){const e=Hi(ye,i.slice(1));if(void 0!==e)return e;const t=i[i.length-1];if(t.endsWith("Y2")||t.endsWith("Y3")){const e=t.endsWith("Y2")?"Y2":"Y3",n=t.slice(0,-2),r=Hi(ye,i.slice(1,-1).concat(n));if(void 0!==r){if("unitCost"===n||n.startsWith("unitCost")){const i=Hi(ye,["temelBilgiler","inflation"])||{},t=1+Number((null===i||void 0===i?void 0:i.y2)||0),n=t*(1+Number((null===i||void 0===i?void 0:i.y3)||0));return"Y2"===e?Number(r)*t:Number(r)*n}return r}}if(("studentCountY2"===t||"studentCountY3"===t)&&ye){const e=Hi(ye,i.slice(1,-1));if(e&&"object"===typeof e){const i=e.studentCount;if(null!=i)return i}}const n=i.indexOf("years");if(n>=0&&i.length>n+1&&ye){const e=i[n+1];if("y2"===e||"y3"===e){const t=[...i];t[n+1]="y1";const r=Hi(ye,t.slice(1));if(void 0!==r){if(i.includes("ik")&&i.includes("unitCosts")){const i=Hi(ye,["ik","unitCostRatio"]),t=Number(i);if(Number.isFinite(t)){const i=Number(r),n="y2"===e?t:t*t;return Number.isFinite(i)?i*n:void 0}}return r}}}if("ik.years"===i.slice(1,3).join(".")&&ye){if(i.includes("unitCostRatio")){const e=Hi(ye,["ik","unitCostRatio"]);return void 0!==e?e:1}if(["unitCosts","headcountsByLevel"].some(e=>i.includes(e)))return 0}if(("y1"===t||"y2"===t||"y3"===t)&&ye){const e=Hi(ye,i.slice(1,-1));if(e&&"object"===typeof e&&null!=e.y1)return e.y1;const t=i.indexOf("byKademe");if(t>=1&&i.length>t+1){const e=i[t+1],n=Hi(ye,["kapasite","byKademe",e,"caps","y1"]);if(void 0!==n)return n}const n=Hi(ye,["kapasite","years","y1"]);if(void 0!==n)return n}if("cur"===t&&ye){const e=i.indexOf("byKademe");if(e>=1&&i.length>e+1){const t=i[e+1],n=Hi(ye,["kapasite","byKademe",t,"caps","cur"]);if(void 0!==n)return n}const t=Hi(ye,["kapasite","currentStudents"]);if(void 0!==t)return t}return}return"norm"===i[0]?Hi(ge,i.slice(1)):void 0}},[ye,ge]),Bi=ke("inputs.")||ke("norm."),zi=(0,r.useCallback)(async()=>{if(Qe){if(Bi){if(!await Mi())return}await re(Qe)}},[Qe,Bi,Mi,re]),Pi=(0,r.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"approve";if(Qe&&null!==H&&void 0!==H&&H.id&&!$){V(!0);try{await a.FH.reviewWorkItem(M,H.id,Qe,{action:e}),o.oR.success("approve"===e?"Onayland\u0131":"Revize istendi"),await te(),await ne()}catch(i){o.oR.error((null===i||void 0===i?void 0:i.message)||"\u0130\u015flem ba\u015far\u0131s\u0131z")}finally{V(!1)}}},[Qe,null===H||void 0===H?void 0:H.id,$,M,te,ne]),Ki=String((null===R||void 0===R?void 0:R.role)||""),Di=Bi&&!(Qe&&"submitted"===ii&&Ki&&!("accountant"===Ki)),Ti="submitted"===ii?"Modul incelemede":"approved"===ii?"Modul onaylandi":"Modul kilitli",Wi=ji?"Senaryo kilitli":ti?Ti:"",Ui=Qe&&!ji&&["not_started","in_progress","needs_revision"].includes(ii),Gi=(0,r.useCallback)((e,i)=>{if(!e)return;if(xi&&(e.startsWith("inputs.")||e.startsWith("norm.")))return;e.startsWith("inputs.")&&de(t=>{if(!t)return t;const n=e.split(".");if(Li(Hi(t,n.slice(1)),i))return t;const r=structuredClone(t),l=function(e,i,t){if(!e||!Array.isArray(i)||!i.length)return!1;let n=e;for(let l=0;l<i.length-1;l++){const e=i[l];if(null==n)return!1;if(Array.isArray(n)){const i=j(n,e);if(i<0)return!1;null!=n[i]&&"object"===typeof n[i]||(n[i]={}),n=n[i];continue}if("object"!==typeof n)return!1;null!=n[e]&&"object"===typeof n[e]||(n[e]={}),n=n[e]}const r=i[i.length-1];if(Array.isArray(n)){const e=j(n,r);return!(e<0)&&(n[e]=t,!0)}return null!=n&&"object"===typeof n&&(n[r]=t,!0)}(r,n.slice(1),i);return l?r:t});const t=Yi(e),n=Li(i,t);ve(i=>{const t=new Set(i);return n?t.delete(e):t.add(e),function(e,i){if(e===i)return!0;if(e.size!==i.size)return!1;for(const t of e)if(!i.has(t))return!1;return!0}(i,t)?i:t})},[xi,Yi,de]);(0,r.useEffect)(()=>{const e=e=>{Di&&(e.preventDefault(),e.returnValue="")};return Di&&window.addEventListener("beforeunload",e),()=>{window.removeEventListener("beforeunload",e)}},[Di]),(0,r.useEffect)(()=>{try{window.__fsUnsavedChanges=Di}catch(e){}return()=>{try{window.__fsUnsavedChanges=!1}catch(e){}}},[Di]);const Zi=r.useCallback(e=>{if(xi)return;const i=(null===e||void 0===e?void 0:e.y1)||{},t=["turkPersonelMaas","turkDestekPersonelMaas","yerelPersonelMaas","yerelDestekPersonelMaas","internationalPersonelMaas"];de(e=>{var n,r;const l=e||{},o=(null===l||void 0===l||null===(n=l.giderler)||void 0===n||null===(r=n.isletme)||void 0===r?void 0:r.items)||{};let a=!1;for(const u of t){const e=Number((null===o||void 0===o?void 0:o[u])||0),t=Number((null===i||void 0===i?void 0:i[u])||0);if(Math.abs(e-t)>1e-6){a=!0;break}}if(!a)return e;const s=structuredClone(l);s.giderler=s.giderler||{},s.giderler.isletme=s.giderler.isletme||{},s.giderler.isletme.items=s.giderler.isletme.items||{};for(const u of t)s.giderler.isletme.items[u]=Number((null===i||void 0===i?void 0:i[u])||0);if(mi)for(const u of t)Gi("inputs.giderler.isletme.items.".concat(u),Number((null===i||void 0===i?void 0:i[u])||0));return s})},[xi,Gi,mi]),$i=r.useCallback(e=>{xi||e&&"object"===typeof e&&de(i=>{let t=structuredClone(i||{});return t.gradesYears=e,Array.isArray(e.y1)&&(t.grades=structuredClone(e.y1)),t=Ci(t),t})},[Ci,xi]),Vi=(0,r.useCallback)(e=>{xi||oe(i=>"function"===typeof e?e(i):e)},[xi,oe]),qi=h.has(Xe),Ji=ce||Ne||Le||!_e,Xi=e=>{if(!e)return"";const i=Math.max(0,(Me||Date.now())-e);return i<6e4?"az once":i<36e5?"".concat(Math.floor(i/6e4)," dk once"):"".concat(Math.floor(i/36e5)," saat once")};function Qi(e){switch(e){case"Revize istendi":return"is-bad";case"Merkeze iletildi":case"\u0130ncelemede":case"Haz\u0131rlan\u0131yor":return"is-warn";case"Kontrol edildi":case"Onayland\u0131":return"is-ok";default:return"is-muted"}}(0,r.useEffect)(()=>{Ji&&Ee(!1)},[Ji]);const et={schoolId:M,school:O,me:R,inputs:ue,setField:function(e,i){if(xi)return;const t=structuredClone(ue||{}),n=e.split(".");let r=t;for(let l=0;l<n.length-1;l++)r[n[l]]=r[n[l]]||{},r=r[n[l]];r[n[n.length-1]]=i,de(t)},norm:le,setNorm:Vi,handlePlanningGradesChange:$i,dirtyPaths:fe,markDirty:Gi,baseYear:ri,programType:ui,inputCurrencyCode:li,selectedScenario:H,prevReport:B,prevScenarioMeta:P,report:_e,reportCurrency:De,setReportCurrency:Te,reportMode:Ue,reportModeLoading:Ze,handleReportModeChange:_i,detailedReportMode:Ve,setDetailedReportMode:qe,reportExportRef:Re,progMap:yi,normAvgPct:pi,expensesAvgPct:gi,normMissingLines:bi,expensesMissingLines:hi,uiScopeKey:Ke,handleIkSalaryComputed:Zi,workItems:D,refreshWorkItems:te,submitWorkItem:re};return(0,g.jsxs)("div",{className:"container school-page",children:[(0,g.jsx)(o.N9,{position:"bottom-right",autoClose:3500,newestOnTop:!0,closeOnClick:!0,pauseOnFocusLoss:!0,pauseOnHover:!0,hideProgressBar:!0,theme:"dark"}),(0,g.jsx)("style",{children:"@keyframes schoolSpin{to{transform:rotate(360deg)}}"}),Ye?(0,g.jsx)("div",{className:"modal-backdrop",role:"status","aria-live":"polite","aria-busy":"true",children:(0,g.jsxs)("div",{className:"card",style:{width:"min(420px, 92vw)",padding:"18px 16px",textAlign:"center"},children:[(0,g.jsx)("div",{"aria-hidden":!0,style:{width:36,height:36,margin:"0 auto",borderRadius:"50%",border:"3px solid rgba(0,0,0,.15)",borderTopColor:"rgba(0,0,0,.75)",animation:"schoolSpin .8s linear infinite"}}),(0,g.jsx)("div",{style:{fontWeight:800,marginTop:12},children:ze||"Yukleniyor..."}),(0,g.jsx)("div",{className:"small muted",style:{marginTop:6},children:"Lutfen bekleyin..."})]})}):null,E?(0,g.jsx)("div",{className:"card",style:{marginTop:10,background:"#fff1f2",borderColor:"#fecaca"},children:E}):null,X?(0,g.jsx)(l.sv,{context:et}):(0,g.jsxs)("div",{className:"card",style:{marginTop:12},children:[(0,g.jsx)("div",{style:{fontWeight:700},children:"Okul & Senaryo Sec"}),(0,g.jsx)("div",{className:"small",style:{marginTop:6},children:"Bu bolumu acmak icin once okul ve senaryo secin."}),(0,g.jsx)("button",{type:"button",className:"btn primary",style:{marginTop:12},onClick:()=>x("/select?schoolId=".concat(M)),children:"Okul & Senaryo Sec"})]}),function(){var e,i,t,n,r,l,d,c,m,f,y,p;if(!qi)return null;const b={temel:"temel_bilgiler",kapasite:"kapasite",norm:"norm.ders_dagilimi",ik:"ik.local_staff",gelir:"gelirler.unit_fee",gider:"giderler.isletme"},h=[];yi&&yi.temelBilgiler&&h.push({key:"temel",label:"Temel",labelShort:"Temel",pct:w(yi.temelBilgiler),done:!0===yi.temelBilgiler.done}),yi&&yi.kapasite&&h.push({key:"kapasite",label:"Kapasite",labelShort:"Kap",pct:w(yi.kapasite),done:!0===yi.kapasite.done});const k=fi?!0===(null===yi||void 0===yi||null===(e=yi.gradesPlan)||void 0===e?void 0:e.done)||void 0===(null===yi||void 0===yi||null===(i=yi.gradesPlan)||void 0===i?void 0:i.done):(!0===(null===yi||void 0===yi||null===(t=yi.gradesPlan)||void 0===t?void 0:t.done)||void 0===(null===yi||void 0===yi||null===(n=yi.gradesPlan)||void 0===n?void 0:n.done))&&(!0===(null===yi||void 0===yi||null===(r=yi.norm)||void 0===r?void 0:r.done)||void 0===(null===yi||void 0===yi||null===(l=yi.norm)||void 0===l?void 0:l.done));h.push({key:"norm",label:"Norm",labelShort:"Norm",pct:Number.isFinite(pi)?pi:0,done:k}),yi&&yi.ik&&h.push({key:"ik",label:"\u0130K",labelShort:"\u0130K",pct:w(yi.ik),done:!0===yi.ik.done}),yi&&yi.gelirler&&h.push({key:"gelir",label:"Gelir",labelShort:"Gel",pct:w(yi.gelirler),done:!0===yi.gelirler.done});const _=(!0===(null===yi||void 0===yi||null===(d=yi.giderler)||void 0===d?void 0:d.done)||void 0===(null===yi||void 0===yi||null===(c=yi.giderler)||void 0===c?void 0:c.done))&&(!0===(null===yi||void 0===yi||null===(m=yi.discounts)||void 0===m?void 0:m.done)||void 0===(null===yi||void 0===yi||null===(f=yi.discounts)||void 0===f?void 0:f.done));h.push({key:"gider",label:"Gider",labelShort:"Gid",pct:Number.isFinite(gi)?gi:0,done:_});const S=h.every(e=>e.done),N=null===H||void 0===H?void 0:H.progress_pct,C=H?function(e,i){if(!e)return null;const t=String(e.status||"draft");if("draft"===t){const e=Number(i);return Number.isFinite(e)&&e>0?"Haz\u0131rlan\u0131yor":"Taslak"}return"in_review"===t?"\u0130ncelemede":"revision_requested"===t?"Revize istendi":"sent_for_approval"===t||"submitted"===t?"Merkeze iletildi":"approved"===t?e.sent_at?"Onayland\u0131":"Kontrol edildi":"Taslak"}(H,N):null,j=C&&["\u0130ncelemede","Revize istendi","Merkeze iletildi","Kontrol edildi","Onayland\u0131"].includes(C)?C:null,x=j?Qi(j):null,A=W&&Qe?function(e){switch(String(e||"not_started")){case"approved":return"Kontrol edildi";case"needs_revision":return"Revize istendi";case"submitted":return"\u0130ncelemede";case"in_progress":return"Haz\u0131rlan\u0131yor";default:return"Taslak"}}(ii):null,I=A?Qi(A):null,E=Boolean(Qe&&A);let L=null;if("Kontrol edildi"===j&&null!==H&&void 0!==H&&H.checked_at){const e=new Date(H.checked_at);L="Kontrol: ".concat(Number.isFinite(e.getTime())?e.toLocaleString():"")}else if("Merkeze iletildi"===j&&null!==H&&void 0!==H&&H.sent_at){const e=new Date(H.sent_at);L="\u0130letildi: ".concat(Number.isFinite(e.getTime())?e.toLocaleString():"")}else if("Onayland\u0131"===j&&null!==H&&void 0!==H&&H.reviewed_at){const e=new Date(H.reviewed_at);L="Onay: ".concat(Number.isFinite(e.getTime())?e.toLocaleString():"")}let Y=null,B=null;const z="Merkeze iletildi"===j||"Onayland\u0131"===j,P=z||!Qe||W&&G,K=P?j:null,T=P?x:null,U=P?L:null;if(z&&K)Y={label:K,className:T,tooltip:U};else if(E){Y={label:A,className:I};K&&K!==A&&!("Revize istendi"===K&&"needs_revision"!==ii||"Kontrol edildi"===K&&"needs_revision"===ii||"\u0130ncelemede"===K&&"approved"===ii)&&(B={label:K,className:T,tooltip:U})}else K?(Y={label:K,className:T,tooltip:U},A&&A!==K&&(B={label:A,className:I})):A&&(Y={label:A,className:I});const Z=[];Ce&&Z.push("Kaydedildi ".concat(Xi(Ce))),xe&&Z.push("Hesapland\u0131 ".concat(Xi(xe)));let V=!1;try{var q,J;V="1"===(null===(q=window)||void 0===q||null===(J=q.localStorage)||void 0===J?void 0:J.getItem("fs_debug_kpi"))}catch(We){V=!1}if(V){const e=["calc:".concat(Ne?"1":"0"),"lastCalc:".concat(xe?new Date(xe).toLocaleTimeString():"none"),"report:".concat(_e?"yes":"no")];Z.push("DEBUG ".concat(e.join(" \u2022 ")))}const Q=Z.join(" \u2022 "),ee=Boolean(Q),ie=String((null===R||void 0===R?void 0:R.role)||""),re=null!==(y=null!==(p=null===O||void 0===O?void 0:O.country_id)&&void 0!==p?p:null===R||void 0===R?void 0:R.country_id)&&void 0!==y?y:null,le={schoolId:M,countryId:re},oe=null===H||void 0===H?void 0:H.status,ae=H&&H.id,se=(e,i)=>{try{return(0,u.$3)(R,e,i,le)}catch(t){return!1}},de={temel:"basics",kapasite:"kapasite",norm:"norm",ik:"hr",gelir:"income",gider:"expenses"},me={temel:"temel_bilgiler",kapasite:"kapasite",norm:"norm",ik:"ik",gelir:"gelirler",gider:"giderler"},fe={temel_bilgiler:"temel",kapasite:"kapasite","norm.ders_dagilimi":"norm","ik.local_staff":"ik","gelirler.unit_fee":"gelir","giderler.isletme":"gider"}[String(Qe||"")]||null,ve=h.find(e=>e.key===fe),ye=!!ve&&!0===ve.done,pe=ae&&["draft","in_review","revision_requested"].includes(oe)&&("principal"===ie||"hr"===ie||"manager"===ie||"accountant"===ie),ge=(Qe&&{temel_bilgiler:["page.temel_bilgiler"],kapasite:["section.kapasite.caps","page.kapasite"],"norm.ders_dagilimi":["section.norm.ders_dagilimi","page.norm"],"ik.local_staff":["section.ik.local_staff","page.ik"],"gelirler.unit_fee":["section.gelirler.unit_fee","page.gelirler"],"giderler.isletme":["section.giderler.isletme","page.giderler"]}[String(Qe)]||[]).some(e=>{try{return se(e,"write")}catch(i){return!1}}),be=ae&&("accountant"===ie||"manager"===ie||se("scenario.forward","write"))&&"approved"===oe&&!(null!==H&&void 0!==H&&H.sent_at)&&(null===H||void 0===H?void 0:H.checked_at),he=ae&&("admin"===ie||se("admin.scenario.review","write"))&&"sent_for_approval"===oe,ke=ae&&Qe&&"submitted"===ii&&("admin"===ie||"manager"===ie||"accountant"===ie||se("page.manage_permissions","read")||se("page.manage_permissions","write")),Se=$||ce||Ne||Bi;let we="Mod\xfcl\xfc onayla";Bi?we="\xd6nce de\u011fi\u015fiklikleri kaydedin.":ce?we="Kaydetme devam ediyor.":Ne?we="Hesaplama devam ediyor.":$&&(we="Onaylan\u0131yor...");const je=["page.temel_bilgiler","page.kapasite","page.norm","page.ik","page.gelirler","page.giderler"].every(e=>{try{return(0,u.$3)(R,e,"write",le)}catch(i){return!1}}),Ae=[];let Me=!0,Oe="",Re=null,Ye=null;if(he)Oe="Onayla",Re=(0,g.jsx)(v.A7C,{"aria-hidden":"true"}),Me=!1,ce&&(Me=!0,Ae.push("Kaydetme devam ediyor.")),Ne&&(Me=!0,Ae.push("Hesaplama devam ediyor.")),Me||(Ye=async()=>{try{await a.FH.adminReviewScenario(H.id,{action:"approve"}),o.oR.success("Onayland\u0131"),await te(),await ne()}catch(e){o.oR.error((null===e||void 0===e?void 0:e.message)||"Onay ba\u015far\u0131s\u0131z")}});else if(be){if(Oe="Merkeze ilet",Re=(0,g.jsx)(v.Cer,{"aria-hidden":"true"}),Me=!1,!S){Me=!0;const e=h.filter(e=>!e.done);Ae.push("T\xfcm mod\xfcller tamamlanmal\u0131: "+e.map(e=>"".concat(e.label," ").concat(e.pct,"%")).join(", "))}Bi&&(Me=!0,Ae.push("\xd6nce de\u011fi\u015fiklikleri kaydedin.")),ce&&(Me=!0,Ae.push("Kaydetme devam ediyor.")),Ne&&(Me=!0,Ae.push("Hesaplama devam ediyor.")),ji&&(Me=!0,Ae.push("Senaryo kilitli.")),Me||(Ye=async()=>{try{if(!Fi("Hesaplama"))return;if(!Ei("Hesaplama"))return;if(Bi){if(!await Mi())return}if(!await Ri({keepTab:!0}))return;await a.FH.sendForApproval(M,H.id),o.oR.success("Merkeze iletildi"),await te(),await ne()}catch(e){o.oR.error((null===e||void 0===e?void 0:e.message)||"\u0130letme ba\u015far\u0131s\u0131z")}})}else pe&&(Oe="G\xf6nder",Re=(0,g.jsx)(v.Cer,{"aria-hidden":"true"}),Me=!1,Qe||(Me=!0,Ae.push("G\xf6nderilecek bir mod\xfcl yok.")),Qe&&!ge&&(Me=!0,Ae.push("Bu mod\xfcl\xfc g\xf6nderme yetkiniz yok.")),Qe&&!Ui&&(Me=!0,Ae.push(Ti||"Mod\xfcl g\xf6nderilemez")),ye||(Me=!0,Ae.push("Bu mod\xfcl tamamlanmal\u0131.")),Bi&&(Me=!0,Ae.push("\xd6nce de\u011fi\u015fiklikleri kaydedin.")),ce&&(Me=!0,Ae.push("Kaydetme devam ediyor.")),Ne&&(Me=!0,Ae.push("Hesaplama devam ediyor.")),ji&&(Me=!0,Ae.push("Senaryo kilitli.")),!Me&&Qe&&ge&&Ui&&ye&&(Ye=async()=>{await zi()}));const Be=Ae.length>0?Ae.join(" \u2022 "):void 0,ze=Boolean(_e),Pe=Bi?"Kaydet & Hesapla":ze?"Yeniden Hesapla":"Hesapla",Ke=Le?"PDF hazirlaniyor...":"Disa Aktar",Te="report"===Xe||ze;return(0,g.jsx)("div",{className:"school-sticky-footer",role:"region","aria-label":"Scenario actions",children:(0,g.jsxs)("div",{className:"school-sticky-footer-inner",children:[(0,g.jsxs)("div",{className:"school-footer-left",children:[(0,g.jsxs)("div",{className:"school-footer-pills",role:"status","aria-live":"polite",children:[Y?(0,g.jsx)("span",{className:"school-pill ".concat(Y.className),title:Y.tooltip,children:Y.label}):null,B?(0,g.jsx)("span",{className:"school-pill ".concat(B.className),title:B.tooltip,children:B.label}):null,ue?(0,g.jsx)("span",{className:"school-pill is-warn ".concat(Bi?"":"is-placeholder"),title:Bi?"Kaydedilmemi\u015f de\u011fi\u015fiklikler var":void 0,"aria-hidden":Bi?void 0:"true",children:"\u25cf De\u011fi\u015fiklik var"}):null]}),ue?(0,g.jsx)("div",{className:"school-footer-meta small ".concat(ee?"":"is-placeholder"),title:ee?Q:void 0,"aria-hidden":ee?void 0:"true",children:ee?Q:"Kaydedildi"}):null]}),ue?(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("div",{className:"school-footer-middle",children:(0,g.jsx)("div",{className:"module-progress",role:"progressbar","aria-valuemin":"0","aria-valuemax":"100",children:h.map(e=>{const i=de[e.key],t=Boolean(i&&(e=>{const i=me[e];if(!i)return!1;if(se("page.".concat(i),"read"))return!0;const t=Array.isArray(null===R||void 0===R?void 0:R.permissions)?R.permissions:[],n=le.countryId;return t.some(e=>{if("read"!==e.action&&"write"!==e.action)return!1;if(!String(e.resource||"").startsWith("section.".concat(i,".")))return!1;const t=null!=e.scope_country_id?Number(e.scope_country_id):null,r=null!=e.scope_school_id?Number(e.scope_school_id):null;return(null==t||null==n||Number(t)===Number(n))&&(null==r||null==M||Number(r)===Number(M))&&(null==r||null!=M)&&(null==t||null!=n)})})(e.key)),n=fe===e.key,r=function(e,i,t){if("approved"===i&&t)return"is-final";if(["sent_for_approval","submitted"].includes(String(i||"")))return"is-forwarded";switch(String(e||"not_started")){case"needs_revision":return"is-revision";case"approved":return"is-approved";case"submitted":return"is-review";default:return"is-draft"}}((e=>{if(!e)return"not_started";if(!W)return"not_started";const i=b[e];if(!i)return"not_started";const t=Array.isArray(D)?D.find(e=>String(null===e||void 0===e?void 0:e.work_id)===String(i)):null;return null!==t&&void 0!==t&&t.state?String(t.state):"not_started"})(e.key),null===H||void 0===H?void 0:H.status,null===H||void 0===H?void 0:H.sent_at),l=t?"button":"div";return(0,g.jsxs)(l,{type:t?"button":void 0,onClick:t?()=>ni(i):void 0,className:"module-seg ".concat(t?"is-clickable":""," ").concat(n?"is-active":""),title:"".concat(e.label,": ").concat(Math.round(e.pct),"% ").concat(e.done?"Tamamland\u0131":"Eksik"),"aria-disabled":t?void 0:"true",children:[(0,g.jsx)("div",{className:"module-title",children:e.labelShort}),(0,g.jsxs)("div",{className:"module-bar",children:[(0,g.jsx)("div",{className:"module-fill ".concat(r),style:{width:"".concat(Math.min(100,Math.max(0,Math.round(e.pct))),"%")}}),(0,g.jsxs)("span",{className:"module-percent",children:[Math.round(e.pct),"%"]})]})]},e.key)})})}),(0,g.jsxs)("div",{className:"school-footer-right",children:[ke?(0,g.jsx)(s.A,{lines:we?[we]:[],children:(0,g.jsxs)("button",{type:"button",className:"topbar-btn is-primary",onClick:()=>Pi("approve"),disabled:Se,title:we,children:[(0,g.jsx)(v.A7C,{"aria-hidden":"true"}),(0,g.jsx)("span",{children:$?"Onaylan\u0131yor...":"Onayla"})]})}):null,Oe?(0,g.jsx)(s.A,{lines:Be?[Be]:[],children:(0,g.jsxs)("button",{type:"button",className:"topbar-btn is-primary",onClick:Ye,disabled:Me,title:Be,children:[Re,(0,g.jsx)("span",{children:Oe})]})}):null,(0,g.jsxs)("button",{type:"button",className:"topbar-btn "+(Bi&&!ce?"is-save":"is-ghost"),onClick:Mi,disabled:!Bi||ce||xi,title:xi?Wi:Bi?"De\u011fi\u015fiklikleri kaydet":"Kaydedilecek de\u011fi\u015fiklik yok",children:[(0,g.jsx)(v.dIn,{"aria-hidden":"true"}),(0,g.jsx)("span",{children:ce?"Kaydediliyor...":Bi?"Kaydet":"Kaydedildi"})]}),je?(0,g.jsxs)("button",{type:"button",className:"topbar-btn is-primary",onClick:async()=>{if(!ce&&!Ne&&Fi("Hesaplama")&&Ei("Hesaplama")){if(Bi){return void(await Mi()&&await Ri())}await Ri()}},disabled:ce||Ne,title:Pe,children:[(0,g.jsx)(v.Ani,{"aria-hidden":"true"}),(0,g.jsx)("span",{children:Ne?"Hesaplan\u0131yor...":Pe})]}):null,Te?(0,g.jsxs)("div",{className:"action-menu",ref:Fe,children:[(0,g.jsxs)("button",{type:"button",className:"topbar-btn is-ghost ".concat(Le?"is-loading":""),onClick:()=>{Ji||Ee(e=>!e)},disabled:Ji,"aria-haspopup":"menu","aria-expanded":Ie,"aria-busy":Le?"true":void 0,children:[Le?(0,g.jsx)("span",{className:"pdf-export-spinner","aria-hidden":"true"}):null,Le?null:(0,g.jsx)(v.Mbn,{"aria-hidden":"true"}),(0,g.jsx)("span",{children:Ke})]}),Ie?(0,g.jsxs)("div",{className:"action-menu-panel action-menu-panel--up",role:"menu",children:[(0,g.jsx)("button",{type:"button",className:"action-menu-item",onClick:()=>{Ee(!1),async function(){if(X){F("");try{await a.FH.downloadXlsx(M,X,De,Ue)}catch(e){F(e.message||"Download failed")}}}()},disabled:Ji,role:"menuitem",children:"Excel (.xlsx)"}),(0,g.jsx)("button",{type:"button",className:"action-menu-item",onClick:()=>{Ee(!1),async function(){if(X){F(""),He(!0);try{await a.FH.downloadPdf(M,X,De,Ue)}catch(e){F(e.message||"PDF export failed")}finally{He(!1)}}}()},disabled:Ji,role:"menuitem",children:"PDF (.pdf)"})]}):null]}):null]})]}):(0,g.jsx)("div",{className:"school-footer-right",children:(0,g.jsx)("div",{className:"school-footer-hint small",children:"\xd6nce bir senaryo se\xe7in."})})]})})}()]})}},9322(e,i,t){t.d(i,{Rw:()=>n,Z4:()=>s,ZG:()=>o,pb:()=>a,wN:()=>l});const n={LOCAL:"local",INTERNATIONAL:"international"},r=new Set(Object.values(n));function l(e){const i=String(e||"").trim().toLowerCase();return r.has(i)?i:n.LOCAL}function o(){var e,i,t;let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const a=null!==(e=null!==(i=null===r||void 0===r||null===(t=r.temelBilgiler)||void 0===t?void 0:t.programType)&&void 0!==i?i:null===r||void 0===r?void 0:r.programType)&&void 0!==e?e:null===r||void 0===r?void 0:r.program_type;if(a)return l(a);const s=(null===o||void 0===o?void 0:o.program_type)||(null===o||void 0===o?void 0:o.programType);return s?l(s):n.LOCAL}function a(e){const i=l(arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.LOCAL);return!e||("okulOncesi"===e||(e.endsWith("Yerel")?i===n.LOCAL:!e.endsWith("Int")||i===n.INTERNATIONAL))}function s(e){const i=l(arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.LOCAL);if("okulOncesi"===e)return"okulOncesi";const t=i===n.INTERNATIONAL?"Int":"Yerel";return"".concat(e).concat(t)}}}]);
//# sourceMappingURL=693.f02c9253.chunk.js.map