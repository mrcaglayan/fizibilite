"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[693],{991(e,i,t){t.d(i,{IM:()=>s,fH:()=>u,zj:()=>a});var n=t(5043),r=t(5685);const l="fizizbilite";function o(e,i){try{const t=window.localStorage.getItem(e);return null==t?i:JSON.parse(t)}catch(t){return i}}function a(e,i){let{prefix:t=l,scope:a}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const s=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l,i=arguments.length>1?arguments[1]:void 0;const t=(0,r.zy)();return(0,n.useMemo)(()=>{const n=("string"===typeof i?i.trim():"")||t.pathname+(t.search||"");return e+":"+n},[e,i,t.pathname,t.search])}(t,a),u=(0,n.useMemo)(()=>"".concat(s,":ui:").concat(e),[s,e]),d=(0,n.useRef)(null),[c,m]=(0,n.useState)(()=>o(u,i));return(0,n.useEffect)(()=>{d.current=u,m(o(u,i))},[u]),(0,n.useEffect)(()=>{d.current===u&&function(e,i){try{window.localStorage.setItem(e,JSON.stringify(i))}catch(t){}}(u,c)},[u,c]),[c,m,u]}function s(e){let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],t=arguments.length>2?arguments[2]:void 0;const[n,r]=a(e,!!i,t);return[!!n,e=>r(!!("function"===typeof e?e(n):e))]}function u(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",t=arguments.length>2?arguments[2]:void 0;const[n,r]=a(e,String(null!==i&&void 0!==i?i:""),t);return[String(null!==n&&void 0!==n?n:""),e=>r(String("function"===typeof e?e(n):e))]}},2693(e,i,t){t.r(i),t.d(i,{default:()=>M});var n=t(2555),r=t(5043),l=t(5685),o=t(2115),a=t(7559),s=t(4405),u=t(1298),d=t(6037),c=t(3492),m=t(8345);function f(){let{inputs:e,norm:i,config:t,scenario:n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const r=(0,c.Rn)({inputs:e,norm:i,scenario:n}),l=function(e){const i=(0,c.bO)(),t=e&&"object"===typeof e?e:{},n=t.sections&&"object"===typeof t.sections?t.sections:{},r={version:i.version,sections:{}};return Object.keys(i.sections).forEach(e=>{const t=i.sections[e]||{},l=n[e]&&"object"===typeof n[e]?n[e]:{};r.sections[e]={enabled:"boolean"===typeof l.enabled?l.enabled:!1!==t.enabled,mode:"string"===typeof l.mode&&l.mode?l.mode:t.mode,min:null!=l.min?Number(l.min):t.min,selectedFields:l.selectedFields&&"object"===typeof l.selectedFields?l.selectedFields:{}}}),r}(t),o=(0,m.B)(e),a=new Set(["ik","gelirler","giderler"]),s=new Map(r.sections.map(e=>[e.id,e])),u=new Map;let d=0,f=0,v=0,y=0;r.sections.forEach(t=>{var s;const m=l.sections[t.id]||{};if(!1===m.enabled)return void u.set(t.id,{enabled:!1});const p=!o||a.has(t.tabKey),g=(e,i)=>{d+=e,f+=i,p&&(v+=e,y+=i)},b=!0===t.requiresKademe,h=null===(s=r.context)||void 0===s?void 0:s.hasKademeSelection;if(b&&!h)return u.set(t.id,{enabled:!0,done:!1,doneUnits:0,totalUnits:1,missingReasons:["Kademeler secilmedi"]}),void g(1,0);const k=(Array.isArray(t.fields)?t.fields:[]).filter(e=>{var i;return!1!==(null===(i=m.selectedFields)||void 0===i?void 0:i[e])});if(0===k.length)return void u.set(t.id,{enabled:!0,done:!0,doneUnits:0,totalUnits:0,missingReasons:[]});const _=k.map(e=>r.fieldsById[e]).filter(Boolean).filter(t=>{if("function"!==typeof t.appliesIf)return!0;try{return!1!==t.appliesIf(e,i,n)}catch(r){return!0}}),S=[],N=[];_.forEach(t=>{let n=null;try{n=t.getValue?t.getValue(e,i):null}catch(l){n=null}const r=function(e,i){return"string"===i?(0,c.uI)(e):"boolean"===i?"boolean"===typeof e:(0,c.ac)(e)>0}(n,t.type);r?S.push(t):N.push(t)});const w=S.length;let j=String(m.mode||t.modeDefault||"ALL").toUpperCase(),C=Number.isFinite(Number(m.min))?Number(m.min):t.minDefault;if(o&&"ik.localStaff"===t.id&&(j="MIN",C=1),"MIN"===j){const e=Math.max(1,Number.isFinite(C)?C:1),i=w>=e,n=Math.min(w,e);return u.set(t.id,{enabled:!0,done:i,doneUnits:n,totalUnits:e,missingReasons:i?[]:["En az ".concat(e," alan")]}),void g(e,n)}const A=_.length;if(0===A)return void(!1===t.allowEmpty?(u.set(t.id,{enabled:!0,done:!1,doneUnits:0,totalUnits:1,missingReasons:[t.label||"Eksik"]}),g(1,0)):u.set(t.id,{enabled:!0,done:!0,doneUnits:0,totalUnits:0,missingReasons:[]}));const x=w===A,M=x?[]:N.map(e=>e.label).filter(Boolean);u.set(t.id,{enabled:!0,done:x,doneUnits:w,totalUnits:A,missingReasons:M}),g(A,w)});const p=r.tabs.map(e=>{const i=(e.sectionIds||[]).map(e=>({id:e,result:u.get(e),def:s.get(e)})).filter(e=>e.result&&!1!==e.result.enabled);let t=0,n=0;const r=[];let l=!0;i.forEach(e=>{const i=e.result||{};i.done||(l=!1);const o=Number(i.totalUnits||0),a=Number(i.doneUnits||0);o>0&&(t+=o,n+=a),Array.isArray(i.missingReasons)&&i.missingReasons.length&&r.push(...i.missingReasons)});const o=t?Math.round(n/t*100):l?100:0,a=r.length?r.join(" / "):"";return{key:e.key,label:e.label,pct:o,done:l,missingPreview:a,missingLines:r}}),g=o?v:d,b=o?y:f,h=g?Math.round(b/g*100):100,k=p.filter(e=>!e.done).filter(e=>!o||a.has(e.key)).map(e=>{const i=e.missingPreview||"Eksik alanlar";return"".concat(e.label,": ").concat(i)}),_=o?p.filter(e=>a.has(e.key)):p;return{pct:h,completedCount:_.filter(e=>e.done).length,totalCount:_.length,tabs:p,missingDetailsLines:k}}var v=t(991),y=t(3204),p=t(5534),g=t(9322),b=t(579);function h(e){const i=[];if(!e)return i;const t=String(e).split(".");if(t.length>0&&"inputs"===t[0]&&t.shift(),0===t.length)return i;let n=t[0].replace(/([a-z0-9])([A-Z])/g,"$1_$2").toLowerCase();const r={grades_years:"grades_plan",grades_current:"grades_plan",grades:"grades_plan"};if(Object.prototype.hasOwnProperty.call(r,n)&&(n=r[n]),!n)return i;if(t.length>=2){const e=t[1].replace(/([a-z0-9])([A-Z])/g,"$1_$2").toLowerCase(),r={temel_bilgiler:{inflation:"inflation",ucret_artis_oranlari:"inflation",okul_ucretleri_hesaplama:"inflation",ik_mevcut:"ik_mevcut",burs_indirim_ogrenci_sayilari:"burs_ogr",burs_ogr:"burs_ogr",rakip_analizi:"rakip",rakip:"rakip",performans:"performans",degerlendirme:"performans",okul_egitim_bilgileri:"okul_egitim",yetkililer:null,kademeler:null,program_type:null},gelirler:{"*":"unit_fee"},giderler:{"*":"isletme"},ik:{"*":"local_staff"},discounts:{"*":"discounts"},norm:{"*":"ders_dagilimi"},grades_plan:{"*":"plan"},kapasite:{"*":"caps"}}[n];let l=null;if(l=r?Object.prototype.hasOwnProperty.call(r,e)?r[e]:Object.prototype.hasOwnProperty.call(r,"*")?r["*"]:e:e,l)return i.push("section.".concat(n,".").concat(l)),i}return i.push("page.".concat(n)),i}const k=new Set(["basics","kapasite","income","expenses","norm","hr","detailedReport","report"]),_={basics:"temel-bilgiler",kapasite:"kapasite",norm:"norm",hr:"ik",income:"gelirler",expenses:"giderler",detailedReport:"detayli-rapor",report:"rapor"},S=Object.fromEntries(Object.entries(_).map(e=>{let[i,t]=e;return[t,i]})),N={basics:"temel_bilgiler",kapasite:"kapasite",norm:"norm.ders_dagilimi",hr:"ik.local_staff",income:"gelirler.unit_fee",expenses:"giderler.isletme"},w=new Set(["ik.local_staff","gelirler.unit_fee","giderler.isletme"]);function j(e){const i=String(e||"").trim(),t=i.match(/(\d{4})\s*-\s*(\d{4})/);if(t){const e=Number(t[1]),i=Number(t[2]);if(Number.isFinite(e)&&Number.isFinite(i))return{startYear:e,endYear:i}}const n=i.match(/^(\d{4})$/);if(n){const e=Number(n[1]);if(Number.isFinite(e))return{startYear:e,endYear:e}}return{startYear:null,endYear:null}}function C(e){const i=Number(null===e||void 0===e?void 0:e.pct);return Number.isFinite(i)?i:0}function A(e,i){const t=[],n=new Set;return[e,i].forEach(e=>{Array.isArray(e)&&e.forEach(e=>{const i=String(e||"").trim();i&&!n.has(i)&&(n.add(i),t.push(i))})}),t.slice(0,15)}function x(e,i){if(!Array.isArray(e))return-1;const t=e.findIndex(e=>e&&"object"===typeof e&&"key"in e&&String(e.key)===i);if(-1!==t)return t;const n=e.findIndex(e=>e&&"object"===typeof e&&"name"in e&&String(e.name)===i);if(-1!==n)return n;const r=e.findIndex(e=>e&&"object"===typeof e&&"grade"in e&&String(e.grade)===i);if(-1!==r)return r;const l=Number(i);return Number.isInteger(l)&&String(l)===i&&l>=0&&l<e.length?l:-1}function M(){var e,i;const{id:t}=(0,l.g)(),c=(0,l.zy)(),M=(0,l.Zp)(),O=(0,l.KC)(),I=Number(t),[E,B]=(0,r.useState)(null),[F,L]=(0,r.useState)(""),[R,H]=(0,r.useState)(null);(0,r.useEffect)(()=>{const e="Feasibility Studio";document.title=null!==E&&void 0!==E&&E.name?"".concat(E.name," \xb7 ").concat(e):"School \xb7 ".concat(e)},[null===E||void 0===E?void 0:E.name]);const[Y,z]=(0,r.useState)(null),[P,K]=(0,r.useState)(null),[T,D]=(0,r.useState)(null),[W,U]=(0,r.useState)([]),[G,Z]=(0,r.useState)(!1),[$,q]=(0,r.useState)([]),[V,J]=(0,r.useState)(!1),[X,Q]=(0,r.useState)(!1),[ee,ie]=(0,r.useState)([]),[te,ne]=(0,r.useState)(()=>(0,p.Rj)(I)),[re,le]=(0,r.useState)(null),oe=(0,r.useCallback)(async()=>{const e=null===Y||void 0===Y?void 0:Y.id;if(!e||!I)return U([]),Z(!1),void q([]);try{const i=await a.FH.listWorkItems(I,e);U(Array.isArray(null===i||void 0===i?void 0:i.workItems)?i.workItems:[]),q(Array.isArray(null===i||void 0===i?void 0:i.requiredWorkIds)?i.requiredWorkIds:[]),Z(!0)}catch(i){q([]),Z(!0)}},[I,null===Y||void 0===Y?void 0:Y.id]),ae=(0,r.useCallback)(async()=>{if(I){J(!1);try{const e=await a.FH.listScenarios(I,{limit:50,offset:0,fields:"brief",order:"created_at:desc"}),i=Array.isArray(null===e||void 0===e?void 0:e.items)?e.items:[];ie(i);const t=null!==te&&void 0!==te?te:null===Y||void 0===Y?void 0:Y.id;if(null!=t){const e=i.find(e=>String(null===e||void 0===e?void 0:e.id)===String(t));e&&z(i=>i?(0,n.A)((0,n.A)({},i),e):e)}J(!0)}catch(e){J(!1)}}},[I,te,null===Y||void 0===Y?void 0:Y.id]),se=(0,r.useCallback)(async e=>{const i=null===Y||void 0===Y?void 0:Y.id;if(i&&I&&e)try{await a.FH.submitWorkItem(I,i,e),await oe(),await ae(),o.oR.success("Mod\xfcl g\xf6nderildi.")}catch(t){o.oR.error(t.message||"G\xf6nderme ba\u015far\u0131s\u0131z")}},[I,null===Y||void 0===Y?void 0:Y.id,oe,ae]);(0,r.useEffect)(()=>{if(null===Y||void 0===Y||!Y.id)return U([]),Z(!1),void J(!1);Z(!1),J(!1),oe()},[null===Y||void 0===Y?void 0:Y.id,oe]);const[ue,de]=(0,r.useState)(null),[ce,me]=(0,r.useState)(null),[fe,ve]=(0,r.useState)(null),[ye,pe]=(0,r.useState)(!1),[ge,be]=(0,r.useState)(()=>new Set),[he,ke]=(0,r.useState)(null),[_e,Se]=(0,r.useState)(null),Ne=(0,r.useCallback)(e=>{be(i=>{if(!i.size)return i;let t=!1;const n=new Set;for(const r of i)r.startsWith(e)?t=!0:n.add(r);return t?n:i})},[]),we=(0,r.useCallback)(e=>{for(const i of ge)if(i===e||i.startsWith(e))return!0;return!1},[ge]),[je,Ce]=(0,r.useState)(null),[Ae,xe]=(0,r.useState)(!1),[Me,Oe]=(0,r.useState)(null),[Ie,Ee]=(0,r.useState)(null),[Be,Fe]=(0,r.useState)(0),[Le,Re]=(0,r.useState)(!1),He=(0,r.useRef)(null),Ye=(0,r.useRef)(null),[ze,Pe]=(0,r.useState)(!1),[Ke,Te]=(0,r.useState)(!0),[De,We]=(0,r.useState)("Okul a\xe7iliyor...");(0,r.useEffect)(()=>{ne((0,p.Rj)(I))},[I]);const Ue=(0,r.useMemo)(()=>"school:".concat(I,":scenario:").concat(null!==te&&void 0!==te?te:"none"),[I,te]),[Ge,Ze]=(0,v.zj)("report.currency","usd",{scope:Ue}),$e=(0,r.useRef)(null),[qe,Ve]=(0,v.zj)("report.mode","original",{scope:Ue}),[Je,Xe]=(0,r.useState)(!1),[Qe,ei]=(0,v.fH)("school.detailedReportMode","detailed",{scope:Ue}),ii=(0,r.useMemo)(()=>{const e="/schools/".concat(I,"/");return c.pathname.startsWith(e)&&c.pathname.slice(e.length).split("/")[0]||""},[c.pathname,I]),ti=S[ii]||"",ni=N[ti]||null,ri=(0,r.useMemo)(()=>ni&&Array.isArray(W)&&W.find(e=>String(null===e||void 0===e?void 0:e.work_id)===String(ni))||null,[ni,W]),li=null!==ri&&void 0!==ri&&ri.state?String(ri.state):"not_started",oi=["submitted","approved"].includes(li),ai=r.useCallback(e=>{const i=_[e];i&&M("/schools/".concat(I,"/").concat(i))},[M,I]);(0,r.useEffect)(()=>{S[ii]&&(0,p.BM)(I,te,ii)},[ii,I,te]),(0,r.useEffect)(()=>{S[ii]&&(0,p.dW)(ii)},[ii]),(0,r.useEffect)(()=>{const e="/schools/".concat(I);if(c.pathname!==e&&c.pathname!=="".concat(e,"/"))return;const i=(0,p.Wz)(I,te)||_.basics,t="".concat(e,"/").concat(i);M(t,{replace:!0})},[c.pathname,M,I,te]),(0,r.useEffect)(()=>{Te(!0),We("Okul a\xe7iliyor...")},[I]),(0,r.useEffect)(()=>{re&&te&&String(te)===String(re.scenarioId)&&(ai(re.tab),le(null))},[re,te,ai]),(0,r.useEffect)(()=>{const e=setInterval(()=>Fe(Date.now()),3e4);return()=>clearInterval(e)},[]),(0,r.useEffect)(()=>{if(!Le)return;const e=e=>{const i=He.current;i&&!i.contains(e.target)&&Re(!1)},i=e=>{"Escape"===e.key&&Re(!1)};return document.addEventListener("mousedown",e),document.addEventListener("keydown",i),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("keydown",i)}},[Le]);const si=j(null===Y||void 0===Y?void 0:Y.academic_year).startYear,ui="LOCAL"===(null===Y||void 0===Y?void 0:Y.input_currency)?Y.local_currency_code||"LOCAL":"USD",di="LOCAL"===(null===Y||void 0===Y?void 0:Y.input_currency),ci=Number((null===fe||void 0===fe||null===(e=fe.temelBilgiler)||void 0===e||null===(i=e.performans)||void 0===i?void 0:i.prevYearRealizedFxUsdToLocal)||0),mi=di&&!(Number.isFinite(ci)&&ci>0),fi=(0,r.useMemo)(()=>(0,g.ZG)(fe,Y),[fe,Y]),vi=(0,r.useMemo)(()=>{var e,i;const t=null!==(e=null!==(i=null===E||void 0===E?void 0:E.country_id)&&void 0!==i?i:null===R||void 0===R?void 0:R.country_id)&&void 0!==e?e:null;return{schoolId:I,countryId:t}},[I,null===E||void 0===E?void 0:E.country_id,null===R||void 0===R?void 0:R.country_id]),yi=(0,r.useMemo)(()=>{try{return(0,u.$3)(R,"page.norm","read",vi)}catch(e){return!1}},[R,vi]),pi=(0,r.useMemo)(()=>{try{return!!(0,u.$3)(R,"section.giderler.isletme","write",vi)||(0,u.$3)(R,"page.giderler","write",vi)}catch(e){return!1}},[R,vi]),gi=!ue&&!yi,bi=(0,r.useMemo)(()=>f({inputs:fe,norm:ue,config:ce,scenario:Y}),[fe,ue,ce,Y]),hi=(0,r.useMemo)(()=>(0,m.B)(fe),[fe]);(0,r.useEffect)(()=>{I&&te&&fe&&(0,p.X3)(I,te,{isHeadquarter:hi})},[I,te,fe,hi]);const ki=(0,r.useMemo)(()=>Object.fromEntries(((null===bi||void 0===bi?void 0:bi.tabs)||[]).map(e=>[e.key,e])),[bi]),_i=(0,r.useMemo)(()=>{const e=C(ki.gradesPlan),i=gi?e:C(ki.norm);return Math.round((e+i)/2)},[ki,gi]),Si=(0,r.useMemo)(()=>{const e=C(ki.giderler);if(hi)return e;const i=C(ki.discounts);return Math.round((e+i)/2)},[ki,hi]),Ni=(0,r.useMemo)(()=>{var e,i;return A(null===(e=ki.gradesPlan)||void 0===e?void 0:e.missingLines,null===(i=ki.norm)||void 0===i?void 0:i.missingLines)},[ki]),wi=(0,r.useMemo)(()=>{var e,i,t;return hi?Array.isArray(null===(e=ki.giderler)||void 0===e?void 0:e.missingLines)?ki.giderler.missingLines:[]:A(null===(i=ki.giderler)||void 0===i?void 0:i.missingLines,null===(t=ki.discounts)||void 0===t?void 0:t.missingLines)},[ki,hi]),ji=(0,r.useCallback)(async e=>{if(!te)return;const i=String(e||"original");Xe(!0),L("");try{const e=await a.FH.getScenarioReport(I,te,i);Ce((null===e||void 0===e?void 0:e.results)||null)}catch(t){L(t.message||"Report fetch failed")}finally{Xe(!1)}},[I,te]),Ci=(0,r.useCallback)(async e=>{const i=String(e||"original");i===qe&&je||(Ve(i),await ji(i))},[ji,qe,je,Ve]);(0,r.useEffect)(()=>{if(null!==O&&void 0!==O&&O.setHeaderMeta)return O.setHeaderMeta({title:null!==E&&void 0!==E&&E.name?E.name:"Okul",subtitle:Y?"".concat(Y.name).concat(Y.academic_year?" \u2022 ".concat(Y.academic_year):""):"Senaryo se\xe7in",hideDefault:!1,centered:!0}),()=>{var e;null===(e=O.clearHeaderMeta)||void 0===e||e.call(O)}},[O,Y,null===E||void 0===E?void 0:E.name]);const Ai=(0,r.useCallback)(e=>{var i,t,n;const r=e||{},l=r.ik||{},o=null!==l&&void 0!==l&&null!==(i=l.years)&&void 0!==i&&i.y1?l.years.y1:l,a=(null===o||void 0===o?void 0:o.unitCosts)||{},s=(null===o||void 0===o?void 0:o.headcountsByLevel)||{},u=["turk_mudur","turk_mdyard","turk_egitimci","turk_temsil","yerel_yonetici_egitimci","yerel_destek","yerel_ulke_temsil_destek","int_yonetici_egitimci"],d=Object.keys(s||{}),c=d.length?d:["okulOncesi","ilkokulYerel","ilkokulInt","ortaokulYerel","ortaokulInt","liseYerel","liseInt"],m={};for(const h of u){let e=0;for(const i of c){var f;e+=Number((null===s||void 0===s||null===(f=s[i])||void 0===f?void 0:f[h])||0)}m[h]=Number((null===a||void 0===a?void 0:a[h])||0)*e}const v={turkPersonelMaas:(m.turk_mudur||0)+(m.turk_mdyard||0)+(m.turk_egitimci||0),turkDestekPersonelMaas:m.turk_temsil||0,yerelPersonelMaas:m.yerel_yonetici_egitimci||0,yerelDestekPersonelMaas:(m.yerel_destek||0)+(m.yerel_ulke_temsil_destek||0),internationalPersonelMaas:m.int_yonetici_egitimci||0},y=(null===r||void 0===r||null===(t=r.giderler)||void 0===t||null===(n=t.isletme)||void 0===n?void 0:n.items)||{},p=Object.keys(v);let g=!1;for(const h of p){const e=Number((null===y||void 0===y?void 0:y[h])||0),i=Number((null===v||void 0===v?void 0:v[h])||0);if(Math.abs(e-i)>1e-6){g=!0;break}}if(!g)return r;const b=structuredClone(r);b.giderler=b.giderler||{},b.giderler.isletme=b.giderler.isletme||{},b.giderler.isletme.items=b.giderler.isletme.items||{};for(const h of p)b.giderler.isletme.items[h]=Number(v[h]||0);return b},[]),xi=(0,r.useCallback)(e=>{var i,t,r;const l=e=>{const i=Number(e);return Number.isFinite(i)?i:0},o=e||{},a=l(o.schoolCapacity),s=o.kapasite&&"object"===typeof o.kapasite?o.kapasite:{},u=s.years&&"object"===typeof s.years?s.years:{},d=l(null!=u.y1?u.y1:a),c=l(null!=u.y2?u.y2:d),m=l(null!=u.y3?u.y3:d),f=l(s.currentStudents),v=s.byKademe&&"object"===typeof s.byKademe?s.byKademe:{};if(!("schoolCapacity"in o||!o.kapasite||"object"!==typeof o.kapasite||!s.years||"object"!==typeof s.years||l(null===s||void 0===s||null===(i=s.years)||void 0===i?void 0:i.y1)!==d||l(null===s||void 0===s||null===(t=s.years)||void 0===t?void 0:t.y2)!==c||l(null===s||void 0===s||null===(r=s.years)||void 0===r?void 0:r.y3)!==m||l(null===s||void 0===s?void 0:s.currentStudents)!==f||!s.byKademe||"object"!==typeof s.byKademe))return o;const y=structuredClone(o);return y.kapasite=(0,n.A)((0,n.A)({},s||{}),{},{currentStudents:f,years:{y1:d,y2:c,y3:m},byKademe:v}),"schoolCapacity"in y&&delete y.schoolCapacity,y},[]),Mi=(0,r.useCallback)(e=>{const i=e||{},t=(0,d.oP)().map(e=>({grade:e,branchCount:0,studentsPerBranch:0})),n=Array.isArray(i.grades)?i.grades:t,r=i.gradesYears&&"object"===typeof i.gradesYears?i.gradesYears:{},l=Array.isArray(r.y1)?r.y1:n,o=Array.isArray(r.y2)?r.y2:l,a=Array.isArray(r.y3)?r.y3:l,s=e=>{const i=new Map;return(Array.isArray(e)?e:[]).forEach(e=>{const t=(e=>{var i,t,n;return{grade:String(null!==(i=null===e||void 0===e?void 0:e.grade)&&void 0!==i?i:""),branchCount:Number(null!==(t=null===e||void 0===e?void 0:e.branchCount)&&void 0!==t?t:0),studentsPerBranch:Number(null!==(n=null===e||void 0===e?void 0:e.studentsPerBranch)&&void 0!==n?n:0)}})(e);t.grade&&i.set(t.grade,t)}),i};if(!(!i.gradesYears||!Array.isArray(i.grades)||!Array.isArray(r.y1)||!Array.isArray(r.y2)||!Array.isArray(r.y3)||!((e,i)=>{if(!Array.isArray(e)||!Array.isArray(i))return!1;const t=s(e),n=s(i);if(t.size!==n.size)return!1;for(const[r,l]of t.entries()){const e=n.get(r);if(!e)return!1;if(Number(l.branchCount)!==Number(e.branchCount))return!1;if(Number(l.studentsPerBranch)!==Number(e.studentsPerBranch))return!1}return!0})(i.grades,l)))return i;const u=structuredClone(i);return u.gradesYears={y1:structuredClone(l),y2:structuredClone(o),y3:structuredClone(a)},u.grades=structuredClone(u.gradesYears.y1),u},[]),Oi=(0,r.useCallback)(e=>{var i,t,r,l;const o=e&&"object"===typeof e?e:{},a=(null===o||void 0===o||null===(i=o.gradesYears)||void 0===i?void 0:i.y1)||(null===o||void 0===o?void 0:o.grades)||[],s=(0,d.qV)(a,null===o||void 0===o||null===(t=o.temelBilgiler)||void 0===t?void 0:t.kademeler),u=(0,g.ZG)(o),c={okulOncesi:Number(s.okulOncesi||0),ilkokulYerel:0,ilkokulInt:0,ortaokulYerel:0,ortaokulInt:0,liseYerel:0,liseInt:0};c[(0,g.Z4)("ilkokul",u)]=Number(s.ilkokul||0),c[(0,g.Z4)("ortaokul",u)]=Number(s.ortaokul||0),c[(0,g.Z4)("lise",u)]=Number(s.lise||0);const m=((e,i)=>{if(!Array.isArray(e))return{rows:e,changed:!1};let t=!1;const r=e.map(e=>{var r,l;const o=String(null!==(r=null===e||void 0===e?void 0:e.key)&&void 0!==r?r:""),a=i(o);if(null==a)return e;const s=Number(null!==(l=null===e||void 0===e?void 0:e.studentCount)&&void 0!==l?l:0);return Math.abs(s-a)<1e-6?e:(t=!0,(0,n.A)((0,n.A)({},e),{},{studentCount:a}))});return{rows:t?r:e,changed:t}})(null===o||void 0===o||null===(r=o.gelirler)||void 0===r||null===(l=r.tuition)||void 0===l?void 0:l.rows,e=>Object.prototype.hasOwnProperty.call(c,e)?c[e]:null);if(!m.changed)return o;const f=structuredClone(o);return f.gelirler=f.gelirler||{},m.changed&&(f.gelirler.tuition=f.gelirler.tuition||{},f.gelirler.tuition.rows=m.rows),f},[]);(0,r.useEffect)(()=>{let e=!0;return async function(){try{const i=await a.FH.getProgressRequirements();if(!e)return;me((null===i||void 0===i?void 0:i.config)||i||null)}catch(i){if(!e)return;me(null)}}(),()=>{e=!1}},[]),(0,r.useEffect)(()=>{!async function(){L(""),Te(!0),We("Okul a\xe7iliyor...");try{const i=await a.FH.getSchool(I);B(i);try{const e=await a.FH.getMe();H(e)}catch(e){}We("Senaryolar kontrol ediliyor...");const t=await a.FH.listScenarios(I,{limit:50,offset:0,fields:"brief",order:"created_at:desc"}),n=Array.isArray(null===t||void 0===t?void 0:t.items)?t.items:[];ie(n),null!=te&&(n.some(e=>String(e.id)===String(te))||((0,p.sE)(I,null),ne(null))),Te(!1)}catch(i){L(i.message||"Failed to load school"),Te(!1)}}()},[I]),(0,r.useEffect)(()=>{!async function(){if(!te)return z(null),ve(null),ke(null),Ce(null),K(null),D(null),de(null),Se(null),Ne("inputs."),void Ne("norm.");L(""),Ce(null),Oe(null),Ee(null);try{var e;const i=await a.FH.getScenarioContext(I,te);z((null===i||void 0===i?void 0:i.scenario)||null);const t=null===i||void 0===i?void 0:i.inputs,r=t&&"object"===typeof t?Mi((e=>{const i=e||{},t=i.temelBilgiler&&"object"===typeof i.temelBilgiler?i.temelBilgiler:{},r=structuredClone(i),l=t.inflation&&"object"===typeof t.inflation?t.inflation:{},o=e=>Number.isFinite(Number(e))?Number(e):0;return r.temelBilgiler={inflation:(0,n.A)((0,n.A)({},l),{},{expenseDeviationPct:o(l.expenseDeviationPct),y2023:o(l.y2023),y2024:o(l.y2024),y2025:o(l.y2025),y1:o(l.y1),y2:o(l.y2),y3:o(l.y3),currentSeasonAvgFee:o(l.currentSeasonAvgFee)}),yetkililer:t.yetkililer||{mudur:"",ulkeTemsilcisi:"",raporuHazirlayan:""},okulEgitimBilgileri:t.okulEgitimBilgileri||{egitimBaslamaTarihi:"",zorunluEgitimDonemleri:"",birDersSuresiDakika:0,gunlukDersSaati:0,haftalikDersSaatiToplam:0,sabahciOglenci:"",ogretmenHaftalikDersOrt:0,gecisSinaviBilgisi:"",uygulananProgram:""},kademeler:(0,d.Ds)(t.kademeler),programType:(0,g.wN)(t.programType),okulUcretleriHesaplama:"boolean"!==typeof t.okulUcretleriHesaplama||t.okulUcretleriHesaplama,ucretArtisOranlari:t.ucretArtisOranlari||{okulOncesi:0,ilkokulYerel:0,ilkokulInt:0,ortaokulYerel:0,ortaokulInt:0,liseYerel:0,liseInt:0},ikMevcut:t.ikMevcut||{turkPersonelYoneticiEgitimci:0,turkPersonelTemsilcilik:0,yerelKadroluEgitimci:0,yerelUcretliVakaterEgitimci:0,yerelDestek:0,yerelTemsilcilik:0,international:0},bursIndirimOgrenciSayilari:t.bursIndirimOgrenciSayilari||{magisBasariBursu:0,maarifYetenekBursu:0,ihtiyacBursu:0,okulBasariBursu:0,tamEgitimBursu:0,barinmaBursu:0,turkceBasariBursu:0,uluslararasiYukumlulukIndirimi:0,vakifCalisaniIndirimi:0,kardesIndirimi:0,erkenKayitIndirimi:0,pesinOdemeIndirimi:0,kademeGecisIndirimi:0,temsilIndirimi:0,kurumIndirimi:0,istisnaiIndirim:0,yerelMevzuatIndirimi:0},rakipAnalizi:t.rakipAnalizi||{okulOncesi:{a:0,b:0,c:0},ilkokul:{a:0,b:0,c:0},ortaokul:{a:0,b:0,c:0},lise:{a:0,b:0,c:0}},performans:t.performans||{gerceklesen:{ogrenciSayisi:0,gelirler:0,giderler:0,karZarar:0,bursVeIndirimler:0}},degerlendirme:"string"===typeof t.degerlendirme?t.degerlendirme:""},r})(xi(t))):t;ve(r),ke(r&&"object"===typeof r?structuredClone(r):r),Ne("inputs.");const l=null!==(e=null===i||void 0===i?void 0:i.norm)&&void 0!==e?e:null;de(l),Se(l?structuredClone(l):null),Ne("norm.")}catch(i){L(i.message||"Failed to load scenario inputs")}}()},[I,te,Ne,xi,Mi]),(0,r.useEffect)(()=>{if(!te)return void($e.current=null);const e=null===Y||void 0===Y?void 0:Y.id;if(!e||String(e)!==String(te))return;const i="LOCAL"===(null===Y||void 0===Y?void 0:Y.input_currency)&&Number(null===Y||void 0===Y?void 0:Y.fx_usd_to_local)>0&&(null===Y||void 0===Y?void 0:Y.local_currency_code),t=String(e);if($e.current!==t)return Ze(i?"local":"usd"),void($e.current=t);i||"usd"===Ge||Ze("usd")},[te,null===Y||void 0===Y?void 0:Y.id,null===Y||void 0===Y?void 0:Y.input_currency,null===Y||void 0===Y?void 0:Y.fx_usd_to_local,null===Y||void 0===Y?void 0:Y.local_currency_code,Ge,Ze]),(0,r.useEffect)(()=>{!async function(){try{K(null),D(null);const e=null===Y||void 0===Y?void 0:Y.academic_year;if(!e||null===ee||void 0===ee||!ee.length)return;const{startYear:i,endYear:t}=j(e);if(!i)return;const n=i-1,r=(null!==t&&void 0!==t?t:i)-1,l=ee.find(e=>{const i=j(null===e||void 0===e?void 0:e.academic_year);return i.startYear===n&&i.endYear===r});if(!l)return;D(l);const o=await a.FH.calculateScenario(I,l.id);K((null===o||void 0===o?void 0:o.results)||null)}catch(e){K(null)}}()},[I,null===Y||void 0===Y?void 0:Y.academic_year,ee]);const Ii=function(e){const i=String((null===e||void 0===e?void 0:e.status)||"draft"),t=null!=(null===e||void 0===e?void 0:e.submitted_at),n=null!=(null===e||void 0===e?void 0:e.sent_at);return"sent_for_approval"===i||"submitted"===i||"approved"===i&&n||"in_review"===i&&t}(Y),Ei=Ii||oi,Bi=(0,r.useCallback)(async()=>{if(!ue||!te)return;const e=null!==ue&&void 0!==ue&&ue.years?{years:ue.years}:{teacherWeeklyMaxHours:ue.teacherWeeklyMaxHours,curriculumWeeklyHours:ue.curriculumWeeklyHours};await a.FH.saveNormConfig(I,te,e);const i=await a.FH.getNormConfig(I,te);de(i),Se(i?structuredClone(i):null),Ne("norm.")},[ue,te,I,Ne]),Fi=(0,r.useCallback)(async()=>{if(!te||!fe)return!1;if(Ei)return L(Ii?"Senaryo kilitli. Inceleme bekleniyor.":"Modul kilitli. Inceleme bekleniyor."),!1;const e=we("inputs."),i=we("norm.");if(!e&&!i)return!0;pe(!0),L("");try{if(e){let e=Ai(fe);e=xi(e),e=Mi(e),e=Oi(e),e!==fe&&ve(e);const i=new Set,t=[];for(const r of ge){const e=String(r||"");if(e.startsWith("inputs.")){t.push(e);for(const t of h(e))i.add(t)}}const n=Array.from(i);await a.FH.saveScenarioInputs(I,te,e,n,t),ke(e&&"object"===typeof e?structuredClone(e):e),Ne("inputs.")}return i&&await Bi(),Oe(Date.now()),!0}catch(t){const n=e&&i?"Save failed":i?"Save norm failed":"Save inputs failed";return L(t.message||n),!1}finally{pe(!1)}},[Ai,Oi,xi,Mi,te,fe,Ei,Ii,we,ge,I,Ne,Bi]);function Li(e){const i=Array.isArray(e)?e:[];let t=0;for(const r of i){var n;const e=Number(null!==(n=null===r||void 0===r?void 0:r.studentsPerBranch)&&void 0!==n?n:0);Number.isFinite(e)&&(t+=e)}return t}function Ri(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"blocking-toast";o.oR.warn(e,{toastId:i,position:"bottom-right",autoClose:!1,closeOnClick:!1,draggable:!0,icon:"??",style:{background:"rgba(15, 23, 42, 0.96)",color:"#f8fafc",border:"1px solid rgba(251, 191, 36, 0.35)",boxShadow:"0 18px 40px rgba(0,0,0,.28)",borderRadius:14}})}function Hi(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Islem";if(!fe)return!0;if(hi)return!0;const i=function(e){const i=e&&"object"===typeof e?e:{},t=i.gradesYears&&"object"===typeof i.gradesYears?i.gradesYears:{};return{y1:Li(Array.isArray(t.y1)?t.y1:i.grades),y2:Li(t.y2),y3:Li(t.y3)}}(fe),t=[];if(i.y2>0||t.push("Y2"),i.y3>0||t.push("Y3"),!t.length)return!0;const n="".concat(e," yapilamaz: Norm > Planlanan Donem Bilgileri bolumunde ")+"".concat(t.join(" ve ")," toplam ogrenci 0 gorunuyor. Lutfen Y2/Y3 ogrenci sayilarini girin.");return L(""),Ri(n,"norm-y2y3-missing"),"norm"!==ti&&ai("norm"),!1}function Yi(){if(!fe)return!0;if(!di)return!0;if(!mi)return!0;const e="".concat(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Islem"," yapilamaz: Temel Bilgiler > Performans alanindaki ")+'"Onceki Donem Ortalama Kur (Gerceklesen)" girilmelidir.';return L(""),Ri(e,"prev-realized-fx-missing"),"basics"!==ti&&ai("basics"),!1}async function zi(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!te)return!1;if(!Yi("Hesaplama"))return!1;if(!e.skipPlanValidation&&!Hi("Hesaplama"))return!1;xe(!0),L("");let i=!1;try{const t=await a.FH.calculateScenario(I,te);"distributed"===qe?await ji("distributed"):Ce(t.results),e.keepTab||ai("report"),Ee(Date.now()),"undefined"!==typeof window&&console.log("[kpi] calculate ok",{scenarioId:te,hasResults:Boolean(null===t||void 0===t?void 0:t.results)}),i=!0}catch(t){L(t.message||"Calculation failed"),"undefined"!==typeof window&&console.log("[kpi] calculate failed",{scenarioId:te,error:(null===t||void 0===t?void 0:t.message)||t})}finally{xe(!1)}return i}function Pi(e,i){return null==e&&null==i||("number"===typeof e||"number"===typeof i?Number(e)===Number(i):"boolean"===typeof e||"boolean"===typeof i?Boolean(e)===Boolean(i):Object.is(e,i))}function Ki(e,i){let t=e;for(const n of i){if(null==t)return;if(Array.isArray(t)){const e=t.find(e=>e&&"object"===typeof e&&"key"in e&&String(e.key)===n);if(e){t=e;continue}const i=t.find(e=>e&&"object"===typeof e&&"name"in e&&String(e.name)===n);if(i){t=i;continue}const r=t.find(e=>e&&"object"===typeof e&&"grade"in e&&String(e.grade)===n);if(r){t=r;continue}const l=Number(n);if(Number.isInteger(l)&&String(l)===n){t=t[l];continue}return}if("object"!==typeof t)return;t=t[n]}return t}const Ti=(0,r.useCallback)(e=>{if(!e)return;const i=e.split(".");if(i.length){if("inputs"===i[0]){const e=Ki(he,i.slice(1));if(void 0!==e)return e;const t=i[i.length-1];if(t.endsWith("Y2")||t.endsWith("Y3")){const e=t.endsWith("Y2")?"Y2":"Y3",n=t.slice(0,-2),r=Ki(he,i.slice(1,-1).concat(n));if(void 0!==r){if("unitCost"===n||n.startsWith("unitCost")){const i=Ki(he,["temelBilgiler","inflation"])||{},t=1+Number((null===i||void 0===i?void 0:i.y2)||0),n=t*(1+Number((null===i||void 0===i?void 0:i.y3)||0));return"Y2"===e?Number(r)*t:Number(r)*n}return r}}if(("studentCountY2"===t||"studentCountY3"===t)&&he){const e=Ki(he,i.slice(1,-1));if(e&&"object"===typeof e){const i=e.studentCount;if(null!=i)return i}}const n=i.indexOf("years");if(n>=0&&i.length>n+1&&he){const e=i[n+1];if("y2"===e||"y3"===e){const t=[...i];t[n+1]="y1";const r=Ki(he,t.slice(1));if(void 0!==r){if(i.includes("ik")&&i.includes("unitCosts")){const i=Ki(he,["ik","unitCostRatio"]),t=Number(i);if(Number.isFinite(t)){const i=Number(r),n="y2"===e?t:t*t;return Number.isFinite(i)?i*n:void 0}}return r}}}if("ik.years"===i.slice(1,3).join(".")&&he){if(i.includes("unitCostRatio")){const e=Ki(he,["ik","unitCostRatio"]);return void 0!==e?e:1}if(["unitCosts","headcountsByLevel"].some(e=>i.includes(e)))return 0}if(("y1"===t||"y2"===t||"y3"===t)&&he){const e=Ki(he,i.slice(1,-1));if(e&&"object"===typeof e&&null!=e.y1)return e.y1;const t=i.indexOf("byKademe");if(t>=1&&i.length>t+1){const e=i[t+1],n=Ki(he,["kapasite","byKademe",e,"caps","y1"]);if(void 0!==n)return n}const n=Ki(he,["kapasite","years","y1"]);if(void 0!==n)return n}if("cur"===t&&he){const e=i.indexOf("byKademe");if(e>=1&&i.length>e+1){const t=i[e+1],n=Ki(he,["kapasite","byKademe",t,"caps","cur"]);if(void 0!==n)return n}const t=Ki(he,["kapasite","currentStudents"]);if(void 0!==t)return t}return}return"norm"===i[0]?Ki(_e,i.slice(1)):void 0}},[he,_e]),Di=we("inputs.")||we("norm."),Wi=(0,r.useCallback)(async()=>{if(ni){if(Di){if(!await Fi())return}await se(ni)}},[ni,Di,Fi,se]),Ui=(0,r.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"approve";if(ni&&null!==Y&&void 0!==Y&&Y.id&&!X){Q(!0);try{await a.FH.reviewWorkItem(I,Y.id,ni,{action:e}),o.oR.success("approve"===e?"Onayland\u0131":"Revize istendi"),await oe(),await ae()}catch(i){o.oR.error((null===i||void 0===i?void 0:i.message)||"\u0130\u015flem ba\u015far\u0131s\u0131z")}finally{Q(!1)}}},[ni,null===Y||void 0===Y?void 0:Y.id,X,I,oe,ae]),Gi=String((null===R||void 0===R?void 0:R.role)||""),Zi=Di&&!(ni&&"submitted"===li&&Gi&&!("accountant"===Gi)),$i="submitted"===li?"Modul incelemede":"approved"===li?"Modul onaylandi":"Modul kilitli",qi=Ii?"Senaryo kilitli":oi?$i:"",Vi=!!ni&&($.length?$.includes(ni):!hi||w.has(ni)),Ji=ni&&Vi&&!Ii&&["not_started","in_progress","needs_revision"].includes(li),Xi=(0,r.useCallback)((e,i)=>{if(!e)return;if(Ei&&(e.startsWith("inputs.")||e.startsWith("norm.")))return;e.startsWith("inputs.")&&ve(t=>{if(!t)return t;const n=e.split(".");if(Pi(Ki(t,n.slice(1)),i))return t;const r=structuredClone(t),l=function(e,i,t){if(!e||!Array.isArray(i)||!i.length)return!1;let n=e;for(let l=0;l<i.length-1;l++){const e=i[l];if(null==n)return!1;if(Array.isArray(n)){const i=x(n,e);if(i<0)return!1;null!=n[i]&&"object"===typeof n[i]||(n[i]={}),n=n[i];continue}if("object"!==typeof n)return!1;null!=n[e]&&"object"===typeof n[e]||(n[e]={}),n=n[e]}const r=i[i.length-1];if(Array.isArray(n)){const e=x(n,r);return!(e<0)&&(n[e]=t,!0)}return null!=n&&"object"===typeof n&&(n[r]=t,!0)}(r,n.slice(1),i);return l?r:t});const t=Ti(e),n=Pi(i,t);be(i=>{const t=new Set(i);return n?t.delete(e):t.add(e),function(e,i){if(e===i)return!0;if(e.size!==i.size)return!1;for(const t of e)if(!i.has(t))return!1;return!0}(i,t)?i:t})},[Ei,Ti,ve]);(0,r.useEffect)(()=>{const e=e=>{Zi&&(e.preventDefault(),e.returnValue="")};return Zi&&window.addEventListener("beforeunload",e),()=>{window.removeEventListener("beforeunload",e)}},[Zi]),(0,r.useEffect)(()=>{try{window.__fsUnsavedChanges=Zi}catch(e){}return()=>{try{window.__fsUnsavedChanges=!1}catch(e){}}},[Zi]);const Qi=r.useCallback(e=>{if(Ei)return;const i=(null===e||void 0===e?void 0:e.y1)||{},t=["turkPersonelMaas","turkDestekPersonelMaas","yerelPersonelMaas","yerelDestekPersonelMaas","internationalPersonelMaas"];ve(e=>{var n,r;const l=e||{},o=(null===l||void 0===l||null===(n=l.giderler)||void 0===n||null===(r=n.isletme)||void 0===r?void 0:r.items)||{};let a=!1;for(const u of t){const e=Number((null===o||void 0===o?void 0:o[u])||0),t=Number((null===i||void 0===i?void 0:i[u])||0);if(Math.abs(e-t)>1e-6){a=!0;break}}if(!a)return e;const s=structuredClone(l);s.giderler=s.giderler||{},s.giderler.isletme=s.giderler.isletme||{},s.giderler.isletme.items=s.giderler.isletme.items||{};for(const u of t)s.giderler.isletme.items[u]=Number((null===i||void 0===i?void 0:i[u])||0);if(pi)for(const u of t)Xi("inputs.giderler.isletme.items.".concat(u),Number((null===i||void 0===i?void 0:i[u])||0));return s})},[Ei,Xi,pi]),et=r.useCallback(e=>{Ei||e&&"object"===typeof e&&ve(i=>{let t=structuredClone(i||{});return t.gradesYears=e,Array.isArray(e.y1)&&(t.grades=structuredClone(e.y1)),t=Oi(t),t})},[Oi,Ei]),it=(0,r.useCallback)(e=>{Ei||de(i=>"function"===typeof e?e(i):e)},[Ei,de]),tt=k.has(ti),nt=ye||Ae||ze||!je,rt=e=>{if(!e)return"";const i=Math.max(0,(Be||Date.now())-e);return i<6e4?"az once":i<36e5?"".concat(Math.floor(i/6e4)," dk once"):"".concat(Math.floor(i/36e5)," saat once")};function lt(e){switch(e){case"Revize istendi":return"is-bad";case"Merkeze iletildi":case"\u0130ncelemede":case"Haz\u0131rlan\u0131yor":return"is-warn";case"Kontrol edildi":case"Onayland\u0131":return"is-ok";default:return"is-muted"}}(0,r.useEffect)(()=>{nt&&Re(!1)},[nt]);const ot={schoolId:I,school:E,me:R,inputs:fe,setField:function(e,i){if(Ei)return;const t=structuredClone(fe||{}),n=e.split(".");let r=t;for(let l=0;l<n.length-1;l++)r[n[l]]=r[n[l]]||{},r=r[n[l]];r[n[n.length-1]]=i,ve(t)},norm:ue,setNorm:it,handlePlanningGradesChange:et,dirtyPaths:ge,markDirty:Xi,baseYear:si,programType:fi,inputCurrencyCode:ui,selectedScenario:Y,prevReport:P,prevScenarioMeta:T,report:je,reportCurrency:Ge,setReportCurrency:Ze,reportMode:qe,reportModeLoading:Je,handleReportModeChange:Ci,detailedReportMode:Qe,setDetailedReportMode:ei,reportExportRef:Ye,progMap:ki,normAvgPct:_i,expensesAvgPct:Si,normMissingLines:Ni,expensesMissingLines:wi,uiScopeKey:Ue,handleIkSalaryComputed:Qi,workItems:W,refreshWorkItems:oe,submitWorkItem:se};return(0,b.jsxs)("div",{className:"container school-page",children:[(0,b.jsx)(o.N9,{position:"bottom-right",autoClose:3500,newestOnTop:!0,closeOnClick:!0,pauseOnFocusLoss:!0,pauseOnHover:!0,hideProgressBar:!0,theme:"dark"}),(0,b.jsx)("style",{children:"@keyframes schoolSpin{to{transform:rotate(360deg)}}"}),Ke?(0,b.jsx)("div",{className:"modal-backdrop",role:"status","aria-live":"polite","aria-busy":"true",children:(0,b.jsxs)("div",{className:"card",style:{width:"min(420px, 92vw)",padding:"18px 16px",textAlign:"center"},children:[(0,b.jsx)("div",{"aria-hidden":!0,style:{width:36,height:36,margin:"0 auto",borderRadius:"50%",border:"3px solid rgba(0,0,0,.15)",borderTopColor:"rgba(0,0,0,.75)",animation:"schoolSpin .8s linear infinite"}}),(0,b.jsx)("div",{style:{fontWeight:800,marginTop:12},children:De||"Yukleniyor..."}),(0,b.jsx)("div",{className:"small muted",style:{marginTop:6},children:"Lutfen bekleyin..."})]})}):null,F?(0,b.jsx)("div",{className:"card",style:{marginTop:10,background:"#fff1f2",borderColor:"#fecaca"},children:F}):null,te?(0,b.jsx)(l.sv,{context:ot}):(0,b.jsxs)("div",{className:"card",style:{marginTop:12},children:[(0,b.jsx)("div",{style:{fontWeight:700},children:"Okul & Senaryo Sec"}),(0,b.jsx)("div",{className:"small",style:{marginTop:6},children:"Bu bolumu acmak icin once okul ve senaryo secin."}),(0,b.jsx)("button",{type:"button",className:"btn primary",style:{marginTop:12},onClick:()=>M("/select?schoolId=".concat(I)),children:"Okul & Senaryo Sec"})]}),function(){var e,i,t,n,r,l,d,c,m,f,v,p,g,h;if(!tt)return null;const k={temel:"temel_bilgiler",kapasite:"kapasite",norm:"norm.ders_dagilimi",ik:"ik.local_staff",gelir:"gelirler.unit_fee",gider:"giderler.isletme"},_=[],S=" (Opsiyonel)";ki&&ki.temelBilgiler&&_.push({key:"temel",label:hi?"Temel".concat(S):"Temel",labelShort:"Temel",pct:C(ki.temelBilgiler),done:!0===ki.temelBilgiler.done,isOptional:hi}),ki&&ki.kapasite&&_.push({key:"kapasite",label:hi?"Kapasite".concat(S):"Kapasite",labelShort:"Kap",pct:C(ki.kapasite),done:!0===ki.kapasite.done,isOptional:hi});const N=gi?!0===(null===ki||void 0===ki||null===(e=ki.gradesPlan)||void 0===e?void 0:e.done)||void 0===(null===ki||void 0===ki||null===(i=ki.gradesPlan)||void 0===i?void 0:i.done):(!0===(null===ki||void 0===ki||null===(t=ki.gradesPlan)||void 0===t?void 0:t.done)||void 0===(null===ki||void 0===ki||null===(n=ki.gradesPlan)||void 0===n?void 0:n.done))&&(!0===(null===ki||void 0===ki||null===(r=ki.norm)||void 0===r?void 0:r.done)||void 0===(null===ki||void 0===ki||null===(l=ki.norm)||void 0===l?void 0:l.done));_.push({key:"norm",label:hi?"Norm".concat(S):"Norm",labelShort:"Norm",pct:Number.isFinite(_i)?_i:0,done:N,isOptional:hi}),ki&&ki.ik&&_.push({key:"ik",label:"?K",labelShort:"?K",pct:C(ki.ik),done:!0===ki.ik.done}),ki&&ki.gelirler&&_.push({key:"gelir",label:"Gelir",labelShort:"Gel",pct:C(ki.gelirler),done:!0===ki.gelirler.done});const w=hi?!0===(null===ki||void 0===ki||null===(d=ki.giderler)||void 0===d?void 0:d.done)||void 0===(null===ki||void 0===ki||null===(c=ki.giderler)||void 0===c?void 0:c.done):(!0===(null===ki||void 0===ki||null===(m=ki.giderler)||void 0===m?void 0:m.done)||void 0===(null===ki||void 0===ki||null===(f=ki.giderler)||void 0===f?void 0:f.done))&&(!0===(null===ki||void 0===ki||null===(v=ki.discounts)||void 0===v?void 0:v.done)||void 0===(null===ki||void 0===ki||null===(p=ki.discounts)||void 0===p?void 0:p.done));_.push({key:"gider",label:"Gider",labelShort:"Gid",pct:Number.isFinite(Si)?Si:0,done:w});const j=_.filter(e=>!e.isOptional).every(e=>e.done),A=null===Y||void 0===Y?void 0:Y.progress_pct,x=Y?function(e,i){if(!e)return null;const t=String(e.status||"draft");if("draft"===t){const e=Number(i);return Number.isFinite(e)&&e>0?"Haz\u0131rlan\u0131yor":"Taslak"}return"in_review"===t?"\u0130ncelemede":"revision_requested"===t?"Revize istendi":"sent_for_approval"===t||"submitted"===t?"Merkeze iletildi":"approved"===t?e.sent_at?"Onayland\u0131":"Kontrol edildi":"Taslak"}(Y,A):null,M=x&&["\u0130ncelemede","Revize istendi","Merkeze iletildi","Kontrol edildi","Onayland\u0131"].includes(x)?x:null,O=M?lt(M):null,B=G&&ni?function(e){switch(String(e||"not_started")){case"approved":return"Kontrol edildi";case"needs_revision":return"Revize istendi";case"submitted":return"\u0130ncelemede";case"in_progress":return"Haz\u0131rlan\u0131yor";default:return"Taslak"}}(li):null,F=B?lt(B):null,H=Boolean(ni&&B);let z=null;if("Kontrol edildi"===M&&null!==Y&&void 0!==Y&&Y.checked_at){const e=new Date(Y.checked_at);z="Kontrol: ".concat(Number.isFinite(e.getTime())?e.toLocaleString():"")}else if("Merkeze iletildi"===M&&null!==Y&&void 0!==Y&&Y.sent_at){const e=new Date(Y.sent_at);z="\u0130letildi: ".concat(Number.isFinite(e.getTime())?e.toLocaleString():"")}else if("Onayland\u0131"===M&&null!==Y&&void 0!==Y&&Y.reviewed_at){const e=new Date(Y.reviewed_at);z="Onay: ".concat(Number.isFinite(e.getTime())?e.toLocaleString():"")}let P=null,K=null;const T="Merkeze iletildi"===M||"Onayland\u0131"===M,D=T||!ni||G&&V,U=D?M:null,Z=D?O:null,$=D?z:null;if(T&&U)P={label:U,className:Z,tooltip:$};else if(H){P={label:B,className:F};U&&U!==B&&!("Revize istendi"===U&&"needs_revision"!==li||"Kontrol edildi"===U&&"needs_revision"===li||"\u0130ncelemede"===U&&"approved"===li)&&(K={label:U,className:Z,tooltip:$})}else U?(P={label:U,className:Z,tooltip:$},B&&B!==U&&(K={label:B,className:F})):B&&(P={label:B,className:F});const q=[];Me&&q.push("Kaydedildi ".concat(rt(Me))),Ie&&q.push("Hesapland\u0131 ".concat(rt(Ie)));let J=!1;try{var Q,ee;J="1"===(null===(Q=window)||void 0===Q||null===(ee=Q.localStorage)||void 0===ee?void 0:ee.getItem("fs_debug_kpi"))}catch(Ze){J=!1}if(J){const e=["calc:".concat(Ae?"1":"0"),"lastCalc:".concat(Ie?new Date(Ie).toLocaleTimeString():"none"),"report:".concat(je?"yes":"no")];q.push("DEBUG ".concat(e.join(" \u2022 ")))}const ie=q.join(" \u2022 "),ne=Boolean(ie),re=String((null===R||void 0===R?void 0:R.role)||""),le=null!==(g=null!==(h=null===E||void 0===E?void 0:E.country_id)&&void 0!==h?h:null===R||void 0===R?void 0:R.country_id)&&void 0!==g?g:null,se={schoolId:I,countryId:le},ue=null===Y||void 0===Y?void 0:Y.status,de=Y&&Y.id,ce=(e,i)=>{try{return(0,u.$3)(R,e,i,se)}catch(t){return!1}},me={temel:"basics",kapasite:"kapasite",norm:"norm",ik:"hr",gelir:"income",gider:"expenses"},ve={temel:"temel_bilgiler",kapasite:"kapasite",norm:"norm",ik:"ik",gelir:"gelirler",gider:"giderler"},pe={temel_bilgiler:"temel",kapasite:"kapasite","norm.ders_dagilimi":"norm","ik.local_staff":"ik","gelirler.unit_fee":"gelir","giderler.isletme":"gider"}[String(ni||"")]||null,ge=_.find(e=>e.key===pe),be=!!ge&&!0===ge.done,he=de&&["draft","in_review","revision_requested"].includes(ue)&&("principal"===re||"hr"===re||"manager"===re||"accountant"===re),ke=(ni&&{temel_bilgiler:["page.temel_bilgiler"],kapasite:["section.kapasite.caps","page.kapasite"],"norm.ders_dagilimi":["section.norm.ders_dagilimi","page.norm"],"ik.local_staff":["section.ik.local_staff","page.ik"],"gelirler.unit_fee":["section.gelirler.unit_fee","page.gelirler"],"giderler.isletme":["section.giderler.isletme","page.giderler"]}[String(ni)]||[]).some(e=>{try{return ce(e,"write")}catch(i){return!1}}),_e=de&&("accountant"===re||"manager"===re||ce("scenario.forward","write"))&&"approved"===ue&&!(null!==Y&&void 0!==Y&&Y.sent_at)&&(null===Y||void 0===Y?void 0:Y.checked_at),Se=de&&("admin"===re||ce("admin.scenario.review","write"))&&"sent_for_approval"===ue,Ne=de&&ni&&"submitted"===li&&("admin"===re||"manager"===re||"accountant"===re||ce("page.manage_permissions","read")||ce("page.manage_permissions","write")),we=X||ye||Ae||Di;let Ce="Mod\xfcl\xfc onayla";Di?Ce="\xd6nce de\u011fi\u015fiklikleri kaydedin.":ye?Ce="Kaydetme devam ediyor.":Ae?Ce="Hesaplama devam ediyor.":X&&(Ce="Onaylan\u0131yor...");const xe=["page.temel_bilgiler","page.kapasite","page.norm","page.ik","page.gelirler","page.giderler"].every(e=>{try{return(0,u.$3)(R,e,"write",se)}catch(i){return!1}}),Oe=[];let Ee=!0,Be="",Fe=null,Ye=null;if(Se)Be="Onayla",Fe=(0,b.jsx)(y.A7C,{"aria-hidden":"true"}),Ee=!1,ye&&(Ee=!0,Oe.push("Kaydetme devam ediyor.")),Ae&&(Ee=!0,Oe.push("Hesaplama devam ediyor.")),Ee||(Ye=async()=>{try{await a.FH.adminReviewScenario(Y.id,{action:"approve"}),o.oR.success("Onayland\u0131"),await oe(),await ae()}catch(e){o.oR.error((null===e||void 0===e?void 0:e.message)||"Onay ba\u015far\u0131s\u0131z")}});else if(_e){if(Be="Merkeze ilet",Fe=(0,b.jsx)(y.Cer,{"aria-hidden":"true"}),Ee=!1,!j){Ee=!0;const e=_.filter(e=>!e.done&&!e.isOptional);Oe.push("T\xfcm mod\xfcller tamamlanmal\u0131: "+e.map(e=>"".concat(e.label," ").concat(e.pct,"%")).join(", "))}Di&&(Ee=!0,Oe.push("\xd6nce de\u011fi\u015fiklikleri kaydedin.")),ye&&(Ee=!0,Oe.push("Kaydetme devam ediyor.")),Ae&&(Ee=!0,Oe.push("Hesaplama devam ediyor.")),Ii&&(Ee=!0,Oe.push("Senaryo kilitli.")),Ee||(Ye=async()=>{try{if(!Yi("Hesaplama"))return;if(!Hi("Hesaplama"))return;if(Di){if(!await Fi())return}if(!await zi({keepTab:!0}))return;await a.FH.sendForApproval(I,Y.id),o.oR.success("Merkeze iletildi"),await oe(),await ae()}catch(e){o.oR.error((null===e||void 0===e?void 0:e.message)||"\u0130letme ba\u015far\u0131s\u0131z")}})}else if(he){Be="G\xf6nder",Fe=(0,b.jsx)(y.Cer,{"aria-hidden":"true"}),Ee=!1,ni||(Ee=!0,Oe.push("G?nderilecek bir mod?l yok."));ni&&!Vi?(Ee=!0,Oe.push("HQ senaryoda bu mod?l opsiyonel; g?nderilmesi gerekmiyor.")):(ni&&!ke&&(Ee=!0,Oe.push("Bu mod?l? g?nderme yetkiniz yok.")),ni&&!Ji&&(Ee=!0,Oe.push($i||"Mod?l g?nderilemez")),be||(Ee=!0,Oe.push("Bu mod?l tamamlanmal?.")),Di&&(Ee=!0,Oe.push("?nce de?i?iklikleri kaydedin.")),ye&&(Ee=!0,Oe.push("Kaydetme devam ediyor.")),Ae&&(Ee=!0,Oe.push("Hesaplama devam ediyor.")),Ii&&(Ee=!0,Oe.push("Senaryo kilitli."))),!Ee&&ni&&ke&&Ji&&be&&(Ye=async()=>{await Wi()})}const Ke=Oe.length>0?Oe.join(" \u2022 "):void 0,Te=Boolean(je),De=Di?"Kaydet & Hesapla":Te?"Yeniden Hesapla":"Hesapla",We=ze?"PDF hazirlaniyor...":"Disa Aktar",Ue="report"===ti||Te;return(0,b.jsx)("div",{className:"school-sticky-footer",role:"region","aria-label":"Scenario actions",children:(0,b.jsxs)("div",{className:"school-sticky-footer-inner",children:[(0,b.jsxs)("div",{className:"school-footer-left",children:[(0,b.jsxs)("div",{className:"school-footer-pills",role:"status","aria-live":"polite",children:[P?(0,b.jsx)("span",{className:"school-pill ".concat(P.className),title:P.tooltip,children:P.label}):null,K?(0,b.jsx)("span",{className:"school-pill ".concat(K.className),title:K.tooltip,children:K.label}):null,fe?(0,b.jsx)("span",{className:"school-pill is-warn ".concat(Di?"":"is-placeholder"),title:Di?"Kaydedilmemi\u015f de\u011fi\u015fiklikler var":void 0,"aria-hidden":Di?void 0:"true",children:"\u25cf De\u011fi\u015fiklik var"}):null]}),fe?(0,b.jsx)("div",{className:"school-footer-meta small ".concat(ne?"":"is-placeholder"),title:ne?ie:void 0,"aria-hidden":ne?void 0:"true",children:ne?ie:"Kaydedildi"}):null]}),fe?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"school-footer-middle",children:(0,b.jsx)("div",{className:"module-progress",role:"progressbar","aria-valuemin":"0","aria-valuemax":"100",children:_.map(e=>{const i=me[e.key],t=Boolean(i&&(e=>{const i=ve[e];if(!i)return!1;if(ce("page.".concat(i),"read"))return!0;const t=Array.isArray(null===R||void 0===R?void 0:R.permissions)?R.permissions:[],n=se.countryId;return t.some(e=>{if("read"!==e.action&&"write"!==e.action)return!1;if(!String(e.resource||"").startsWith("section.".concat(i,".")))return!1;const t=null!=e.scope_country_id?Number(e.scope_country_id):null,r=null!=e.scope_school_id?Number(e.scope_school_id):null;return(null==t||null==n||Number(t)===Number(n))&&(null==r||null==I||Number(r)===Number(I))&&(null==r||null!=I)&&(null==t||null!=n)})})(e.key)),n=pe===e.key,r=function(e,i,t){if("approved"===i&&t)return"is-final";if(["sent_for_approval","submitted"].includes(String(i||"")))return"is-forwarded";switch(String(e||"not_started")){case"needs_revision":return"is-revision";case"approved":return"is-approved";case"submitted":return"is-review";default:return"is-draft"}}((e=>{if(!e)return"not_started";if(!G)return"not_started";const i=k[e];if(!i)return"not_started";const t=Array.isArray(W)?W.find(e=>String(null===e||void 0===e?void 0:e.work_id)===String(i)):null;return null!==t&&void 0!==t&&t.state?String(t.state):"not_started"})(e.key),null===Y||void 0===Y?void 0:Y.status,null===Y||void 0===Y?void 0:Y.sent_at),l=t?"button":"div";return(0,b.jsxs)(l,{type:t?"button":void 0,onClick:t?()=>ai(i):void 0,className:"module-seg ".concat(t?"is-clickable":""," ").concat(n?"is-active":""),title:"".concat(e.label,": ").concat(Math.round(e.pct),"% ").concat(e.done?"Tamamland\u0131":"Eksik"),"aria-disabled":t?void 0:"true",children:[(0,b.jsx)("div",{className:"module-title",children:e.labelShort}),(0,b.jsxs)("div",{className:"module-bar",children:[(0,b.jsx)("div",{className:"module-fill ".concat(r),style:{width:"".concat(Math.min(100,Math.max(0,Math.round(e.pct))),"%")}}),(0,b.jsxs)("span",{className:"module-percent",children:[Math.round(e.pct),"%"]})]})]},e.key)})})}),(0,b.jsxs)("div",{className:"school-footer-right",children:[Ne?(0,b.jsx)(s.A,{lines:Ce?[Ce]:[],children:(0,b.jsxs)("button",{type:"button",className:"topbar-btn is-primary",onClick:()=>Ui("approve"),disabled:we,title:Ce,children:[(0,b.jsx)(y.A7C,{"aria-hidden":"true"}),(0,b.jsx)("span",{children:X?"Onaylan\u0131yor...":"Onayla"})]})}):null,Be?(0,b.jsx)(s.A,{lines:Ke?[Ke]:[],children:(0,b.jsxs)("button",{type:"button",className:"topbar-btn is-primary",onClick:Ye,disabled:Ee,title:Ke,children:[Fe,(0,b.jsx)("span",{children:Be})]})}):null,(0,b.jsxs)("button",{type:"button",className:"topbar-btn "+(Di&&!ye?"is-save":"is-ghost"),onClick:Fi,disabled:!Di||ye||Ei,title:Ei?qi:Di?"De\u011fi\u015fiklikleri kaydet":"Kaydedilecek de\u011fi\u015fiklik yok",children:[(0,b.jsx)(y.dIn,{"aria-hidden":"true"}),(0,b.jsx)("span",{children:ye?"Kaydediliyor...":Di?"Kaydet":"Kaydedildi"})]}),xe?(0,b.jsxs)("button",{type:"button",className:"topbar-btn is-primary",onClick:async()=>{if(!ye&&!Ae&&Yi("Hesaplama")&&Hi("Hesaplama")){if(Di){return void(await Fi()&&await zi())}await zi()}},disabled:ye||Ae,title:De,children:[(0,b.jsx)(y.Ani,{"aria-hidden":"true"}),(0,b.jsx)("span",{children:Ae?"Hesaplan\u0131yor...":De})]}):null,Ue?(0,b.jsxs)("div",{className:"action-menu",ref:He,children:[(0,b.jsxs)("button",{type:"button",className:"topbar-btn is-ghost ".concat(ze?"is-loading":""),onClick:()=>{nt||Re(e=>!e)},disabled:nt,"aria-haspopup":"menu","aria-expanded":Le,"aria-busy":ze?"true":void 0,children:[ze?(0,b.jsx)("span",{className:"pdf-export-spinner","aria-hidden":"true"}):null,ze?null:(0,b.jsx)(y.Mbn,{"aria-hidden":"true"}),(0,b.jsx)("span",{children:We})]}),Le?(0,b.jsxs)("div",{className:"action-menu-panel action-menu-panel--up",role:"menu",children:[(0,b.jsx)("button",{type:"button",className:"action-menu-item",onClick:()=>{Re(!1),async function(){if(te){L("");try{await a.FH.downloadXlsx(I,te,Ge,qe)}catch(e){L(e.message||"Download failed")}}}()},disabled:nt,role:"menuitem",children:"Excel (.xlsx)"}),(0,b.jsx)("button",{type:"button",className:"action-menu-item",onClick:()=>{Re(!1),async function(){if(te){L(""),Pe(!0);try{await a.FH.downloadPdf(I,te,Ge,qe)}catch(e){L(e.message||"PDF export failed")}finally{Pe(!1)}}}()},disabled:nt,role:"menuitem",children:"PDF (.pdf)"})]}):null]}):null]})]}):(0,b.jsx)("div",{className:"school-footer-right",children:(0,b.jsx)("div",{className:"school-footer-hint small",children:"\xd6nce bir senaryo se\xe7in."})})]})})}()]})}},8345(e,i,t){t.d(i,{B:()=>r});const n=["okulOncesi","ilkokul","ortaokul","lise"];function r(e){var i;const t=null===e||void 0===e||null===(i=e.temelBilgiler)||void 0===i?void 0:i.kademeler;return!(!t||"object"!==typeof t)&&n.every(e=>{var i;return!1===(null===t||void 0===t||null===(i=t[e])||void 0===i?void 0:i.enabled)})}},9322(e,i,t){t.d(i,{Rw:()=>n,Z4:()=>s,ZG:()=>o,pb:()=>a,wN:()=>l});const n={LOCAL:"local",INTERNATIONAL:"international"},r=new Set(Object.values(n));function l(e){const i=String(e||"").trim().toLowerCase();return r.has(i)?i:n.LOCAL}function o(){var e,i,t;let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const a=null!==(e=null!==(i=null===r||void 0===r||null===(t=r.temelBilgiler)||void 0===t?void 0:t.programType)&&void 0!==i?i:null===r||void 0===r?void 0:r.programType)&&void 0!==e?e:null===r||void 0===r?void 0:r.program_type;if(a)return l(a);const s=(null===o||void 0===o?void 0:o.program_type)||(null===o||void 0===o?void 0:o.programType);return s?l(s):n.LOCAL}function a(e){const i=l(arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.LOCAL);return!e||("okulOncesi"===e||(e.endsWith("Yerel")?i===n.LOCAL:!e.endsWith("Int")||i===n.INTERNATIONAL))}function s(e){const i=l(arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.LOCAL);if("okulOncesi"===e)return"okulOncesi";const t=i===n.INTERNATIONAL?"Int":"Yerel";return"".concat(e).concat(t)}}}]);
//# sourceMappingURL=693.ae8825b8.chunk.js.map