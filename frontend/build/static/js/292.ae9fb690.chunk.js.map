{"version":3,"file":"static/js/292.ae9fb690.chunk.js","mappings":"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","sources":["components/permissions/PermissionsTable.jsx","components/access/AdminCreateUserModal.jsx","components/access/AdminCreateSchoolModal.jsx","components/access/AdminSchoolPrincipalsDrawer.jsx","pages/AdminPermissionsPage.jsx","hooks/useListQueries.js"],"sourcesContent":["import React, { useEffect, useMemo, useState } from \"react\";\r\n\r\nconst stripActionSuffix = (label) => {\r\n  const raw = String(label || \"\");\r\n  return raw.replace(/\\s*(?:-|\\u2013)\\s*(View|Edit)\\s*$/i, \"\");\r\n};\r\n\r\nconst renderPermMark = (enabled) => (\r\n  <span className={`perm-mark ${enabled ? \"is-yes\" : \"is-no\"}`}>\r\n    {enabled ? (\r\n      <svg viewBox=\"0 0 24 24\" aria-hidden=\"true\" className=\"perm-mark-icon\">\r\n        <path d=\"M5 13l4 4L19 7\" />\r\n      </svg>\r\n    ) : (\r\n      <svg viewBox=\"0 0 24 24\" aria-hidden=\"true\" className=\"perm-mark-icon\">\r\n        <path d=\"M6 6l12 12M18 6l-12 12\" />\r\n      </svg>\r\n    )}\r\n  </span>\r\n);\r\n\r\nexport default function PermissionsTable({\r\n  permissionsGrouped = {},\r\n  permissionSelections = {},\r\n  permissionScopes = {},\r\n  userSchools = [],\r\n  isAdmin = false,\r\n  onTogglePermission,\r\n  onToggleGroup,\r\n  onScopeChange,\r\n  defaultCollapsed = false,\r\n}) {\r\n  // Local search state for filtering permissions\r\n  const [search, setSearch] = useState(\"\");\r\n  // Track collapsed state for groups\r\n  const [collapsedGroups, setCollapsedGroups] = useState(() => {\r\n    if (!defaultCollapsed) return {};\r\n    const groupKeys = Object.keys(permissionsGrouped || {});\r\n    if (groupKeys.length === 0) return {};\r\n    return groupKeys.reduce((acc, grp) => {\r\n      acc[grp] = true;\r\n      return acc;\r\n    }, {});\r\n  });\r\n\r\n  useEffect(() => {\r\n    if (!defaultCollapsed) return;\r\n    const groupKeys = Object.keys(permissionsGrouped || {});\r\n    if (groupKeys.length === 0) return;\r\n    setCollapsedGroups((prev) => {\r\n      let changed = false;\r\n      const next = { ...prev };\r\n      groupKeys.forEach((grp) => {\r\n        if (next[grp] == null) {\r\n          next[grp] = true;\r\n          changed = true;\r\n        }\r\n      });\r\n      return changed ? next : prev;\r\n    });\r\n  }, [defaultCollapsed, permissionsGrouped]);\r\n\r\n  const permissionRowsByGroup = useMemo(() => {\r\n    const out = {};\r\n    Object.entries(permissionsGrouped || {}).forEach(([groupName, perms]) => {\r\n      const map = new Map();\r\n      perms.forEach((perm) => {\r\n        if (!isAdmin && perm.resource === \"page.manage_permissions\") return;\r\n        const resource = String(perm.resource || \"\");\r\n        if (!resource) return;\r\n        if (!map.has(resource)) {\r\n          map.set(resource, {\r\n            resource,\r\n            label: stripActionSuffix(perm.label || resource),\r\n            readKey: `${resource}|read`,\r\n            writeKey: `${resource}|write`,\r\n          });\r\n        }\r\n      });\r\n      const rows = Array.from(map.values());\r\n      // Sort alphabetically using English locale to match UI language\r\n      rows.sort((a, b) => a.label.localeCompare(b.label, \"en\", { sensitivity: \"base\" }));\r\n      out[groupName] = rows;\r\n    });\r\n    return out;\r\n  }, [permissionsGrouped, isAdmin]);\r\n\r\n  if (!permissionsGrouped || Object.keys(permissionsGrouped).length === 0) {\r\n    return <div>No permissions defined.</div>;\r\n  }\r\n\r\n  // Search handler\r\n  const handleSearchChange = (e) => {\r\n    setSearch(e.target.value);\r\n  };\r\n\r\n  const toggleCollapse = (grp) => {\r\n    setCollapsedGroups((prev) => ({ ...prev, [grp]: !prev[grp] }));\r\n  };\r\n\r\n  return (\r\n    <>\r\n      {/* Permission search */}\r\n      <div style={{ marginBottom: 12 }}>\r\n        <input\r\n          className=\"input sm\"\r\n          placeholder=\"Search permissionsâ€¦\"\r\n          value={search}\r\n          onChange={handleSearchChange}\r\n        />\r\n      </div>\r\n      {Object.entries(permissionsGrouped).map(([grp, perms]) => {\r\n        const rows = permissionRowsByGroup[grp] || [];\r\n        if (rows.length === 0) return null;\r\n        // Filter groupKeys and rows based on search\r\n        const groupKeys = perms\r\n          .filter((perm) => (isAdmin ? true : perm.resource !== \"page.manage_permissions\"))\r\n          .map((perm) => `${perm.resource}|${perm.action}`);\r\n        const selectedCount = groupKeys.filter((k) => permissionSelections[k]).length;\r\n        const allSelected = groupKeys.length > 0 && selectedCount === groupKeys.length;\r\n        const indeterminate = selectedCount > 0 && !allSelected;\r\n        // Filter rows by search\r\n        const filteredRows = rows.filter((row) => {\r\n          if (!search) return true;\r\n          const term = search.trim().toLowerCase();\r\n          return (\r\n            (row.label || \"\").toLowerCase().includes(term) ||\r\n            (row.resource || \"\").toLowerCase().includes(term)\r\n          );\r\n        });\r\n        // Determine collapse state\r\n        const isCollapsed = collapsedGroups[grp];\r\n        return (\r\n          <div key={grp} style={{ marginBottom: 12 }}>\r\n            <div className=\"row\" style={{ alignItems: \"center\", marginBottom: 6 }}>\r\n              <input\r\n                type=\"checkbox\"\r\n                checked={allSelected}\r\n                ref={(el) => {\r\n                  if (el) el.indeterminate = indeterminate;\r\n                }}\r\n                onChange={() => onToggleGroup?.(groupKeys, !allSelected)}\r\n              />\r\n              <div\r\n                style={{ fontWeight: 600, cursor: \"pointer\", display: \"flex\", alignItems: \"center\", gap: 6 }}\r\n                onClick={() => toggleCollapse(grp)}\r\n              >\r\n                {grp}\r\n                <span style={{ fontWeight: 400, fontSize: 12, color: '#6b7280' }}>\r\n                  ({selectedCount}/{groupKeys.length} enabled)\r\n                </span>\r\n                <span style={{ fontSize: 10 }}>\r\n                  {isCollapsed ? \"â–¶\" : \"â–¼\"}\r\n                </span>\r\n              </div>\r\n            </div>\r\n            {!isCollapsed && filteredRows.length > 0 && (\r\n              <table className=\"table permissions-table\">\r\n                <thead>\r\n                  <tr>\r\n                    <th>Permission</th>\r\n                    <th style={{ textAlign: \"center\" }}>Read</th>\r\n                    <th style={{ textAlign: \"center\" }}>Write</th>\r\n                    <th>Scope</th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody>\r\n                  {filteredRows.map((row) => {\r\n                    const readSelected = Boolean(permissionSelections[row.readKey]);\r\n                    const writeSelected = Boolean(permissionSelections[row.writeKey]);\r\n                    const scopeVal =\r\n                      permissionScopes[row.writeKey] || permissionScopes[row.readKey] || \"country\";\r\n                    const scopeDisabled = !readSelected && !writeSelected;\r\n                    return (\r\n                      <tr key={row.resource}>\r\n                        <td>\r\n                          <div style={{ fontWeight: 600 }}>{row.label}</div>\r\n                          <div className=\"small\" style={{ color: '#6b7280' }}>{row.resource}</div>\r\n                        </td>\r\n                        <td style={{ textAlign: \"center\" }}>\r\n                          <button\r\n                            type=\"button\"\r\n                            className={`perm-toggle ${readSelected ? \"is-yes\" : \"is-no\"}`}\r\n                            onClick={() => onTogglePermission?.(row.readKey, scopeVal)}\r\n                            aria-pressed={readSelected}\r\n                            title=\"Read\"\r\n                          >\r\n                            {renderPermMark(readSelected)}\r\n                          </button>\r\n                        </td>\r\n                        <td style={{ textAlign: \"center\" }}>\r\n                          <button\r\n                            type=\"button\"\r\n                            className={`perm-toggle ${writeSelected ? \"is-yes\" : \"is-no\"}`}\r\n                            onClick={() => onTogglePermission?.(row.writeKey, scopeVal)}\r\n                            aria-pressed={writeSelected}\r\n                            title=\"Write\"\r\n                          >\r\n                            {renderPermMark(writeSelected)}\r\n                          </button>\r\n                        </td>\r\n                        <td>\r\n                          <select\r\n                            className=\"input sm\"\r\n                            disabled={scopeDisabled}\r\n                            value={scopeVal}\r\n                            onChange={(e) => onScopeChange?.(row.resource, e.target.value)}\r\n                          >\r\n                            <option value=\"country\">{isAdmin ? \"User Country\" : \"Country\"}</option>\r\n                            {userSchools &&\r\n                              userSchools.map((s) => (\r\n                                <option key={s.id} value={`school:${s.id}`}>\r\n                                  {s.name}\r\n                                </option>\r\n                              ))}\r\n                          </select>\r\n                        </td>\r\n                      </tr>\r\n                    );\r\n                  })}\r\n                </tbody>\r\n              </table>\r\n            )}\r\n            {!isCollapsed && filteredRows.length === 0 && (\r\n              <div className=\"small\" style={{ marginLeft: 32 }}>No permissions match your search.</div>\r\n            )}\r\n          </div>\r\n        );\r\n      })}\r\n    </>\r\n  );\r\n}\r\n","import React, { useEffect, useState } from \"react\";\r\nimport { api } from \"../../api\";\r\nimport { toast } from \"react-toastify\";\r\n\r\n/**\r\n * Modal for creating a new user in the admin context.\r\n *\r\n * Admins can assign a role (User, HR, Principal, Manager, Accountant, Admin)\r\n * and optionally assign the user to a country. A temporary password is\r\n * required. Upon successful creation, the modal will close and the\r\n * provided onCreated callback will be fired to refresh parent state.\r\n *\r\n * Props:\r\n * - show (boolean): whether the modal is visible\r\n * - onClose (function): called when the modal should close\r\n * - onCreated (function): called after a user is successfully created\r\n * - countries (array): list of countries { id, name } for the country selector\r\n */\r\nexport default function AdminCreateUserModal({ show, onClose, onCreated, countries = [] }) {\r\n  const [fullName, setFullName] = useState(\"\");\r\n  const [email, setEmail] = useState(\"\");\r\n  const [password, setPassword] = useState(\"\");\r\n  const [role, setRole] = useState(\"user\");\r\n  const [countryId, setCountryId] = useState(\"\");\r\n  const [schoolId, setSchoolId] = useState(\"\");\r\n  const [schools, setSchools] = useState([]);\r\n  const [schoolsLoading, setSchoolsLoading] = useState(false);\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  useEffect(() => {\r\n    if (!show) return;\r\n    if (role !== \"principal\") {\r\n      setSchoolId(\"\");\r\n      setSchools([]);\r\n      return;\r\n    }\r\n    if (!countryId) {\r\n      setSchoolId(\"\");\r\n      setSchools([]);\r\n      return;\r\n    }\r\n    setSchoolId(\"\");\r\n    setSchools([]);\r\n    let active = true;\r\n    setSchoolsLoading(true);\r\n    (async () => {\r\n      try {\r\n        const rows = await api.adminListCountrySchools(countryId);\r\n        const list = Array.isArray(rows) ? rows : rows?.items && Array.isArray(rows.items) ? rows.items : [];\r\n        if (active) {\r\n          setSchools(list);\r\n        }\r\n      } catch (err) {\r\n        console.error(err);\r\n        if (active) {\r\n          setSchools([]);\r\n          toast.error(err?.message || \"Failed to load schools\");\r\n        }\r\n      } finally {\r\n        if (active) setSchoolsLoading(false);\r\n      }\r\n    })();\r\n    return () => {\r\n      active = false;\r\n    };\r\n  }, [show, role, countryId]);\r\n\r\n  if (!show) return null;\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    const trimmedEmail = email.trim();\r\n    if (!trimmedEmail || !password) {\r\n      toast.error(\"Email and password are required\");\r\n      return;\r\n    }\r\n    if (password.length < 8) {\r\n      toast.error(\"Password must be at least 8 characters\");\r\n      return;\r\n    }\r\n    // Validate role\r\n    const allowedRoles = [\"user\", \"hr\", \"principal\", \"manager\", \"accountant\", \"admin\"];\r\n    if (!allowedRoles.includes(role)) {\r\n      toast.error(\"Invalid role\");\r\n      return;\r\n    }\r\n    if (role === \"principal\" && !countryId) {\r\n      toast.error(\"Country is required for principals\");\r\n      return;\r\n    }\r\n    setLoading(true);\r\n    try {\r\n      const payload = {\r\n        full_name: fullName ? fullName.trim() : null,\r\n        email: trimmedEmail,\r\n        password,\r\n        role,\r\n      };\r\n      if (countryId && countryId !== \"unassigned\") {\r\n        payload.country_id = Number(countryId);\r\n      }\r\n      const created = await api.createUser(payload);\r\n      if (role === \"principal\" && schoolId) {\r\n        const schoolIdNum = Number(schoolId);\r\n        if (Number.isFinite(schoolIdNum)) {\r\n          try {\r\n            const existing = await api.adminGetSchoolPrincipals(schoolIdNum);\r\n            const existingIds = Array.isArray(existing)\r\n              ? existing.map((u) => Number(u.id)).filter(Number.isFinite)\r\n              : [];\r\n            const newId = Number(created?.id);\r\n            if (Number.isFinite(newId) && !existingIds.includes(newId)) {\r\n              existingIds.push(newId);\r\n            }\r\n            await api.adminSetSchoolPrincipals(schoolIdNum, { userIds: existingIds });\r\n          } catch (err) {\r\n            console.error(err);\r\n            toast.error(err?.message || \"Failed to assign principal to school\");\r\n          }\r\n        }\r\n      }\r\n      toast.success(\"User created\");\r\n      // Reset form fields\r\n      setFullName(\"\");\r\n      setEmail(\"\");\r\n      setPassword(\"\");\r\n      setRole(\"user\");\r\n      setCountryId(\"\");\r\n      setSchoolId(\"\");\r\n      setSchools([]);\r\n      onCreated?.();\r\n      onClose?.();\r\n    } catch (err) {\r\n      console.error(err);\r\n      toast.error(err?.message || \"Failed to create user\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"modal-backdrop\" onClick={onClose}>\r\n      <div\r\n        className=\"modal\"\r\n        onClick={(e) => {\r\n          // Prevent backdrop click from closing when clicking inside modal\r\n          e.stopPropagation();\r\n        }}\r\n      >\r\n        <h2 style={{ marginTop: 0, marginBottom: 8 }}>Create User</h2>\r\n        <div className=\"small\" style={{ marginBottom: 12 }}>\r\n          Enter details for the new user. A temporary password must be at least 8 characters.\r\n        </div>\r\n        <form onSubmit={handleSubmit}>\r\n          <div className=\"row\" style={{ gap: 8, flexWrap: \"wrap\", marginBottom: 12 }}>\r\n            <input\r\n              className=\"input full\"\r\n              placeholder=\"Full name\"\r\n              value={fullName}\r\n              onChange={(e) => setFullName(e.target.value)}\r\n            />\r\n            <input\r\n              className=\"input full\"\r\n              placeholder=\"Email\"\r\n              type=\"email\"\r\n              value={email}\r\n              onChange={(e) => setEmail(e.target.value)}\r\n            />\r\n            <input\r\n              className=\"input full\"\r\n              placeholder=\"Temporary password\"\r\n              type=\"password\"\r\n              value={password}\r\n              onChange={(e) => setPassword(e.target.value)}\r\n            />\r\n            <select\r\n              className=\"input full\"\r\n              value={role}\r\n              onChange={(e) => setRole(e.target.value)}\r\n            >\r\n              <option value=\"user\">User</option>\r\n              <option value=\"hr\">HR</option>\r\n              <option value=\"principal\">Principal</option>\r\n              <option value=\"manager\">Manager</option>\r\n              <option value=\"accountant\">Accountant</option>\r\n              <option value=\"admin\">Admin</option>\r\n            </select>\r\n            <select\r\n              className=\"input full\"\r\n              value={countryId}\r\n              onChange={(e) => setCountryId(e.target.value)}\r\n            >\r\n              <option value=\"\">\r\n                {role === \"principal\" ? \"Select country (required)\" : \"Unassigned\"}\r\n              </option>\r\n              {countries.map((c) => (\r\n                <option key={c.id} value={c.id}>\r\n                  {c.name}\r\n                </option>\r\n              ))}\r\n            </select>\r\n            {role === \"principal\" ? (\r\n              <select\r\n                className=\"input full\"\r\n                value={schoolId}\r\n                onChange={(e) => setSchoolId(e.target.value)}\r\n                disabled={!countryId || schoolsLoading}\r\n              >\r\n                <option value=\"\">\r\n                  {schoolsLoading ? \"Loading schools...\" : \"Optional: assign to a school\"}\r\n                </option>\r\n                {schools.map((s) => (\r\n                  <option key={s.id} value={s.id}>\r\n                    {s.name}\r\n                  </option>\r\n                ))}\r\n              </select>\r\n            ) : null}\r\n          </div>\r\n          <div className=\"row\" style={{ justifyContent: \"flex-end\", gap: 8 }}>\r\n            <button type=\"button\" className=\"btn\" onClick={onClose} disabled={loading}>\r\n              Cancel\r\n            </button>\r\n            <button type=\"submit\" className=\"btn primary\" disabled={loading}>\r\n              {loading ? \"Creating...\" : \"Create User\"}\r\n            </button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import React, { useMemo, useState } from \"react\";\r\nimport { api } from \"../../api\";\r\nimport { toast } from \"react-toastify\";\r\n\r\n/**\r\n * Modal for creating a new school within a selected country.\r\n *\r\n * Admins must choose a country to assign the school to. After successful\r\n * creation, the modal closes and the parent can refresh the schools list.\r\n *\r\n * Props:\r\n * - show (boolean): whether the modal is visible\r\n * - onClose (function): called when the modal should close\r\n * - onCreated (function): called after a school is successfully created\r\n * - countries (array): list of countries { id, name }\r\n */\r\nexport default function AdminCreateSchoolModal({ show, onClose, onCreated, countries = [] }) {\r\n  const [countryId, setCountryId] = useState(\"\");\r\n  const [schoolRows, setSchoolRows] = useState([\"\"]);\r\n  const [loading, setLoading] = useState(false);\r\n  const createCount = useMemo(\r\n    () => schoolRows.reduce((count, row) => (String(row || \"\").trim() ? count + 1 : count), 0),\r\n    [schoolRows]\r\n  );\r\n\r\n  if (!show) return null;\r\n\r\n  const updateRow = (index, value) => {\r\n    setSchoolRows((prev) => {\r\n      const next = [...prev];\r\n      next[index] = value;\r\n      return next;\r\n    });\r\n  };\r\n\r\n  const addRow = () => {\r\n    setSchoolRows((prev) => [...prev, \"\"]);\r\n  };\r\n\r\n  const removeRow = (index) => {\r\n    setSchoolRows((prev) => {\r\n      if (prev.length <= 1) return prev;\r\n      return prev.filter((_, i) => i !== index);\r\n    });\r\n  };\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    const rawNames = schoolRows.map((row) => String(row || \"\").trim()).filter(Boolean);\r\n    const names = Array.from(new Set(rawNames));\r\n    if (!countryId) {\r\n      toast.error(\"Country is required\");\r\n      return;\r\n    }\r\n    if (!names.length) {\r\n      toast.error(\"At least one school name is required\");\r\n      return;\r\n    }\r\n    setLoading(true);\r\n    const errors = [];\r\n    let created = 0;\r\n    try {\r\n      for (const name of names) {\r\n        try {\r\n          await api.adminCreateCountrySchool(countryId, { name });\r\n          created += 1;\r\n        } catch (err) {\r\n          errors.push({ name, message: err?.message || \"Failed to create school\" });\r\n        }\r\n      }\r\n      if (created > 0) {\r\n        onCreated?.(countryId);\r\n      }\r\n      if (errors.length) {\r\n        toast.error(`${errors.length} of ${names.length} schools failed`);\r\n        setSchoolRows(errors.map((err) => err.name));\r\n      } else {\r\n        toast.success(`${created} schools created`);\r\n        setCountryId(\"\");\r\n        setSchoolRows([\"\"]);\r\n        onClose?.();\r\n      }\r\n    } catch (err) {\r\n      console.error(err);\r\n      toast.error(err?.message || \"Failed to create school\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"modal-backdrop\" onClick={onClose}>\r\n      <div\r\n        className=\"modal\"\r\n        onClick={(e) => {\r\n          e.stopPropagation();\r\n        }}\r\n      >\r\n        <h2 style={{ marginTop: 0, marginBottom: 8 }}>Create School</h2>\r\n        <div className=\"small\" style={{ marginBottom: 12 }}>\r\n          Choose a country and enter one or more school names.\r\n        </div>\r\n        <form onSubmit={handleSubmit}>\r\n          <div className=\"row\" style={{ gap: 8, flexWrap: \"wrap\", marginBottom: 12 }}>\r\n            <select\r\n              className=\"input full\"\r\n              value={countryId}\r\n              onChange={(e) => setCountryId(e.target.value)}\r\n              disabled={loading}\r\n            >\r\n              <option value=\"\">Select countryâ€¦</option>\r\n              {countries.map((c) => (\r\n                <option key={c.id} value={c.id}>\r\n                  {c.name}\r\n                </option>\r\n              ))}\r\n            </select>\r\n          </div>\r\n          <div style={{ display: \"grid\", gap: 8, marginBottom: 12 }}>\r\n            {schoolRows.map((row, idx) => (\r\n              <div key={`school-row-${idx}`} className=\"row\" style={{ gap: 8 }}>\r\n                <input\r\n                  className=\"input full\"\r\n                  placeholder={`School name #${idx + 1}`}\r\n                  value={row}\r\n                  onChange={(e) => updateRow(idx, e.target.value)}\r\n                  disabled={loading}\r\n                />\r\n                <button\r\n                  type=\"button\"\r\n                  className=\"btn\"\r\n                  onClick={() => removeRow(idx)}\r\n                  disabled={loading || schoolRows.length <= 1}\r\n                >\r\n                  Remove\r\n                </button>\r\n              </div>\r\n            ))}\r\n          </div>\r\n          <div className=\"row\" style={{ justifyContent: \"space-between\", gap: 8, marginBottom: 12 }}>\r\n            <button type=\"button\" className=\"btn\" onClick={addRow} disabled={loading}>\r\n              Add row\r\n            </button>\r\n            <div className=\"small\" style={{ color: \"#6b7280\" }}>\r\n              Add one school per row.\r\n            </div>\r\n          </div>\r\n          <div className=\"row\" style={{ justifyContent: \"flex-end\", gap: 8 }}>\r\n            <button type=\"button\" className=\"btn\" onClick={onClose} disabled={loading}>\r\n              Cancel\r\n            </button>\r\n            <button type=\"submit\" className=\"btn primary\" disabled={loading}>\r\n              {loading\r\n                ? \"Creating...\"\r\n                : createCount > 1\r\n                  ? `Create ${createCount} schools`\r\n                  : \"Create school\"}\r\n            </button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import React, { useEffect, useState, useMemo } from \"react\";\r\nimport { api } from \"../../api\";\r\nimport { toast } from \"react-toastify\";\r\n\r\n/**\r\n * Drawer for assigning principals to a school in the admin context.\r\n *\r\n * The drawer slides from the right and allows adding/removing principals\r\n * for the selected school. Candidate principals are filtered by country\r\n * to ensure only principals from the selected country may be assigned.\r\n *\r\n * Props:\r\n * - show: boolean controlling visibility\r\n * - school: the selected school object { id, name }\r\n * - users: array of all users (to derive principals list)\r\n * - countryId: the ID of the currently selected country\r\n * - onClose: callback when the drawer should close\r\n * - onSaved: callback after saving assignments (optional)\r\n */\r\nexport default function AdminSchoolPrincipalsDrawer({ show, school, users = [], countryId, onClose, onSaved }) {\r\n  const [assigned, setAssigned] = useState([]);\r\n  const [initialAssigned, setInitialAssigned] = useState([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [saving, setSaving] = useState(false);\r\n  const [searchTerm, setSearchTerm] = useState(\"\");\r\n\r\n  // Derive list of principal users filtered by country\r\n  const principalUsers = useMemo(\r\n    () => users.filter((u) => u.role === \"principal\" && String(u.country_id) === String(countryId)),\r\n    [users, countryId]\r\n  );\r\n\r\n  // Load existing principals when drawer opens or school changes\r\n  useEffect(() => {\r\n    async function load() {\r\n      if (!show || !school) return;\r\n      setLoading(true);\r\n      try {\r\n        const list = await api.adminGetSchoolPrincipals(school.id);\r\n        const ids = Array.isArray(list) ? list.map((u) => u.id) : [];\r\n        setAssigned(ids);\r\n        setInitialAssigned(ids);\r\n      } catch (err) {\r\n        console.error(err);\r\n        setAssigned([]);\r\n        setInitialAssigned([]);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    }\r\n    load();\r\n  }, [show, school]);\r\n\r\n  // Filter available principals based on search and not already assigned\r\n  const availablePrincipals = useMemo(() => {\r\n    const term = searchTerm.trim().toLowerCase();\r\n    return principalUsers\r\n      .filter((u) => !assigned.includes(u.id))\r\n      .filter((u) => {\r\n        if (!term) return true;\r\n        const name = (u.full_name || \"\").toLowerCase();\r\n        const email = (u.email || \"\").toLowerCase();\r\n        return name.includes(term) || email.includes(term);\r\n      });\r\n  }, [principalUsers, assigned, searchTerm]);\r\n\r\n  // Determine if assignments have changed. Hook must run before any early return.\r\n  const hasChanges = useMemo(() => {\r\n    if (assigned.length !== initialAssigned.length) return true;\r\n    for (const id of assigned) {\r\n      if (!initialAssigned.includes(id)) return true;\r\n    }\r\n    return false;\r\n  }, [assigned, initialAssigned]);\r\n\r\n  // Early return after hooks are declared\r\n  if (!show || !school) return null;\r\n\r\n  const addPrincipal = (userId) => {\r\n    setAssigned((prev) => (prev.includes(userId) ? prev : [...prev, userId]));\r\n  };\r\n\r\n  const removePrincipal = (userId) => {\r\n    setAssigned((prev) => prev.filter((id) => id !== userId));\r\n  };\r\n\r\n  const handleSave = async () => {\r\n    if (!school) return;\r\n    setSaving(true);\r\n    try {\r\n      await api.adminSetSchoolPrincipals(school.id, { userIds: assigned });\r\n      toast.success(\"Saved\");\r\n      setInitialAssigned(assigned.slice());\r\n      onSaved?.(school.id, assigned);\r\n      onClose?.();\r\n    } catch (err) {\r\n      console.error(err);\r\n      toast.error(err?.message || \"Failed to save principals\");\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  const handleCancel = () => {\r\n    // Revert to initial assignments and close\r\n    setAssigned(initialAssigned.slice());\r\n    onClose?.();\r\n  };\r\n\r\n  return (\r\n    <div className=\"drawer-backdrop\" onClick={handleCancel}>\r\n      <div\r\n        className=\"drawer\"\r\n        onClick={(e) => {\r\n          // prevent closing on clicks inside drawer\r\n          e.stopPropagation();\r\n        }}\r\n      >\r\n        <div className=\"drawer-header\" style={{ display: \"flex\", justifyContent: \"space-between\", alignItems: \"center\", marginBottom: 12 }}>\r\n          <div style={{ fontWeight: 700 }}>School: {school.name}</div>\r\n          <button className=\"btn\" style={{ border: \"none\", background: \"transparent\", padding: 0 }} onClick={handleCancel}>\r\n            Ã—\r\n          </button>\r\n        </div>\r\n        {loading ? (\r\n          <div>Loading principals...</div>\r\n        ) : principalUsers.length === 0 ? (\r\n          <div>No principals found in this country. Create a principal user first, then assign them to schools.</div>\r\n        ) : (\r\n          <>\r\n            {/* Assigned principals */}\r\n            <div style={{ marginBottom: 12 }}>\r\n              <div style={{ fontWeight: 600, marginBottom: 6 }}>Assigned principals</div>\r\n              {assigned.length === 0 ? (\r\n                <div className=\"small\">No principals assigned to this school yet.</div>\r\n              ) : (\r\n                <div className=\"row\" style={{ gap: 6, flexWrap: \"wrap\" }}>\r\n                  {assigned.map((id) => {\r\n                    const u = users.find((x) => String(x.id) === String(id));\r\n                    const label = u ? u.full_name || u.email || u.id : id;\r\n                    return (\r\n                      <div key={id} className=\"chip\">\r\n                        <span>{label}</span>\r\n                        <button\r\n                          type=\"button\"\r\n                          className=\"chip-remove\"\r\n                          onClick={() => removePrincipal(id)}\r\n                          aria-label=\"Remove principal\"\r\n                        >\r\n                          Ã—\r\n                        </button>\r\n                      </div>\r\n                    );\r\n                  })}\r\n                </div>\r\n              )}\r\n            </div>\r\n            {/* Add principal search */}\r\n            <div style={{ marginBottom: 12 }}>\r\n              <div style={{ fontWeight: 600, marginBottom: 6 }}>Add principal</div>\r\n              <input\r\n                className=\"input full\"\r\n                placeholder=\"Find a principalâ€¦\"\r\n                value={searchTerm}\r\n                onChange={(e) => setSearchTerm(e.target.value)}\r\n                style={{ marginBottom: 6 }}\r\n              />\r\n              <div style={{ maxHeight: 200, overflowY: \"auto\" }}>\r\n                {availablePrincipals.length === 0 ? (\r\n                  <div className=\"small\">No principals available</div>\r\n                ) : (\r\n                  availablePrincipals.map((u) => {\r\n                    const label = u.full_name || u.email || u.id;\r\n                    return (\r\n                      <div\r\n                        key={u.id}\r\n                        className=\"access-list-item\"\r\n                        style={{ cursor: \"pointer\" }}\r\n                        onClick={() => addPrincipal(u.id)}\r\n                      >\r\n                        <div>{label}</div>\r\n                      </div>\r\n                    );\r\n                  })\r\n                )}\r\n              </div>\r\n            </div>\r\n            {/* Drawer footer */}\r\n            <div style={{ display: \"flex\", justifyContent: \"flex-end\", gap: 8 }}>\r\n              <button className=\"btn\" onClick={handleCancel} disabled={saving}>\r\n                Cancel\r\n              </button>\r\n              <button className=\"btn primary\" onClick={handleSave} disabled={saving || !hasChanges}>\r\n                {saving ? \"Saving...\" : \"Save\"}\r\n              </button>\r\n            </div>\r\n          </>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}","import React, { useEffect, useState, useMemo, useCallback, useRef } from \"react\";\r\nimport { api } from \"../api\";\r\nimport { useAdminUsers, useListCountries } from \"../hooks/useListQueries\";\r\nimport { toast } from \"react-toastify\";\r\nimport { useOutletContext } from \"react-router-dom\";\r\nimport { FaSchool, FaUserPlus } from \"react-icons/fa\";\r\nimport PermissionsTable from \"../components/permissions/PermissionsTable\";\r\nimport AdminCreateUserModal from \"../components/access/AdminCreateUserModal\";\r\nimport AdminCreateSchoolModal from \"../components/access/AdminCreateSchoolModal\";\r\nimport AdminSchoolPrincipalsDrawer from \"../components/access/AdminSchoolPrincipalsDrawer\";\r\n\r\nconst CAPABILITY_DEFS = [\r\n  { key: \"managePermissions\", label: \"Manage Permissions\", resources: [\"page.manage_permissions\"] },\r\n  { key: \"createUser\", label: \"Create User\", resources: [\"user.create\"] },\r\n  { key: \"createSchool\", label: \"Create School\", resources: [\"school.create\"] },\r\n  {\r\n    key: \"scenarioActions\",\r\n    label: \"Scenario Actions\",\r\n    resources: [\r\n      \"scenario.create\",\r\n      \"scenario.plan_edit\",\r\n      \"scenario.copy\",\r\n      \"scenario.submit\",\r\n      \"scenario.delete\",\r\n    ],\r\n  },\r\n];\r\nconst CAPABILITY_RESOURCES = CAPABILITY_DEFS.flatMap((def) => def.resources);\r\nconst CAPABILITY_RESOURCE_SET = new Set(CAPABILITY_RESOURCES);\r\n\r\nfunction dedupePermissions(list) {\r\n  const map = new Map();\r\n  (Array.isArray(list) ? list : []).forEach((perm) => {\r\n    const key = [\r\n      perm.resource,\r\n      perm.action,\r\n      perm.scope_country_id ?? \"\",\r\n      perm.scope_school_id ?? \"\",\r\n    ].join(\"|\");\r\n    map.set(key, perm);\r\n  });\r\n  return Array.from(map.values());\r\n}\r\n\r\nfunction hasScopedWritePermission(perms, resource, countryId) {\r\n  if (!Array.isArray(perms)) return false;\r\n  return perms.some((perm) => {\r\n    if (perm.resource !== resource || perm.action !== \"write\") return false;\r\n    if (perm.scope_school_id != null) return false;\r\n    if (perm.scope_country_id == null) return true;\r\n    return Number(perm.scope_country_id) === Number(countryId);\r\n  });\r\n}\r\n\r\nfunction buildCapabilityState(perms, countryId) {\r\n  const state = {};\r\n  CAPABILITY_DEFS.forEach((def) => {\r\n    state[def.key] = def.resources.every((resource) =>\r\n      hasScopedWritePermission(perms, resource, countryId)\r\n    );\r\n  });\r\n  return state;\r\n}\r\n\r\n/**\r\n * AdminPermissionsPage renders the Access Management hub for administrators.\r\n * Administrators can manage users across all countries, assign countries and\r\n * roles, edit permissions scoped to country or schools, create users and\r\n * schools, and assign principals to schools via a drawer.  The UI is built\r\n * with a twoâ€‘pane layout and tabs for Users & Permissions and Schools &\r\n * Principals.  All UI text is English.\r\n */\r\nexport default function AdminPermissionsPage() {\r\n  const outlet = useOutletContext();\r\n  // Countries list used for filters and selectors\r\n  const [countries, setCountries] = useState([]);\r\n  // countriesLoading is unused; removed to avoid ESLint warning\r\n  // Users data and filters\r\n  const [users, setUsers] = useState([]);\r\n  const usersQuery = useAdminUsers({\r\n    limit: 50,\r\n    offset: 0,\r\n    fields: \"brief\",\r\n    order: \"full_name:asc\",\r\n  });\r\n  const usersLoading = usersQuery.isFetching;\r\n  const [searchUser, setSearchUser] = useState(\"\");\r\n  const [roleFilter, setRoleFilter] = useState(\"all\");\r\n  const [countryFilter, setCountryFilter] = useState(\"all\");\r\n  const [showUnassignedOnly, setShowUnassignedOnly] = useState(false);\r\n  const [selectedUserId, setSelectedUserId] = useState(null);\r\n  // Selected user metadata and snapshots\r\n  const [selectedUserRole, setSelectedUserRole] = useState(null);\r\n  const [selectedUserCountryId, setSelectedUserCountryId] = useState(\"\");\r\n  const [initialRole, setInitialRole] = useState(null);\r\n  const [initialCountryId, setInitialCountryId] = useState(\"\");\r\n  const [permissionSelections, setPermissionSelections] = useState({});\r\n  const [permissionScopes, setPermissionScopes] = useState({});\r\n  const [initialSelections, setInitialSelections] = useState({});\r\n  const [initialScopes, setInitialScopes] = useState({});\r\n  const [permissionsCatalog, setPermissionsCatalog] = useState(null);\r\n  const [permissionsLoading, setPermissionsLoading] = useState(false);\r\n  const [userSchools, setUserSchools] = useState([]);\r\n  const [saving, setSaving] = useState(false);\r\n  // Tab state: 'countries', 'users', or 'schools'\r\n  const [activeTab, setActiveTab] = useState(\"countries\");\r\n  // Countries tab state\r\n  const [selectedCountryIdForDrawer, setSelectedCountryIdForDrawer] = useState(null);\r\n  const [selectedAccountantId, setSelectedAccountantId] = useState(\"\");\r\n  const [assignAccountantUserId, setAssignAccountantUserId] = useState(\"\");\r\n  const [permissionsByUserId, setPermissionsByUserId] = useState({});\r\n  const [permissionsLoadingByUserId, setPermissionsLoadingByUserId] = useState({});\r\n  const permissionsByUserIdRef = useRef({});\r\n  const permissionsLoadingByUserIdRef = useRef({});\r\n  const [capabilityDraft, setCapabilityDraft] = useState(null);\r\n  const [capabilitySnapshot, setCapabilitySnapshot] = useState(null);\r\n  const [capabilitySaving, setCapabilitySaving] = useState(false);\r\n  // Create modals\r\n  const [showCreateUser, setShowCreateUser] = useState(false);\r\n  const [showCreateSchool, setShowCreateSchool] = useState(false);\r\n  // Schools tab state\r\n  const [selectedCountryId, setSelectedCountryId] = useState(\"\");\r\n  const [schools, setSchools] = useState([]);\r\n  const [searchSchool, setSearchSchool] = useState(\"\");\r\n  const [selectedSchoolId, setSelectedSchoolId] = useState(null);\r\n\r\n  const countriesQuery = useListCountries();\r\n\r\n  // Set header meta on mount/unmount\r\n  useEffect(() => {\r\n    outlet?.setHeaderMeta?.({\r\n      title: \"Access Management\",\r\n      subtitle: \"Manage users, permissions, and principal assignments\",\r\n      centered: true,\r\n    });\r\n    return () => {\r\n      outlet?.clearHeaderMeta?.();\r\n    };\r\n  }, [outlet]);\r\n\r\n  // Load list of countries\r\n  const loadCountries = useCallback(async () => {\r\n    const result = await countriesQuery.refetch();\r\n    if (result?.error) {\r\n      console.error(result.error);\r\n      toast.error(result.error?.message || \"Failed to load countries\");\r\n    }\r\n  }, [countriesQuery]);\r\n\r\n  // Load list of users\r\n  const loadUsers = useCallback(async () => {\r\n    const result = await usersQuery.refetch();\r\n    if (result?.error) {\r\n      console.error(result.error);\r\n      toast.error(result.error?.message || \"Failed to load users\");\r\n    }\r\n  }, [usersQuery]);\r\n\r\n  useEffect(() => {\r\n    const rows = countriesQuery.data;\r\n    setCountries(Array.isArray(rows) ? rows : []);\r\n  }, [countriesQuery.data]);\r\n\r\n  useEffect(() => {\r\n    const rows = usersQuery.data?.items;\r\n    setUsers(Array.isArray(rows) ? rows : []);\r\n  }, [usersQuery.data]);\r\n\r\n  useEffect(() => {\r\n    if (!countriesQuery.isError) return;\r\n    console.error(countriesQuery.error);\r\n    toast.error(countriesQuery.error?.message || \"Failed to load countries\");\r\n  }, [countriesQuery.isError, countriesQuery.error]);\r\n\r\n  useEffect(() => {\r\n    if (!usersQuery.isError) return;\r\n    console.error(usersQuery.error);\r\n    toast.error(usersQuery.error?.message || \"Failed to load users\");\r\n  }, [usersQuery.isError, usersQuery.error]);\r\n\r\n  // Load schools for selected country in Schools tab\r\n  const loadSchoolsForCountry = useCallback(async (countryId) => {\r\n    const cid = Number(countryId);\r\n    if (!Number.isFinite(cid)) {\r\n      setSchools([]);\r\n      return;\r\n    }\r\n    try {\r\n      const rows = await api.adminListCountrySchools(cid);\r\n      if (Array.isArray(rows)) {\r\n        setSchools(rows);\r\n      } else if (rows && Array.isArray(rows.items)) {\r\n        setSchools(rows.items);\r\n      } else {\r\n        setSchools([]);\r\n      }\r\n    } catch (err) {\r\n      console.error(err);\r\n      toast.error(err?.message || \"Failed to load schools\");\r\n      setSchools([]);\r\n    }\r\n  }, []);\r\n\r\n  // Load permissions catalog, user permissions, and country schools for selected user\r\n  const loadPermissionsForUser = useCallback(async (user) => {\r\n    if (!user) {\r\n      // Reset state when no user is selected\r\n      setPermissionsCatalog(null);\r\n      setPermissionSelections({});\r\n      setPermissionScopes({});\r\n      setUserSchools([]);\r\n      setSelectedUserRole(null);\r\n      setSelectedUserCountryId(\"\");\r\n      setInitialRole(null);\r\n      setInitialCountryId(\"\");\r\n      setInitialSelections({});\r\n      setInitialScopes({});\r\n      return;\r\n    }\r\n    setPermissionsLoading(true);\r\n    try {\r\n      const schoolsPromise =\r\n        user.country_id != null ? api.adminListCountrySchools(user.country_id) : Promise.resolve([]);\r\n      const [catalogData, userPerms, schoolRows] = await Promise.all([\r\n        api.adminGetPermissionsCatalog(),\r\n        api.adminGetUserPermissions(user.id),\r\n        schoolsPromise,\r\n      ]);\r\n      setPermissionsCatalog(catalogData || null);\r\n      let schoolsList = [];\r\n      if (Array.isArray(schoolRows)) {\r\n        schoolsList = schoolRows;\r\n      } else if (schoolRows && Array.isArray(schoolRows.items)) {\r\n        schoolsList = schoolRows.items;\r\n      }\r\n      setUserSchools(schoolsList);\r\n      const sel = {};\r\n      const scopes = {};\r\n      (userPerms || []).forEach((p) => {\r\n        const key = `${p.resource}|${p.action}`;\r\n        sel[key] = true;\r\n        if (p.scope_school_id != null) {\r\n          scopes[key] = `school:${p.scope_school_id}`;\r\n        } else {\r\n          scopes[key] = \"country\";\r\n        }\r\n      });\r\n      setPermissionSelections(sel);\r\n      setPermissionScopes(scopes);\r\n      setSelectedUserRole(user.role || null);\r\n      setSelectedUserCountryId(user.country_id != null ? String(user.country_id) : \"\");\r\n      setInitialRole(user.role || null);\r\n      setInitialCountryId(user.country_id != null ? String(user.country_id) : \"\");\r\n      setInitialSelections(sel);\r\n      setInitialScopes(scopes);\r\n    } catch (err) {\r\n      console.error(err);\r\n      toast.error(err?.message || \"Failed to load permissions\");\r\n    } finally {\r\n      setPermissionsLoading(false);\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    permissionsByUserIdRef.current = permissionsByUserId;\r\n  }, [permissionsByUserId]);\r\n\r\n  useEffect(() => {\r\n    permissionsLoadingByUserIdRef.current = permissionsLoadingByUserId;\r\n  }, [permissionsLoadingByUserId]);\r\n\r\n  // When selected user or users list changes: load their permissions\r\n  useEffect(() => {\r\n    const user = users.find((u) => String(u.id) === String(selectedUserId));\r\n    loadPermissionsForUser(user);\r\n  }, [selectedUserId, users, loadPermissionsForUser]);\r\n\r\n  // When selectedCountryId changes in Schools tab: load schools\r\n  useEffect(() => {\r\n    if (activeTab !== \"schools\") return;\r\n    loadSchoolsForCountry(selectedCountryId);\r\n  }, [activeTab, selectedCountryId, loadSchoolsForCountry]);\r\n\r\n  const accountantUsers = useMemo(\r\n    () => users.filter((u) => String(u.role) === \"accountant\"),\r\n    [users]\r\n  );\r\n\r\n  const accountantsByCountry = useMemo(() => {\r\n    const map = {};\r\n    accountantUsers.forEach((user) => {\r\n      const key = user.country_id != null ? String(user.country_id) : \"\";\r\n      if (!map[key]) map[key] = [];\r\n      map[key].push(user);\r\n    });\r\n    Object.values(map).forEach((list) => {\r\n      list.sort((a, b) => {\r\n        const nameA = (a.full_name || a.email || \"\").toLowerCase();\r\n        const nameB = (b.full_name || b.email || \"\").toLowerCase();\r\n        return nameA.localeCompare(nameB);\r\n      });\r\n    });\r\n    return map;\r\n  }, [accountantUsers]);\r\n\r\n  const ensureUserPermissions = useCallback(async (userId) => {\r\n    if (!userId) return [];\r\n    const cached = permissionsByUserIdRef.current[userId];\r\n    if (cached) return cached;\r\n    setPermissionsLoadingByUserId((prev) => ({ ...prev, [userId]: true }));\r\n    try {\r\n      const perms = await api.adminGetUserPermissions(userId);\r\n      const normalized = Array.isArray(perms) ? perms : [];\r\n      setPermissionsByUserId((prev) => ({ ...prev, [userId]: normalized }));\r\n      return normalized;\r\n    } catch (err) {\r\n      console.error(err);\r\n      toast.error(err?.message || \"Failed to load accountant permissions\");\r\n      return [];\r\n    } finally {\r\n      setPermissionsLoadingByUserId((prev) => {\r\n        const next = { ...prev };\r\n        delete next[userId];\r\n        return next;\r\n      });\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (activeTab !== \"countries\") return;\r\n    if (accountantUsers.length === 0) return;\r\n    const toFetch = accountantUsers.filter(\r\n      (user) =>\r\n        !permissionsByUserIdRef.current[user.id] &&\r\n        !permissionsLoadingByUserIdRef.current[user.id]\r\n    );\r\n    if (toFetch.length === 0) return;\r\n    setPermissionsLoadingByUserId((prev) => {\r\n      const next = { ...prev };\r\n      toFetch.forEach((user) => {\r\n        next[user.id] = true;\r\n      });\r\n      return next;\r\n    });\r\n    Promise.allSettled(toFetch.map((user) => api.adminGetUserPermissions(user.id)))\r\n      .then((results) => {\r\n        let hadError = false;\r\n        setPermissionsByUserId((prev) => {\r\n          const next = { ...prev };\r\n          results.forEach((result, index) => {\r\n            const userId = toFetch[index]?.id;\r\n            if (!userId) return;\r\n            if (result.status === \"fulfilled\") {\r\n              next[userId] = Array.isArray(result.value) ? result.value : [];\r\n            } else {\r\n              hadError = true;\r\n            }\r\n          });\r\n          return next;\r\n        });\r\n        if (hadError) {\r\n          toast.error(\"Failed to load some accountant permissions\");\r\n        }\r\n      })\r\n      .finally(() => {\r\n        setPermissionsLoadingByUserId((prev) => {\r\n          const next = { ...prev };\r\n          toFetch.forEach((user) => {\r\n            delete next[user.id];\r\n          });\r\n          return next;\r\n        });\r\n      });\r\n  }, [activeTab, accountantUsers]);\r\n\r\n  const selectedCountryForDrawer = useMemo(\r\n    () =>\r\n      countries.find((country) => String(country.id) === String(selectedCountryIdForDrawer)) ||\r\n      null,\r\n    [countries, selectedCountryIdForDrawer]\r\n  );\r\n\r\n  const drawerAccountants = useMemo(() => {\r\n    if (!selectedCountryForDrawer) return [];\r\n    return accountantsByCountry[String(selectedCountryForDrawer.id)] || [];\r\n  }, [accountantsByCountry, selectedCountryForDrawer]);\r\n\r\n  const assignableAccountants = useMemo(() => {\r\n    if (!selectedCountryForDrawer) return [];\r\n    return users.filter((user) => {\r\n      if (String(user.role) === \"admin\") return false;\r\n      if (user.country_id == null) return true;\r\n      return Number(user.country_id) === Number(selectedCountryForDrawer.id);\r\n    });\r\n  }, [selectedCountryForDrawer, users]);\r\n\r\n  useEffect(() => {\r\n    if (!selectedCountryForDrawer) {\r\n      setSelectedAccountantId(\"\");\r\n      setAssignAccountantUserId(\"\");\r\n      setCapabilityDraft(null);\r\n      setCapabilitySnapshot(null);\r\n      return;\r\n    }\r\n    if (drawerAccountants.length === 0) {\r\n      setSelectedAccountantId(\"\");\r\n      setCapabilityDraft(null);\r\n      setCapabilitySnapshot(null);\r\n      return;\r\n    }\r\n    const hasSelected = drawerAccountants.some(\r\n      (user) => String(user.id) === String(selectedAccountantId)\r\n    );\r\n    if (!hasSelected) {\r\n      setSelectedAccountantId(String(drawerAccountants[0].id));\r\n    }\r\n  }, [drawerAccountants, selectedAccountantId, selectedCountryForDrawer]);\r\n\r\n  useEffect(() => {\r\n    let isActive = true;\r\n    const load = async () => {\r\n      if (!selectedCountryForDrawer || !selectedAccountantId) {\r\n        setCapabilityDraft(null);\r\n        setCapabilitySnapshot(null);\r\n        return;\r\n      }\r\n      const userId = Number(selectedAccountantId);\r\n      if (!Number.isFinite(userId)) return;\r\n      const perms = await ensureUserPermissions(userId);\r\n      if (!isActive) return;\r\n      const caps = buildCapabilityState(perms, selectedCountryForDrawer.id);\r\n      setCapabilityDraft(caps);\r\n      setCapabilitySnapshot(caps);\r\n    };\r\n    load();\r\n    return () => {\r\n      isActive = false;\r\n    };\r\n  }, [ensureUserPermissions, selectedAccountantId, selectedCountryForDrawer]);\r\n\r\n  // Helper to group permissions by group name\r\n  const permissionsGrouped = useMemo(() => {\r\n    if (!permissionsCatalog) return {};\r\n    if (typeof permissionsCatalog === \"object\" && !Array.isArray(permissionsCatalog)) {\r\n      return permissionsCatalog;\r\n    }\r\n    if (Array.isArray(permissionsCatalog)) {\r\n      return permissionsCatalog.reduce((acc, perm) => {\r\n        const grp = perm.group || \"Other\";\r\n        if (!acc[grp]) acc[grp] = [];\r\n        acc[grp].push(perm);\r\n        return acc;\r\n      }, {});\r\n    }\r\n    return {};\r\n  }, [permissionsCatalog]);\r\n\r\n  /**\r\n   * Toggle a permission (read or write) while enforcing dependency rules.\r\n   * Write implies read. Disabling read will disable write. Scopes default to \"country\".\r\n   */\r\n  const togglePermission = useCallback(\r\n    (key, scopeValue = \"country\") => {\r\n      if (!key) return;\r\n      const [resource, action] = key.split(\"|\");\r\n      const readKey = `${resource}|read`;\r\n      const writeKey = `${resource}|write`;\r\n      const newSelections = { ...permissionSelections };\r\n      const newScopes = { ...permissionScopes };\r\n      const currentVal = !!permissionSelections[key];\r\n      const enable = !currentVal;\r\n      if (action === \"write\") {\r\n        if (enable) {\r\n          newSelections[writeKey] = true;\r\n          newSelections[readKey] = true;\r\n          if (!newScopes[writeKey]) newScopes[writeKey] = scopeValue || \"country\";\r\n          if (!newScopes[readKey]) newScopes[readKey] = scopeValue || \"country\";\r\n        } else {\r\n          // disabling write only\r\n          newSelections[writeKey] = false;\r\n          delete newScopes[writeKey];\r\n        }\r\n      } else {\r\n        // toggling read\r\n        if (enable) {\r\n          newSelections[readKey] = true;\r\n          if (!newScopes[readKey]) newScopes[readKey] = scopeValue || \"country\";\r\n        } else {\r\n          // disabling read removes both read and write\r\n          newSelections[readKey] = false;\r\n          newSelections[writeKey] = false;\r\n          delete newScopes[readKey];\r\n          delete newScopes[writeKey];\r\n        }\r\n      }\r\n      setPermissionSelections(newSelections);\r\n      setPermissionScopes(newScopes);\r\n    },\r\n    [permissionSelections, permissionScopes]\r\n  );\r\n\r\n  /**\r\n   * Toggle an entire group of permissions on or off. Delegates to togglePermission\r\n   * for each individual key to ensure dependency rules are enforced.\r\n   */\r\n  const togglePermissionGroup = useCallback(\r\n    (groupKeys, nextValue) => {\r\n      if (!Array.isArray(groupKeys) || groupKeys.length === 0) return;\r\n      groupKeys.forEach((k) => {\r\n        const cur = !!permissionSelections[k];\r\n        if (cur !== nextValue) {\r\n          togglePermission(k, \"country\");\r\n        }\r\n      });\r\n    },\r\n    [permissionSelections, togglePermission]\r\n  );\r\n\r\n  /**\r\n   * Change the scope for a given resource across both read and write actions.\r\n   */\r\n  function changePermissionScopeForResource(resource, value) {\r\n    const readKey = `${resource}|read`;\r\n    const writeKey = `${resource}|write`;\r\n    setPermissionScopes((prev) => {\r\n      const next = { ...prev };\r\n      if (permissionSelections[readKey]) next[readKey] = value;\r\n      if (permissionSelections[writeKey]) next[writeKey] = value;\r\n      return next;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Determine if there are unsaved changes relative to the initial snapshot.\r\n   */\r\n  const hasUnsavedChanges = useMemo(() => {\r\n    if (selectedUserId == null) return false;\r\n    if (selectedUserRole !== initialRole) return true;\r\n    if ((selectedUserCountryId || \"\") !== (initialCountryId || \"\")) return true;\r\n    const allKeys = new Set([\r\n      ...Object.keys(initialSelections || {}),\r\n      ...Object.keys(permissionSelections || {}),\r\n    ]);\r\n    for (const k of allKeys) {\r\n      const curSel = !!permissionSelections[k];\r\n      const initSel = !!initialSelections[k];\r\n      if (curSel !== initSel) return true;\r\n      const curScope = permissionScopes[k] || null;\r\n      const initScope = initialScopes[k] || null;\r\n      if (curScope !== initScope) return true;\r\n    }\r\n    return false;\r\n  }, [\r\n    selectedUserId,\r\n    selectedUserRole,\r\n    selectedUserCountryId,\r\n    initialRole,\r\n    initialCountryId,\r\n    permissionSelections,\r\n    permissionScopes,\r\n    initialSelections,\r\n    initialScopes,\r\n  ]);\r\n\r\n  /**\r\n   * Save changes for the selected user. Writes country, role and permissions to the server.\r\n   */\r\n  async function saveChanges() {\r\n    const user = users.find((u) => String(u.id) === String(selectedUserId));\r\n    if (!user) {\r\n      toast.error(\"Select a user\");\r\n      return;\r\n    }\r\n    const countryChanged = (selectedUserCountryId || \"\") !== (initialCountryId || \"\");\r\n    const roleChanged = selectedUserRole !== initialRole;\r\n    // Determine if permissions changed\r\n    let permissionsChanged = false;\r\n    const keysUnion = new Set([\r\n      ...Object.keys(initialSelections || {}),\r\n      ...Object.keys(permissionSelections || {}),\r\n    ]);\r\n    for (const k of keysUnion) {\r\n      const curSel = !!permissionSelections[k];\r\n      const initSel = !!initialSelections[k];\r\n      if (curSel !== initSel) {\r\n        permissionsChanged = true;\r\n        break;\r\n      }\r\n      const curScope = permissionScopes[k] || null;\r\n      const initScope = initialScopes[k] || null;\r\n      if (curScope !== initScope) {\r\n        permissionsChanged = true;\r\n        break;\r\n      }\r\n    }\r\n    let perms = [];\r\n    if (permissionsChanged) {\r\n      const scopeCountryId = selectedUserCountryId && selectedUserCountryId !== \"\" ? Number(selectedUserCountryId) : null;\r\n      perms = [];\r\n      Object.keys(permissionSelections || {}).forEach((k) => {\r\n        if (!permissionSelections[k]) return;\r\n        const [resource, action] = k.split(\"|\");\r\n        let scopeVal = permissionScopes[k] || \"country\";\r\n        let scope_country_id = null;\r\n        let scope_school_id = null;\r\n        if (scopeVal === \"country\") {\r\n          scope_country_id = scopeCountryId;\r\n        } else if (scopeVal.startsWith(\"school:\")) {\r\n          const sidStr = scopeVal.split(\":\")[1];\r\n          const sid = Number(sidStr);\r\n          if (Number.isFinite(sid)) {\r\n            scope_school_id = sid;\r\n          }\r\n          scope_country_id = scopeCountryId;\r\n        }\r\n        perms.push({ resource, action, scope_country_id, scope_school_id });\r\n      });\r\n    }\r\n    setSaving(true);\r\n    try {\r\n      if (countryChanged) {\r\n        const cid = selectedUserCountryId ? Number(selectedUserCountryId) : null;\r\n        await api.assignUserCountry(user.id, { country_id: cid });\r\n      }\r\n      if (roleChanged) {\r\n        await api.adminUpdateUserRole(user.id, { role: selectedUserRole });\r\n      }\r\n      if (permissionsChanged) {\r\n        await api.adminSetUserPermissions(user.id, { permissions: perms });\r\n      }\r\n      toast.success(\"Saved\");\r\n      // Reload users to update country/role badges\r\n      await loadUsers();\r\n      // Reload permissions for the selected user using updated data\r\n      await loadPermissionsForUser({\r\n        id: user.id,\r\n        role: selectedUserRole,\r\n        country_id: selectedUserCountryId ? Number(selectedUserCountryId) : null,\r\n      });\r\n      // Reset snapshot states\r\n      setInitialRole(selectedUserRole);\r\n      setInitialCountryId(selectedUserCountryId || \"\");\r\n      setInitialSelections({ ...permissionSelections });\r\n      setInitialScopes({ ...permissionScopes });\r\n    } catch (err) {\r\n      console.error(err);\r\n      toast.error(err?.message || \"Save failed\");\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Discard unsaved changes by restoring selections, scopes, role and country from snapshots.\r\n   */\r\n  function discardChanges() {\r\n    setPermissionSelections({ ...initialSelections });\r\n    setPermissionScopes({ ...initialScopes });\r\n    setSelectedUserRole(initialRole);\r\n    setSelectedUserCountryId(initialCountryId || \"\");\r\n  }\r\n\r\n  // Filter users list based on search, role, country and showUnassignedOnly\r\n  const filteredUsers = useMemo(() => {\r\n    let list = users;\r\n    if (roleFilter && roleFilter !== \"all\") {\r\n      list = list.filter((u) => u.role === roleFilter);\r\n    }\r\n    if (showUnassignedOnly) {\r\n      list = list.filter((u) => u.country_id == null);\r\n    }\r\n    if (countryFilter && countryFilter !== \"all\") {\r\n      if (countryFilter === \"unassigned\") {\r\n        list = list.filter((u) => u.country_id == null);\r\n      } else {\r\n        list = list.filter((u) => String(u.country_id) === String(countryFilter));\r\n      }\r\n    }\r\n    const term = searchUser.trim().toLowerCase();\r\n    if (term) {\r\n      list = list.filter((u) => {\r\n        const name = (u.full_name || \"\").toLowerCase();\r\n        const email = (u.email || \"\").toLowerCase();\r\n        return name.includes(term) || email.includes(term);\r\n      });\r\n    }\r\n    return list;\r\n  }, [users, roleFilter, countryFilter, searchUser, showUnassignedOnly]);\r\n\r\n  // Filter schools list based on search term\r\n  const filteredSchools = useMemo(() => {\r\n    if (!Array.isArray(schools)) return [];\r\n    const term = searchSchool.trim().toLowerCase();\r\n    if (!term) return schools;\r\n    return schools.filter((s) => {\r\n      const name = (s.name || \"\").toLowerCase();\r\n      return name.includes(term);\r\n    });\r\n  }, [schools, searchSchool]);\r\n\r\n  const capabilityDirty = useMemo(() => {\r\n    if (!capabilityDraft || !capabilitySnapshot) return false;\r\n    return CAPABILITY_DEFS.some(\r\n      (def) => capabilityDraft[def.key] !== capabilitySnapshot[def.key]\r\n    );\r\n  }, [capabilityDraft, capabilitySnapshot]);\r\n\r\n  const getUserLabel = useCallback(\r\n    (user) => user?.full_name || user?.email || user?.id || \"Unknown\",\r\n    []\r\n  );\r\n\r\n  const handleAssignAccountant = async () => {\r\n    if (!selectedCountryForDrawer || !assignAccountantUserId) return;\r\n    const userId = Number(assignAccountantUserId);\r\n    if (!Number.isFinite(userId)) return;\r\n    setCapabilitySaving(true);\r\n    try {\r\n      const selectedUser = users.find((u) => String(u.id) === String(userId));\r\n      if (!selectedUser) {\r\n        toast.error(\"User not found\");\r\n        return;\r\n      }\r\n      if (selectedUser.country_id == null || Number(selectedUser.country_id) !== Number(selectedCountryForDrawer.id)) {\r\n        await api.assignUserCountry(userId, { country_id: selectedCountryForDrawer.id });\r\n      }\r\n      await api.adminUpdateUserRole(userId, { role: \"accountant\" });\r\n      toast.success(\"Accountant assigned\");\r\n      setPermissionsByUserId((prev) => {\r\n        const next = { ...prev };\r\n        delete next[userId];\r\n        return next;\r\n      });\r\n      await loadUsers();\r\n      setAssignAccountantUserId(\"\");\r\n      setSelectedAccountantId(String(userId));\r\n    } catch (err) {\r\n      console.error(err);\r\n      toast.error(err?.message || \"Failed to assign accountant\");\r\n    } finally {\r\n      setCapabilitySaving(false);\r\n    }\r\n  };\r\n\r\n  const handleToggleCapability = (key) => {\r\n    setCapabilityDraft((prev) => ({ ...prev, [key]: !prev?.[key] }));\r\n  };\r\n\r\n  const handleDiscardCapabilities = () => {\r\n    setCapabilityDraft(capabilitySnapshot);\r\n  };\r\n\r\n  const handleSaveCapabilities = async () => {\r\n    if (!selectedCountryForDrawer || !selectedAccountantId) return;\r\n    const userId = Number(selectedAccountantId);\r\n    if (!Number.isFinite(userId)) return;\r\n    setCapabilitySaving(true);\r\n    try {\r\n      const basePerms = permissionsByUserIdRef.current[userId] || (await ensureUserPermissions(userId));\r\n      let nextPerms = (Array.isArray(basePerms) ? basePerms : []).filter(\r\n        (perm) => !CAPABILITY_RESOURCE_SET.has(perm.resource)\r\n      );\r\n      CAPABILITY_DEFS.forEach((def) => {\r\n        if (!capabilityDraft?.[def.key]) return;\r\n        def.resources.forEach((resource) => {\r\n          nextPerms.push({\r\n            resource,\r\n            action: \"read\",\r\n            scope_country_id: Number(selectedCountryForDrawer.id),\r\n            scope_school_id: null,\r\n          });\r\n          nextPerms.push({\r\n            resource,\r\n            action: \"write\",\r\n            scope_country_id: Number(selectedCountryForDrawer.id),\r\n            scope_school_id: null,\r\n          });\r\n        });\r\n      });\r\n      nextPerms = dedupePermissions(nextPerms);\r\n      await api.adminSetUserPermissions(userId, { permissions: nextPerms });\r\n      setPermissionsByUserId((prev) => ({ ...prev, [userId]: nextPerms }));\r\n      setCapabilitySnapshot(capabilityDraft);\r\n      toast.success(\"Accountant permissions updated\");\r\n    } catch (err) {\r\n      console.error(err);\r\n      toast.error(err?.message || \"Failed to update permissions\");\r\n    } finally {\r\n      setCapabilitySaving(false);\r\n    }\r\n  };\r\n\r\n  const handleOpenFullEditor = () => {\r\n    if (!selectedAccountantId) return;\r\n    setActiveTab(\"users\");\r\n    setSelectedUserId(String(selectedAccountantId));\r\n    setSelectedCountryIdForDrawer(null);\r\n  };\r\n\r\n  return (\r\n    <div className=\"permissions-page\">\r\n      <div className=\"container permissions-page-content\" style={{ padding: \"1rem\" }}>\r\n        {/* Top bar with tabs and actions */}\r\n        <div className=\"row\" style={{ justifyContent: \"space-between\", alignItems: \"center\" }}>\r\n          <div className=\"access-hub-tabs\">\r\n            <div\r\n              className={`access-hub-tab ${activeTab === \"countries\" ? \"is-active\" : \"\"}`}\r\n              onClick={() => {\r\n                setActiveTab(\"countries\");\r\n                setSelectedUserId(null);\r\n                setSelectedSchoolId(null);\r\n              }}\r\n            >\r\n              Countries & Accountants\r\n            </div>\r\n            <div\r\n              className={`access-hub-tab ${activeTab === \"users\" ? \"is-active\" : \"\"}`}\r\n              onClick={() => {\r\n                setActiveTab(\"users\");\r\n                setSelectedSchoolId(null);\r\n                setSelectedCountryIdForDrawer(null);\r\n              }}\r\n            >\r\n              Users & Permissions\r\n            </div>\r\n            <div\r\n              className={`access-hub-tab ${activeTab === \"schools\" ? \"is-active\" : \"\"}`}\r\n              onClick={() => {\r\n                setActiveTab(\"schools\");\r\n                setSelectedUserId(null);\r\n                setSelectedCountryIdForDrawer(null);\r\n              }}\r\n            >\r\n              Schools & Principals\r\n            </div>\r\n          </div>\r\n            <div className=\"row\" style={{ gap: 8 }}>\r\n              <button className=\"btn primary\" onClick={() => setShowCreateUser(true)}>\r\n                <span className=\"row\" style={{ gap: 6, alignItems: \"center\" }}>\r\n                  <FaUserPlus aria-hidden=\"true\" />\r\n                  <span>Create user</span>\r\n                </span>\r\n              </button>\r\n              <button className=\"btn primary\" onClick={() => setShowCreateSchool(true)}>\r\n                <span className=\"row\" style={{ gap: 6, alignItems: \"center\" }}>\r\n                  <FaSchool aria-hidden=\"true\" />\r\n                  <span>Create school</span>\r\n                </span>\r\n              </button>\r\n            </div>\r\n          </div>\r\n          {activeTab === \"countries\" && (\r\n            <>\r\n              <div\r\n                className={`school-assignments-overlay ${\r\n                  selectedCountryForDrawer ? \"is-open\" : \"\"\r\n                }`}\r\n                onClick={() => setSelectedCountryIdForDrawer(null)}\r\n                role=\"button\"\r\n                aria-label=\"Close country drawer\"\r\n                tabIndex={-1}\r\n              />\r\n              <aside\r\n                className={`school-assignments-drawer ${\r\n                  selectedCountryForDrawer ? \"is-open\" : \"\"\r\n                }`}\r\n              >\r\n                <div className=\"school-assignments-drawer-header\">\r\n                  <div>\r\n                    <div className=\"school-assignments-drawer-title\">Country accountants</div>\r\n                    <div className=\"school-assignments-drawer-subtitle\">\r\n                      {selectedCountryForDrawer\r\n                        ? `${selectedCountryForDrawer.name} ${selectedCountryForDrawer.code ? `(${selectedCountryForDrawer.code})` : \"\"}`\r\n                        : \"Select a country\"}\r\n                    </div>\r\n                  </div>\r\n                  <button\r\n                    className=\"btn school-assignments-close\"\r\n                    onClick={() => setSelectedCountryIdForDrawer(null)}\r\n                    aria-label=\"Close drawer\"\r\n                    type=\"button\"\r\n                  >\r\n                  x\r\n                  </button>\r\n                </div>\r\n                <div className=\"school-assignments-drawer-body\">\r\n                  {!selectedCountryForDrawer ? (\r\n                    <div className=\"school-assignments-empty\">Select a country to manage accountants.</div>\r\n                  ) : (\r\n                    <>\r\n                      <div className=\"school-assignments-section-title\">Assigned accountant</div>\r\n                      {drawerAccountants.length === 0 ? (\r\n                        <div className=\"school-assignments-add-card\">\r\n                          <div className=\"row\" style={{ flexDirection: \"column\", gap: 8 }}>\r\n                            <select\r\n                              className=\"input full\"\r\n                              value={assignAccountantUserId}\r\n                              onChange={(e) => setAssignAccountantUserId(e.target.value)}\r\n                            >\r\n                              <option value=\"\">Select user...</option>\r\n                              {assignableAccountants.map((user) => (\r\n                                <option key={user.id} value={user.id}>\r\n                                  {getUserLabel(user)}\r\n                                </option>\r\n                              ))}\r\n                            </select>\r\n                            <button\r\n                              className=\"btn primary\"\r\n                              onClick={handleAssignAccountant}\r\n                              disabled={!assignAccountantUserId || capabilitySaving}\r\n                            >\r\n                              {capabilitySaving ? \"Assigning...\" : \"Set as Accountant\"}\r\n                            </button>\r\n                            {assignableAccountants.length === 0 && (\r\n                              <div className=\"small\">No eligible users available.</div>\r\n                            )}\r\n                          </div>\r\n                        </div>\r\n                      ) : (\r\n                        <div className=\"school-assignments-add-card\">\r\n                          {drawerAccountants.length > 1 ? (\r\n                            <select\r\n                              className=\"input full\"\r\n                              value={selectedAccountantId}\r\n                              onChange={(e) => setSelectedAccountantId(e.target.value)}\r\n                            >\r\n                              {drawerAccountants.map((user) => (\r\n                                <option key={user.id} value={user.id}>\r\n                                  {getUserLabel(user)}\r\n                                </option>\r\n                              ))}\r\n                            </select>\r\n                          ) : (\r\n                            <div style={{ fontWeight: 600 }}>\r\n                              {getUserLabel(drawerAccountants[0])}\r\n                            </div>\r\n                          )}\r\n                          {drawerAccountants.length > 1 && (\r\n                            <div className=\"small\" style={{ marginTop: 6 }}>\r\n                              Multiple accountants assigned. Select one to edit.\r\n                            </div>\r\n                          )}\r\n                        </div>\r\n                      )}\r\n\r\n                      <div className=\"school-assignments-section-title\">Accountant capabilities</div>\r\n                      {!selectedAccountantId ? (\r\n                        <div className=\"school-assignments-empty\">\r\n                          Assign an accountant to edit capabilities.\r\n                        </div>\r\n                      ) : (\r\n                        <div className=\"school-assignments-card\">\r\n                          {CAPABILITY_DEFS.map((def) => (\r\n                            <label key={def.key} className=\"school-assignments-module-item\">\r\n                              <input\r\n                                type=\"checkbox\"\r\n                                checked={Boolean(capabilityDraft?.[def.key])}\r\n                                onChange={() => handleToggleCapability(def.key)}\r\n                                disabled={capabilitySaving}\r\n                              />\r\n                              <span>{def.label}</span>\r\n                            </label>\r\n                          ))}\r\n                          <div\r\n                            className=\"row\"\r\n                            style={{ justifyContent: \"flex-end\", gap: 8, marginTop: 12 }}\r\n                          >\r\n                            <button\r\n                              className=\"btn\"\r\n                              onClick={handleDiscardCapabilities}\r\n                              disabled={!capabilityDirty || capabilitySaving}\r\n                            >\r\n                              Discard\r\n                            </button>\r\n                            <button\r\n                              className=\"btn primary\"\r\n                              onClick={handleSaveCapabilities}\r\n                              disabled={!capabilityDirty || capabilitySaving}\r\n                            >\r\n                              {capabilitySaving ? \"Saving...\" : \"Save\"}\r\n                            </button>\r\n                          </div>\r\n                        </div>\r\n                      )}\r\n\r\n                      {selectedAccountantId && (\r\n                        <button\r\n                          className=\"btn\"\r\n                          onClick={handleOpenFullEditor}\r\n                          style={{ marginTop: 12 }}\r\n                        >\r\n                          Open full permission editor\r\n                        </button>\r\n                      )}\r\n                    </>\r\n                  )}\r\n                </div>\r\n              </aside>\r\n            </>\r\n          )}\r\n        {/* Tab content */}\r\n        {activeTab === \"countries\" && (\r\n          <div style={{ marginTop: 16 }}>\r\n            <div style={{ fontWeight: 700, marginBottom: 12 }}>Countries</div>\r\n            <div className=\"row\" style={{ gap: 6, marginBottom: 12, flexWrap: \"wrap\" }}>\r\n              <span className=\"role-tag is-ok\">Enabled</span>\r\n              <span className=\"role-tag is-warn\">Disabled / No accountant</span>\r\n              <span className=\"role-tag is-muted\">Loading / Unknown</span>\r\n            </div>\r\n            <div className=\"school-assignments-table-wrap\">\r\n              <table className=\"table school-assignments-table\">\r\n                <thead>\r\n                  <tr>\r\n                    <th>Country</th>\r\n                    <th>Accountant status</th>\r\n                    <th>Capabilities</th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody>\r\n                  {countries.length === 0 ? (\r\n                    <tr>\r\n                      <td colSpan={3}>No countries available.</td>\r\n                    </tr>\r\n                  ) : (\r\n                    countries.map((country) => {\r\n                      const accountants = accountantsByCountry[String(country.id)] || [];\r\n                      const primaryAccountant = accountants[0] || null;\r\n                      const hasMultiple = accountants.length > 1;\r\n                      const statusLabel =\r\n                        accountants.length === 0\r\n                          ? \"No accountant\"\r\n                          : accountants.length === 1\r\n                            ? `1 accountant: ${getUserLabel(primaryAccountant)}`\r\n                            : `Multiple accountants: ${accountants.length}`;\r\n                      const perms = primaryAccountant\r\n                        ? permissionsByUserId[primaryAccountant.id]\r\n                        : null;\r\n                      const capabilities = perms\r\n                        ? buildCapabilityState(perms, country.id)\r\n                        : null;\r\n                      const isPermsLoading =\r\n                        primaryAccountant &&\r\n                        Boolean(permissionsLoadingByUserId[primaryAccountant.id]);\r\n                      return (\r\n                        <tr\r\n                          key={country.id}\r\n                          style={{ cursor: \"pointer\" }}\r\n                          onClick={() => setSelectedCountryIdForDrawer(String(country.id))}\r\n                        >\r\n                          <td>\r\n                            <div style={{ fontWeight: 600 }}>\r\n                              {country.name}\r\n                              {country.code ? ` (${country.code})` : \"\"}\r\n                            </div>\r\n                          </td>\r\n                          <td>\r\n                            <div style={{ display: \"flex\", alignItems: \"center\", gap: 8 }}>\r\n                              <span\r\n                                className={`role-tag ${\r\n                                  accountants.length === 1 ? \"is-ok\" : \"is-warn\"\r\n                                }`}\r\n                              >\r\n                                {statusLabel}\r\n                              </span>\r\n                              {hasMultiple && <span className=\"role-tag is-warn\">Needs review</span>}\r\n                            </div>\r\n                          </td>\r\n                          <td>\r\n                            <div className=\"row\" style={{ gap: 6 }}>\r\n                              {CAPABILITY_DEFS.map((def) => {\r\n                                const enabled = capabilities?.[def.key];\r\n                                const label = def.label;\r\n                                let status = \"Unknown\";\r\n                                let badgeClass = \"role-tag is-muted\";\r\n                                if (accountants.length === 0) {\r\n                                  status = \"No accountant\";\r\n                                  badgeClass = \"role-tag is-warn\";\r\n                                } else if (isPermsLoading) {\r\n                                  status = \"Loading\";\r\n                                  badgeClass = \"role-tag is-muted\";\r\n                                } else if (!capabilities) {\r\n                                  status = \"Unknown\";\r\n                                  badgeClass = \"role-tag is-muted\";\r\n                                } else if (enabled) {\r\n                                  status = \"Enabled\";\r\n                                  badgeClass = \"role-tag is-ok\";\r\n                                } else {\r\n                                  status = \"Disabled\";\r\n                                  badgeClass = \"role-tag is-warn\";\r\n                                }\r\n                                return (\r\n                                  <span\r\n                                    key={def.key}\r\n                                    className={badgeClass}\r\n                                  >\r\n                                    {label}: {status}\r\n                                  </span>\r\n                                );\r\n                              })}\r\n                            </div>\r\n                          </td>\r\n                        </tr>\r\n                      );\r\n                    })\r\n                  )}\r\n                </tbody>\r\n              </table>\r\n            </div>\r\n          </div>\r\n        )}\r\n        {activeTab === \"users\" && (\r\n          <div className=\"access-hub-grid\" style={{ marginTop: 16 }}>\r\n            {/* Left pane: user list and filters */}\r\n            <div className=\"left-pane\">\r\n              <div style={{ marginBottom: 12, fontWeight: 700 }}>Users</div>\r\n              <div className=\"row\" style={{ flexDirection: \"column\", gap: 8 }}>\r\n                <input\r\n                  className=\"input full\"\r\n                  placeholder=\"Search users by name or emailâ€¦\"\r\n                  value={searchUser}\r\n                  onChange={(e) => setSearchUser(e.target.value)}\r\n                />\r\n                <select\r\n                  className=\"input full\"\r\n                  value={roleFilter}\r\n                  onChange={(e) => setRoleFilter(e.target.value)}\r\n                >\r\n                  <option value=\"all\">All roles</option>\r\n                  <option value=\"user\">User</option>\r\n                  <option value=\"hr\">HR</option>\r\n                  <option value=\"principal\">Principal</option>\r\n                  <option value=\"manager\">Manager</option>\r\n                  <option value=\"accountant\">Accountant</option>\r\n                  <option value=\"admin\">Admin</option>\r\n                </select>\r\n                <select\r\n                  className=\"input full\"\r\n                  value={countryFilter}\r\n                  onChange={(e) => setCountryFilter(e.target.value)}\r\n                >\r\n                  <option value=\"all\">All countries</option>\r\n                  {countries.map((c) => (\r\n                    <option key={c.id} value={String(c.id)}>\r\n                      {c.name}\r\n                    </option>\r\n                  ))}\r\n                  <option value=\"unassigned\">Unassigned</option>\r\n                </select>\r\n                <label style={{ display: \"flex\", alignItems: \"center\", gap: 6 }}>\r\n                  <input\r\n                    type=\"checkbox\"\r\n                    checked={showUnassignedOnly}\r\n                    onChange={(e) => setShowUnassignedOnly(e.target.checked)}\r\n                  />\r\n                  <span className=\"small\">Show unassigned only</span>\r\n                </label>\r\n              </div>\r\n              <div style={{ marginTop: 12 }}>\r\n                {usersLoading ? (\r\n                  <div>Loading usersâ€¦</div>\r\n                ) : filteredUsers.length === 0 ? (\r\n                  <div>No users yet. Create a user to start assigning permissions.</div>\r\n                ) : (\r\n                  filteredUsers.map((u) => {\r\n                    const isSelected = String(u.id) === String(selectedUserId);\r\n                    const name = u.full_name || u.email || u.id;\r\n                    const email = u.email || \"\";\r\n                    const roleLabel =\r\n                      u.role?.charAt(0).toUpperCase() + u.role?.slice(1) || \"\";\r\n                    const countryLabel = u.country_name || \"Unassigned\";\r\n                    return (\r\n                      <div\r\n                        key={u.id}\r\n                        className={`access-list-item ${isSelected ? \"is-selected\" : \"\"}`}\r\n                        onClick={() => setSelectedUserId(String(u.id))}\r\n                      >\r\n                        <div style={{ display: \"flex\", flexDirection: \"column\" }}>\r\n                          <div style={{ fontWeight: 600 }}>{name}</div>\r\n                          <div className=\"small\" style={{ color: \"#6b7280\" }}>\r\n                            {email}\r\n                          </div>\r\n                        </div>\r\n                        <div style={{ display: \"flex\", alignItems: \"center\", gap: 6 }}>\r\n                          <span className=\"role-tag\">{roleLabel}</span>\r\n                          <span className=\"role-tag\">{countryLabel}</span>\r\n                        </div>\r\n                      </div>\r\n                    );\r\n                  })\r\n                )}\r\n              </div>\r\n            </div>\r\n            {/* Right pane: user editor */}\r\n            <div className=\"right-pane\">\r\n              {!selectedUserId ? (\r\n                <div style={{ padding: 16 }}>Select a user from the list to edit role and permissions.</div>\r\n              ) : permissionsLoading ? (\r\n                <div>Loading permissionsâ€¦</div>\r\n              ) : (\r\n                <>\r\n                  {/* User details */}\r\n                  <div className=\"card\" style={{ marginBottom: 16 }}>\r\n                    <div style={{ fontWeight: 700, marginBottom: 8 }}>User details</div>\r\n                    {(() => {\r\n                      const u = users.find((x) => String(x.id) === String(selectedUserId));\r\n                      if (!u) return null;\r\n                      const name = u.full_name || u.email || u.id;\r\n                      return (\r\n                        <>\r\n                          <div style={{ marginBottom: 8 }}>\r\n                            <div style={{ fontWeight: 600 }}>{name}</div>\r\n                            <div className=\"small\" style={{ color: \"#6b7280\" }}>\r\n                              {u.email}\r\n                            </div>\r\n                          </div>\r\n                          <div className=\"row\" style={{ gap: 8, marginBottom: 8 }}>\r\n                            <div style={{ flex: 1 }}>\r\n                              <label className=\"small\" style={{ display: \"block\", marginBottom: 4 }}>\r\n                                Role\r\n                              </label>\r\n                              <select\r\n                                className=\"input full\"\r\n                                value={selectedUserRole || \"user\"}\r\n                                onChange={(e) => setSelectedUserRole(e.target.value)}\r\n                              >\r\n                                <option value=\"user\">User</option>\r\n                                <option value=\"hr\">HR</option>\r\n                                <option value=\"principal\">Principal</option>\r\n                                <option value=\"manager\">Manager</option>\r\n                                <option value=\"accountant\">Accountant</option>\r\n                                <option value=\"admin\">Admin</option>\r\n                              </select>\r\n                            </div>\r\n                            <div style={{ flex: 1 }}>\r\n                              <label className=\"small\" style={{ display: \"block\", marginBottom: 4 }}>\r\n                                Country\r\n                              </label>\r\n                              <select\r\n                                className=\"input full\"\r\n                                value={selectedUserCountryId}\r\n                                onChange={(e) => setSelectedUserCountryId(e.target.value)}\r\n                              >\r\n                                <option value=\"\">Unassigned</option>\r\n                                {countries.map((c) => (\r\n                                  <option key={c.id} value={String(c.id)}>\r\n                                    {c.name}\r\n                                  </option>\r\n                                ))}\r\n                              </select>\r\n                              {selectedUserCountryId === \"\" && (\r\n                                <div className=\"small\" style={{ color: \"#ef4444\", marginTop: 4 }}>\r\n                                  Assign a country to edit scoped permissions.\r\n                                </div>\r\n                              )}\r\n                            </div>\r\n                          </div>\r\n                        </>\r\n                      );\r\n                    })()}\r\n                  </div>\r\n                  {/* Permissions section */}\r\n                  <div className=\"card\">\r\n                    <div style={{ fontWeight: 700, marginBottom: 8 }}>Permissions</div>\r\n                    {!selectedUserCountryId ? (\r\n                      <div>Assign a country to edit scoped permissions.</div>\r\n                    ) : (\r\n                      <PermissionsTable\r\n                        permissionsGrouped={permissionsGrouped}\r\n                        permissionSelections={permissionSelections}\r\n                        permissionScopes={permissionScopes}\r\n                        userSchools={userSchools}\r\n                        isAdmin\r\n                        onTogglePermission={togglePermission}\r\n                        onToggleGroup={togglePermissionGroup}\r\n                        onScopeChange={changePermissionScopeForResource}\r\n                      />\r\n                    )}\r\n                  </div>\r\n                </>\r\n              )}\r\n            </div>\r\n          </div>\r\n        )}\r\n        {activeTab === \"schools\" && (\r\n          <div className=\"access-hub-grid\" style={{ marginTop: 16 }}>\r\n            {/* Left pane: country selector and schools list */}\r\n            <div className=\"left-pane\">\r\n              <div style={{ marginBottom: 12, fontWeight: 700 }}>Schools</div>\r\n              <div className=\"row\" style={{ flexDirection: \"column\", gap: 8 }}>\r\n                <select\r\n                  className=\"input full\"\r\n                  value={selectedCountryId}\r\n                  onChange={(e) => setSelectedCountryId(e.target.value)}\r\n                >\r\n                  <option value=\"\">Select countryâ€¦</option>\r\n                  {countries.map((c) => (\r\n                    <option key={c.id} value={String(c.id)}>\r\n                      {c.name}\r\n                    </option>\r\n                  ))}\r\n                </select>\r\n                <input\r\n                  className=\"input full\"\r\n                  placeholder=\"Search schoolsâ€¦\"\r\n                  value={searchSchool}\r\n                  onChange={(e) => setSearchSchool(e.target.value)}\r\n                  disabled={!selectedCountryId}\r\n                />\r\n              </div>\r\n              <div style={{ marginTop: 12 }}>\r\n                {!selectedCountryId ? (\r\n                  <div>Select a country to view schools and assign principals.</div>\r\n                ) : schools.length === 0 ? (\r\n                  <div>No schools in this country yet. Create a school to assign principals.</div>\r\n                ) : filteredSchools.length === 0 ? (\r\n                  <div>No schools match your search.</div>\r\n                ) : (\r\n                  filteredSchools.map((s) => {\r\n                    const isSelected = String(s.id) === String(selectedSchoolId);\r\n                    return (\r\n                      <div\r\n                        key={s.id}\r\n                        className={`access-list-item ${isSelected ? \"is-selected\" : \"\"}`}\r\n                        onClick={() => setSelectedSchoolId(String(s.id))}\r\n                      >\r\n                        <div>{s.name}</div>\r\n                      </div>\r\n                    );\r\n                  })\r\n                )}\r\n              </div>\r\n            </div>\r\n            {/* Right pane: placeholder for instructional text */}\r\n            <div className=\"right-pane\">\r\n              {!selectedSchoolId && (\r\n                <div style={{ padding: 16 }}>Select a school to manage principal assignments.</div>\r\n              )}\r\n            </div>\r\n            {selectedSchoolId && (\r\n              <AdminSchoolPrincipalsDrawer\r\n                show={!!selectedSchoolId}\r\n                school={schools.find((s) => String(s.id) === String(selectedSchoolId))}\r\n                users={users}\r\n                countryId={selectedCountryId}\r\n                onClose={() => setSelectedSchoolId(null)}\r\n                onSaved={async (schoolId, assigned) => {\r\n                  // No extra actions needed after saving assignments\r\n                }}\r\n              />\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n      {/* Unsaved changes action bar */}\r\n      {activeTab === \"users\" && selectedUserId && hasUnsavedChanges && (\r\n        <div className=\"permissions-sticky-footer\">\r\n          <div className=\"permissions-sticky-footer-inner\">\r\n            <div className=\"permissions-footer-actions\">\r\n              <button className=\"btn\" onClick={discardChanges} disabled={saving || permissionsLoading}>\r\n                Discard\r\n              </button>\r\n              <button\r\n                className=\"btn primary\"\r\n                onClick={saveChanges}\r\n                disabled={saving || permissionsLoading}\r\n              >\r\n                {saving ? \"Savingâ€¦\" : \"Save changes\"}\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n      {/* Modals */}\r\n      {showCreateUser && (\r\n        <AdminCreateUserModal\r\n          show={showCreateUser}\r\n          onClose={() => setShowCreateUser(false)}\r\n          onCreated={() => {\r\n            loadUsers();\r\n            // When creating a new user, also reload countries in case a new country was added elsewhere\r\n            loadCountries();\r\n          }}\r\n          countries={countries}\r\n        />\r\n      )}\r\n      {showCreateSchool && (\r\n        <AdminCreateSchoolModal\r\n          show={showCreateSchool}\r\n          onClose={() => setShowCreateSchool(false)}\r\n          onCreated={(countryId) => {\r\n            // If the new school belongs to the current country in Schools tab, reload schools\r\n            if (String(countryId) === String(selectedCountryId)) {\r\n              loadSchoolsForCountry(countryId);\r\n            }\r\n            // Refresh list regardless\r\n            loadCountries();\r\n          }}\r\n          countries={countries}\r\n        />\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","import { useQuery } from \"@tanstack/react-query\";\nimport { api } from \"../api\";\n\nconst DEFAULT_QUERY_OPTIONS = {\n  staleTime: 60_000,\n};\n\nexport function useListCountries(options = {}) {\n  return useQuery({\n    queryKey: [\"countries\"],\n    queryFn: () => api.listCountries(),\n    ...DEFAULT_QUERY_OPTIONS,\n    ...options,\n  });\n}\n\nexport function useListSchools(params = {}, options = {}) {\n  return useQuery({\n    queryKey: [\"schools\", params],\n    queryFn: () => api.listSchools(params),\n    ...DEFAULT_QUERY_OPTIONS,\n    ...options,\n  });\n}\n\nexport function useAdminUsers(params = {}, options = {}) {\n  return useQuery({\n    queryKey: [\"adminUsers\", params],\n    queryFn: () => api.listUsers(params),\n    ...DEFAULT_QUERY_OPTIONS,\n    ...options,\n  });\n}\n\nexport function useManagerUsers(params = {}, options = {}) {\n  return useQuery({\n    queryKey: [\"managerUsers\", params],\n    queryFn: () => api.managerListUsers(params),\n    ...DEFAULT_QUERY_OPTIONS,\n    ...options,\n  });\n}\r\n"],"names":["renderPermMark","enabled","_jsx","className","concat","children","viewBox","d","PermissionsTable","_ref","permissionsGrouped","permissionSelections","permissionScopes","userSchools","isAdmin","onTogglePermission","onToggleGroup","onScopeChange","defaultCollapsed","search","setSearch","useState","collapsedGroups","setCollapsedGroups","groupKeys","Object","keys","length","reduce","acc","grp","useEffect","prev","changed","next","_objectSpread","forEach","permissionRowsByGroup","useMemo","out","entries","_ref2","groupName","perms","map","Map","perm","resource","String","label","has","set","replace","readKey","writeKey","rows","Array","from","values","sort","a","b","localeCompare","sensitivity","_jsxs","_Fragment","style","marginBottom","placeholder","value","onChange","e","target","_ref3","filter","action","selectedCount","k","allSelected","indeterminate","filteredRows","row","term","trim","toLowerCase","includes","isCollapsed","alignItems","type","checked","ref","el","fontWeight","cursor","display","gap","onClick","toggleCollapse","fontSize","color","textAlign","readSelected","Boolean","writeSelected","scopeVal","scopeDisabled","title","disabled","s","id","name","marginLeft","AdminCreateUserModal","show","onClose","onCreated","countries","fullName","setFullName","email","setEmail","password","setPassword","role","setRole","countryId","setCountryId","schoolId","setSchoolId","schools","setSchools","schoolsLoading","setSchoolsLoading","loading","setLoading","active","api","adminListCountrySchools","list","isArray","items","err","console","error","toast","message","stopPropagation","marginTop","onSubmit","async","preventDefault","trimmedEmail","payload","full_name","country_id","Number","created","createUser","schoolIdNum","isFinite","existing","adminGetSchoolPrincipals","existingIds","u","newId","push","adminSetSchoolPrincipals","userIds","success","flexWrap","c","justifyContent","AdminCreateSchoolModal","schoolRows","setSchoolRows","createCount","count","rawNames","names","Set","errors","adminCreateCountrySchool","idx","updateRow","index","removeRow","_","i","addRow","AdminSchoolPrincipalsDrawer","school","users","onSaved","assigned","setAssigned","initialAssigned","setInitialAssigned","saving","setSaving","searchTerm","setSearchTerm","principalUsers","ids","load","availablePrincipals","hasChanges","handleCancel","slice","border","background","padding","find","x","removePrincipal","userId","maxHeight","overflowY","addPrincipal","CAPABILITY_DEFS","key","resources","CAPABILITY_RESOURCES","flatMap","def","CAPABILITY_RESOURCE_SET","buildCapabilityState","state","every","some","scope_school_id","scope_country_id","hasScopedWritePermission","AdminPermissionsPage","outlet","useOutletContext","setCountries","setUsers","usersQuery","useAdminUsers","limit","offset","fields","order","usersLoading","isFetching","searchUser","setSearchUser","roleFilter","setRoleFilter","countryFilter","setCountryFilter","showUnassignedOnly","setShowUnassignedOnly","selectedUserId","setSelectedUserId","selectedUserRole","setSelectedUserRole","selectedUserCountryId","setSelectedUserCountryId","initialRole","setInitialRole","initialCountryId","setInitialCountryId","setPermissionSelections","setPermissionScopes","initialSelections","setInitialSelections","initialScopes","setInitialScopes","permissionsCatalog","setPermissionsCatalog","permissionsLoading","setPermissionsLoading","setUserSchools","activeTab","setActiveTab","selectedCountryIdForDrawer","setSelectedCountryIdForDrawer","selectedAccountantId","setSelectedAccountantId","assignAccountantUserId","setAssignAccountantUserId","permissionsByUserId","setPermissionsByUserId","permissionsLoadingByUserId","setPermissionsLoadingByUserId","permissionsByUserIdRef","useRef","permissionsLoadingByUserIdRef","capabilityDraft","setCapabilityDraft","capabilitySnapshot","setCapabilitySnapshot","capabilitySaving","setCapabilitySaving","showCreateUser","setShowCreateUser","showCreateSchool","setShowCreateSchool","selectedCountryId","setSelectedCountryId","searchSchool","setSearchSchool","selectedSchoolId","setSelectedSchoolId","countriesQuery","useListCountries","_outlet$setHeaderMeta","setHeaderMeta","call","subtitle","centered","_outlet$clearHeaderMe","clearHeaderMeta","loadCountries","useCallback","result","refetch","_result$error","loadUsers","_result$error2","data","_usersQuery$data","_countriesQuery$error","isError","_usersQuery$error","loadSchoolsForCountry","cid","loadPermissionsForUser","user","schoolsPromise","Promise","resolve","catalogData","userPerms","all","adminGetPermissionsCatalog","adminGetUserPermissions","schoolsList","sel","scopes","p","current","accountantUsers","accountantsByCountry","nameA","nameB","ensureUserPermissions","cached","normalized","toFetch","allSettled","then","results","hadError","_toFetch$index","status","finally","selectedCountryForDrawer","country","drawerAccountants","assignableAccountants","isActive","caps","group","togglePermission","scopeValue","arguments","undefined","split","newSelections","newScopes","enable","togglePermissionGroup","nextValue","hasUnsavedChanges","allKeys","filteredUsers","filteredSchools","capabilityDirty","getUserLabel","FaUserPlus","FaSchool","tabIndex","code","flexDirection","selectedUser","assignUserCountry","adminUpdateUserRole","handleToggleCapability","handleDiscardCapabilities","basePerms","nextPerms","_perm$scope_country_i","_perm$scope_school_id","join","dedupePermissions","adminSetUserPermissions","permissions","handleOpenFullEditor","colSpan","accountants","primaryAccountant","hasMultiple","statusLabel","capabilities","isPermsLoading","badgeClass","_u$role","_u$role2","isSelected","roleLabel","charAt","toUpperCase","countryLabel","country_name","flex","countryChanged","roleChanged","permissionsChanged","keysUnion","scopeCountryId","startsWith","sidStr","sid","DEFAULT_QUERY_OPTIONS","staleTime","options","useQuery","queryKey","queryFn","listCountries","useListSchools","params","listSchools","listUsers","useManagerUsers","managerListUsers"],"ignoreList":[],"sourceRoot":""}