"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[613],{613(e,s,a){a.d(s,{A:()=>_});var l,i=a(2555),n=a(5043),t=a(7950),r=a(5685),o=a(2115),c=a(3204),d=a(7559),u=a(3182),m=a(4405),h=a(3492),p=a(4930),v=a(579);const x=["y1","y2","y3"],j=["temel_bilgiler","kapasite","norm.ders_dagilimi","ik.local_staff","gelirler.unit_fee","giderler.isletme"],y={temel_bilgiler:"Temel Bilgiler",kapasite:"Kapasite","norm.ders_dagilimi":"Norm","ik.local_staff":"\u0130K","gelirler.unit_fee":"Gelirler","giderler.isletme":"Giderler"},g=(null===(l=p.b[0])||void 0===l?void 0:l.key)||"users",b=e=>p.b.some(s=>s.key===e),N=e=>{if(!e)return null;const s=new URLSearchParams(e).get("tab");return b(s)?s:null},f=e=>{const s=Number(e);return Number.isFinite(s)?s.toLocaleString(void 0,{maximumFractionDigits:0}):"-"},S=e=>{const s=Number(e);return Number.isFinite(s)?(100*s).toLocaleString(void 0,{maximumFractionDigits:2})+"%":"-"},w=e=>{if(!e)return"-";const s=new Date(e);return Number.isFinite(s.getTime())?s.toLocaleString():"-"},k=["Magis Basari Bursu","Maarif Yetenek Bursu","Ihtiyac Bursu","Okul Basari Bursu","Tam Egitim Bursu","Barinma Bursu","Turkce Basari Bursu","Uluslararasi Yukumluluk Indirimi","Vakif Calisani Indirimi","Kardes Indirimi","Erken Kayit Indirimi","Pesin Odeme Indirimi","Kademe Gecis Indirimi","Temsil Indirimi","Kurum Indirimi","Istisnai Indirim","Yerel Mevzuat Indirimi"];function C(e){const s=(0,h.bO)(),a=e&&"object"===typeof e?e:{},l=a.sections&&"object"===typeof a.sections?a.sections:{},i={version:s.version,sections:{}};return Object.keys(s.sections).forEach(e=>{const a=s.sections[e]||{},n=l[e]&&"object"===typeof l[e]?l[e]:{};i.sections[e]={enabled:"boolean"===typeof n.enabled?n.enabled:!1!==a.enabled,mode:"string"===typeof n.mode&&n.mode?n.mode:a.mode,min:null!=n.min?Number(n.min):a.min,selectedFields:n.selectedFields&&"object"===typeof n.selectedFields?n.selectedFields:{}}}),i}function _(){var e,s,a,l,p,_,A,R,F,B,T,I,E,L,M,P,U;let{forcedTab:W=null}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const H=(0,u.A)(),q=(0,r.KC)(),Y=(0,r.zy)(),O=b(W)?W:null,[K,D]=(0,n.useState)(()=>{if(O)return O;const e=N(Y.search);if(e)return e;try{const e=localStorage.getItem("admin.activeTab");if(b(e))return e}catch(s){}return g});(0,n.useEffect)(()=>{if(O)return;const e=N(Y.search);e&&e!==K?D(e):e||K===g||D(g)},[Y.search,K,O]),(0,n.useEffect)(()=>{O&&K!==O&&D(O)},[O,K]),(0,n.useEffect)(()=>{if(!O)try{localStorage.setItem("admin.activeTab",K)}catch(e){}},[K,O]);const[z,G]=(0,n.useState)([]),[Q,J]=(0,n.useState)([]),[V,X]=(0,n.useState)(!1),[Z,$]=(0,n.useState)(!1),[ee,se]=(0,n.useState)(null),[ae,le]=(0,n.useState)(null),[ie,ne]=(0,n.useState)(null),[te,re]=(0,n.useState)(null),[oe,ce]=(0,n.useState)(null),[de,ue]=(0,n.useState)(""),[me,he]=(0,n.useState)(""),[pe,ve]=(0,n.useState)(""),[xe,je]=(0,n.useState)(""),[ye,ge]=(0,n.useState)(""),[be,Ne]=(0,n.useState)(""),[fe,Se]=(0,n.useState)("user"),[we,ke]=(0,n.useState)(""),[Ce,_e]=(0,n.useState)(""),[Ae,Re]=(0,n.useState)(""),[Fe,Be]=(0,n.useState)(!0),[Te,Ie]=(0,n.useState)(""),[Ee,Le]=(0,n.useState)([]),[Me,Pe]=(0,n.useState)(!1),[Ue,We]=(0,n.useState)(""),[He,qe]=(0,n.useState)(""),[Ye,Oe]=(0,n.useState)(!1),[Ke,De]=(0,n.useState)(!1),[ze,Ge]=(0,n.useState)([""]),[Qe,Je]=(0,n.useState)(null),[Ve,Xe]=(0,n.useState)({}),[Ze,$e]=(0,n.useState)(""),[es,ss]=(0,n.useState)(null),[as,ls]=(0,n.useState)(!1),[is,ns]=(0,n.useState)(!1),[ts,rs]=(0,n.useState)(""),[os,cs]=(0,n.useState)(()=>new Set),[ds,us]=(0,n.useState)(""),[ms,hs]=(0,n.useState)(!1),[ps,vs]=(0,n.useState)({}),[xs,js]=(0,n.useState)(new Set),[ys,gs]=(0,n.useState)(new Set),[bs,Ns]=(0,n.useState)([]),[fs,Ss]=(0,n.useState)("scenarios"),[ws,ks]=(0,n.useState)([]),[Cs,_s]=(0,n.useState)(!1),[As,Rs]=(0,n.useState)(null),[Fs,Bs]=(0,n.useState)(""),[Ts,Is]=(0,n.useState)({y1:!0,y2:!0,y3:!0}),[Es,Ls]=(0,n.useState)(()=>{const e={};return j.forEach(s=>e[s]=!1),e}),[Ms,Ps]=(0,n.useState)(!1),[Us,Ws]=(0,n.useState)(null),[Hs,qs]=(0,n.useState)(!1),[Ys,Os]=(0,n.useState)(null),[Ks,Ds]=(0,n.useState)({}),[zs,Gs]=(0,n.useState)({}),[Qs,Js]=(0,n.useState)(!1),[Vs,Xs]=(0,n.useState)(!1),[Zs,$s]=(0,n.useState)([]),ea=(0,n.useMemo)(()=>[{value:"user",label:"User"},{value:"principal",label:"Principal"},{value:"hr",label:"HR"},{value:"manager",label:"Manager"},{value:"accountant",label:"Accountant"},{value:"admin",label:"Admin"}],[]),[sa,aa]=(0,n.useState)(!1),[la,ia]=(0,n.useState)({}),[na,ta]=(0,n.useState)({}),[ra,oa]=(0,n.useState)({}),[ca,da]=(0,n.useState)(!1),[ua,ma]=(0,n.useState)({status:"",academicYear:"",region:"",countryId:""}),[ha,pa]=(0,n.useState)({key:null,dir:null}),[va,xa]=(0,n.useState)(null),[ja,ya]=(0,n.useState)(""),[ga,ba]=(0,n.useState)({y1:!0,y2:!0,y3:!0}),[Na,fa]=(0,n.useState)(()=>{const e={};return j.forEach(s=>e[s]=!1),e}),Sa=(0,n.useCallback)(()=>{const e={};j.forEach(s=>e[s]=!0),fa(e)},[]),wa=(0,n.useCallback)(()=>{const e={};j.forEach(s=>e[s]=!1),fa(e)},[]),[ka,Ca]=(0,n.useState)(!1),_a=(0,n.useCallback)(()=>{const e={};j.forEach(s=>e[s]=!0),Ls(e)},[]),Aa=(0,n.useCallback)(()=>{const e={};j.forEach(s=>e[s]=!1),Ls(e)},[]),[Ra,Fa]=(0,n.useState)(""),[Ba,Ta]=(0,n.useState)(null),[Ia,Ea]=(0,n.useState)(!1),[La,Ma]=(0,n.useState)(!1),Pa=(0,n.useRef)(null),[Ua,Wa]=(0,n.useState)(new Set),[Ha,qa]=(0,n.useState)(new Set);(0,n.useEffect)(()=>{document.title="Admin \xb7 Feasibility Studio"},[]),(0,n.useEffect)(()=>(null===q||void 0===q||q.setHeaderMeta({title:"Admin",subtitle:"Create users, manage countries, and review scenarios."}),()=>{var e;null===q||void 0===q||null===(e=q.clearHeaderMeta)||void 0===e||e.call(q)}),[q]);const Ya=(0,n.useRef)(ua);(0,n.useEffect)(()=>{Ya.current=ua},[ua]);const Oa=(0,n.useMemo)(()=>Q.find(e=>String(e.id)===String(Ce))||null,[Q,Ce]),Ka=(0,n.useMemo)(()=>z.find(e=>String(e.id)===String(Ae))||null,[z,Ae]),Da=(0,n.useMemo)(()=>z.find(e=>String(e.id)===String(Te))||null,[z,Te]);(0,n.useEffect)(()=>{"countries"===K&&Array.isArray(Ee)&&0!==Ee.length&&Ee.forEach(e=>{const s=e.id;void 0===la[s]&&(async()=>{try{const e=await d.FH.adminGetSchoolPrincipals(s);ia(a=>(0,i.A)((0,i.A)({},a),{},{[s]:Array.isArray(e)?e:[]}));const a=Array.isArray(e)?e.map(e=>e.id):[];ta(e=>(0,i.A)((0,i.A)({},e),{},{[s]:a}))}catch(e){console.error(e)}})()})},[K,Ee,la]),(0,n.useEffect)(()=>{const e=null===Oa||void 0===Oa?void 0:Oa.id,s=null===Oa||void 0===Oa?void 0:Oa.country_id;if(!e)return Os(null),Ds({}),Gs({}),void $s([]);Js(!0),Promise.all([d.FH.adminGetPermissionsCatalog(),d.FH.adminGetUserPermissions(e),s?d.FH.adminListCountrySchools(s):Promise.resolve([])]).then(e=>{let[s,a,l]=e;Os(s||null);let i=[];Array.isArray(l)?i=l:l&&Array.isArray(l.items)&&(i=l.items),$s(i);const n={},t={};(a||[]).forEach(e=>{const s="".concat(e.resource,"|").concat(e.action);n[s]=!0,null!=e.scope_school_id?t[s]="school:".concat(e.scope_school_id):t[s]="country"}),Ds(n),Gs(t)}).catch(e=>{console.error(e),o.oR.error((null===e||void 0===e?void 0:e.message)||"Failed to load permissions")}).finally(()=>{Js(!1)})},[Oa]);const za=(0,n.useMemo)(()=>({discounts:k.map(e=>({name:e,ratio:0,value:0}))}),[]),Ga=(0,n.useMemo)(()=>(0,h.Rn)({inputs:za,norm:null}),[za]),Qa=(0,n.useMemo)(()=>C(es),[es]),Ja=Oa&&Ka&&null!=Oa.country_id&&String(Oa.country_id)===String(Ka.id),Va=Oa?Oa.country_name?"".concat(Oa.country_name," (").concat(Oa.country_code,")").concat(Oa.region?" - ".concat(Oa.region):""):"Unassigned":"Select a user",Xa=Ka?"".concat(Ka.name," (").concat(Ka.code,")").concat(Ka.region?" - ".concat(Ka.region):""):"Select a country",Za=null!=(null===Oa||void 0===Oa?void 0:Oa.country_id)?"Update Country":"Assign Country",$a=(0,n.useMemo)(()=>Fe?Q.filter(e=>null==e.country_id):Q,[Q,Fe]),el=(0,n.useMemo)(()=>{const e=new Set;return z.forEach(s=>{s.region&&e.add(s.region)}),Array.from(e).sort()},[z]),sl=(0,n.useMemo)(()=>Ys?Array.isArray(Ys)||"object"!==typeof Ys?Array.isArray(Ys)?Ys.reduce((e,s)=>{const a=s.group||"Other";return e[a]||(e[a]=[]),e[a].push(s),e},{}):{}:Ys:{},[Ys]),al=(0,n.useMemo)(()=>ua.region?z.filter(e=>e.region===ua.region):z,[z,ua.region]),ll=(0,n.useCallback)(e=>{const s={academic_year:["desc","asc",null],country_name:["asc","desc",null],school_name:["asc","desc",null],scenario_name:["asc","desc",null],submitted_at:["desc","asc",null],status:["asc","desc",null]};pa(a=>{const l=s[e]||["asc","desc",null];if(a.key!==e)return{key:e,dir:l[0]};const i=l.indexOf(a.dir),n=l[(i+1)%l.length];return n?{key:e,dir:n}:{key:null,dir:null}})},[pa]),il=(0,n.useCallback)(e=>ha.key===e&&ha.dir?"asc"===ha.dir?"\u25b2":"\u25bc":"",[ha]),nl=(0,n.useCallback)(e=>ha.key===e&&ha.dir?"asc"===ha.dir?"ascending":"descending":"none",[ha]),tl=(0,n.useMemo)(()=>{const e=Array.isArray(bs)?bs:[];if(null===ha||void 0===ha||!ha.key||null===ha||void 0===ha||!ha.dir)return e;const s=e=>{var s,a,l,i,n,t;switch(ha.key){case"country_name":return String((null===(s=e.country)||void 0===s?void 0:s.name)||"");case"school_name":return String((null===(a=e.school)||void 0===a?void 0:a.name)||"");case"scenario_name":return String((null===(l=e.scenario)||void 0===l?void 0:l.name)||"");case"academic_year":return(e=>{const s=String(e||"").trim(),a=s.match(/\d{4}/g)||[],l=a[0]?Number(a[0]):-1;return{a:l,b:a[1]?Number(a[1]):l,raw:s.toLowerCase()}})(null===(i=e.scenario)||void 0===i?void 0:i.academic_year);case"submitted_at":return null!==(n=e.scenario)&&void 0!==n&&n.submitted_at?new Date(e.scenario.submitted_at).getTime():-1/0;case"status":return String((null===(t=e.scenario)||void 0===t?void 0:t.status)||"");default:return""}},a="desc"===ha.dir?-1:1,l=(e,s)=>String(e||"").localeCompare(String(s||""),void 0,{sensitivity:"base"}),i=e.map((e,a)=>({row:e,idx:a,val:s(e)}));return i.sort((e,s)=>{let i=0;const n=e.val,t=s.val;var r,o,c,d;"academic_year"===ha.key?(i=(null!==(r=null===n||void 0===n?void 0:n.a)&&void 0!==r?r:-1)-(null!==(o=null===t||void 0===t?void 0:t.a)&&void 0!==o?o:-1),0===i&&(i=(null!==(c=null===n||void 0===n?void 0:n.b)&&void 0!==c?c:-1)-(null!==(d=null===t||void 0===t?void 0:t.b)&&void 0!==d?d:-1)),0===i&&(i=l(null===n||void 0===n?void 0:n.raw,null===t||void 0===t?void 0:t.raw))):i="number"===typeof n&&"number"===typeof t?n-t:l(n,t);return 0===i?e.idx-s.idx:i*a}),i.map(e=>e.row)},[bs,ha]),rl=ts.trim().toLowerCase(),ol=(0,n.useMemo)(()=>{const e=ds.trim().toLowerCase();return e?z.filter(s=>{const a=String(s.name||"").toLowerCase(),l=String(s.code||"").toLowerCase();return a.includes(e)||l.includes(e)}):z},[z,ds]),cl=os.size,dl=!Ze||0===cl||is||as||ms,ul=(0,n.useMemo)(()=>{const e=Ue.trim().toLowerCase();return e?Ee.filter(s=>String(s.name||"").toLowerCase().includes(e)):Ee},[Ee,Ue]),ml=Ye||Ke,hl=ze.reduce((e,s)=>String(s||"").trim()?e+1:e,0),pl=(0,n.useCallback)(async()=>{X(!0);try{const[e,s]=await Promise.all([d.FH.listCountries(),d.FH.listUsers({limit:50,offset:0,fields:"brief",order:"id:desc"})]);G(e),J(Array.isArray(null===s||void 0===s?void 0:s.items)?s.items:[])}catch(e){o.oR.error(e.message||"Failed to load admin data")}finally{X(!1)}},[]),vl=(0,n.useCallback)(async e=>{const s=Number(e);if(Number.isFinite(s)){Pe(!0);try{const e=await d.FH.adminListCountrySchools(s,{includeClosed:1});Le(Array.isArray(e)?e:[])}catch(a){o.oR.error(a.message||"Failed to load schools")}finally{Pe(!1)}}else Le([])},[]),xl=(0,n.useCallback)(async e=>{const s=Number(e);if(Number.isFinite(s)){ls(!0);try{const e=await d.FH.adminGetProgressRequirements(s);ss(C((null===e||void 0===e?void 0:e.config)||e))}catch(a){o.oR.error(a.message||"Failed to load progress requirements"),ss(C(null))}finally{ls(!1)}}else ss(null)},[]),jl=(0,n.useCallback)(async e=>{const s=e||Ya.current||{};da(!0);try{const e={status:s.status,academicYear:s.academicYear,region:s.region,countryId:s.countryId},a=await d.FH.adminGetScenarioQueue(e);Ns(Array.isArray(a)?a:[])}catch(a){o.oR.error(a.message||"Failed to load approvals queue")}finally{da(!1)}},[]),yl=(0,n.useCallback)(async e=>{const s=e||Ya.current||{};_s(!0);try{const e={status:s.status,academicYear:s.academicYear,region:s.region,countryId:s.countryId},a=await d.FH.adminGetApprovalBatchQueue(e);ks(Array.isArray(a)?a:[])}catch(a){o.oR.error(a.message||"Failed to load approval batches")}finally{_s(!1)}},[]),gl=(0,n.useCallback)(async e=>{const s=(null!==e&&void 0!==e?e:Ra).trim();if(s){Ea(!0);try{const e=await d.FH.adminGetRollup({academicYear:s});Ta(e)}catch(a){o.oR.error(a.message||"Failed to load rollup report")}finally{Ea(!1)}}else o.oR.error("Academic year is required")},[Ra]);async function bl(e){const s=function(){try{const a=["token","auth_token","jwt","access_token"];for(const l of a){var e,s;const a=null===(e=window)||void 0===e||null===(s=e.localStorage)||void 0===s?void 0:s.getItem(l);if(a)return String(a)}}catch(a){}return""}(),a=await fetch("/api/admin/users/".concat(e,"/reset-password"),{method:"POST",headers:(0,i.A)({"Content-Type":"application/json"},s?{Authorization:"Bearer ".concat(s)}:{}),body:JSON.stringify({})});let l={};try{l=await a.json()}catch(r){l={}}if(!a.ok){var n,t;const e=(null===(n=l)||void 0===n?void 0:n.error)||(null===(t=l)||void 0===t?void 0:t.details)||"Reset failed (".concat(a.status,")");throw new Error(e)}return l}(0,n.useEffect)(()=>{var e;"admin"===(null===(e=H.user)||void 0===e?void 0:e.role)&&pl()},[null===(e=H.user)||void 0===e?void 0:e.role,pl]),(0,n.useEffect)(()=>{var e;"approvals"===K&&"admin"===(null===(e=H.user)||void 0===e?void 0:e.role)&&("batches"===fs?yl():jl())},[K,null===(s=H.user)||void 0===s?void 0:s.role,fs,yl,jl]),(0,n.useEffect)(()=>{"countries"===K&&(Te?vl(Te):Le([]))},[K,vl,Te]),(0,n.useEffect)(()=>{"progress"===K&&(Ze?xl(Ze):ss(null))},[K,xl,Ze]),(0,n.useEffect)(()=>{rs(""),js(new Set),gs(new Set)},[Ze]),(0,n.useEffect)(()=>{if(!La)return;const e=e=>{const s=Pa.current;s&&!s.contains(e.target)&&Ma(!1)},s=e=>{"Escape"===e.key&&Ma(!1)};return document.addEventListener("mousedown",e),document.addEventListener("keydown",s),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("keydown",s)}},[La]),(0,n.useEffect)(()=>{if(null===Ba||void 0===Ba||!Ba.regions)return;const e=new Set,s=new Set;Ba.regions.forEach(a=>{e.add(a.region),a.countries.forEach(e=>{s.add("".concat(a.region,"::").concat(e.id))})}),Wa(e),qa(s)},[Ba]),(0,n.useEffect)(()=>{if(!Ce)return void Re("");const e=Q.find(e=>String(e.id)===String(Ce));e&&null!=e.country_id?Re(String(e.country_id)):Re("")},[Ce,Q]),(0,n.useEffect)(()=>{Xe({}),We(""),qe(""),Ge([""])},[Te]);const Nl=(e,s)=>{ss(a=>{var l;const i=C(a),n=structuredClone(i),t=null===(l=n.sections)||void 0===l?void 0:l[e];return t?(s(t),n):i})},fl=(e,s)=>{if(xa({row:e,action:s}),ya(""),ba({y1:!0,y2:!0,y3:!0}),"revise"===s){const e={};j.forEach(s=>e[s]=!1),fa(e)}},Sl=()=>{xa(null),ya(""),ba({y1:!0,y2:!0,y3:!0});const e={};j.forEach(s=>e[s]=!1),fa(e)},wl=(e,s)=>{if(Rs({row:e,action:s}),Bs(""),Is({y1:!0,y2:!0,y3:!0}),"revise"===s){const e={};j.forEach(s=>e[s]=!1),Ls(e)}},kl=()=>{Rs(null),Bs(""),Is({y1:!0,y2:!0,y3:!0});const e={};j.forEach(s=>e[s]=!1),Ls(e),Ws(null)};(0,n.useEffect)(()=>{var e;const s=null===As||void 0===As||null===(e=As.row)||void 0===e?void 0:e.batch_id;s&&(qs(!0),d.FH.adminGetApprovalBatch(s).then(e=>{Ws(e||null)}).catch(e=>{o.oR.error(e.message||"Failed to load batch details"),Ws(null)}).finally(()=>{qs(!1)}))},[null===As||void 0===As||null===(a=As.row)||void 0===a?void 0:a.batch_id]);const Cl=e=>{if(!e)return(0,v.jsx)("div",{className:"kpi-mini kpi-mini-missing",children:"Missing KPIs"});const s=e.net_ciro?e.net_result/e.net_ciro:null;return(0,v.jsxs)("div",{className:"kpi-mini",children:[(0,v.jsxs)("div",{className:"kpi-mini-row",children:[(0,v.jsx)("span",{className:"kpi-mini-label",children:"Net ciro"}),(0,v.jsx)("span",{className:"kpi-mini-value",children:f(e.net_ciro)})]}),(0,v.jsxs)("div",{className:"kpi-mini-row",children:[(0,v.jsx)("span",{className:"kpi-mini-label",children:"Net result"}),(0,v.jsx)("span",{className:"kpi-mini-value",children:f(e.net_result)})]}),(0,v.jsxs)("div",{className:"kpi-mini-row",children:[(0,v.jsx)("span",{className:"kpi-mini-label",children:"Margin"}),(0,v.jsx)("span",{className:"kpi-mini-value",children:S(s)})]})]})},_l=e=>e?(0,v.jsxs)("div",{className:"rollup-year-cell",children:[(0,v.jsxs)("div",{className:"rollup-metric",children:[(0,v.jsx)("span",{className:"rollup-label",children:"Net ciro"}),(0,v.jsx)("span",{className:"rollup-value",children:f(e.net_ciro)})]}),(0,v.jsxs)("div",{className:"rollup-metric",children:[(0,v.jsx)("span",{className:"rollup-label",children:"Net income"}),(0,v.jsx)("span",{className:"rollup-value",children:f(e.net_income)})]}),(0,v.jsxs)("div",{className:"rollup-metric",children:[(0,v.jsx)("span",{className:"rollup-label",children:"Expenses"}),(0,v.jsx)("span",{className:"rollup-value",children:f(e.total_expenses)})]}),(0,v.jsxs)("div",{className:"rollup-metric",children:[(0,v.jsx)("span",{className:"rollup-label",children:"Net result"}),(0,v.jsx)("span",{className:"rollup-value",children:f(e.net_result)})]}),(0,v.jsxs)("div",{className:"rollup-metric",children:[(0,v.jsx)("span",{className:"rollup-label",children:"Margin"}),(0,v.jsx)("span",{className:"rollup-value",children:S(e.profitMargin)})]}),(0,v.jsxs)("div",{className:"rollup-metric",children:[(0,v.jsx)("span",{className:"rollup-label",children:"Students"}),(0,v.jsx)("span",{className:"rollup-value",children:f(e.students_total)})]})]}):(0,v.jsx)("div",{className:"rollup-year-cell is-empty",children:"-"}),Al=()=>{if("approvals"!==K)if("progress"!==K){if("reports"!==K)return"countries"===K?(pl(),void(Te&&vl(Te))):void pl();gl(Ra)}else Ze&&xl(Ze);else"batches"===fs?yl(ua):jl(ua)};if(!H.user)return(0,v.jsx)("div",{className:"container",children:(0,v.jsx)("div",{className:"card",children:"Loading..."})});if("admin"!==H.user.role)return(0,v.jsx)("div",{className:"container",children:(0,v.jsxs)("div",{className:"card",children:[(0,v.jsx)("div",{style:{fontWeight:700},children:"Admin only"}),(0,v.jsx)("div",{className:"small",style:{marginTop:6},children:"You do not have permission to view this page."}),(0,v.jsx)("div",{style:{marginTop:10},children:(0,v.jsx)(r.N_,{to:"/schools",children:"Back to Schools"})})]})});const Rl=Ia||!Ba,Fl=V||("batches"===fs?Cs:ca)||Ia||as,Bl=()=>(0,v.jsx)("button",{className:"btn",onClick:Al,disabled:Fl,children:"Refresh"});return(0,v.jsxs)(v.Fragment,{children:[null!==q&&void 0!==q&&q.headerPortalEl?(0,t.createPortal)(Bl(),q.headerPortalEl):null,(0,v.jsxs)("div",{className:"container",children:[!(null!==q&&void 0!==q&&q.headerPortalEl)&&(0,v.jsxs)("div",{className:"row",style:{justifyContent:"space-between"},children:[(0,v.jsxs)("div",{children:[(0,v.jsx)("div",{style:{fontWeight:800,fontSize:20},children:"Admin"}),(0,v.jsx)("div",{className:"small",children:"Create users, manage countries, and review scenarios."})]}),Bl()]}),(0,v.jsx)(o.N9,{position:"top-right",autoClose:3500,newestOnTop:!0,closeOnClick:!0,pauseOnFocusLoss:!0,pauseOnHover:!0}),Z?(0,v.jsxs)("div",{className:"modal-backdrop",role:"status","aria-live":"polite","aria-busy":"true",children:[(0,v.jsx)("style",{children:"@keyframes adminSpin{to{transform:rotate(360deg)}}"}),(0,v.jsxs)("div",{className:"card",style:{width:"min(360px, 92vw)",padding:"16px",textAlign:"center"},children:[(0,v.jsx)("div",{"aria-hidden":!0,style:{width:28,height:28,margin:"0 auto",borderRadius:"50%",border:"3px solid rgba(0,0,0,.15)",borderTopColor:"rgba(0,0,0,.75)",animation:"adminSpin .8s linear infinite"}}),(0,v.jsx)("div",{style:{fontWeight:700,marginTop:10},children:"Updating user..."}),(0,v.jsx)("div",{className:"small muted",style:{marginTop:6},children:"Please wait."})]})]}):null,ee?(0,v.jsx)("div",{className:"modal-backdrop",role:"dialog","aria-modal":"true",children:(0,v.jsxs)("div",{className:"modal",children:[(0,v.jsx)("div",{style:{fontWeight:700,marginBottom:8},children:"Confirm Change"}),(0,v.jsx)("div",{className:"small",style:{marginBottom:12},children:"Change ".concat(ee.email," from ").concat(ee.currentLabel," to ").concat(ee.nextLabel,"?")}),(0,v.jsxs)("div",{className:"row",style:{justifyContent:"flex-end"},children:[(0,v.jsx)("button",{className:"btn",onClick:()=>se(null),disabled:Z,children:"Cancel"}),(0,v.jsx)("button",{className:"btn primary",onClick:()=>{const e=ee;se(null),async function(e){if(e&&!Z){$(!0);try{await d.FH.assignUserCountry(e.userId,{countryId:e.nextId}),await pl(),o.oR.success(e.hadCountry?"User country updated":"User assigned")}catch(s){o.oR.error(s.message||"Assignment failed")}finally{$(!1)}}}(e)},disabled:Z,children:Z?"Updating...":"Confirm"})]})]})}):null,ae?(0,v.jsx)("div",{className:"modal-backdrop",role:"dialog","aria-modal":"true",children:(0,v.jsxs)("div",{className:"modal",children:[(0,v.jsx)("div",{style:{fontWeight:700,marginBottom:8},children:"Confirm Delete"}),(0,v.jsx)("div",{className:"small",style:{marginBottom:12},children:"Delete ".concat(ae.label,"? This only works if the user has no related records.")}),(0,v.jsxs)("div",{className:"row",style:{justifyContent:"flex-end"},children:[(0,v.jsx)("button",{className:"btn",onClick:()=>le(null),children:"Cancel"}),(0,v.jsx)("button",{className:"btn danger",onClick:()=>{const e=ae;le(null),async function(e){if(e)try{await d.FH.deleteUser(e.id),await pl(),o.oR.success("User deleted")}catch(s){o.oR.error(s.message||"Delete failed")}}(e)},children:"Delete"})]})]})}):null,oe?(0,v.jsxs)("div",{className:"modal-backdrop",role:"status","aria-live":"polite","aria-busy":"true",children:[(0,v.jsx)("style",{children:"@keyframes adminSpin{to{transform:rotate(360deg)}}"}),(0,v.jsxs)("div",{className:"card",style:{width:"min(360px, 92vw)",padding:"16px",textAlign:"center"},children:[(0,v.jsx)("div",{"aria-hidden":!0,style:{width:28,height:28,margin:"0 auto",borderRadius:"50%",border:"3px solid rgba(0,0,0,.15)",borderTopColor:"rgba(0,0,0,.75)",animation:"adminSpin .8s linear infinite"}}),(0,v.jsx)("div",{style:{fontWeight:700,marginTop:10},children:"Resetting password..."}),(0,v.jsx)("div",{className:"small muted",style:{marginTop:6},children:"Please wait."})]})]}):null,ie?(0,v.jsx)("div",{className:"modal-backdrop",role:"dialog","aria-modal":"true",children:(0,v.jsxs)("div",{className:"modal",children:[(0,v.jsx)("div",{style:{fontWeight:700,marginBottom:8},children:"Reset Password"}),(0,v.jsx)("div",{className:"small",style:{marginBottom:12},children:"Generate a new temporary password for ".concat(ie.email,"? The user will be forced to change it on next login.")}),(0,v.jsxs)("div",{className:"row",style:{justifyContent:"flex-end"},children:[(0,v.jsx)("button",{className:"btn",onClick:()=>ne(null),disabled:Boolean(oe),children:"Cancel"}),(0,v.jsx)("button",{className:"btn primary",onClick:()=>{const e=ie;ne(null),async function(e){if(null!==e&&void 0!==e&&e.id&&!oe){ce(e.id);try{const s=await bl(e.id);re({id:e.id,email:e.email,full_name:e.full_name||null,temporary_password:s.temporary_password}),await pl(),o.oR.success("Temporary password generated")}catch(s){o.oR.error(s.message||"Reset failed")}finally{ce(null)}}}(e)},disabled:Boolean(oe),children:"Confirm"})]})]})}):null,te?(0,v.jsx)("div",{className:"modal-backdrop",role:"dialog","aria-modal":"true",children:(0,v.jsxs)("div",{className:"modal",style:{maxWidth:560},children:[(0,v.jsx)("div",{style:{fontWeight:700,marginBottom:8},children:"Temporary Password"}),(0,v.jsx)("div",{className:"small",style:{marginBottom:10},children:"Share this password securely with the user. It will only be shown once here."}),(0,v.jsxs)("div",{className:"card",style:{padding:12,background:"rgba(0,0,0,.03)"},children:[(0,v.jsxs)("div",{className:"small",style:{marginBottom:6},children:["User: ",(0,v.jsx)("strong",{children:te.email})]}),(0,v.jsxs)("div",{className:"row",style:{alignItems:"center",justifyContent:"space-between"},children:[(0,v.jsx)("div",{style:{fontFamily:"ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace",fontSize:18},children:te.temporary_password}),(0,v.jsx)("button",{className:"btn",onClick:()=>async function(e){const s=String(e||"");if(s){try{return await navigator.clipboard.writeText(s),void o.oR.success("Copied")}catch(a){}try{const e=document.createElement("textarea");e.value=s,e.style.position="fixed",e.style.left="-9999px",document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e),o.oR.success("Copied")}catch(l){o.oR.error("Copy failed")}}}(te.temporary_password),children:"Copy"})]})]}),(0,v.jsx)("div",{className:"row",style:{justifyContent:"flex-end",marginTop:12},children:(0,v.jsx)("button",{className:"btn primary",onClick:()=>re(null),children:"Done"})})]})}):null,va?(0,v.jsx)("div",{className:"modal-backdrop",role:"dialog","aria-modal":"true",children:(0,v.jsxs)("div",{className:"modal",children:[(0,v.jsx)("div",{style:{fontWeight:700,marginBottom:8},children:"approve"===va.action?"Approve Scenario":"Request Revision"}),(0,v.jsxs)("div",{className:"small",style:{marginBottom:12},children:[null!==(l=va.row)&&void 0!==l&&null!==(p=l.school)&&void 0!==p&&p.name?"".concat(va.row.school.name," - "):"",(null===(_=va.row)||void 0===_||null===(A=_.scenario)||void 0===A?void 0:A.name)||"Scenario"]}),"approve"===va.action?(0,v.jsxs)("div",{style:{marginBottom:10},children:[(0,v.jsx)("div",{className:"small",style:{marginBottom:6},children:"Included years"}),(0,v.jsx)("div",{className:"row",children:x.map(e=>(0,v.jsxs)("label",{className:"small",style:{display:"inline-flex",gap:6},children:[(0,v.jsx)("input",{type:"checkbox",checked:ga[e],onChange:s=>ba(a=>(0,i.A)((0,i.A)({},a),{},{[e]:s.target.checked}))}),e.toUpperCase()]},e))})]}):null,"revise"===va.action?(0,v.jsxs)("div",{style:{marginBottom:10},children:[(0,v.jsx)("div",{className:"small",style:{marginBottom:6},children:"Sadece se\xe7ilen mod\xfcller revizeye a\xe7\u0131lacak (editable)."}),(0,v.jsxs)("div",{className:"row",style:{flexWrap:"wrap",gap:8},children:[j.map(e=>(0,v.jsxs)("label",{className:"small",style:{display:"inline-flex",gap:6,alignItems:"center"},children:[(0,v.jsx)("input",{type:"checkbox",checked:Boolean(Na[e]),onChange:s=>fa(a=>(0,i.A)((0,i.A)({},a),{},{[e]:s.target.checked}))}),y[e]||e]},e)),(0,v.jsx)("button",{type:"button",className:"btn sm",onClick:Sa,children:"T\xfcm\xfcn\xfc se\xe7"}),(0,v.jsx)("button",{type:"button",className:"btn sm",onClick:wa,children:"Temizle"})]})]}):null,(0,v.jsxs)("div",{style:{marginBottom:12},children:[(0,v.jsxs)("div",{className:"small",style:{marginBottom:6},children:["Note ","revise"===va.action?"(required)":"(optional)"]}),(0,v.jsx)("textarea",{className:"input",style:{width:"100%",minHeight:90},value:ja,onChange:e=>ya(e.target.value)})]}),(0,v.jsxs)("div",{className:"row",style:{justifyContent:"flex-end"},children:[(0,v.jsx)("button",{className:"btn",onClick:Sl,children:"Cancel"}),(0,v.jsx)("button",{className:"btn primary",onClick:async()=>{var e,s;if(null===va||void 0===va||null===(e=va.row)||void 0===e||null===(s=e.scenario)||void 0===s||!s.id)return;const a=va.action,l=ja.trim();if("revise"===a&&!l)return void o.oR.error("Note is required for revision requests");const i={action:a,note:l||null};if("approve"===a){const e=x.filter(e=>ga[e]);if(!e.length)return void o.oR.error("Select at least one year");i.includedYears=e}else if("revise"===a){const e=j.filter(e=>Na[e]);if(!e.length)return void o.oR.error("Select at least one module");i.revisionWorkIds=e}Ca(!0);try{await d.FH.adminReviewScenario(va.row.scenario.id,i),o.oR.success("approve"===a?"Scenario approved":"Revision requested"),Sl(),await jl()}catch(n){o.oR.error(n.message||"Review failed")}finally{Ca(!1)}},disabled:ka,children:ka?"Saving...":"approve"===va.action?"Approve":"Request Revision"})]})]})}):null,As?(0,v.jsx)("div",{className:"modal-backdrop",role:"dialog","aria-modal":"true",children:(0,v.jsxs)("div",{className:"modal",style:{maxWidth:960},children:[(0,v.jsx)("div",{style:{fontWeight:700,marginBottom:8},children:"approve"===As.action?"Approve Batch":"Request Revision"}),(0,v.jsxs)("div",{className:"small",style:{marginBottom:12},children:[null!==(R=As.row)&&void 0!==R&&null!==(F=R.country)&&void 0!==F&&F.name?"".concat(As.row.country.name," - "):"",(null===(B=As.row)||void 0===B?void 0:B.academic_year)||"Batch"]}),Hs?(0,v.jsx)("div",{className:"card",children:"Loading batch details..."}):null!==Us&&void 0!==Us&&null!==(T=Us.items)&&void 0!==T&&T.length?(0,v.jsx)("div",{className:"table-scroll",style:{marginBottom:12},children:(0,v.jsxs)("table",{className:"table",children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{children:"Okul"}),(0,v.jsx)("th",{children:"Senaryo"}),(0,v.jsx)("th",{children:"Durum"}),(0,v.jsx)("th",{children:"Progress"}),(0,v.jsx)("th",{children:"Kaynak"})]})}),(0,v.jsx)("tbody",{children:Us.items.map(e=>(0,v.jsxs)("tr",{children:[(0,v.jsx)("td",{children:e.school_name}),(0,v.jsx)("td",{children:e.scenario_name}),(0,v.jsx)("td",{children:e.status}),(0,v.jsx)("td",{children:Number.isFinite(Number(e.progress_pct))?"".concat(Math.round(Number(e.progress_pct)),"%"):"-"}),(0,v.jsx)("td",{children:e.is_source?"Evet":"Hayir"})]},"".concat(e.school_id,"-").concat(e.scenario_id)))})]})}):(0,v.jsx)("div",{className:"card",children:"No items found."}),"approve"===As.action?(0,v.jsxs)("div",{style:{marginBottom:10},children:[(0,v.jsx)("div",{className:"small",style:{marginBottom:6},children:"Included years"}),(0,v.jsx)("div",{className:"row",children:x.map(e=>(0,v.jsxs)("label",{className:"small",style:{display:"inline-flex",gap:6},children:[(0,v.jsx)("input",{type:"checkbox",checked:Ts[e],onChange:s=>Is(a=>(0,i.A)((0,i.A)({},a),{},{[e]:s.target.checked}))}),e.toUpperCase()]},e))})]}):null,"revise"===As.action?(0,v.jsxs)("div",{style:{marginBottom:10},children:[(0,v.jsx)("div",{className:"small",style:{marginBottom:6},children:"Sadece se\xc3\xa7ilen mod\xc3\xbcller revizeye a\xc3\xa7\xc4\xb1lacak (editable)."}),(0,v.jsxs)("div",{className:"row",style:{flexWrap:"wrap",gap:8},children:[j.map(e=>(0,v.jsxs)("label",{className:"small",style:{display:"inline-flex",gap:6,alignItems:"center"},children:[(0,v.jsx)("input",{type:"checkbox",checked:Boolean(Es[e]),onChange:s=>Ls(a=>(0,i.A)((0,i.A)({},a),{},{[e]:s.target.checked}))}),y[e]||e]},e)),(0,v.jsx)("button",{type:"button",className:"btn sm",onClick:_a,children:"T\xc3\xbcm\xc3\xbcn\xc3\xbc se\xc3\xa7"}),(0,v.jsx)("button",{type:"button",className:"btn sm",onClick:Aa,children:"Temizle"})]})]}):null,(0,v.jsxs)("div",{style:{marginBottom:12},children:[(0,v.jsxs)("div",{className:"small",style:{marginBottom:6},children:["Note ","revise"===As.action?"(required)":"(optional)"]}),(0,v.jsx)("textarea",{className:"input",style:{width:"100%",minHeight:90},value:Fs,onChange:e=>Bs(e.target.value)})]}),(0,v.jsxs)("div",{className:"row",style:{justifyContent:"flex-end"},children:[(0,v.jsx)("button",{className:"btn",onClick:kl,children:"Cancel"}),(0,v.jsx)("button",{className:"btn primary",onClick:async()=>{var e;const s=null===As||void 0===As||null===(e=As.row)||void 0===e?void 0:e.batch_id;if(!s)return;const a=As.action,l=Fs.trim();if("revise"===a&&!l)return void o.oR.error("Note is required for revision requests");const i={action:a,note:l||null};if("approve"===a){const e=x.filter(e=>Ts[e]);if(!e.length)return void o.oR.error("Select at least one year");i.includedYears=e}else{const e=j.filter(e=>Es[e]);if(!e.length)return void o.oR.error("Select at least one module");i.revisionWorkIds=e}Ps(!0);try{await d.FH.adminReviewApprovalBatch(s,i),o.oR.success("approve"===a?"Batch approved":"Revision requested"),kl(),yl(Ya.current)}catch(n){o.oR.error(n.message||"Failed to submit batch review")}finally{Ps(!1)}},disabled:Ms,children:Ms?"Saving...":"approve"===As.action?"Approve":"Request Revision"})]})]})}):null,"users"===K&&(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)("div",{style:{marginTop:12,display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(320px, 1fr))",gap:12},children:[(0,v.jsxs)("div",{className:"card",children:[(0,v.jsx)("div",{style:{fontWeight:700,marginBottom:8},children:"Create User"}),(0,v.jsxs)("div",{className:"row",children:[(0,v.jsx)("input",{className:"input",placeholder:"Full name",value:xe,onChange:e=>je(e.target.value)}),(0,v.jsx)("input",{className:"input",placeholder:"Email",value:ye,onChange:e=>ge(e.target.value)}),(0,v.jsx)("input",{className:"input",placeholder:"Temporary password",type:"password",value:be,onChange:e=>Ne(e.target.value)}),(0,v.jsxs)("select",{className:"input sm",value:fe,onChange:e=>Se(e.target.value),children:[(0,v.jsx)("option",{value:"user",children:"User"}),(0,v.jsx)("option",{value:"admin",children:"Admin"}),(0,v.jsx)("option",{value:"principal",children:"Principal"}),(0,v.jsx)("option",{value:"hr",children:"HR"}),(0,v.jsx)("option",{value:"manager",children:"Manager"}),(0,v.jsx)("option",{value:"accountant",children:"Accountant"})]}),(0,v.jsxs)("select",{className:"input",value:we,onChange:e=>ke(e.target.value),children:[(0,v.jsx)("option",{value:"",children:"Assign country (optional)"}),z.map(e=>(0,v.jsxs)("option",{value:e.id,children:[e.name," (",e.code,")",e.region?" - ".concat(e.region):""]},e.id))]}),(0,v.jsx)("button",{className:"btn primary",onClick:async function(){const e={fullName:xe.trim()||null,email:ye.trim(),password:be,role:fe};if(we){const s=Number(we);if(!Number.isFinite(s))return void o.oR.error("Invalid country selection");e.countryId=s}if(e.email&&e.password)if(e.password.length<8)o.oR.error("Password must be at least 8 characters");else try{await d.FH.createUser(e),je(""),ge(""),Ne(""),Se("user"),ke(""),await pl(),o.oR.success("User created (password reset required on first login)")}catch(s){o.oR.error(s.message||"Create user failed")}else o.oR.error("Email and password are required")},disabled:V,children:(0,v.jsxs)("span",{className:"row",style:{gap:6,alignItems:"center"},children:[(0,v.jsx)(c.NPy,{"aria-hidden":"true"}),(0,v.jsx)("span",{children:"Create"})]})})]}),(0,v.jsx)("div",{className:"small",style:{marginTop:8},children:"New users must reset their password on first login."})]}),(0,v.jsxs)("div",{className:"card",children:[(0,v.jsx)("div",{style:{fontWeight:700,marginBottom:8},children:"Assign / Edit User Country"}),(0,v.jsx)("div",{className:"small",style:{marginBottom:6},children:Oa?"Editing: ".concat(Oa.email).concat(Oa.full_name?" (".concat(Oa.full_name,")"):""," #").concat(Oa.id):"Select a user to assign or edit."}),(0,v.jsxs)("div",{className:"row",children:[(0,v.jsxs)("select",{className:"input",value:Ce,onChange:e=>_e(e.target.value),children:[(0,v.jsx)("option",{value:"",children:"Select user"}),Q.map(e=>(0,v.jsxs)("option",{value:e.id,children:[e.email," ",e.full_name?"(".concat(e.full_name,")"):""," #",e.id]},e.id))]}),(0,v.jsxs)("select",{className:"input",value:Ae,onChange:e=>Re(e.target.value),children:[(0,v.jsx)("option",{value:"",children:"Select country"}),z.map(e=>(0,v.jsxs)("option",{value:e.id,children:[e.name," (",e.code,") - ",e.region]},e.id))]}),(0,v.jsx)("button",{className:"btn primary",onClick:async function(){if(!Oa)return void o.oR.error("Select a user");if(!Ae)return void o.oR.error("Select a country");if(Z)return;const e=Number(Ae);if(Number.isFinite(e))if(Ja)o.oR.error("Selected country is already assigned to this user");else{if(null!=Oa.country_id){const s=Oa.country_name?"".concat(Oa.country_name," (").concat(Oa.country_code,")"):"Unassigned",a=Ka?"".concat(Ka.name," (").concat(Ka.code,")"):"#".concat(e);return void se({userId:Oa.id,nextId:e,email:Oa.email,currentLabel:s,nextLabel:a,hadCountry:!0})}$(!0);try{await d.FH.assignUserCountry(Ce,{countryId:e}),await pl(),o.oR.success("User assigned")}catch(s){o.oR.error(s.message||"Assignment failed")}finally{$(!1)}}else o.oR.error("Invalid country selection")},disabled:V||Z||!Ce||!Ae||Ja,children:Z?"Updating...":Za})]}),(0,v.jsxs)("div",{className:"small",style:{marginTop:8},children:[(0,v.jsxs)("div",{children:["Current: ",Va]}),(0,v.jsxs)("div",{children:["New: ",Xa]}),Oa&&Ka&&null!=Oa.country_id&&!Ja?(0,v.jsx)("div",{style:{color:"#b45309"},children:"You are changing this user's assignment."}):null,Ja?(0,v.jsx)("div",{style:{color:"#6b7280"},children:"Selected country matches current assignment."}):null,"Users must re-login after assignment to refresh their token."]})]})]}),(0,v.jsxs)("div",{className:"card",children:[(0,v.jsx)("div",{style:{fontWeight:700,marginBottom:8},children:"Permissions"}),Oa?Qs?(0,v.jsx)("div",{className:"small",children:"Loading permissions..."}):(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)("div",{style:{marginBottom:8},children:[(0,v.jsx)("label",{className:"small",style:{marginRight:8},children:"Role:"}),(0,v.jsx)("select",{className:"input sm",value:(null===Oa||void 0===Oa?void 0:Oa.role)||"user",onChange:e=>async function(s){if(Oa){aa(!0);try{await d.FH.adminUpdateUserRole(Oa.id,{role:s}),await pl(),_e(String(Oa.id)),o.oR.success("Role updated")}catch(e){o.oR.error((null===e||void 0===e?void 0:e.message)||"Failed to update role")}finally{aa(!1)}}}(e.target.value),disabled:sa,children:ea.map(e=>(0,v.jsx)("option",{value:e.value,children:e.label},e.value))})]}),0===Object.keys(sl).length?(0,v.jsx)("div",{className:"small",children:"No permissions defined."}):Object.entries(sl).map(e=>{let[s,a]=e;return(0,v.jsxs)("div",{style:{marginBottom:12},children:[(0,v.jsx)("div",{style:{fontWeight:600,marginBottom:4},children:s}),a.map(e=>{const s="".concat(e.resource,"|").concat(e.action),a=Boolean(Ks[s]),l=zs[s]||"country";return(0,v.jsxs)("div",{className:"row",style:{alignItems:"center",marginBottom:4},children:[(0,v.jsxs)("label",{className:"small",style:{flexGrow:1,display:"flex",alignItems:"center",gap:6},children:[(0,v.jsx)("input",{type:"checkbox",checked:a,onChange:()=>function(e){Ds(s=>{const a=(0,i.A)({},s);return a[e]=!s[e],a}),Gs(s=>Ks[e]||s[e]?s:(0,i.A)((0,i.A)({},s),{},{[e]:"country"}))}(s)}),e.label]}),(0,v.jsxs)("select",{className:"input sm",disabled:!a,value:l,onChange:e=>function(e,s){Gs(a=>(0,i.A)((0,i.A)({},a),{},{[e]:s}))}(s,e.target.value),children:[(0,v.jsx)("option",{value:"country",children:"Country"}),Zs&&Zs.map(e=>(0,v.jsx)("option",{value:"school:".concat(e.id),children:e.name},e.id))]})]},s)})]},s)}),(0,v.jsx)("div",{className:"row",style:{marginTop:8},children:(0,v.jsx)("button",{className:"btn primary",onClick:async function(){if(!Oa)return void o.oR.error("Select a user to edit permissions");const e=[];Object.keys(Ks||{}).forEach(s=>{if(!Ks[s])return;const[a,l]=s.split("|");let i=zs[s]||"country",n=null,t=null;if("country"===i)null!=Oa.country_id&&(n=Number(Oa.country_id));else if(i.startsWith("school:")){const e=i.split(":")[1],s=Number(e);Number.isFinite(s)&&(t=s),null!=Oa.country_id&&(n=Number(Oa.country_id))}e.push({resource:a,action:l,scope_country_id:n,scope_school_id:t})}),Xs(!0);try{await d.FH.adminSetUserPermissions(Oa.id,{permissions:e});const s=await d.FH.adminGetUserPermissions(Oa.id),a={},l={};(s||[]).forEach(e=>{const s="".concat(e.resource,"|").concat(e.action);a[s]=!0,null!=e.scope_school_id?l[s]="school:".concat(e.scope_school_id):l[s]="country"}),Ds(a),Gs(l),o.oR.success("Permissions saved")}catch(s){o.oR.error((null===s||void 0===s?void 0:s.message)||"Save permissions failed")}finally{Xs(!1)}},disabled:Vs,children:Vs?"Saving...":"Save Permissions"})})]}):(0,v.jsx)("div",{className:"small",children:"Select a user above to edit permissions."})]}),(0,v.jsxs)("div",{className:"card",style:{marginTop:12},children:[(0,v.jsxs)("div",{className:"row",style:{justifyContent:"space-between"},children:[(0,v.jsx)("div",{style:{fontWeight:700},children:"Users"}),(0,v.jsxs)("label",{className:"small",children:[(0,v.jsx)("input",{type:"checkbox",checked:Fe,onChange:e=>Be(e.target.checked)})," ","Unassigned only"]})]}),(0,v.jsxs)("table",{className:"table",style:{marginTop:8},children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{children:"ID"}),(0,v.jsx)("th",{children:"Name"}),(0,v.jsx)("th",{children:"Email"}),(0,v.jsx)("th",{children:"Role"}),(0,v.jsx)("th",{children:"Reset"}),(0,v.jsx)("th",{children:"Country"}),(0,v.jsx)("th",{children:"Region"}),(0,v.jsx)("th",{children:"Actions"})]})}),(0,v.jsx)("tbody",{children:0===$a.length?(0,v.jsx)("tr",{children:(0,v.jsx)("td",{colSpan:"8",className:"small",children:"No users found."})}):$a.map(e=>(0,v.jsxs)("tr",{children:[(0,v.jsx)("td",{className:"small",children:e.id}),(0,v.jsx)("td",{children:e.full_name||"-"}),(0,v.jsx)("td",{children:e.email}),(0,v.jsx)("td",{className:"small",children:e.role}),(0,v.jsx)("td",{children:e.must_reset_password?(0,v.jsx)("span",{className:"badge",children:"Yes"}):(0,v.jsx)("span",{className:"small",children:"No"})}),(0,v.jsx)("td",{children:e.country_name?(0,v.jsxs)("span",{children:[e.country_name," (",e.country_code,")"]}):(0,v.jsx)("span",{className:"badge",children:"Unassigned"})}),(0,v.jsx)("td",{children:e.region||"-"}),(0,v.jsx)("td",{children:(0,v.jsxs)("div",{className:"row",children:[(0,v.jsx)("button",{className:"btn",onClick:()=>_e(String(e.id)),children:"Edit"}),(0,v.jsx)("button",{className:"btn",onClick:()=>async function(e){null!==e&&void 0!==e&&e.id&&ne({id:e.id,email:e.email,full_name:e.full_name||null})}(e),disabled:Boolean(oe),children:"Reset password"}),(0,v.jsx)("button",{className:"btn",onClick:()=>async function(e){if(!e||!e.id)return;const s=e.email||"User #".concat(e.id);le({id:e.id,label:s})}(e),children:"Delete"})]})})]},e.id))})]}),(0,v.jsx)("div",{className:"small",style:{marginTop:8},children:"Delete is blocked if the user has created or updated records."})]})]}),"countries"===K&&(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)("div",{className:"card",style:{marginTop:12},children:[(0,v.jsx)("div",{style:{fontWeight:700,marginBottom:8},children:"Create Country"}),(0,v.jsxs)("div",{className:"row",children:[(0,v.jsx)("input",{className:"input",placeholder:"Country name",value:de,onChange:e=>ue(e.target.value)}),(0,v.jsx)("input",{className:"input sm",placeholder:"Code",value:me,onChange:e=>he(e.target.value.toUpperCase())}),(0,v.jsx)("input",{className:"input",placeholder:"Region",value:pe,onChange:e=>ve(e.target.value)}),(0,v.jsx)("button",{className:"btn primary",onClick:async function(){const e={name:de.trim(),code:me.trim().toUpperCase(),region:pe.trim()};if(e.name&&e.code&&e.region)try{await d.FH.createCountry(e),ue(""),he(""),ve(""),await pl(),o.oR.success("Country created")}catch(s){o.oR.error(s.message||"Create country failed")}else o.oR.error("Name, code, and region are required")},disabled:V,children:"Create"})]})]}),(0,v.jsxs)("div",{className:"card",style:{marginTop:12},children:[(0,v.jsx)("div",{style:{fontWeight:700,marginBottom:8},children:"Countries"}),(0,v.jsxs)("table",{className:"table",children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{children:"ID"}),(0,v.jsx)("th",{children:"Name"}),(0,v.jsx)("th",{children:"Code"}),(0,v.jsx)("th",{children:"Region"})]})}),(0,v.jsx)("tbody",{children:0===z.length?(0,v.jsx)("tr",{children:(0,v.jsx)("td",{colSpan:"4",className:"small",children:"No countries yet."})}):z.map(e=>(0,v.jsxs)("tr",{children:[(0,v.jsx)("td",{className:"small",children:e.id}),(0,v.jsx)("td",{children:e.name}),(0,v.jsx)("td",{className:"small",children:e.code}),(0,v.jsx)("td",{children:e.region})]},e.id))})]})]}),(0,v.jsxs)("div",{className:"card",style:{marginTop:12},children:[(0,v.jsx)("div",{style:{fontWeight:700,marginBottom:8},children:"Country Schools"}),(0,v.jsxs)("div",{className:"row",style:{marginBottom:10},children:[(0,v.jsxs)("select",{className:"input",value:Te,onChange:e=>Ie(e.target.value),children:[(0,v.jsx)("option",{value:"",children:"Select a country"}),z.map(e=>(0,v.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,v.jsx)("input",{className:"input",placeholder:"Search schools",value:Ue,onChange:e=>We(e.target.value),disabled:!Te})]}),(0,v.jsxs)("div",{className:"row",style:{marginBottom:10},children:[(0,v.jsx)("input",{className:"input",placeholder:"New school name",value:He,onChange:e=>qe(e.target.value),disabled:!Te||ml}),(0,v.jsx)("button",{className:"btn primary",onClick:async function(){if(!Te)return void o.oR.error("Select a country");const e=He.trim();if(e){Oe(!0);try{await d.FH.adminCreateCountrySchool(Te,{name:e}),qe(""),await vl(Te),o.oR.success("School created")}catch(s){o.oR.error(s.message||"Create school failed")}finally{Oe(!1)}}else o.oR.error("School name is required")},disabled:!Te||ml,children:(0,v.jsxs)("span",{className:"row",style:{gap:6,alignItems:"center"},children:[(0,v.jsx)(c.iM1,{"aria-hidden":"true"}),(0,v.jsx)("span",{children:Ye?"Creating...":"Create"})]})})]}),(0,v.jsxs)("div",{style:{marginBottom:12,paddingTop:8,borderTop:"1px solid #eef2f7"},children:[(0,v.jsx)("div",{className:"small",style:{fontWeight:700,marginBottom:6},children:"Bulk add schools"}),(0,v.jsx)("div",{style:{display:"grid",gap:6},children:ze.map((e,s)=>(0,v.jsxs)("div",{className:"row",children:[(0,v.jsx)("input",{className:"input",placeholder:"School name #".concat(s+1),value:e,onChange:e=>{return a=s,l=e.target.value,void Ge(e=>{const s=[...e];return s[a]=l,s});var a,l},disabled:!Te||ml}),(0,v.jsx)("button",{className:"btn",type:"button",onClick:()=>{return e=s,void Ge(s=>s.length<=1?s:s.filter((s,a)=>a!==e));var e},disabled:!Te||ml||ze.length<=1,children:"Remove"})]},"school-create-row-".concat(s)))}),(0,v.jsxs)("div",{className:"row",style:{marginTop:8},children:[(0,v.jsx)("button",{className:"btn",type:"button",onClick:function(){Ge(e=>[...e,""])},disabled:!Te||ml,children:"Add row"}),(0,v.jsx)("button",{className:"btn primary",type:"button",onClick:async function(){if(!Te)return void o.oR.error("Select a country");const e=ze.map(e=>String(e||"").trim()).filter(Boolean),s=Array.from(new Set(e));if(!s.length)return void o.oR.error("At least one school name is required");De(!0);const a=[];let l=0;try{for(const e of s)try{await d.FH.adminCreateCountrySchool(Te,{name:e}),l+=1}catch(i){a.push({name:e,message:(null===i||void 0===i?void 0:i.message)||"Create school failed"})}l>0&&await vl(Te),a.length?(o.oR.error("".concat(a.length," of ").concat(s.length," schools failed")),Ge(a.map(e=>e.name))):(o.oR.success("".concat(l," schools created")),Ge([""]))}finally{De(!1)}},disabled:!Te||ml||0===hl,children:(0,v.jsxs)("span",{className:"row",style:{gap:6,alignItems:"center"},children:[(0,v.jsx)(c.iM1,{"aria-hidden":"true"}),(0,v.jsx)("span",{children:Ke?"Creating...":"Create ".concat(hl||"").trim()})]})})]}),(0,v.jsx)("div",{className:"small",style:{marginTop:6,color:"#6b7280"},children:"Add one school per row, then create all at once."})]}),Da?(0,v.jsxs)("table",{className:"table",children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{children:"Name"}),(0,v.jsx)("th",{children:"Status"}),(0,v.jsx)("th",{children:"Created At"}),(0,v.jsx)("th",{children:"Closed At"}),(0,v.jsx)("th",{children:"Principals"}),(0,v.jsx)("th",{children:"Actions"})]})}),(0,v.jsx)("tbody",{children:Me?(0,v.jsx)("tr",{children:(0,v.jsx)("td",{colSpan:"6",className:"small",children:"Loading..."})}):0===ul.length?(0,v.jsx)("tr",{children:(0,v.jsx)("td",{colSpan:"6",className:"small",children:"No schools found."})}):ul.map(e=>{var s,a;const l="closed"===e.status?{label:"Closed",className:"is-muted"}:{label:"Active",className:"is-ok"};const n=null!==(s=null!==(a=Ve[e.id])&&void 0!==a?a:e.name)&&void 0!==s?s:"",t=Qe===e.id;return(0,v.jsxs)("tr",{children:[(0,v.jsx)("td",{children:e.name}),(0,v.jsx)("td",{children:(0,v.jsx)("span",{className:"status-badge ".concat(l.className),children:l.label})}),(0,v.jsx)("td",{className:"small",children:w(e.created_at)}),(0,v.jsx)("td",{className:"small",children:w(e.closed_at)}),(0,v.jsx)("td",{children:Array.isArray(la[e.id])&&la[e.id].length>0?(0,v.jsx)("span",{children:la[e.id].map(e=>e.full_name||e.email).join(", ")}):(0,v.jsx)("span",{className:"small muted",children:"-"})}),(0,v.jsxs)("td",{children:[(0,v.jsxs)("div",{className:"row",children:[(0,v.jsx)("input",{className:"input sm",value:n,onChange:s=>Xe(a=>(0,i.A)((0,i.A)({},a),{},{[e.id]:s.target.value})),disabled:t}),(0,v.jsx)("button",{className:"btn primary",onClick:()=>async function(e){if(null===e||void 0===e||!e.id)return;const s=Ve[e.id],a=String(null!=s?s:e.name||"").trim();if(a){if(a!==e.name){Je(e.id);try{await d.FH.adminUpdateSchool(e.id,{name:a}),await vl(Te),Xe(s=>(0,i.A)((0,i.A)({},s),{},{[e.id]:a})),o.oR.success("School updated")}catch(l){o.oR.error(l.message||"Update failed")}finally{Je(null)}}}else o.oR.error("Name is required")}(e),disabled:t,children:"Save"}),(0,v.jsx)("button",{className:"btn",onClick:()=>async function(e){if(null===e||void 0===e||!e.id)return;const s="closed"===e.status?"active":"closed";Je(e.id);try{await d.FH.adminUpdateSchool(e.id,{status:s}),await vl(Te),o.oR.success("closed"===s?"School closed":"School reopened")}catch(a){o.oR.error(a.message||"Update failed")}finally{Je(null)}}(e),disabled:t,children:"closed"===e.status?"Reopen":"Close"})]}),(0,v.jsxs)("div",{className:"row",style:{marginTop:4},children:[(0,v.jsx)("select",{multiple:!0,className:"input sm",value:(na[e.id]||[]).map(String),onChange:s=>{const a=Array.from(s.target.selectedOptions||[]).map(e=>e.value);!function(e,s){const a=s.map(e=>Number(e)).filter(e=>Number.isFinite(e));ta(s=>(0,i.A)((0,i.A)({},s),{},{[e]:a}))}(e.id,a)},children:Q.filter(e=>"principal"===e.role).map(e=>(0,v.jsxs)("option",{value:e.id,children:[e.email," ",e.full_name?"(".concat(e.full_name,")"):""," #",e.id]},e.id))}),(0,v.jsx)("button",{className:"btn",onClick:()=>async function(e){const s=na[e]||[];oa(s=>(0,i.A)((0,i.A)({},s),{},{[e]:!0}));try{await d.FH.adminSetSchoolPrincipals(e,{userIds:s});const a=Q.filter(e=>"principal"===e.role&&s.includes(e.id));ia(s=>(0,i.A)((0,i.A)({},s),{},{[e]:a})),o.oR.success("Principals updated")}catch(a){o.oR.error((null===a||void 0===a?void 0:a.message)||"Failed to update principals")}finally{oa(s=>(0,i.A)((0,i.A)({},s),{},{[e]:!1}))}}(e.id),disabled:Boolean(ra[e.id]),children:ra[e.id]?"Saving...":"Save"})]})]})]},e.id)})})]}):(0,v.jsx)("div",{className:"small",children:"Select a country to manage its schools."})]})]}),"progress"===K&&(0,v.jsxs)("div",{style:{marginTop:12},children:[(0,v.jsx)("div",{className:"card",children:(0,v.jsxs)("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center"},children:[(0,v.jsxs)("div",{children:[(0,v.jsx)("div",{style:{fontWeight:700},children:"Progress Tracking"}),(0,v.jsx)("div",{className:"small",children:"Configure per-field requirements by country."})]}),(0,v.jsxs)("div",{className:"row",children:[(0,v.jsxs)("select",{className:"input sm",value:Ze,onChange:e=>$e(e.target.value),children:[(0,v.jsx)("option",{value:"",children:"Select country"}),z.map(e=>(0,v.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,v.jsx)("input",{className:"input sm",placeholder:"Search fields",value:ts,onChange:e=>rs(e.target.value)}),(0,v.jsx)("button",{className:"btn primary",onClick:async()=>{if(Ze){ns(!0);try{const e=await d.FH.adminSaveProgressRequirements(Ze,Qa);ss(C((null===e||void 0===e?void 0:e.config)||e)),o.oR.success("Progress requirements saved")}catch(e){o.oR.error(e.message||"Failed to save progress requirements")}finally{ns(!1)}}else o.oR.error("Select a country")},disabled:!Ze||is||as,children:is?"Saving...":"Save"})]})]})}),(0,v.jsxs)("div",{className:"card",style:{marginTop:12},children:[(0,v.jsx)("div",{style:{fontWeight:700,marginBottom:8},children:"Apply to multiple countries"}),(0,v.jsxs)("div",{className:"row",style:{alignItems:"center",flexWrap:"wrap",marginBottom:10},children:[(0,v.jsx)("input",{className:"input sm",placeholder:"Search countries",value:ds,onChange:e=>us(e.target.value)}),(0,v.jsx)("button",{className:"btn",onClick:()=>{cs(e=>{const s=new Set(e);return ol.forEach(e=>{const a=Number(e.id);Number.isFinite(a)&&s.add(a)}),s})},disabled:0===ol.length||ms,children:"Select all"}),(0,v.jsx)("button",{className:"btn",onClick:()=>{cs(new Set)},disabled:0===cl||ms,children:"Clear"}),(0,v.jsx)("button",{className:"btn primary",onClick:async()=>{const e=Array.from(os).map(e=>Number(e)).filter(e=>Number.isFinite(e)),s=Array.from(new Set(e));if(!s.length)return void o.oR.error("Select at least one country");if(!Ze)return void o.oR.error("Select a country to edit rules first");if(window.confirm("Apply this configuration to ".concat(s.length," countries? This will overwrite their current rules."))){hs(!0);try{const e=await d.FH.adminBulkSaveProgressRequirements(s,Qa),a=Number.isFinite(Number(null===e||void 0===e?void 0:e.updatedCount))?Number(e.updatedCount):s.length;o.oR.success("Applied to ".concat(a," countries")),s.some(e=>String(e)===String(Ze))&&await xl(Ze)}catch(a){o.oR.error(a.message||"Failed to apply progress requirements")}finally{hs(!1)}}},disabled:dl,children:ms?"Applying...":"Apply to Selected (".concat(cl,")")})]}),(0,v.jsx)("div",{style:{border:"1px solid #e5e7eb",borderRadius:10,padding:10,background:"#fff",maxHeight:240,overflowY:"auto"},children:0===ol.length?(0,v.jsx)("div",{className:"small",children:"No countries found."}):ol.map(e=>{const s=Number(e.id),a=os.has(s);return(0,v.jsxs)("label",{style:{display:"flex",gap:8,alignItems:"center",padding:"6px 0"},children:[(0,v.jsx)("input",{type:"checkbox",checked:a,onChange:()=>(e=>{const s=Number(e);Number.isFinite(s)&&cs(e=>{const a=new Set(e);return a.has(s)?a.delete(s):a.add(s),a})})(s)}),(0,v.jsx)("span",{children:e.name||"-"})]},e.id)})})]}),Ze?(0,v.jsx)("div",{className:"card",style:{marginTop:12},children:as?(0,v.jsx)("div",{className:"small",children:"Loading..."}):(0,v.jsx)("div",{style:{display:"grid",gap:12},children:Ga.tabs.map(e=>{const s=Ga.sections.filter(s=>s.tabKey===e.key),a=s.filter(e=>{if(!rl)return!0;const s=String(e.label||"").toLowerCase().includes(rl),a=(e.fields||[]).map(e=>Ga.fieldsById[e]).filter(Boolean).some(e=>{const s=String(e.label||"").toLowerCase(),a=String(e.id||"").toLowerCase();return s.includes(rl)||a.includes(rl)});return s||a});if(!a.length)return null;const l=xs.has(e.key)||Boolean(rl);return(0,v.jsxs)("div",{style:{border:"1px solid #e5e7eb",borderRadius:10,padding:10},children:[(0,v.jsxs)("div",{className:"row",style:{justifyContent:"space-between"},children:[(0,v.jsxs)("div",{className:"row",children:[(0,v.jsx)("button",{type:"button",className:"btn",onClick:()=>{return s=e.key,void js(e=>{const a=new Set(e);return a.has(s)?a.delete(s):a.add(s),a});var s},children:l?"-":"+"}),(0,v.jsx)("div",{style:{fontWeight:700},children:e.label})]}),(0,v.jsxs)("div",{className:"small",children:[s.length," sections"]})]}),l?(0,v.jsx)("div",{style:{display:"grid",gap:10,marginTop:10},children:a.map(e=>{var s;const a=(null===(s=Qa.sections)||void 0===s?void 0:s[e.id])||{},l=!1!==a.enabled,n=String(a.mode||e.modeDefault||"ALL").toUpperCase(),t=Number.isFinite(Number(a.min))&&Number(a.min)>0?Number(a.min):e.minDefault||1,r=(e.fields||[]).map(e=>Ga.fieldsById[e]).filter(Boolean),o=rl?r.filter(e=>{const s=String(e.label||"").toLowerCase(),a=String(e.id||"").toLowerCase();return s.includes(rl)||a.includes(rl)}):r;if(!o.length&&rl)return null;const c=ys.has(e.id)||Boolean(rl),d=(rl?o:r).map(e=>e.id),u=r.filter(e=>{var s;return!1!==(null===(s=a.selectedFields)||void 0===s?void 0:s[e.id])}).length,m=r.length,h=Boolean(ps[e.id]),p=h?o.filter(e=>{var s;return!1!==(null===(s=a.selectedFields)||void 0===s?void 0:s[e.id])}):o,x="MIN"===n?t:null,j="MIN"===n&&x>u,y="ALL"===n?"\u2705 Rule: Must complete ALL selected fields (".concat(u," selected)"):j?"\u26a0\ufe0f MIN (".concat(x,") is greater than selected (").concat(u,"). It will behave like ALL."):"\u2705 Rule: Must complete AT LEAST ".concat(x," of ").concat(u," selected fields"),g="MIN"===n?x:u;return(0,v.jsxs)("div",{style:{borderTop:"1px solid #eef2f7",paddingTop:10},children:[(0,v.jsxs)("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center"},children:[(0,v.jsxs)("div",{className:"row",children:[(0,v.jsx)("button",{type:"button",className:"btn",onClick:()=>{return s=e.id,void gs(e=>{const a=new Set(e);return a.has(s)?a.delete(s):a.add(s),a});var s},children:c?"-":"+"}),(0,v.jsx)("div",{style:{fontWeight:700},children:e.label}),(0,v.jsx)("span",{className:"status-badge ".concat(l?"is-ok":"is-muted"),children:l?"Enabled":"Disabled"}),(0,v.jsxs)("span",{className:"small",children:[u,"/",r.length||0," selected"]})]}),(0,v.jsxs)("div",{className:"row",children:[(0,v.jsxs)("label",{className:"small",children:[(0,v.jsx)("input",{type:"checkbox",checked:h,onChange:()=>vs(s=>(0,i.A)((0,i.A)({},s),{},{[e.id]:!(null!==s&&void 0!==s&&s[e.id])}))})," ","Show only selected"]}),(0,v.jsxs)("label",{className:"small",children:[(0,v.jsx)("input",{type:"checkbox",checked:l,onChange:s=>{return a=e.id,l=s.target.checked,void Nl(a,e=>{e.enabled=!!l});var a,l}})," ","Enabled"]}),(0,v.jsxs)("select",{className:"input xs",value:n,onChange:s=>{return a=e.id,l=s.target.value,void Nl(a,e=>{e.mode=l});var a,l},children:[(0,v.jsx)("option",{value:"ALL",children:"ALL"}),(0,v.jsx)("option",{value:"MIN",children:"MIN"})]}),"MIN"===n?(0,v.jsx)("input",{className:"input xs",type:"number",min:"1",value:t,onChange:s=>((e,s)=>{const a=Number(s);Nl(e,e=>{e.min=Number.isFinite(a)?Math.max(1,a):1})})(e.id,s.target.value)}):null,(0,v.jsx)("button",{className:"btn",onClick:()=>{return s=e.id,a=d,void Nl(s,e=>{e.selectedFields||(e.selectedFields={}),a.forEach(s=>{e.selectedFields&&delete e.selectedFields[s]})});var s,a},disabled:!d.length,children:"Select all"}),(0,v.jsx)("button",{className:"btn",onClick:()=>{return s=e.id,a=d,void Nl(s,e=>{e.selectedFields||(e.selectedFields={}),a.forEach(s=>{e.selectedFields&&(e.selectedFields[s]=!1)})});var s,a},disabled:!d.length,children:"Unselect all"})]})]}),(0,v.jsx)("div",{className:"small",style:{marginTop:6},children:y}),(0,v.jsxs)("div",{className:"small",style:{marginTop:4,color:"#6b7280"},children:["Selected: ",u,"/",m," \xb7 Mode: ",n," \xb7 Required: ",g]}),c?(0,v.jsx)("div",{style:{marginTop:8},children:p.length?(0,v.jsx)("div",{className:"grid2",style:{gap:8},children:p.map(s=>{var i;const n=!1!==(null===(i=a.selectedFields)||void 0===i?void 0:i[s.id]),t=((e,s)=>{if(!s)return null;const a=String(s.id||""),l=String(s.label||"");return"gradesPlan.plan"===e&&(a.startsWith("gradesPlan.")||l.includes("Plan "))?"grade":"ik.localStaff"===e&&a.startsWith("ik.headcount.")||"gelirler.unitFee"===e&&a.startsWith("gelirler.tuition.")?"type":null})(e.id,s);return(0,v.jsxs)("label",{className:"small",style:{display:"flex",gap:8,alignItems:"center",justifyContent:"space-between",width:"100%"},children:[(0,v.jsxs)("span",{style:{display:"inline-flex",gap:8,alignItems:"center"},children:[(0,v.jsx)("input",{type:"checkbox",checked:n,onChange:a=>((e,s,a)=>{Nl(e,e=>{e.selectedFields||(e.selectedFields={}),a?delete e.selectedFields[s]:e.selectedFields[s]=!1})})(e.id,s.id,a.target.checked),disabled:!l}),(0,v.jsx)("span",{children:s.label||s.id})]}),t?(0,v.jsxs)("span",{style:{padding:"2px 8px",borderRadius:999,background:"#eef2f7",color:"#374151",fontSize:11,lineHeight:1.4,whiteSpace:"nowrap"},children:["Dynamic: ",t]}):null]},s.id)})}):(0,v.jsx)("div",{className:"small",children:"No fields available for this section."})}):null]},e.id)})}):null]},e.key)})})}):(0,v.jsx)("div",{className:"card",style:{marginTop:12},children:(0,v.jsx)("div",{className:"small",children:"Select a country to edit progress rules."})})]}),"approvals"===K&&(0,v.jsxs)("div",{className:"card",style:{marginTop:12},children:[(0,v.jsxs)("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center",gap:12},children:[(0,v.jsxs)("div",{children:[(0,v.jsx)("div",{style:{fontWeight:700},children:"\xc7al\u0131\u015fma Listeleri"}),(0,v.jsx)("div",{className:"small",children:"batches"===fs?"Review country approval batches.":"Review submitted scenarios and approve for rollups."})]}),(0,v.jsxs)("div",{className:"row",style:{gap:8},children:[(0,v.jsx)("button",{className:"btn ".concat("scenarios"===fs?"primary":""),onClick:()=>Ss("scenarios"),children:"Senaryolar"}),(0,v.jsx)("button",{className:"btn ".concat("batches"===fs?"primary":""),onClick:()=>Ss("batches"),children:"Ulke Paketleri"})]})]}),(0,v.jsxs)("div",{className:"row admin-filter-row",style:{marginTop:10},children:[(0,v.jsxs)("select",{className:"input sm",value:ua.status,onChange:e=>ma(s=>(0,i.A)((0,i.A)({},s),{},{status:e.target.value})),children:[(0,v.jsx)("option",{value:"",children:"All"}),(0,v.jsx)("option",{value:"sent_for_approval",children:"Sent for approval"}),(0,v.jsx)("option",{value:"approved",children:"Approved"}),(0,v.jsx)("option",{value:"revision_requested",children:"Revision requested"}),(0,v.jsx)("option",{value:"draft",children:"Draft"})]}),(0,v.jsx)("input",{className:"input sm",placeholder:"Academic year",value:ua.academicYear,onChange:e=>ma(s=>(0,i.A)((0,i.A)({},s),{},{academicYear:e.target.value}))}),(0,v.jsxs)("select",{className:"input sm",value:ua.region,onChange:e=>ma(s=>(0,i.A)((0,i.A)({},s),{},{region:e.target.value,countryId:""})),children:[(0,v.jsx)("option",{value:"",children:"All regions"}),el.map(e=>(0,v.jsx)("option",{value:e,children:e},e))]}),(0,v.jsxs)("select",{className:"input sm",value:ua.countryId,onChange:e=>ma(s=>(0,i.A)((0,i.A)({},s),{},{countryId:e.target.value})),children:[(0,v.jsx)("option",{value:"",children:"All countries"}),al.map(e=>(0,v.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,v.jsx)("button",{className:"btn",onClick:()=>"batches"===fs?yl(ua):jl(ua),disabled:"batches"===fs?Cs:ca,children:"Apply"})]}),"scenarios"===fs?(0,v.jsxs)("table",{className:"table admin-approvals-table",style:{marginTop:12},children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{"aria-sort":nl("country_name"),children:(0,v.jsxs)("button",{type:"button",onClick:()=>ll("country_name"),style:{display:"inline-flex",alignItems:"center",gap:6,background:"none",border:"none",padding:0,cursor:"pointer",font:"inherit"},title:"Sort",children:["\xdclke ",(0,v.jsx)("span",{"aria-hidden":!0,children:il("country_name")})]})}),(0,v.jsx)("th",{"aria-sort":nl("school_name"),children:(0,v.jsxs)("button",{type:"button",onClick:()=>ll("school_name"),style:{display:"inline-flex",alignItems:"center",gap:6,background:"none",border:"none",padding:0,cursor:"pointer",font:"inherit"},title:"Sort",children:["School ",(0,v.jsx)("span",{"aria-hidden":!0,children:il("school_name")})]})}),(0,v.jsx)("th",{"aria-sort":nl("scenario_name"),children:(0,v.jsxs)("button",{type:"button",onClick:()=>ll("scenario_name"),style:{display:"inline-flex",alignItems:"center",gap:6,background:"none",border:"none",padding:0,cursor:"pointer",font:"inherit"},title:"Sort",children:["Scenario ",(0,v.jsx)("span",{"aria-hidden":!0,children:il("scenario_name")})]})}),(0,v.jsx)("th",{"aria-sort":nl("academic_year"),children:(0,v.jsxs)("button",{type:"button",onClick:()=>ll("academic_year"),style:{display:"inline-flex",alignItems:"center",gap:6,background:"none",border:"none",padding:0,cursor:"pointer",font:"inherit"},title:"Sort",children:["Academic Year ",(0,v.jsx)("span",{"aria-hidden":!0,children:il("academic_year")})]})}),(0,v.jsx)("th",{"aria-sort":nl("submitted_at"),children:(0,v.jsxs)("button",{type:"button",onClick:()=>ll("submitted_at"),style:{display:"inline-flex",alignItems:"center",gap:6,background:"none",border:"none",padding:0,cursor:"pointer",font:"inherit"},title:"Sort",children:["Submitted ",(0,v.jsx)("span",{"aria-hidden":!0,children:il("submitted_at")})]})}),(0,v.jsx)("th",{"aria-sort":nl("status"),children:(0,v.jsxs)("button",{type:"button",onClick:()=>ll("status"),style:{display:"inline-flex",alignItems:"center",gap:6,background:"none",border:"none",padding:0,cursor:"pointer",font:"inherit"},title:"Sort",children:["Status ",(0,v.jsx)("span",{"aria-hidden":!0,children:il("status")})]})}),(0,v.jsx)("th",{children:"Progress"}),(0,v.jsx)("th",{children:"Y1 KPIs"}),(0,v.jsx)("th",{children:"Y2 KPIs"}),(0,v.jsx)("th",{children:"Y3 KPIs"}),(0,v.jsx)("th",{children:"Actions"})]})}),(0,v.jsx)("tbody",{children:ca?(0,v.jsx)("tr",{children:(0,v.jsx)("td",{colSpan:"11",className:"small",children:"Loading..."})}):0===tl.length?(0,v.jsx)("tr",{children:(0,v.jsx)("td",{colSpan:"11",className:"small",children:"No scenarios found."})}):tl.map(e=>{var s,a,l,i,n,t,r,o,c,d,u,h,p,x,j,y,g,b,N,f,S;const k=(e=>{const s=e&&"object"===typeof e?e:{status:e},a=s.status,l=s.sent_at;switch(a){case"revision_requested":return{label:"Revize istendi",className:"is-bad"};case"sent_for_approval":return{label:"Merkeze iletildi",className:"is-warn"};case"approved":return l?{label:"Onayland\u0131",className:"is-ok"}:{label:"Kontrol edildi",className:"is-ok"};case"in_review":return{label:"\u0130ncelemede",className:"is-warn"};case"submitted":return{label:"Onayda",className:"is-warn"};default:return{label:"Taslak",className:"is-muted"}}})(e.scenario),C="sent_for_approval"===(null===(s=e.scenario)||void 0===s?void 0:s.status)||"submitted"===(null===(a=e.scenario)||void 0===a?void 0:a.status),_=["sent_for_approval","approved","submitted"].includes(null===(l=e.scenario)||void 0===l?void 0:l.status),A=(null===(i=e.missingKpis)||void 0===i?void 0:i.y1)||(null===(n=e.missingKpis)||void 0===n?void 0:n.y2)||(null===(t=e.missingKpis)||void 0===t?void 0:t.y3),R=Number.isFinite(Number(null===(r=e.scenario)||void 0===r?void 0:r.progress_pct))?Math.round(Number(e.scenario.progress_pct)):null,F=Number((null===(o=e.scenario)||void 0===o?void 0:o.progress_missing_count)||0),B=null===(c=e.scenario)||void 0===c?void 0:c.progress_missing_preview,T=null==R?[]:F>0?["Eksik:",B||"Eksik alanlar"]:["Tum tablar tamamlandi"];return(0,v.jsxs)("tr",{children:[(0,v.jsxs)("td",{children:[(0,v.jsx)("div",{style:{fontWeight:700},children:(null===(p=e.country)||void 0===p?void 0:p.name)||"-"}),null!==(x=e.country)&&void 0!==x&&x.region?(0,v.jsx)("div",{className:"small",children:e.country.region}):null]}),(0,v.jsx)("td",{children:(0,v.jsx)("div",{style:{fontWeight:700},children:(null===(j=e.school)||void 0===j?void 0:j.name)||"-"})}),(0,v.jsxs)("td",{children:[(0,v.jsx)("div",{children:(null===(y=e.scenario)||void 0===y?void 0:y.name)||"-"}),A?(0,v.jsx)("span",{className:"status-badge is-bad",children:"Missing KPIs"}):null]}),(0,v.jsx)("td",{className:"small",children:(null===(g=e.scenario)||void 0===g?void 0:g.academic_year)||"-"}),(0,v.jsx)("td",{className:"small",children:w(null===(b=e.scenario)||void 0===b?void 0:b.submitted_at)}),(0,v.jsx)("td",{children:(0,v.jsx)("span",{className:"status-badge ".concat(k.className),children:k.label})}),(0,v.jsx)("td",{children:null==R?(0,v.jsx)("span",{className:"small",children:"-"}):(0,v.jsx)(m.A,{lines:T,children:(0,v.jsxs)("span",{className:"badge",children:[R,"%"]})})}),(0,v.jsx)("td",{children:Cl(null===(N=e.kpis)||void 0===N?void 0:N.y1)}),(0,v.jsx)("td",{children:Cl(null===(f=e.kpis)||void 0===f?void 0:f.y2)}),(0,v.jsx)("td",{children:Cl(null===(S=e.kpis)||void 0===S?void 0:S.y3)}),(0,v.jsx)("td",{children:(0,v.jsxs)("div",{className:"row",children:[(0,v.jsx)("button",{className:"btn primary",onClick:()=>fl(e,"approve"),disabled:!C||ka,children:"Onayla"}),(0,v.jsx)("button",{className:"btn",onClick:()=>fl(e,"revise"),disabled:!_||ka,children:"Revizyon \u0130ste"})]})})]},(null===(d=e.scenario)||void 0===d?void 0:d.id)||"".concat(null===(u=e.school)||void 0===u?void 0:u.id,"-").concat(null===(h=e.scenario)||void 0===h?void 0:h.name))})})]}):(0,v.jsxs)("table",{className:"table admin-approvals-table",style:{marginTop:12},children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{children:"\xdclke"}),(0,v.jsx)("th",{children:"Akademik Y\u0131l"}),(0,v.jsx)("th",{children:"Durum"}),(0,v.jsx)("th",{children:"Olu\u015fturma"}),(0,v.jsx)("th",{children:"\u0130nceleme"}),(0,v.jsx)("th",{children:"Senaryo"}),(0,v.jsx)("th",{children:"Okul"}),(0,v.jsx)("th",{children:"\u0130\u015flem"})]})}),(0,v.jsx)("tbody",{children:Cs?(0,v.jsx)("tr",{children:(0,v.jsx)("td",{colSpan:"8",className:"small",children:"Loading..."})}):0===ws.length?(0,v.jsx)("tr",{children:(0,v.jsx)("td",{colSpan:"8",className:"small",children:"No batches found."})}):ws.map(e=>{var s,a;const l=(e=>{switch(String(e||"")){case"revision_requested":return{label:"Revize istendi",className:"is-bad"};case"sent_for_approval":return{label:"Merkeze iletildi",className:"is-warn"};case"approved":return{label:"Onayland\xc4\xb1",className:"is-ok"};default:return{label:"-",className:"is-muted"}}})(e.status),i="sent_for_approval"===e.status,n=["sent_for_approval","approved"].includes(e.status);return(0,v.jsxs)("tr",{children:[(0,v.jsxs)("td",{children:[(0,v.jsx)("div",{style:{fontWeight:700},children:(null===(s=e.country)||void 0===s?void 0:s.name)||"-"}),null!==(a=e.country)&&void 0!==a&&a.region?(0,v.jsx)("div",{className:"small",children:e.country.region}):null]}),(0,v.jsx)("td",{className:"small",children:e.academic_year||"-"}),(0,v.jsx)("td",{children:(0,v.jsx)("span",{className:"status-badge ".concat(l.className),children:l.label})}),(0,v.jsx)("td",{className:"small",children:w(e.created_at)}),(0,v.jsx)("td",{className:"small",children:w(e.reviewed_at)}),(0,v.jsx)("td",{className:"small",children:e.scenario_count}),(0,v.jsx)("td",{className:"small",children:e.school_count}),(0,v.jsx)("td",{children:(0,v.jsxs)("div",{className:"row",children:[(0,v.jsx)("button",{className:"btn",onClick:()=>wl(e,"approve"),disabled:!i||Ms,children:"Onayla"}),(0,v.jsx)("button",{className:"btn",onClick:()=>wl(e,"revise"),disabled:!n||Ms,children:"Revizyon \u0130ste"})]})})]},e.batch_id)})})]})]}),"reports"===K&&(0,v.jsxs)("div",{style:{marginTop:12},children:[(0,v.jsx)("div",{className:"card",children:(0,v.jsxs)("div",{className:"row",style:{justifyContent:"space-between"},children:[(0,v.jsxs)("div",{children:[(0,v.jsx)("div",{style:{fontWeight:700},children:"Rollup Reports"}),(0,v.jsx)("div",{className:"small",children:"Approved scenarios only. Select an academic year."})]}),(0,v.jsxs)("div",{className:"row",children:[(0,v.jsx)("input",{className:"input sm",placeholder:"Academic year",value:Ra,onChange:e=>Fa(e.target.value)}),(0,v.jsx)("button",{className:"btn",onClick:()=>gl(Ra),disabled:Ia,children:Ia?"Loading...":"Load"}),(0,v.jsxs)("div",{className:"action-menu",ref:Pa,children:[(0,v.jsx)("button",{type:"button",className:"btn",onClick:()=>{Rl||Ma(e=>!e)},disabled:Rl,"aria-haspopup":"menu","aria-expanded":La,children:"Export"}),La?(0,v.jsxs)("div",{className:"action-menu-panel",role:"menu",children:[(0,v.jsxs)("button",{type:"button",className:"action-menu-item",onClick:()=>{Ma(!1)},disabled:!0,title:"Excel export coming soon",role:"menuitem",children:["Excel (.xlsx)"," (coming soon)"]}),(0,v.jsx)("button",{type:"button",className:"action-menu-item",disabled:!0,role:"menuitem",children:"PDF (coming soon)"})]}):null]})]})]})}),Ba?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)("div",{className:"card",style:{marginTop:12},children:[(0,v.jsx)("div",{style:{fontWeight:700},children:"Consolidated KPIs"}),(0,v.jsx)("div",{className:"admin-kpi-strip",style:{marginTop:10},children:x.map(e=>{var s,a,l,i,n,t,r,o,c,d,u,m;return(0,v.jsxs)("div",{className:"admin-kpi-year",children:[(0,v.jsx)("div",{className:"admin-kpi-year-title",children:e.toUpperCase()}),(0,v.jsxs)("div",{className:"admin-kpi-grid",children:[(0,v.jsxs)("div",{className:"admin-kpi",children:[(0,v.jsx)("div",{className:"admin-kpi-label",children:"Net ciro"}),(0,v.jsx)("div",{className:"admin-kpi-value",children:f(null===(s=Ba.totals)||void 0===s||null===(a=s[e])||void 0===a?void 0:a.net_ciro)})]}),(0,v.jsxs)("div",{className:"admin-kpi",children:[(0,v.jsx)("div",{className:"admin-kpi-label",children:"Net income"}),(0,v.jsx)("div",{className:"admin-kpi-value",children:f(null===(l=Ba.totals)||void 0===l||null===(i=l[e])||void 0===i?void 0:i.net_income)})]}),(0,v.jsxs)("div",{className:"admin-kpi",children:[(0,v.jsx)("div",{className:"admin-kpi-label",children:"Expenses"}),(0,v.jsx)("div",{className:"admin-kpi-value",children:f(null===(n=Ba.totals)||void 0===n||null===(t=n[e])||void 0===t?void 0:t.total_expenses)})]}),(0,v.jsxs)("div",{className:"admin-kpi",children:[(0,v.jsx)("div",{className:"admin-kpi-label",children:"Net result"}),(0,v.jsx)("div",{className:"admin-kpi-value",children:f(null===(r=Ba.totals)||void 0===r||null===(o=r[e])||void 0===o?void 0:o.net_result)})]}),(0,v.jsxs)("div",{className:"admin-kpi",children:[(0,v.jsx)("div",{className:"admin-kpi-label",children:"Margin"}),(0,v.jsx)("div",{className:"admin-kpi-value",children:S(null===(c=Ba.totals)||void 0===c||null===(d=c[e])||void 0===d?void 0:d.profitMargin)})]}),(0,v.jsxs)("div",{className:"admin-kpi",children:[(0,v.jsx)("div",{className:"admin-kpi-label",children:"Students"}),(0,v.jsx)("div",{className:"admin-kpi-value",children:f(null===(u=Ba.totals)||void 0===u||null===(m=u[e])||void 0===m?void 0:m.students_total)})]})]})]},e)})})]}),(0,v.jsxs)("div",{className:"card",style:{marginTop:12},children:[(0,v.jsx)("div",{style:{fontWeight:700},children:"Rollup Tree"}),(0,v.jsx)("div",{className:"small",style:{marginTop:4},children:"Only approved scenarios are consolidated. Excluded years show as blank."}),(0,v.jsx)("div",{className:"rollup-table-wrap",style:{marginTop:10},children:(0,v.jsxs)("table",{className:"table rollup-table",children:[(0,v.jsx)("thead",{children:(0,v.jsxs)("tr",{children:[(0,v.jsx)("th",{style:{minWidth:220},children:"Unit"}),(0,v.jsx)("th",{style:{minWidth:220},children:"Y1"}),(0,v.jsx)("th",{style:{minWidth:220},children:"Y2"}),(0,v.jsx)("th",{style:{minWidth:220},children:"Y3"})]})}),(0,v.jsxs)("tbody",{children:[(0,v.jsxs)("tr",{className:"rollup-row rollup-total",children:[(0,v.jsx)("td",{className:"rollup-name",children:"Totals"}),(0,v.jsx)("td",{children:_l(null===(I=Ba.totals)||void 0===I?void 0:I.y1)}),(0,v.jsx)("td",{children:_l(null===(E=Ba.totals)||void 0===E?void 0:E.y2)}),(0,v.jsx)("td",{children:_l(null===(L=Ba.totals)||void 0===L?void 0:L.y3)})]}),null===(M=Ba.regions)||void 0===M?void 0:M.map(e=>{var s,a,l,i;const t=e.region||"Unknown",r=Ua.has(t);return(0,v.jsxs)(n.Fragment,{children:[(0,v.jsxs)("tr",{className:"rollup-row rollup-region",children:[(0,v.jsxs)("td",{className:"rollup-name",children:[(0,v.jsx)("button",{type:"button",className:"tree-toggle",onClick:()=>(e=>{Wa(s=>{const a=new Set(s);return a.has(e)?a.delete(e):a.add(e),a})})(t),"aria-label":"Toggle region",children:r?"-":"+"}),(0,v.jsx)("span",{className:"rollup-title",children:e.region||"Unknown region"})]}),(0,v.jsx)("td",{children:_l(null===(s=e.years)||void 0===s?void 0:s.y1)}),(0,v.jsx)("td",{children:_l(null===(a=e.years)||void 0===a?void 0:a.y2)}),(0,v.jsx)("td",{children:_l(null===(l=e.years)||void 0===l?void 0:l.y3)})]}),r?null===(i=e.countries)||void 0===i?void 0:i.map(e=>{var s,a,l,i;const r="".concat(t,"::").concat(e.id),o=Ha.has(r);return(0,v.jsxs)(n.Fragment,{children:[(0,v.jsxs)("tr",{className:"rollup-row rollup-country",children:[(0,v.jsxs)("td",{className:"rollup-name level-1",children:[(0,v.jsx)("button",{type:"button",className:"tree-toggle",onClick:()=>((e,s)=>{const a="".concat(e,"::").concat(s);qa(e=>{const s=new Set(e);return s.has(a)?s.delete(a):s.add(a),s})})(t,e.id),"aria-label":"Toggle country",children:o?"-":"+"}),(0,v.jsx)("span",{className:"rollup-title",children:e.name})]}),(0,v.jsx)("td",{children:_l(null===(s=e.years)||void 0===s?void 0:s.y1)}),(0,v.jsx)("td",{children:_l(null===(a=e.years)||void 0===a?void 0:a.y2)}),(0,v.jsx)("td",{children:_l(null===(l=e.years)||void 0===l?void 0:l.y3)})]}),o?null===(i=e.schools)||void 0===i?void 0:i.map(e=>{var s,a,l,i;return(0,v.jsxs)("tr",{className:"rollup-row rollup-school",children:[(0,v.jsxs)("td",{className:"rollup-name level-2",children:[e.name,null!==(s=e.included_years)&&void 0!==s&&s.length?(0,v.jsxs)("span",{className:"rollup-sub",children:["(",e.included_years.join(", "),")"]}):null]}),(0,v.jsx)("td",{children:_l(null===(a=e.years)||void 0===a?void 0:a.y1)}),(0,v.jsx)("td",{children:_l(null===(l=e.years)||void 0===l?void 0:l.y2)}),(0,v.jsx)("td",{children:_l(null===(i=e.years)||void 0===i?void 0:i.y3)})]},"school-".concat(e.id))}):null]},r)}):null]},"region-".concat(t))})]})]})})]}),null!==(P=Ba.missingNoApproved)&&void 0!==P&&P.length?(0,v.jsxs)("div",{className:"card admin-alert",style:{marginTop:12},children:[(0,v.jsx)("div",{className:"admin-alert-title",children:"Schools without an approved scenario"}),(0,v.jsx)("ul",{children:Ba.missingNoApproved.map(e=>(0,v.jsxs)("li",{children:[e.name," (",e.country_name,")"]},"missing-".concat(e.id)))})]}):null,null!==(U=Ba.missingKpis)&&void 0!==U&&U.length?(0,v.jsxs)("div",{className:"card admin-alert",style:{marginTop:12},children:[(0,v.jsx)("div",{className:"admin-alert-title",children:"Approved scenarios missing KPI snapshots"}),(0,v.jsx)("ul",{children:Ba.missingKpis.map(e=>(0,v.jsxs)("li",{children:["Scenario #",e.scenario_id," (School #",e.school_id,") - missing ",e.missingYears.join(", ")]},"missing-kpi-".concat(e.scenario_id)))})]}):null]}):(0,v.jsx)("div",{className:"card",style:{marginTop:12},children:(0,v.jsx)("div",{className:"small",children:"Select an academic year to view the rollup report."})})]})]})]})}}}]);
//# sourceMappingURL=613.7feff463.chunk.js.map