{"version":3,"file":"static/js/613.b934c539.chunk.js","mappings":"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","sources":["pages/AdminPage.jsx"],"sourcesContent":["//frontend/src/pages/AdminPage.jsx\r\n\r\nimport React, { useCallback, useEffect, useMemo, useRef, useState } from \"react\";\r\nimport { createPortal } from \"react-dom\";\r\nimport { Link, useLocation, useOutletContext } from \"react-router-dom\";\r\nimport { ToastContainer, toast } from \"react-toastify\";\r\nimport { api } from \"../api\";\r\nimport { useAuth } from \"../auth/AuthContext\";\r\nimport Tooltip from \"../components/ui/Tooltip\";\r\nimport { buildProgressCatalog, DEFAULT_PROGRESS_CONFIG } from \"../utils/progressCatalog\";\r\nimport { ADMIN_TABS } from \"../data/adminTabs\";\r\n\r\n\r\n\r\nconst YEAR_KEYS = [\"y1\", \"y2\", \"y3\"];\r\n\r\n// Required module identifiers used in the scenario workflow.  When\r\n// requesting a revision, the admin can choose which of these modules\r\n// should be unlocked for editing.  These values must stay in sync\r\n// with the backend REQUIRED_WORK_IDS constant defined in\r\n// backend/src/utils/scenarioWorkflow.js.\r\nconst REQUIRED_WORK_IDS = [\r\n  \"temel_bilgiler\",\r\n  \"kapasite\",\r\n  \"norm.ders_dagilimi\",\r\n  \"ik.local_staff\",\r\n  \"gelirler.unit_fee\",\r\n  \"giderler.isletme\",\r\n];\r\n\r\n// Human-readable labels for each required module.  Used in the\r\n// admin revision modal to present checkboxes to select which\r\n// modules should be sent back for revision.\r\nconst WORK_ID_LABELS = {\r\n  temel_bilgiler: \"Temel Bilgiler\",\r\n  kapasite: \"Kapasite\",\r\n  \"norm.ders_dagilimi\": \"Norm\",\r\n  \"ik.local_staff\": \"K\",\r\n  \"gelirler.unit_fee\": \"Gelirler\",\r\n  \"giderler.isletme\": \"Giderler\",\r\n};\r\nconst DEFAULT_ADMIN_TAB = ADMIN_TABS[0]?.key || \"users\";\r\nconst isValidAdminTab = (value) => ADMIN_TABS.some((tab) => tab.key === value);\r\nconst getTabFromSearch = (search) => {\r\n  if (!search) return null;\r\n  const params = new URLSearchParams(search);\r\n  const value = params.get(\"tab\");\r\n  return isValidAdminTab(value) ? value : null;\r\n};\r\n\r\nconst fmt = (v) => {\r\n  const n = Number(v);\r\n  return Number.isFinite(n) ? n.toLocaleString(undefined, { maximumFractionDigits: 0 }) : \"-\";\r\n};\r\n\r\nconst fmtPct = (v) => {\r\n  const n = Number(v);\r\n  return Number.isFinite(n)\r\n    ? (n * 100).toLocaleString(undefined, { maximumFractionDigits: 2 }) + \"%\"\r\n    : \"-\";\r\n};\r\n\r\nconst formatDateTime = (value) => {\r\n  if (!value) return \"-\";\r\n  const d = new Date(value);\r\n  return Number.isFinite(d.getTime()) ? d.toLocaleString() : \"-\";\r\n};\r\n\r\nconst SAMPLE_DISCOUNTS = [\r\n  \"Magis Basari Bursu\",\r\n  \"Maarif Yetenek Bursu\",\r\n  \"Ihtiyac Bursu\",\r\n  \"Okul Basari Bursu\",\r\n  \"Tam Egitim Bursu\",\r\n  \"Barinma Bursu\",\r\n  \"Turkce Basari Bursu\",\r\n  \"Uluslararasi Yukumluluk Indirimi\",\r\n  \"Vakif Calisani Indirimi\",\r\n  \"Kardes Indirimi\",\r\n  \"Erken Kayit Indirimi\",\r\n  \"Pesin Odeme Indirimi\",\r\n  \"Kademe Gecis Indirimi\",\r\n  \"Temsil Indirimi\",\r\n  \"Kurum Indirimi\",\r\n  \"Istisnai Indirim\",\r\n  \"Yerel Mevzuat Indirimi\",\r\n];\r\n\r\nfunction normalizeProgressConfig(config) {\r\n  const defaults = DEFAULT_PROGRESS_CONFIG();\r\n  const input = config && typeof config === \"object\" ? config : {};\r\n  const sectionsInput = input.sections && typeof input.sections === \"object\" ? input.sections : {};\r\n  const out = { version: defaults.version, sections: {} };\r\n\r\n  Object.keys(defaults.sections).forEach((id) => {\r\n    const base = defaults.sections[id] || {};\r\n    const incoming = sectionsInput[id] && typeof sectionsInput[id] === \"object\" ? sectionsInput[id] : {};\r\n    out.sections[id] = {\r\n      enabled: typeof incoming.enabled === \"boolean\" ? incoming.enabled : base.enabled !== false,\r\n      mode: typeof incoming.mode === \"string\" && incoming.mode ? incoming.mode : base.mode,\r\n      min: incoming.min != null ? Number(incoming.min) : base.min,\r\n      selectedFields:\r\n        incoming.selectedFields && typeof incoming.selectedFields === \"object\" ? incoming.selectedFields : {},\r\n    };\r\n  });\r\n\r\n  return out;\r\n}\r\n\r\n// Compute status badge metadata for a scenario.  Accepts either a status\r\n// string or a full scenario object.  When a scenario is approved but\r\n// has not yet been forwarded to administrators (sent_at is null), it\r\n// is considered manager-approved (Kontrol edildi).\r\nconst getStatusMeta = (scenarioOrStatus) => {\r\n  const obj = scenarioOrStatus && typeof scenarioOrStatus === 'object' ? scenarioOrStatus : { status: scenarioOrStatus };\r\n  const status = obj.status;\r\n  const sentAt = obj.sent_at;\r\n  switch (status) {\r\n    case 'revision_requested':\r\n      return { label: 'Revize istendi', className: 'is-bad' };\r\n    case 'sent_for_approval':\r\n      return { label: 'Merkeze iletildi', className: 'is-warn' };\r\n    case 'approved':\r\n      if (sentAt) {\r\n        return { label: 'Onayland', className: 'is-ok' };\r\n      }\r\n      return { label: 'Kontrol edildi', className: 'is-ok' };\r\n    case 'in_review':\r\n      return { label: 'ncelemede', className: 'is-warn' };\r\n    case 'submitted':\r\n      return { label: 'Onayda', className: 'is-warn' };\r\n    case 'draft':\r\n      return { label: 'Taslak', className: 'is-muted' };\r\n    default:\r\n      return { label: 'Taslak', className: 'is-muted' };\r\n  }\r\n};\r\n\r\nconst getSchoolStatusMeta = (status) => {\r\n  if (status === \"closed\") return { label: \"Closed\", className: \"is-muted\" };\r\n  return { label: \"Active\", className: \"is-ok\" };\r\n};\r\n\r\nconst getDynamicHint = (sectionId, field) => {\r\n  if (!field) return null;\r\n  const id = String(field.id || \"\");\r\n  const label = String(field.label || \"\");\r\n  if (sectionId === \"gradesPlan.plan\") {\r\n    if (id.startsWith(\"gradesPlan.\") || label.includes(\"Plan \")) return \"grade\";\r\n  }\r\n  if (sectionId === \"ik.localStaff\" && id.startsWith(\"ik.headcount.\")) return \"type\";\r\n  if (sectionId === \"gelirler.unitFee\" && id.startsWith(\"gelirler.tuition.\")) return \"type\";\r\n  return null;\r\n};\r\n\r\nexport default function AdminPage({ forcedTab = null } = {}) {\r\n  const auth = useAuth();\r\n  const outlet = useOutletContext();\r\n  const location = useLocation();\r\n  const normalizedForcedTab = isValidAdminTab(forcedTab) ? forcedTab : null;\r\n  const [activeTab, setActiveTab] = useState(() => {\r\n    if (normalizedForcedTab) return normalizedForcedTab;\r\n    const fromSearch = getTabFromSearch(location.search);\r\n    if (fromSearch) return fromSearch;\r\n    try {\r\n      const stored = localStorage.getItem(\"admin.activeTab\");\r\n      if (isValidAdminTab(stored)) return stored;\r\n    } catch (_) {\r\n      // ignore\r\n    }\r\n    return DEFAULT_ADMIN_TAB;\r\n  });\r\n  useEffect(() => {\r\n    if (normalizedForcedTab) return;\r\n    const fromSearch = getTabFromSearch(location.search);\r\n    if (fromSearch && fromSearch !== activeTab) {\r\n      setActiveTab(fromSearch);\r\n      return;\r\n    }\r\n    if (!fromSearch && activeTab !== DEFAULT_ADMIN_TAB) {\r\n      setActiveTab(DEFAULT_ADMIN_TAB);\r\n    }\r\n  }, [location.search, activeTab, normalizedForcedTab]);\r\n  useEffect(() => {\r\n    if (!normalizedForcedTab) return;\r\n    if (activeTab !== normalizedForcedTab) setActiveTab(normalizedForcedTab);\r\n  }, [normalizedForcedTab, activeTab]);\r\n  useEffect(() => {\r\n    if (normalizedForcedTab) return;\r\n    try {\r\n      localStorage.setItem(\"admin.activeTab\", activeTab);\r\n    } catch (_) {\r\n      // ignore\r\n    }\r\n  }, [activeTab, normalizedForcedTab]);\r\n\r\n  const [countries, setCountries] = useState([]);\r\n  const [users, setUsers] = useState([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [userUpdateLoading, setUserUpdateLoading] = useState(false);\r\n  const [confirmAssign, setConfirmAssign] = useState(null);\r\n  const [confirmDelete, setConfirmDelete] = useState(null);\r\n  const [confirmReset, setConfirmReset] = useState(null);\r\n  const [resetResult, setResetResult] = useState(null);\r\n  const [resetLoadingId, setResetLoadingId] = useState(null);\r\n\r\n  const [countryName, setCountryName] = useState(\"\");\r\n  const [countryCode, setCountryCode] = useState(\"\");\r\n  const [countryRegion, setCountryRegion] = useState(\"\");\r\n\r\n  const [newUserName, setNewUserName] = useState(\"\");\r\n  const [newUserEmail, setNewUserEmail] = useState(\"\");\r\n  const [newUserPassword, setNewUserPassword] = useState(\"\");\r\n  const [newUserRole, setNewUserRole] = useState(\"user\");\r\n  const [newUserCountryId, setNewUserCountryId] = useState(\"\");\r\n\r\n  const [assignUserId, setAssignUserId] = useState(\"\");\r\n  const [assignCountryId, setAssignCountryId] = useState(\"\");\r\n  const [showUnassigned, setShowUnassigned] = useState(true);\r\n\r\n  const [schoolsCountryId, setSchoolsCountryId] = useState(\"\");\r\n  const [countrySchools, setCountrySchools] = useState([]);\r\n  const [countrySchoolsLoading, setCountrySchoolsLoading] = useState(false);\r\n  const [schoolsSearch, setSchoolsSearch] = useState(\"\");\r\n  const [newSchoolName, setNewSchoolName] = useState(\"\");\r\n  const [schoolCreateLoading, setSchoolCreateLoading] = useState(false);\r\n  const [schoolSavingId, setSchoolSavingId] = useState(null);\r\n  const [schoolNameDrafts, setSchoolNameDrafts] = useState({});\r\n\r\n  const [progressCountryId, setProgressCountryId] = useState(\"\");\r\n  const [progressConfig, setProgressConfig] = useState(null);\r\n  const [progressLoading, setProgressLoading] = useState(false);\r\n  const [progressSaving, setProgressSaving] = useState(false);\r\n  const [progressSearch, setProgressSearch] = useState(\"\");\r\n  const [progressTargetIds, setProgressTargetIds] = useState(() => new Set());\r\n  const [progressCountryListSearch, setProgressCountryListSearch] = useState(\"\");\r\n  const [progressBulkSaving, setProgressBulkSaving] = useState(false);\r\n  const [showOnlySelectedBySection, setShowOnlySelectedBySection] = useState({});\r\n  const [expandedProgressTabs, setExpandedProgressTabs] = useState(new Set());\r\n  const [expandedProgressSections, setExpandedProgressSections] = useState(new Set());\r\n\r\n  const [queueRows, setQueueRows] = useState([]);\r\n\r\n  // Permissions catalog & user permissions state (for admin permission editor)\r\n  const [permissionsCatalog, setPermissionsCatalog] = useState(null);\r\n  // Map of permission key (resource|action) to boolean indicating selected for the current user\r\n  const [permissionSelections, setPermissionSelections] = useState({});\r\n  // Map of permission key to scope identifier: \"country\" or \"school:<id>\"\r\n  const [permissionScopes, setPermissionScopes] = useState({});\r\n  const [permissionsLoading, setPermissionsLoading] = useState(false);\r\n  const [permissionsSaving, setPermissionsSaving] = useState(false);\r\n  // List of schools in the selected user's country for scope selection\r\n  const [userSchools, setUserSchools] = useState([]);\r\n  // Define role options for admin when editing a user's role.  Admins can\r\n  // assign any role, including manager/accountant and admin.\r\n  const roleOptions = useMemo(\r\n    () => [\r\n      { value: \"user\", label: \"User\" },\r\n      { value: \"principal\", label: \"Principal\" },\r\n      { value: \"hr\", label: \"HR\" },\r\n      { value: \"manager\", label: \"Manager\" },\r\n      { value: \"accountant\", label: \"Accountant\" },\r\n      { value: \"admin\", label: \"Admin\" },\r\n    ],\r\n    []\r\n  );\r\n\r\n  // Track updating of a user's role when editing via the admin Users tab.\r\n  const [roleUpdating, setRoleUpdating] = useState(false);\r\n\r\n  // Principal assignments state per school\r\n  // principalLists maps schoolId -> array of user objects assigned as principals\r\n  const [principalLists, setPrincipalLists] = useState({});\r\n  // principalDrafts maps schoolId -> array of userIds currently selected in the editor\r\n  const [principalDrafts, setPrincipalDrafts] = useState({});\r\n  // Track saving state per school when updating principal assignments\r\n  const [principalSaving, setPrincipalSaving] = useState({});\r\n  const [queueLoading, setQueueLoading] = useState(false);\r\n  const [queueFilters, setQueueFilters] = useState({\r\n    status: \"\",\r\n    academicYear: \"\",\r\n    region: \"\",\r\n    countryId: \"\",\r\n  });\r\n\r\n  const [queueSort, setQueueSort] = useState({ key: null, dir: null });\r\n\r\n  const [reviewModal, setReviewModal] = useState(null);\r\n  const [reviewNote, setReviewNote] = useState(\"\");\r\n  const [reviewIncludedYears, setReviewIncludedYears] = useState({\r\n    y1: true,\r\n    y2: true,\r\n    y3: true,\r\n  });\r\n\r\n  // When the admin requests a revision on a scenario, they must select\r\n  // which modules should be reopened for editing.  This state maps\r\n  // module identifiers (work ids) to booleans indicating whether\r\n  // that module is selected for revision.  It is initialized when\r\n  // opening the revision modal.\r\n  const [reviewRevisionSelection, setReviewRevisionSelection] = useState(() => {\r\n    const initial = {};\r\n    REQUIRED_WORK_IDS.forEach((id) => (initial[id] = false));\r\n    return initial;\r\n  });\r\n\r\n  // Helpers to select or clear all modules in the revision selection.  These\r\n  // functions are memoized via useCallback to avoid re-creating on\r\n  // every render.\r\n  const selectAllRevisionWork = useCallback(() => {\r\n    const next = {};\r\n    REQUIRED_WORK_IDS.forEach((id) => (next[id] = true));\r\n    setReviewRevisionSelection(next);\r\n  }, []);\r\n\r\n  const clearRevisionWork = useCallback(() => {\r\n    const next = {};\r\n    REQUIRED_WORK_IDS.forEach((id) => (next[id] = false));\r\n    setReviewRevisionSelection(next);\r\n  }, []);\r\n  const [reviewSaving, setReviewSaving] = useState(false);\r\n\r\n  const [rollupYear, setRollupYear] = useState(\"\");\r\n  const [rollupData, setRollupData] = useState(null);\r\n  const [rollupLoading, setRollupLoading] = useState(false);\r\n  const [rollupExportOpen, setRollupExportOpen] = useState(false);\r\n  const rollupExportRef = useRef(null);\r\n  const [expandedRegions, setExpandedRegions] = useState(new Set());\r\n  const [expandedCountries, setExpandedCountries] = useState(new Set());\r\n\r\n  useEffect(() => {\r\n    document.title = \"Admin  Feasibility Studio\";\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    outlet?.setHeaderMeta({\r\n      title: \"Admin\",\r\n      subtitle: \"Create users, manage countries, and review scenarios.\",\r\n    });\r\n    return () => {\r\n      outlet?.clearHeaderMeta?.();\r\n    };\r\n  }, [outlet]);\r\n\r\n  // Keep latest queue filters without making loadQueue depend on queueFilters\r\n  const queueFiltersRef = useRef(queueFilters);\r\n  useEffect(() => {\r\n    queueFiltersRef.current = queueFilters;\r\n  }, [queueFilters]);\r\n\r\n  const selectedUser = useMemo(\r\n    () => users.find((u) => String(u.id) === String(assignUserId)) || null,\r\n    [users, assignUserId]\r\n  );\r\n\r\n  const selectedCountry = useMemo(\r\n    () => countries.find((c) => String(c.id) === String(assignCountryId)) || null,\r\n    [countries, assignCountryId]\r\n  );\r\n\r\n  const selectedSchoolsCountry = useMemo(\r\n    () => countries.find((c) => String(c.id) === String(schoolsCountryId)) || null,\r\n    [countries, schoolsCountryId]\r\n  );\r\n\r\n  // Load principal lists for each school when the country schools list changes\r\n  useEffect(() => {\r\n    // Only load when we are on the countries tab and have schools for the selected country\r\n    if (activeTab !== \"countries\") return;\r\n    if (!Array.isArray(countrySchools) || countrySchools.length === 0) return;\r\n    countrySchools.forEach((school) => {\r\n      const id = school.id;\r\n      // If we haven't loaded this school's principals yet, fetch them\r\n      if (principalLists[id] === undefined) {\r\n        (async () => {\r\n          try {\r\n            const list = await api.adminGetSchoolPrincipals(id);\r\n            setPrincipalLists((prev) => ({ ...prev, [id]: Array.isArray(list) ? list : [] }));\r\n            // Initialize draft selection with current principal IDs\r\n            const ids = Array.isArray(list) ? list.map((u) => u.id) : [];\r\n            setPrincipalDrafts((prev) => ({ ...prev, [id]: ids }));\r\n          } catch (e) {\r\n            console.error(e);\r\n            // Do not toast here to avoid spam; errors will be shown on save\r\n          }\r\n        })();\r\n      }\r\n    });\r\n  }, [activeTab, countrySchools, principalLists]);\r\n\r\n  // Load permissions catalog, user permissions, and schools list for the selected user\r\n  useEffect(() => {\r\n    // derive simple IDs from the selectedUser to avoid stale object dependencies\r\n    const userId = selectedUser?.id;\r\n    const countryId = selectedUser?.country_id;\r\n    // If no user selected, reset and exit early\r\n    if (!userId) {\r\n      setPermissionsCatalog(null);\r\n      setPermissionSelections({});\r\n      setPermissionScopes({});\r\n      setUserSchools([]);\r\n      return;\r\n    }\r\n    setPermissionsLoading(true);\r\n    Promise.all([\r\n      api.adminGetPermissionsCatalog(),\r\n      api.adminGetUserPermissions(userId),\r\n      countryId ? api.adminListCountrySchools(countryId) : Promise.resolve([]),\r\n    ])\r\n      .then(([catalogData, userPerms, schoolsData]) => {\r\n        setPermissionsCatalog(catalogData || null);\r\n        // Determine scope options: flatten schools list\r\n        let schoolsList = [];\r\n        if (Array.isArray(schoolsData)) {\r\n          schoolsList = schoolsData;\r\n        } else if (schoolsData && Array.isArray(schoolsData.items)) {\r\n          schoolsList = schoolsData.items;\r\n        }\r\n        setUserSchools(schoolsList);\r\n        // Initialize selection and scope state from existing user perms\r\n        const sel = {};\r\n        const scopeMap = {};\r\n        (userPerms || []).forEach((p) => {\r\n          const key = `${p.resource}|${p.action}`;\r\n          sel[key] = true;\r\n          if (p.scope_school_id != null) {\r\n            scopeMap[key] = `school:${p.scope_school_id}`;\r\n          } else {\r\n            scopeMap[key] = \"country\";\r\n          }\r\n        });\r\n        setPermissionSelections(sel);\r\n        setPermissionScopes(scopeMap);\r\n      })\r\n      .catch((e) => {\r\n        console.error(e);\r\n        toast.error(e?.message || \"Failed to load permissions\");\r\n      })\r\n      .finally(() => {\r\n        setPermissionsLoading(false);\r\n      });\r\n  }, [selectedUser]);\r\n\r\n  const progressCatalogInputs = useMemo(\r\n    () => ({\r\n      discounts: SAMPLE_DISCOUNTS.map((name) => ({ name, ratio: 0, value: 0 })),\r\n    }),\r\n    []\r\n  );\r\n\r\n  const progressCatalog = useMemo(\r\n    () => buildProgressCatalog({ inputs: progressCatalogInputs, norm: null }),\r\n    [progressCatalogInputs]\r\n  );\r\n\r\n  const progressConfigNormalized = useMemo(\r\n    () => normalizeProgressConfig(progressConfig),\r\n    [progressConfig]\r\n  );\r\n\r\n  const isSameCountry =\r\n    selectedUser &&\r\n    selectedCountry &&\r\n    selectedUser.country_id != null &&\r\n    String(selectedUser.country_id) === String(selectedCountry.id);\r\n\r\n  const currentAssignmentLabel = selectedUser\r\n    ? selectedUser.country_name\r\n      ? `${selectedUser.country_name} (${selectedUser.country_code})${selectedUser.region ? ` - ${selectedUser.region}` : \"\"\r\n      }`\r\n      : \"Unassigned\"\r\n    : \"Select a user\";\r\n\r\n  const newAssignmentLabel = selectedCountry\r\n    ? `${selectedCountry.name} (${selectedCountry.code})${selectedCountry.region ? ` - ${selectedCountry.region}` : \"\"\r\n    }`\r\n    : \"Select a country\";\r\n\r\n  const actionLabel = selectedUser?.country_id != null ? \"Update Country\" : \"Assign Country\";\r\n\r\n  const filteredUsers = useMemo(() => {\r\n    if (!showUnassigned) return users;\r\n    return users.filter((u) => u.country_id == null);\r\n  }, [users, showUnassigned]);\r\n\r\n  const regionOptions = useMemo(() => {\r\n    const set = new Set();\r\n    countries.forEach((c) => {\r\n      if (c.region) set.add(c.region);\r\n    });\r\n    return Array.from(set).sort();\r\n  }, [countries]);\r\n\r\n  // Group permissions by their catalog group for display\r\n  const permissionsGrouped = useMemo(() => {\r\n    // When no catalog loaded, return empty object\r\n    if (!permissionsCatalog) return {};\r\n    // Backend returns a grouped object (group -> array of permissions) via\r\n    // /admin/permissions/catalog. When it's already grouped, return it as is.\r\n    if (!Array.isArray(permissionsCatalog) && typeof permissionsCatalog === \"object\") {\r\n      return permissionsCatalog;\r\n    }\r\n    // Otherwise if an array is provided, group by the `group` property on each entry.\r\n    if (Array.isArray(permissionsCatalog)) {\r\n      return permissionsCatalog.reduce((acc, perm) => {\r\n        const grp = perm.group || \"Other\";\r\n        if (!acc[grp]) acc[grp] = [];\r\n        acc[grp].push(perm);\r\n        return acc;\r\n      }, {});\r\n    }\r\n    return {};\r\n  }, [permissionsCatalog]);\r\n\r\n  const queueCountryOptions = useMemo(() => {\r\n    if (!queueFilters.region) return countries;\r\n    return countries.filter((c) => c.region === queueFilters.region);\r\n  }, [countries, queueFilters.region]);\r\n\r\n  const toggleQueueSort = useCallback((key) => {\r\n    const cycles = {\r\n      academic_year: [\"desc\", \"asc\", null],\r\n      country_name: [\"asc\", \"desc\", null],\r\n      school_name: [\"asc\", \"desc\", null],\r\n      scenario_name: [\"asc\", \"desc\", null],\r\n      submitted_at: [\"desc\", \"asc\", null],\r\n      status: [\"asc\", \"desc\", null],\r\n    };\r\n\r\n    setQueueSort((prev) => {\r\n      const cycle = cycles[key] || [\"asc\", \"desc\", null];\r\n      if (prev.key !== key) return { key, dir: cycle[0] };\r\n\r\n      const i = cycle.indexOf(prev.dir);\r\n      const next = cycle[(i + 1) % cycle.length];\r\n      if (!next) return { key: null, dir: null };\r\n      return { key, dir: next };\r\n    });\r\n  }, [setQueueSort]);\r\n\r\n  const sortIndicator = useCallback(\r\n    (key) => {\r\n      if (queueSort.key !== key || !queueSort.dir) return \"\";\r\n      return queueSort.dir === \"asc\" ? \"\" : \"\";\r\n    },\r\n    [queueSort]\r\n  );\r\n\r\n  const ariaSort = useCallback(\r\n    (key) => {\r\n      if (queueSort.key !== key || !queueSort.dir) return \"none\";\r\n      return queueSort.dir === \"asc\" ? \"ascending\" : \"descending\";\r\n    },\r\n    [queueSort]\r\n  );\r\n\r\n  const sortedQueueRows = useMemo(() => {\r\n    const base = Array.isArray(queueRows) ? queueRows : [];\r\n    if (!queueSort?.key || !queueSort?.dir) return base;\r\n\r\n    const parseAcademicYear = (value) => {\r\n      const raw = String(value || \"\").trim();\r\n      const nums = raw.match(/\\d{4}/g) || [];\r\n      const a = nums[0] ? Number(nums[0]) : -1;\r\n      const b = nums[1] ? Number(nums[1]) : a;\r\n      return { a, b, raw: raw.toLowerCase() };\r\n    };\r\n\r\n    const getValue = (row) => {\r\n      switch (queueSort.key) {\r\n        case \"country_name\":\r\n          return String(row.country?.name || \"\");\r\n        case \"school_name\":\r\n          return String(row.school?.name || \"\");\r\n        case \"scenario_name\":\r\n          return String(row.scenario?.name || \"\");\r\n        case \"academic_year\":\r\n          return parseAcademicYear(row.scenario?.academic_year);\r\n        case \"submitted_at\":\r\n          return row.scenario?.submitted_at ? new Date(row.scenario.submitted_at).getTime() : -Infinity;\r\n        case \"status\":\r\n          return String(row.scenario?.status || \"\");\r\n        default:\r\n          return \"\";\r\n      }\r\n    };\r\n\r\n    const dirMul = queueSort.dir === \"desc\" ? -1 : 1;\r\n    const cmpStr = (a, b) =>\r\n      String(a || \"\").localeCompare(String(b || \"\"), undefined, { sensitivity: \"base\" });\r\n\r\n    const decorated = base.map((row, idx) => ({ row, idx, val: getValue(row) }));\r\n\r\n    decorated.sort((A, B) => {\r\n      let c = 0;\r\n      const av = A.val;\r\n      const bv = B.val;\r\n\r\n      if (queueSort.key === \"academic_year\") {\r\n        c = (av?.a ?? -1) - (bv?.a ?? -1);\r\n        if (c === 0) c = (av?.b ?? -1) - (bv?.b ?? -1);\r\n        if (c === 0) c = cmpStr(av?.raw, bv?.raw);\r\n      } else if (typeof av === \"number\" && typeof bv === \"number\") {\r\n        c = av - bv;\r\n      } else {\r\n        c = cmpStr(av, bv);\r\n      }\r\n\r\n      if (c === 0) return A.idx - B.idx; // back to server order\r\n      return c * dirMul;\r\n    });\r\n\r\n    return decorated.map((d) => d.row);\r\n  }, [queueRows, queueSort]);\r\n\r\n  const progressSearchValue = progressSearch.trim().toLowerCase();\r\n\r\n  const filteredCountriesForApply = useMemo(() => {\r\n    const q = progressCountryListSearch.trim().toLowerCase();\r\n    if (!q) return countries;\r\n    return countries.filter((c) => {\r\n      const name = String(c.name || \"\").toLowerCase();\r\n      const code = String(c.code || \"\").toLowerCase();\r\n      return name.includes(q) || code.includes(q);\r\n    });\r\n  }, [countries, progressCountryListSearch]);\r\n\r\n  const progressTargetCount = progressTargetIds.size;\r\n  const progressBulkDisabled =\r\n    !progressCountryId ||\r\n    progressTargetCount === 0 ||\r\n    progressSaving ||\r\n    progressLoading ||\r\n    progressBulkSaving;\r\n\r\n  const filteredCountrySchools = useMemo(() => {\r\n    const q = schoolsSearch.trim().toLowerCase();\r\n    if (!q) return countrySchools;\r\n    return countrySchools.filter((s) => String(s.name || \"\").toLowerCase().includes(q));\r\n  }, [countrySchools, schoolsSearch]);\r\n\r\n  const load = useCallback(async () => {\n    setLoading(true);\n    try {\n      const [countriesRows, userData] = await Promise.all([\n        api.listCountries(),\n        api.listUsers({ limit: 50, offset: 0, fields: \"brief\", order: \"id:desc\" }),\n      ]);\n      setCountries(countriesRows);\n      setUsers(Array.isArray(userData?.items) ? userData.items : []);\n    } catch (e) {\n      toast.error(e.message || \"Failed to load admin data\");\n    } finally {\n      setLoading(false);\r\n    }\r\n  }, []);\r\n\r\n  const loadCountrySchools = useCallback(async (countryIdArg) => {\r\n    const countryId = Number(countryIdArg);\r\n    if (!Number.isFinite(countryId)) {\r\n      setCountrySchools([]);\r\n      return;\r\n    }\r\n    setCountrySchoolsLoading(true);\r\n    try {\r\n      const rows = await api.adminListCountrySchools(countryId, { includeClosed: 1 });\r\n      setCountrySchools(Array.isArray(rows) ? rows : []);\r\n    } catch (e) {\r\n      toast.error(e.message || \"Failed to load schools\");\r\n    } finally {\r\n      setCountrySchoolsLoading(false);\r\n    }\r\n  }, []);\r\n\r\n  const loadProgressRequirements = useCallback(async (countryIdArg) => {\r\n    const countryId = Number(countryIdArg);\r\n    if (!Number.isFinite(countryId)) {\r\n      setProgressConfig(null);\r\n      return;\r\n    }\r\n    setProgressLoading(true);\r\n    try {\r\n      const data = await api.adminGetProgressRequirements(countryId);\r\n      setProgressConfig(normalizeProgressConfig(data?.config || data));\r\n    } catch (e) {\r\n      toast.error(e.message || \"Failed to load progress requirements\");\r\n      setProgressConfig(normalizeProgressConfig(null));\r\n    } finally {\r\n      setProgressLoading(false);\r\n    }\r\n  }, []);\r\n\r\n  const loadQueue = useCallback(async (filtersArg) => {\r\n    const f = filtersArg || queueFiltersRef.current || {};\r\n    setQueueLoading(true);\r\n    try {\r\n      const params = {\r\n        status: f.status,\r\n        academicYear: f.academicYear,\r\n        region: f.region,\r\n        countryId: f.countryId,\r\n      };\r\n      const rows = await api.adminGetScenarioQueue(params);\r\n      setQueueRows(Array.isArray(rows) ? rows : []);\r\n    } catch (e) {\r\n      toast.error(e.message || \"Failed to load approvals queue\");\r\n    } finally {\r\n      setQueueLoading(false);\r\n    }\r\n  }, []);\r\n\r\n  const loadRollup = useCallback(async (academicYearArg) => {\r\n    const academicYear = (academicYearArg ?? rollupYear).trim();\r\n    if (!academicYear) {\r\n      toast.error(\"Academic year is required\");\r\n      return;\r\n    }\r\n    setRollupLoading(true);\r\n    try {\r\n      const data = await api.adminGetRollup({ academicYear });\r\n      setRollupData(data);\r\n    } catch (e) {\r\n      toast.error(e.message || \"Failed to load rollup report\");\r\n    } finally {\r\n      setRollupLoading(false);\r\n    }\r\n  }, [rollupYear]);\r\n\r\n  useEffect(() => {\r\n    if (auth.user?.role === \"admin\") load();\r\n  }, [auth.user?.role, load]);\r\n\r\n  useEffect(() => {\r\n    if (activeTab === \"approvals\" && auth.user?.role === \"admin\") {\r\n      loadQueue(); // uses latest filters via ref\r\n    }\r\n  }, [activeTab, auth.user?.role, loadQueue]);\r\n\r\n  useEffect(() => {\r\n    if (activeTab !== \"countries\") return;\r\n    if (!schoolsCountryId) {\r\n      setCountrySchools([]);\r\n      return;\r\n    }\r\n    loadCountrySchools(schoolsCountryId);\r\n  }, [activeTab, loadCountrySchools, schoolsCountryId]);\r\n\r\n  useEffect(() => {\r\n    if (activeTab !== \"progress\") return;\r\n    if (!progressCountryId) {\r\n      setProgressConfig(null);\r\n      return;\r\n    }\r\n    loadProgressRequirements(progressCountryId);\r\n  }, [activeTab, loadProgressRequirements, progressCountryId]);\r\n\r\n  useEffect(() => {\r\n    setProgressSearch(\"\");\r\n    setExpandedProgressTabs(new Set());\r\n    setExpandedProgressSections(new Set());\r\n  }, [progressCountryId]);\r\n\r\n  useEffect(() => {\r\n    if (!rollupExportOpen) return;\r\n    const handleClick = (event) => {\r\n      const el = rollupExportRef.current;\r\n      if (!el || el.contains(event.target)) return;\r\n      setRollupExportOpen(false);\r\n    };\r\n    const handleKey = (event) => {\r\n      if (event.key === \"Escape\") setRollupExportOpen(false);\r\n    };\r\n    document.addEventListener(\"mousedown\", handleClick);\r\n    document.addEventListener(\"keydown\", handleKey);\r\n    return () => {\r\n      document.removeEventListener(\"mousedown\", handleClick);\r\n      document.removeEventListener(\"keydown\", handleKey);\r\n    };\r\n  }, [rollupExportOpen]);\r\n\r\n  useEffect(() => {\r\n    if (!rollupData?.regions) return;\r\n    const regionSet = new Set();\r\n    const countrySet = new Set();\r\n    rollupData.regions.forEach((region) => {\r\n      regionSet.add(region.region);\r\n      region.countries.forEach((country) => {\r\n        countrySet.add(`${region.region}::${country.id}`);\r\n      });\r\n    });\r\n    setExpandedRegions(regionSet);\r\n    setExpandedCountries(countrySet);\r\n  }, [rollupData]);\r\n\r\n  useEffect(() => {\r\n    if (!assignUserId) {\r\n      setAssignCountryId(\"\");\r\n      return;\r\n    }\r\n    const user = users.find((u) => String(u.id) === String(assignUserId));\r\n    if (!user) {\r\n      setAssignCountryId(\"\");\r\n      return;\r\n    }\r\n    if (user.country_id != null) setAssignCountryId(String(user.country_id));\r\n    else setAssignCountryId(\"\");\r\n  }, [assignUserId, users]);\r\n\r\n  useEffect(() => {\r\n    setSchoolNameDrafts({});\r\n    setSchoolsSearch(\"\");\r\n    setNewSchoolName(\"\");\r\n  }, [schoolsCountryId]);\r\n\r\n  async function createCountry() {\r\n    const payload = {\r\n      name: countryName.trim(),\r\n      code: countryCode.trim().toUpperCase(),\r\n      region: countryRegion.trim(),\r\n    };\r\n    if (!payload.name || !payload.code || !payload.region) {\r\n      toast.error(\"Name, code, and region are required\");\r\n      return;\r\n    }\r\n    try {\r\n      await api.createCountry(payload);\r\n      setCountryName(\"\");\r\n      setCountryCode(\"\");\r\n      setCountryRegion(\"\");\r\n      await load();\r\n      toast.success(\"Country created\");\r\n    } catch (e) {\r\n      toast.error(e.message || \"Create country failed\");\r\n    }\r\n  }\r\n\r\n  async function createCountrySchool() {\r\n    if (!schoolsCountryId) {\r\n      toast.error(\"Select a country\");\r\n      return;\r\n    }\r\n    const name = newSchoolName.trim();\r\n    if (!name) {\r\n      toast.error(\"School name is required\");\r\n      return;\r\n    }\r\n    setSchoolCreateLoading(true);\r\n    try {\r\n      await api.adminCreateCountrySchool(schoolsCountryId, { name });\r\n      setNewSchoolName(\"\");\r\n      await loadCountrySchools(schoolsCountryId);\r\n      toast.success(\"School created\");\r\n    } catch (e) {\r\n      toast.error(e.message || \"Create school failed\");\r\n    } finally {\r\n      setSchoolCreateLoading(false);\r\n    }\r\n  }\r\n\r\n  async function createUser() {\r\n    const payload = {\r\n      fullName: newUserName.trim() || null,\r\n      email: newUserEmail.trim(),\r\n      password: newUserPassword,\r\n      role: newUserRole,\r\n    };\r\n    if (newUserCountryId) {\r\n      const nextId = Number(newUserCountryId);\r\n      if (!Number.isFinite(nextId)) {\r\n        toast.error(\"Invalid country selection\");\r\n        return;\r\n      }\r\n      payload.countryId = nextId;\r\n    }\r\n    if (!payload.email || !payload.password) {\r\n      toast.error(\"Email and password are required\");\r\n      return;\r\n    }\r\n    if (payload.password.length < 8) {\r\n      toast.error(\"Password must be at least 8 characters\");\r\n      return;\r\n    }\r\n    try {\r\n      await api.createUser(payload);\r\n      setNewUserName(\"\");\r\n      setNewUserEmail(\"\");\r\n      setNewUserPassword(\"\");\r\n      setNewUserRole(\"user\");\r\n      setNewUserCountryId(\"\");\r\n      await load();\r\n      toast.success(\"User created (password reset required on first login)\");\r\n    } catch (e) {\r\n      toast.error(e.message || \"Create user failed\");\r\n    }\r\n  }\r\n\r\n  async function assignCountry() {\r\n    if (!selectedUser) {\r\n      toast.error(\"Select a user\");\r\n      return;\r\n    }\r\n    if (!assignCountryId) {\r\n      toast.error(\"Select a country\");\r\n      return;\r\n    }\r\n    if (userUpdateLoading) return;\r\n    const nextId = Number(assignCountryId);\r\n    if (!Number.isFinite(nextId)) {\r\n      toast.error(\"Invalid country selection\");\r\n      return;\r\n    }\r\n    if (isSameCountry) {\r\n      toast.error(\"Selected country is already assigned to this user\");\r\n      return;\r\n    }\r\n    if (selectedUser.country_id != null) {\r\n      const currentLabel = selectedUser.country_name\r\n        ? `${selectedUser.country_name} (${selectedUser.country_code})`\r\n        : \"Unassigned\";\r\n      const nextLabel = selectedCountry ? `${selectedCountry.name} (${selectedCountry.code})` : `#${nextId}`;\r\n      setConfirmAssign({\r\n        userId: selectedUser.id,\r\n        nextId,\r\n        email: selectedUser.email,\r\n        currentLabel,\r\n        nextLabel,\r\n        hadCountry: true,\r\n      });\r\n      return;\r\n    }\r\n    setUserUpdateLoading(true);\r\n    try {\r\n      await api.assignUserCountry(assignUserId, { countryId: nextId });\r\n      await load();\r\n      toast.success(\"User assigned\");\r\n    } catch (e) {\r\n      toast.error(e.message || \"Assignment failed\");\r\n    } finally {\r\n      setUserUpdateLoading(false);\r\n    }\r\n  }\r\n\r\n  async function confirmAssignCountry(data) {\r\n    if (!data) return;\r\n    if (userUpdateLoading) return;\r\n    setUserUpdateLoading(true);\r\n    try {\r\n      await api.assignUserCountry(data.userId, { countryId: data.nextId });\r\n      await load();\r\n      toast.success(data.hadCountry ? \"User country updated\" : \"User assigned\");\r\n    } catch (e) {\r\n      toast.error(e.message || \"Assignment failed\");\r\n    } finally {\r\n      setUserUpdateLoading(false);\r\n    }\r\n  }\r\n\r\n  async function deleteUser(user) {\r\n    if (!user || !user.id) return;\r\n    const label = user.email || `User #${user.id}`;\r\n    setConfirmDelete({ id: user.id, label });\r\n  }\r\n\r\n  async function confirmDeleteUser(data) {\r\n    if (!data) return;\r\n    try {\r\n      await api.deleteUser(data.id);\r\n      await load();\r\n      toast.success(\"User deleted\");\r\n    } catch (e) {\r\n      toast.error(e.message || \"Delete failed\");\r\n    }\r\n  }\r\n\r\n  // --- Permission editor helpers ---\r\n  /**\r\n   * Toggle selection of a permission key (resource|action) in the UI.\r\n   * When enabling a permission for the first time without a scope, defaults to country scope.\r\n   */\r\n  function togglePermission(key) {\r\n    setPermissionSelections((prev) => {\r\n      const next = { ...prev };\r\n      next[key] = !prev[key];\r\n      return next;\r\n    });\r\n    setPermissionScopes((prev) => {\r\n      // When turning on a permission that doesnt have a scope yet, default to country\r\n      if (!permissionSelections[key] && !prev[key]) {\r\n        return { ...prev, [key]: \"country\" };\r\n      }\r\n      return prev;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Change the scope for a permission key.\r\n   * @param {string} key The permission key (resource|action)\r\n   * @param {string} value The selected scope: \"country\" or \"school:<id>\"\r\n   */\r\n  function changePermissionScope(key, value) {\r\n    setPermissionScopes((prev) => ({ ...prev, [key]: value }));\r\n  }\r\n\r\n  /**\r\n   * Persist the current permission selections for the selected user.\r\n   * Constructs the payload based on selected permissions and scopes and sends\r\n   * it to the backend. Afterwards reloads the users permissions from the\r\n   * server to ensure UI consistency.\r\n   */\r\n  async function saveUserPermissions() {\r\n    if (!selectedUser) {\r\n      toast.error(\"Select a user to edit permissions\");\r\n      return;\r\n    }\r\n    const perms = [];\r\n    const keys = Object.keys(permissionSelections || {});\r\n    keys.forEach((key) => {\r\n      if (!permissionSelections[key]) return;\r\n      const [resource, action] = key.split(\"|\");\r\n      let scopeVal = permissionScopes[key] || \"country\";\r\n      let scope_country_id = null;\r\n      let scope_school_id = null;\r\n      // Determine scope\r\n      if (scopeVal === \"country\") {\r\n        // assign scope_country_id based on user's country_id if available\r\n        if (selectedUser.country_id != null) {\r\n          scope_country_id = Number(selectedUser.country_id);\r\n        }\r\n      } else if (scopeVal.startsWith(\"school:\")) {\r\n        const idStr = scopeVal.split(\":\")[1];\r\n        const sid = Number(idStr);\r\n        if (Number.isFinite(sid)) {\r\n          scope_school_id = sid;\r\n        }\r\n        // set country_id if available\r\n        if (selectedUser.country_id != null) {\r\n          scope_country_id = Number(selectedUser.country_id);\r\n        }\r\n      }\r\n      perms.push({ resource, action, scope_country_id, scope_school_id });\r\n    });\r\n    setPermissionsSaving(true);\r\n    try {\r\n      await api.adminSetUserPermissions(selectedUser.id, { permissions: perms });\r\n      // Reload user permissions to reflect server state\r\n      const updated = await api.adminGetUserPermissions(selectedUser.id);\r\n      // Recompute selections and scopes based on the latest permissions returned\r\n      const sel = {};\r\n      const scopeMap = {};\r\n      (updated || []).forEach((p) => {\r\n        const k = `${p.resource}|${p.action}`;\r\n        sel[k] = true;\r\n        if (p.scope_school_id != null) {\r\n          scopeMap[k] = `school:${p.scope_school_id}`;\r\n        } else {\r\n          scopeMap[k] = \"country\";\r\n        }\r\n      });\r\n      setPermissionSelections(sel);\r\n      setPermissionScopes(scopeMap);\r\n      toast.success(\"Permissions saved\");\r\n    } catch (e) {\r\n      toast.error(e?.message || \"Save permissions failed\");\r\n    } finally {\r\n      setPermissionsSaving(false);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update the role of the currently selected user.  This is triggered\r\n   * when an admin chooses a new role from the role selector.  The\r\n   * function calls the adminUpdateUserRole API and then refreshes\r\n   * the list of users to reflect the change.  Displays success or\r\n   * error messages via toast notifications.\r\n   *\r\n   * @param {string} role The new role to assign to the user\r\n   */\r\n  async function updateSelectedUserRole(role) {\r\n    // Ensure there is a selected user before updating\r\n    if (!selectedUser) return;\r\n    setRoleUpdating(true);\r\n    try {\r\n      await api.adminUpdateUserRole(selectedUser.id, { role });\r\n      // Reload data so the user list reflects the new role\r\n      await load();\r\n      // Maintain the current selection after reload\r\n      setAssignUserId(String(selectedUser.id));\r\n      toast.success(\"Role updated\");\r\n    } catch (e) {\r\n      toast.error(e?.message || \"Failed to update role\");\r\n    } finally {\r\n      setRoleUpdating(false);\r\n    }\r\n  }\r\n\r\n  // --- Principal assignment helpers ---\r\n  /**\r\n   * Handle selection of principal users for a school. Updates the draft state.\r\n   * @param {number} schoolId\r\n   * @param {string[]} valueIds Array of selected userId strings from a multiselect element\r\n   */\r\n  function handlePrincipalSelectionChange(schoolId, valueIds) {\r\n    const ids = valueIds.map((v) => Number(v)).filter((n) => Number.isFinite(n));\r\n    setPrincipalDrafts((prev) => ({ ...prev, [schoolId]: ids }));\r\n  }\r\n\r\n  /**\r\n   * Save principal assignments for a given school. Sends the current draft\r\n   * selection to the backend and updates the local principal list.\r\n   * @param {number} schoolId\r\n   */\r\n  async function savePrincipalAssignments(schoolId) {\r\n    const userIds = principalDrafts[schoolId] || [];\r\n    setPrincipalSaving((prev) => ({ ...prev, [schoolId]: true }));\r\n    try {\r\n      await api.adminSetSchoolPrincipals(schoolId, { userIds });\r\n      // Update local list with selected principal user objects\r\n      const newList = users.filter((u) => u.role === \"principal\" && userIds.includes(u.id));\r\n      setPrincipalLists((prev) => ({ ...prev, [schoolId]: newList }));\r\n      toast.success(\"Principals updated\");\r\n    } catch (e) {\r\n      toast.error(e?.message || \"Failed to update principals\");\r\n    } finally {\r\n      setPrincipalSaving((prev) => ({ ...prev, [schoolId]: false }));\r\n    }\r\n  }\r\n\r\n  function getAuthTokenFromStorage() {\r\n    try {\r\n      const keys = [\"token\", \"auth_token\", \"jwt\", \"access_token\"];\r\n      for (const k of keys) {\r\n        const v = window?.localStorage?.getItem(k);\r\n        if (v) return String(v);\r\n      }\r\n    } catch {\r\n      // ignore\r\n    }\r\n    return \"\";\r\n  }\r\n\r\n  async function adminResetUserPassword(userId) {\r\n    const token = getAuthTokenFromStorage();\r\n    const res = await fetch(`/api/admin/users/${userId}/reset-password`, {\r\n      method: \"POST\",\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n        ...(token ? { Authorization: `Bearer ${token}` } : {}),\r\n      },\r\n      body: JSON.stringify({}),\r\n    });\r\n    let data = {};\r\n    try {\r\n      data = await res.json();\r\n    } catch {\r\n      data = {};\r\n    }\r\n    if (!res.ok) {\r\n      const msg = data?.error || data?.details || `Reset failed (${res.status})`;\r\n      throw new Error(msg);\r\n    }\r\n    return data;\r\n  }\r\n\r\n  async function resetPasswordForUser(user) {\r\n    if (!user?.id) return;\r\n    setConfirmReset({ id: user.id, email: user.email, full_name: user.full_name || null });\r\n  }\r\n\r\n  async function confirmResetPassword(data) {\r\n    if (!data?.id) return;\r\n    if (resetLoadingId) return;\r\n    setResetLoadingId(data.id);\r\n    try {\r\n      const out = await adminResetUserPassword(data.id);\r\n      setResetResult({\r\n        id: data.id,\r\n        email: data.email,\r\n        full_name: data.full_name || null,\r\n        temporary_password: out.temporary_password,\r\n      });\r\n      await load();\r\n      toast.success(\"Temporary password generated\");\r\n    } catch (e) {\r\n      toast.error(e.message || \"Reset failed\");\r\n    } finally {\r\n      setResetLoadingId(null);\r\n    }\r\n  }\r\n\r\n  async function copyText(text) {\r\n    const value = String(text || \"\");\r\n    if (!value) return;\r\n    try {\r\n      await navigator.clipboard.writeText(value);\r\n      toast.success(\"Copied\");\r\n      return;\r\n    } catch {\r\n      // fallback\r\n    }\r\n    try {\r\n      const ta = document.createElement(\"textarea\");\r\n      ta.value = value;\r\n      ta.style.position = \"fixed\";\r\n      ta.style.left = \"-9999px\";\r\n      document.body.appendChild(ta);\r\n      ta.select();\r\n      document.execCommand(\"copy\");\r\n      document.body.removeChild(ta);\r\n      toast.success(\"Copied\");\r\n    } catch {\r\n      toast.error(\"Copy failed\");\r\n    }\r\n  }\r\n\r\n  async function saveSchoolName(school) {\r\n    if (!school?.id) return;\r\n    const draft = schoolNameDrafts[school.id];\r\n    const nextName = String(draft != null ? draft : school.name || \"\").trim();\r\n    if (!nextName) {\r\n      toast.error(\"Name is required\");\r\n      return;\r\n    }\r\n    if (nextName === school.name) return;\r\n\r\n    setSchoolSavingId(school.id);\r\n    try {\r\n      await api.adminUpdateSchool(school.id, { name: nextName });\r\n      await loadCountrySchools(schoolsCountryId);\r\n      setSchoolNameDrafts((prev) => ({ ...prev, [school.id]: nextName }));\r\n      toast.success(\"School updated\");\r\n    } catch (e) {\r\n      toast.error(e.message || \"Update failed\");\r\n    } finally {\r\n      setSchoolSavingId(null);\r\n    }\r\n  }\r\n\r\n  async function toggleSchoolStatus(school) {\r\n    if (!school?.id) return;\r\n    const nextStatus = school.status === \"closed\" ? \"active\" : \"closed\";\r\n    setSchoolSavingId(school.id);\r\n    try {\r\n      await api.adminUpdateSchool(school.id, { status: nextStatus });\r\n      await loadCountrySchools(schoolsCountryId);\r\n      toast.success(nextStatus === \"closed\" ? \"School closed\" : \"School reopened\");\r\n    } catch (e) {\r\n      toast.error(e.message || \"Update failed\");\r\n    } finally {\r\n      setSchoolSavingId(null);\r\n    }\r\n  }\r\n\r\n  const toggleProgressTab = (tabKey) => {\r\n    setExpandedProgressTabs((prev) => {\r\n      const next = new Set(prev);\r\n      if (next.has(tabKey)) next.delete(tabKey);\r\n      else next.add(tabKey);\r\n      return next;\r\n    });\r\n  };\r\n\r\n  const toggleProgressSection = (sectionId) => {\r\n    setExpandedProgressSections((prev) => {\r\n      const next = new Set(prev);\r\n      if (next.has(sectionId)) next.delete(sectionId);\r\n      else next.add(sectionId);\r\n      return next;\r\n    });\r\n  };\r\n\r\n  const updateProgressSection = (sectionId, updater) => {\r\n    setProgressConfig((prev) => {\r\n      const base = normalizeProgressConfig(prev);\r\n      const next = structuredClone(base);\r\n      const section = next.sections?.[sectionId];\r\n      if (!section) return base;\r\n      updater(section);\r\n      return next;\r\n    });\r\n  };\r\n\r\n  const setProgressFieldSelected = (sectionId, fieldId, checked) => {\r\n    updateProgressSection(sectionId, (section) => {\r\n      if (!section.selectedFields) section.selectedFields = {};\r\n      if (checked) delete section.selectedFields[fieldId];\r\n      else section.selectedFields[fieldId] = false;\r\n    });\r\n  };\r\n\r\n  const setProgressSectionEnabled = (sectionId, enabled) => {\r\n    updateProgressSection(sectionId, (section) => {\r\n      section.enabled = !!enabled;\r\n    });\r\n  };\r\n\r\n  const setProgressSectionMode = (sectionId, mode) => {\r\n    updateProgressSection(sectionId, (section) => {\r\n      section.mode = mode;\r\n    });\r\n  };\r\n\r\n  const setProgressSectionMin = (sectionId, value) => {\r\n    const num = Number(value);\r\n    updateProgressSection(sectionId, (section) => {\r\n      section.min = Number.isFinite(num) ? Math.max(1, num) : 1;\r\n    });\r\n  };\r\n\r\n  const selectAllSectionFields = (sectionId, fieldIds) => {\r\n    updateProgressSection(sectionId, (section) => {\r\n      if (!section.selectedFields) section.selectedFields = {};\r\n      fieldIds.forEach((id) => {\r\n        if (section.selectedFields) delete section.selectedFields[id];\r\n      });\r\n    });\r\n  };\r\n\r\n  const unselectAllSectionFields = (sectionId, fieldIds) => {\r\n    updateProgressSection(sectionId, (section) => {\r\n      if (!section.selectedFields) section.selectedFields = {};\r\n      fieldIds.forEach((id) => {\r\n        if (section.selectedFields) section.selectedFields[id] = false;\r\n      });\r\n    });\r\n  };\r\n\r\n  const toggleTargetCountry = (countryId) => {\r\n    const id = Number(countryId);\r\n    if (!Number.isFinite(id)) return;\r\n    setProgressTargetIds((prev) => {\r\n      const next = new Set(prev);\r\n      if (next.has(id)) next.delete(id);\r\n      else next.add(id);\r\n      return next;\r\n    });\r\n  };\r\n\r\n  const selectAllTargets = () => {\r\n    setProgressTargetIds((prev) => {\r\n      const next = new Set(prev);\r\n      filteredCountriesForApply.forEach((country) => {\r\n        const id = Number(country.id);\r\n        if (Number.isFinite(id)) next.add(id);\r\n      });\r\n      return next;\r\n    });\r\n  };\r\n\r\n  const clearTargets = () => {\r\n    setProgressTargetIds(new Set());\r\n  };\r\n\r\n  const applyProgressConfigToSelectedCountries = async () => {\r\n    const ids = Array.from(progressTargetIds)\r\n      .map((id) => Number(id))\r\n      .filter((id) => Number.isFinite(id));\r\n    const uniqueIds = Array.from(new Set(ids));\r\n    if (!uniqueIds.length) {\r\n      toast.error(\"Select at least one country\");\r\n      return;\r\n    }\r\n    if (!progressCountryId) {\r\n      toast.error(\"Select a country to edit rules first\");\r\n      return;\r\n    }\r\n    const ok = window.confirm(\r\n      `Apply this configuration to ${uniqueIds.length} countries? This will overwrite their current rules.`\r\n    );\r\n    if (!ok) return;\r\n\r\n    setProgressBulkSaving(true);\r\n    try {\r\n      const result = await api.adminBulkSaveProgressRequirements(uniqueIds, progressConfigNormalized);\r\n      const updatedCount = Number.isFinite(Number(result?.updatedCount))\r\n        ? Number(result.updatedCount)\r\n        : uniqueIds.length;\r\n      toast.success(`Applied to ${updatedCount} countries`);\r\n      if (uniqueIds.some((id) => String(id) === String(progressCountryId))) {\r\n        await loadProgressRequirements(progressCountryId);\r\n      }\r\n    } catch (e) {\r\n      toast.error(e.message || \"Failed to apply progress requirements\");\r\n    } finally {\r\n      setProgressBulkSaving(false);\r\n    }\r\n  };\r\n\r\n  const saveProgressConfig = async () => {\r\n    if (!progressCountryId) {\r\n      toast.error(\"Select a country\");\r\n      return;\r\n    }\r\n    setProgressSaving(true);\r\n    try {\r\n      const saved = await api.adminSaveProgressRequirements(progressCountryId, progressConfigNormalized);\r\n      setProgressConfig(normalizeProgressConfig(saved?.config || saved));\r\n      toast.success(\"Progress requirements saved\");\r\n    } catch (e) {\r\n      toast.error(e.message || \"Failed to save progress requirements\");\r\n    } finally {\r\n      setProgressSaving(false);\r\n    }\r\n  };\r\n\r\n  const openReviewModal = (row, action) => {\r\n    setReviewModal({ row, action });\r\n    setReviewNote(\"\");\r\n    setReviewIncludedYears({ y1: true, y2: true, y3: true });\r\n    if (action === \"revise\") {\r\n      // Reset revision selection: all modules unchecked by default\r\n      const initial = {};\r\n      REQUIRED_WORK_IDS.forEach((id) => (initial[id] = false));\r\n      setReviewRevisionSelection(initial);\r\n    }\r\n  };\r\n\r\n  const closeReviewModal = () => {\r\n    setReviewModal(null);\r\n    setReviewNote(\"\");\r\n    setReviewIncludedYears({ y1: true, y2: true, y3: true });\r\n    // Reset revision selections on close\r\n    const reset = {};\r\n    REQUIRED_WORK_IDS.forEach((id) => (reset[id] = false));\r\n    setReviewRevisionSelection(reset);\r\n  };\r\n\r\n  const submitReview = async () => {\r\n    if (!reviewModal?.row?.scenario?.id) return;\r\n    const action = reviewModal.action;\r\n    const note = reviewNote.trim();\r\n    if (action === \"revise\" && !note) {\r\n      toast.error(\"Note is required for revision requests\");\r\n      return;\r\n    }\r\n    const payload = { action, note: note || null };\r\n    if (action === \"approve\") {\r\n      const includedYears = YEAR_KEYS.filter((key) => reviewIncludedYears[key]);\r\n      if (!includedYears.length) {\r\n        toast.error(\"Select at least one year\");\r\n        return;\r\n      }\r\n      payload.includedYears = includedYears;\r\n    } else if (action === \"revise\") {\r\n      // Collect selected revision work ids.  At least one must be selected.\r\n      const revisionWorkIds = REQUIRED_WORK_IDS.filter((id) => reviewRevisionSelection[id]);\r\n      if (!revisionWorkIds.length) {\r\n        toast.error(\"Select at least one module\");\r\n        return;\r\n      }\r\n      payload.revisionWorkIds = revisionWorkIds;\r\n    }\r\n    setReviewSaving(true);\r\n    try {\r\n      await api.adminReviewScenario(reviewModal.row.scenario.id, payload);\r\n      toast.success(action === \"approve\" ? \"Scenario approved\" : \"Revision requested\");\r\n      closeReviewModal();\r\n      await loadQueue(); // uses latest filters via ref\r\n    } catch (e) {\r\n      toast.error(e.message || \"Review failed\");\r\n    } finally {\r\n      setReviewSaving(false);\r\n    }\r\n  };\r\n\r\n  const toggleRegion = (regionKey) => {\r\n    setExpandedRegions((prev) => {\r\n      const next = new Set(prev);\r\n      if (next.has(regionKey)) next.delete(regionKey);\r\n      else next.add(regionKey);\r\n      return next;\r\n    });\r\n  };\r\n\r\n  const toggleCountry = (regionKey, countryId) => {\r\n    const key = `${regionKey}::${countryId}`;\r\n    setExpandedCountries((prev) => {\r\n      const next = new Set(prev);\r\n      if (next.has(key)) next.delete(key);\r\n      else next.add(key);\r\n      return next;\r\n    });\r\n  };\r\n\r\n  const renderQueueKpis = (kpi) => {\r\n    if (!kpi) {\r\n      return <div className=\"kpi-mini kpi-mini-missing\">Missing KPIs</div>;\r\n    }\r\n    const margin = kpi.net_ciro ? kpi.net_result / kpi.net_ciro : null;\r\n    return (\r\n      <div className=\"kpi-mini\">\r\n        <div className=\"kpi-mini-row\">\r\n          <span className=\"kpi-mini-label\">Net ciro</span>\r\n          <span className=\"kpi-mini-value\">{fmt(kpi.net_ciro)}</span>\r\n        </div>\r\n        <div className=\"kpi-mini-row\">\r\n          <span className=\"kpi-mini-label\">Net result</span>\r\n          <span className=\"kpi-mini-value\">{fmt(kpi.net_result)}</span>\r\n        </div>\r\n        <div className=\"kpi-mini-row\">\r\n          <span className=\"kpi-mini-label\">Margin</span>\r\n          <span className=\"kpi-mini-value\">{fmtPct(margin)}</span>\r\n        </div>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  const renderYearCell = (year) => {\r\n    if (!year) return <div className=\"rollup-year-cell is-empty\">-</div>;\r\n    return (\r\n      <div className=\"rollup-year-cell\">\r\n        <div className=\"rollup-metric\">\r\n          <span className=\"rollup-label\">Net ciro</span>\r\n          <span className=\"rollup-value\">{fmt(year.net_ciro)}</span>\r\n        </div>\r\n        <div className=\"rollup-metric\">\r\n          <span className=\"rollup-label\">Net income</span>\r\n          <span className=\"rollup-value\">{fmt(year.net_income)}</span>\r\n        </div>\r\n        <div className=\"rollup-metric\">\r\n          <span className=\"rollup-label\">Expenses</span>\r\n          <span className=\"rollup-value\">{fmt(year.total_expenses)}</span>\r\n        </div>\r\n        <div className=\"rollup-metric\">\r\n          <span className=\"rollup-label\">Net result</span>\r\n          <span className=\"rollup-value\">{fmt(year.net_result)}</span>\r\n        </div>\r\n        <div className=\"rollup-metric\">\r\n          <span className=\"rollup-label\">Margin</span>\r\n          <span className=\"rollup-value\">{fmtPct(year.profitMargin)}</span>\r\n        </div>\r\n        <div className=\"rollup-metric\">\r\n          <span className=\"rollup-label\">Students</span>\r\n          <span className=\"rollup-value\">{fmt(year.students_total)}</span>\r\n        </div>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  const handleRefresh = () => {\r\n    if (activeTab === \"approvals\") {\r\n      loadQueue(queueFilters);\r\n      return;\r\n    }\r\n    if (activeTab === \"progress\") {\r\n      if (progressCountryId) loadProgressRequirements(progressCountryId);\r\n      return;\r\n    }\r\n    if (activeTab === \"reports\") {\r\n      loadRollup(rollupYear);\r\n      return;\r\n    }\r\n    if (activeTab === \"countries\") {\r\n      load();\r\n      if (schoolsCountryId) loadCountrySchools(schoolsCountryId);\r\n      return;\r\n    }\r\n    load();\r\n  };\r\n\r\n  if (!auth.user) {\r\n    return (\r\n      <div className=\"container\">\r\n        <div className=\"card\">Loading...</div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (auth.user.role !== \"admin\") {\r\n    return (\r\n      <div className=\"container\">\r\n        <div className=\"card\">\r\n          <div style={{ fontWeight: 700 }}>Admin only</div>\r\n          <div className=\"small\" style={{ marginTop: 6 }}>\r\n            You do not have permission to view this page.\r\n          </div>\r\n          <div style={{ marginTop: 10 }}>\r\n            <Link to=\"/schools\">Back to Schools</Link>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const rollupExportDisabled = rollupLoading || !rollupData;\r\n  const rollupXlsxReady = false;\r\n  const refreshDisabled = loading || queueLoading || rollupLoading || progressLoading;\r\n  const renderRefreshButton = () => (\r\n    <button className=\"btn\" onClick={handleRefresh} disabled={refreshDisabled}>\r\n      Refresh\r\n    </button>\r\n  );\r\n\r\n  return (\r\n    <>\r\n      {outlet?.headerPortalEl ? createPortal(renderRefreshButton(), outlet.headerPortalEl) : null}\r\n      <div className=\"container\">\r\n        {!outlet?.headerPortalEl && (\r\n          <div className=\"row\" style={{ justifyContent: \"space-between\" }}>\r\n            <div>\r\n              <div style={{ fontWeight: 800, fontSize: 20 }}>Admin</div>\r\n              <div className=\"small\">Create users, manage countries, and review scenarios.</div>\r\n            </div>\r\n            {renderRefreshButton()}\r\n          </div>\r\n        )}\r\n\r\n        <ToastContainer position=\"top-right\" autoClose={3500} newestOnTop closeOnClick pauseOnFocusLoss pauseOnHover />\r\n\r\n      {userUpdateLoading ? (\r\n        <div className=\"modal-backdrop\" role=\"status\" aria-live=\"polite\" aria-busy=\"true\">\r\n          <style>{`@keyframes adminSpin{to{transform:rotate(360deg)}}`}</style>\r\n          <div\r\n            className=\"card\"\r\n            style={{\r\n              width: \"min(360px, 92vw)\",\r\n              padding: \"16px\",\r\n              textAlign: \"center\",\r\n            }}\r\n          >\r\n            <div\r\n              aria-hidden\r\n              style={{\r\n                width: 28,\r\n                height: 28,\r\n                margin: \"0 auto\",\r\n                borderRadius: \"50%\",\r\n                border: \"3px solid rgba(0,0,0,.15)\",\r\n                borderTopColor: \"rgba(0,0,0,.75)\",\r\n                animation: \"adminSpin .8s linear infinite\",\r\n              }}\r\n            />\r\n            <div style={{ fontWeight: 700, marginTop: 10 }}>Updating user...</div>\r\n            <div className=\"small muted\" style={{ marginTop: 6 }}>\r\n              Please wait.\r\n            </div>\r\n          </div>\r\n        </div>\r\n      ) : null}\r\n\r\n      {confirmAssign ? (\r\n        <div className=\"modal-backdrop\" role=\"dialog\" aria-modal=\"true\">\r\n          <div className=\"modal\">\r\n            <div style={{ fontWeight: 700, marginBottom: 8 }}>Confirm Change</div>\r\n            <div className=\"small\" style={{ marginBottom: 12 }}>\r\n              {`Change ${confirmAssign.email} from ${confirmAssign.currentLabel} to ${confirmAssign.nextLabel}?`}\r\n            </div>\r\n            <div className=\"row\" style={{ justifyContent: \"flex-end\" }}>\r\n              <button className=\"btn\" onClick={() => setConfirmAssign(null)} disabled={userUpdateLoading}>\r\n                Cancel\r\n              </button>\r\n              <button\r\n                className=\"btn primary\"\r\n                onClick={() => {\r\n                  const data = confirmAssign;\r\n                  setConfirmAssign(null);\r\n                  confirmAssignCountry(data);\r\n                }}\r\n                disabled={userUpdateLoading}\r\n              >\r\n                {userUpdateLoading ? \"Updating...\" : \"Confirm\"}\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      ) : null}\r\n\r\n      {confirmDelete ? (\r\n        <div className=\"modal-backdrop\" role=\"dialog\" aria-modal=\"true\">\r\n          <div className=\"modal\">\r\n            <div style={{ fontWeight: 700, marginBottom: 8 }}>Confirm Delete</div>\r\n            <div className=\"small\" style={{ marginBottom: 12 }}>\r\n              {`Delete ${confirmDelete.label}? This only works if the user has no related records.`}\r\n            </div>\r\n            <div className=\"row\" style={{ justifyContent: \"flex-end\" }}>\r\n              <button className=\"btn\" onClick={() => setConfirmDelete(null)}>\r\n                Cancel\r\n              </button>\r\n              <button\r\n                className=\"btn danger\"\r\n                onClick={() => {\r\n                  const data = confirmDelete;\r\n                  setConfirmDelete(null);\r\n                  confirmDeleteUser(data);\r\n                }}\r\n              >\r\n                Delete\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      ) : null}\r\n\r\n      {resetLoadingId ? (\r\n        <div className=\"modal-backdrop\" role=\"status\" aria-live=\"polite\" aria-busy=\"true\">\r\n          <style>{`@keyframes adminSpin{to{transform:rotate(360deg)}}`}</style>\r\n          <div\r\n            className=\"card\"\r\n            style={{\r\n              width: \"min(360px, 92vw)\",\r\n              padding: \"16px\",\r\n              textAlign: \"center\",\r\n            }}\r\n          >\r\n            <div\r\n              aria-hidden\r\n              style={{\r\n                width: 28,\r\n                height: 28,\r\n                margin: \"0 auto\",\r\n                borderRadius: \"50%\",\r\n                border: \"3px solid rgba(0,0,0,.15)\",\r\n                borderTopColor: \"rgba(0,0,0,.75)\",\r\n                animation: \"adminSpin .8s linear infinite\",\r\n              }}\r\n            />\r\n            <div style={{ fontWeight: 700, marginTop: 10 }}>Resetting password...</div>\r\n            <div className=\"small muted\" style={{ marginTop: 6 }}>\r\n              Please wait.\r\n            </div>\r\n          </div>\r\n        </div>\r\n      ) : null}\r\n\r\n      {confirmReset ? (\r\n        <div className=\"modal-backdrop\" role=\"dialog\" aria-modal=\"true\">\r\n          <div className=\"modal\">\r\n            <div style={{ fontWeight: 700, marginBottom: 8 }}>Reset Password</div>\r\n            <div className=\"small\" style={{ marginBottom: 12 }}>\r\n              {`Generate a new temporary password for ${confirmReset.email}? The user will be forced to change it on next login.`}\r\n            </div>\r\n            <div className=\"row\" style={{ justifyContent: \"flex-end\" }}>\r\n              <button className=\"btn\" onClick={() => setConfirmReset(null)} disabled={Boolean(resetLoadingId)}>\r\n                Cancel\r\n              </button>\r\n              <button\r\n                className=\"btn primary\"\r\n                onClick={() => {\r\n                  const data = confirmReset;\r\n                  setConfirmReset(null);\r\n                  confirmResetPassword(data);\r\n                }}\r\n                disabled={Boolean(resetLoadingId)}\r\n              >\r\n                Confirm\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      ) : null}\r\n\r\n      {resetResult ? (\r\n        <div className=\"modal-backdrop\" role=\"dialog\" aria-modal=\"true\">\r\n          <div className=\"modal\" style={{ maxWidth: 560 }}>\r\n            <div style={{ fontWeight: 700, marginBottom: 8 }}>Temporary Password</div>\r\n            <div className=\"small\" style={{ marginBottom: 10 }}>\r\n              Share this password securely with the user. It will only be shown once here.\r\n            </div>\r\n            <div className=\"card\" style={{ padding: 12, background: \"rgba(0,0,0,.03)\" }}>\r\n              <div className=\"small\" style={{ marginBottom: 6 }}>\r\n                User: <strong>{resetResult.email}</strong>\r\n              </div>\r\n              <div className=\"row\" style={{ alignItems: \"center\", justifyContent: \"space-between\" }}>\r\n                <div style={{ fontFamily: \"ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace\", fontSize: 18 }}>\r\n                  {resetResult.temporary_password}\r\n                </div>\r\n                <button className=\"btn\" onClick={() => copyText(resetResult.temporary_password)}>\r\n                  Copy\r\n                </button>\r\n              </div>\r\n            </div>\r\n            <div className=\"row\" style={{ justifyContent: \"flex-end\", marginTop: 12 }}>\r\n              <button className=\"btn primary\" onClick={() => setResetResult(null)}>\r\n                Done\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      ) : null}\r\n\r\n      {reviewModal ? (\r\n        <div className=\"modal-backdrop\" role=\"dialog\" aria-modal=\"true\">\r\n          <div className=\"modal\">\r\n            <div style={{ fontWeight: 700, marginBottom: 8 }}>\r\n              {reviewModal.action === \"approve\" ? \"Approve Scenario\" : \"Request Revision\"}\r\n            </div>\r\n            <div className=\"small\" style={{ marginBottom: 12 }}>\r\n              {reviewModal.row?.school?.name ? `${reviewModal.row.school.name} - ` : \"\"}\r\n              {reviewModal.row?.scenario?.name || \"Scenario\"}\r\n            </div>\r\n\r\n            {reviewModal.action === \"approve\" ? (\r\n              <div style={{ marginBottom: 10 }}>\r\n                <div className=\"small\" style={{ marginBottom: 6 }}>\r\n                  Included years\r\n                </div>\r\n                <div className=\"row\">\r\n                  {YEAR_KEYS.map((key) => (\r\n                    <label key={key} className=\"small\" style={{ display: \"inline-flex\", gap: 6 }}>\r\n                      <input\r\n                        type=\"checkbox\"\r\n                        checked={reviewIncludedYears[key]}\r\n                        onChange={(e) => setReviewIncludedYears((prev) => ({ ...prev, [key]: e.target.checked }))}\r\n                      />\r\n                      {key.toUpperCase()}\r\n                    </label>\r\n                  ))}\r\n                </div>\r\n              </div>\r\n            ) : null}\r\n\r\n            {reviewModal.action === \"revise\" ? (\r\n              <div style={{ marginBottom: 10 }}>\r\n                <div className=\"small\" style={{ marginBottom: 6 }}>\r\n                  Sadece seilen modller revizeye alacak (editable).\r\n                </div>\r\n                <div className=\"row\" style={{ flexWrap: \"wrap\", gap: 8 }}>\r\n                  {REQUIRED_WORK_IDS.map((id) => (\r\n                    <label\r\n                      key={id}\r\n                      className=\"small\"\r\n                      style={{ display: \"inline-flex\", gap: 6, alignItems: \"center\" }}\r\n                    >\r\n                      <input\r\n                        type=\"checkbox\"\r\n                        checked={Boolean(reviewRevisionSelection[id])}\r\n                        onChange={(e) =>\r\n                          setReviewRevisionSelection((prev) => ({ ...prev, [id]: e.target.checked }))\r\n                        }\r\n                      />\r\n                      {WORK_ID_LABELS[id] || id}\r\n                    </label>\r\n                  ))}\r\n                  <button type=\"button\" className=\"btn sm\" onClick={selectAllRevisionWork}>\r\n                    Tmn se\r\n                  </button>\r\n                  <button type=\"button\" className=\"btn sm\" onClick={clearRevisionWork}>\r\n                    Temizle\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            ) : null}\r\n\r\n            <div style={{ marginBottom: 12 }}>\r\n              <div className=\"small\" style={{ marginBottom: 6 }}>\r\n                Note {reviewModal.action === \"revise\" ? \"(required)\" : \"(optional)\"}\r\n              </div>\r\n              <textarea\r\n                className=\"input\"\r\n                style={{ width: \"100%\", minHeight: 90 }}\r\n                value={reviewNote}\r\n                onChange={(e) => setReviewNote(e.target.value)}\r\n              />\r\n            </div>\r\n\r\n            <div className=\"row\" style={{ justifyContent: \"flex-end\" }}>\r\n              <button className=\"btn\" onClick={closeReviewModal}>\r\n                Cancel\r\n              </button>\r\n              <button className=\"btn primary\" onClick={submitReview} disabled={reviewSaving}>\r\n                {reviewSaving ? \"Saving...\" : reviewModal.action === \"approve\" ? \"Approve\" : \"Request Revision\"}\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      ) : null}\r\n\r\n      {activeTab === \"users\" && (\r\n        <>\r\n          <div\r\n            style={{\r\n              marginTop: 12,\r\n              display: \"grid\",\r\n              gridTemplateColumns: \"repeat(auto-fit, minmax(320px, 1fr))\",\r\n              gap: 12,\r\n            }}\r\n          >\r\n            <div className=\"card\">\r\n              <div style={{ fontWeight: 700, marginBottom: 8 }}>Create User</div>\r\n              <div className=\"row\">\r\n                <input\r\n                  className=\"input\"\r\n                  placeholder=\"Full name\"\r\n                  value={newUserName}\r\n                  onChange={(e) => setNewUserName(e.target.value)}\r\n                />\r\n                <input\r\n                  className=\"input\"\r\n                  placeholder=\"Email\"\r\n                  value={newUserEmail}\r\n                  onChange={(e) => setNewUserEmail(e.target.value)}\r\n                />\r\n                <input\r\n                  className=\"input\"\r\n                  placeholder=\"Temporary password\"\r\n                  type=\"password\"\r\n                  value={newUserPassword}\r\n                  onChange={(e) => setNewUserPassword(e.target.value)}\r\n                />\r\n                <select className=\"input sm\" value={newUserRole} onChange={(e) => setNewUserRole(e.target.value)}>\r\n                  <option value=\"user\">User</option>\r\n                  <option value=\"admin\">Admin</option>\r\n                  <option value=\"principal\">Principal</option>\r\n                  <option value=\"hr\">HR</option>\r\n                  <option value=\"manager\">Manager</option>\r\n                  <option value=\"accountant\">Accountant</option>\r\n                </select>\r\n                <select\r\n                  className=\"input\"\r\n                  value={newUserCountryId}\r\n                  onChange={(e) => setNewUserCountryId(e.target.value)}\r\n                >\r\n                  <option value=\"\">Assign country (optional)</option>\r\n                  {countries.map((c) => (\r\n                    <option key={c.id} value={c.id}>\r\n                      {c.name} ({c.code}){c.region ? ` - ${c.region}` : \"\"}\r\n                    </option>\r\n                  ))}\r\n                </select>\r\n                <button className=\"btn primary\" onClick={createUser} disabled={loading}>\r\n                  Create\r\n                </button>\r\n              </div>\r\n              <div className=\"small\" style={{ marginTop: 8 }}>\r\n                New users must reset their password on first login.\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"card\">\r\n              <div style={{ fontWeight: 700, marginBottom: 8 }}>Assign / Edit User Country</div>\r\n              <div className=\"small\" style={{ marginBottom: 6 }}>\r\n                {selectedUser\r\n                  ? `Editing: ${selectedUser.email}${selectedUser.full_name ? ` (${selectedUser.full_name})` : \"\"\r\n                  } #${selectedUser.id}`\r\n                  : \"Select a user to assign or edit.\"}\r\n              </div>\r\n              <div className=\"row\">\r\n                <select className=\"input\" value={assignUserId} onChange={(e) => setAssignUserId(e.target.value)}>\r\n                  <option value=\"\">Select user</option>\r\n                  {users.map((u) => (\r\n                    <option key={u.id} value={u.id}>\r\n                      {u.email} {u.full_name ? `(${u.full_name})` : \"\"} #{u.id}\r\n                    </option>\r\n                  ))}\r\n                </select>\r\n                <select className=\"input\" value={assignCountryId} onChange={(e) => setAssignCountryId(e.target.value)}>\r\n                  <option value=\"\">Select country</option>\r\n                  {countries.map((c) => (\r\n                    <option key={c.id} value={c.id}>\r\n                      {c.name} ({c.code}) - {c.region}\r\n                    </option>\r\n                  ))}\r\n                </select>\r\n                <button\r\n                  className=\"btn primary\"\r\n                  onClick={assignCountry}\r\n                  disabled={loading || userUpdateLoading || !assignUserId || !assignCountryId || isSameCountry}\r\n                >\r\n                  {userUpdateLoading ? \"Updating...\" : actionLabel}\r\n                </button>\r\n              </div>\r\n              <div className=\"small\" style={{ marginTop: 8 }}>\r\n                <div>Current: {currentAssignmentLabel}</div>\r\n                <div>New: {newAssignmentLabel}</div>\r\n                {selectedUser && selectedCountry && selectedUser.country_id != null && !isSameCountry ? (\r\n                  <div style={{ color: \"#b45309\" }}>You are changing this user's assignment.</div>\r\n                ) : null}\r\n                {isSameCountry ? <div style={{ color: \"#6b7280\" }}>Selected country matches current assignment.</div> : null}\r\n                Users must re-login after assignment to refresh their token.\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n            {/* Permissions editor for the selected user */}\r\n            <div className=\"card\">\r\n              <div style={{ fontWeight: 700, marginBottom: 8 }}>Permissions</div>\r\n              {/* Only render the editor when a user is selected */}\r\n              {!selectedUser ? (\r\n                <div className=\"small\">Select a user above to edit permissions.</div>\r\n              ) : permissionsLoading ? (\r\n                <div className=\"small\">Loading permissions...</div>\r\n              ) : (\r\n                <>\r\n                  {/* Role selector for admin to change the user's role */}\r\n                  <div style={{ marginBottom: 8 }}>\r\n                    <label className=\"small\" style={{ marginRight: 8 }}>Role:</label>\r\n                    <select\r\n                      className=\"input sm\"\r\n                      value={selectedUser?.role || \"user\"}\r\n                      onChange={(e) => updateSelectedUserRole(e.target.value)}\r\n                      disabled={roleUpdating}\r\n                    >\r\n                      {roleOptions.map((opt) => (\r\n                        <option key={opt.value} value={opt.value}>{opt.label}</option>\r\n                      ))}\r\n                    </select>\r\n                  </div>\r\n                  {Object.keys(permissionsGrouped).length === 0 ? (\r\n                    <div className=\"small\">No permissions defined.</div>\r\n                  ) : (\r\n                    Object.entries(permissionsGrouped).map(([groupName, perms]) => (\r\n                      <div key={groupName} style={{ marginBottom: 12 }}>\r\n                        <div style={{ fontWeight: 600, marginBottom: 4 }}>{groupName}</div>\r\n                        {perms.map((perm) => {\r\n                          const key = `${perm.resource}|${perm.action}`;\r\n                          const isSelected = Boolean(permissionSelections[key]);\r\n                          const scopeValue = permissionScopes[key] || \"country\";\r\n                          return (\r\n                            <div key={key} className=\"row\" style={{ alignItems: \"center\", marginBottom: 4 }}>\r\n                              <label className=\"small\" style={{ flexGrow: 1, display: \"flex\", alignItems: \"center\", gap: 6 }}>\r\n                                <input\r\n                                  type=\"checkbox\"\r\n                                  checked={isSelected}\r\n                                  onChange={() => togglePermission(key)}\r\n                                />\r\n                                {perm.label}\r\n                              </label>\r\n                              {/* Scope selector */}\r\n                              <select\r\n                                className=\"input sm\"\r\n                                disabled={!isSelected}\r\n                                value={scopeValue}\r\n                                onChange={(e) => changePermissionScope(key, e.target.value)}\r\n                              >\r\n                                <option value=\"country\">Country</option>\r\n                                {userSchools && userSchools.map((s) => (\r\n                                  <option key={s.id} value={`school:${s.id}`}>\r\n                                    {s.name}\r\n                                  </option>\r\n                                ))}\r\n                              </select>\r\n                            </div>\r\n                          );\r\n                        })}\r\n                      </div>\r\n                    ))\r\n                  )}\r\n                  <div className=\"row\" style={{ marginTop: 8 }}>\r\n                    <button className=\"btn primary\" onClick={saveUserPermissions} disabled={permissionsSaving}>\r\n                      {permissionsSaving ? \"Saving...\" : \"Save Permissions\"}\r\n                    </button>\r\n                  </div>\r\n                </>\r\n              )}\r\n            </div>\r\n\r\n          <div className=\"card\" style={{ marginTop: 12 }}>\r\n            <div className=\"row\" style={{ justifyContent: \"space-between\" }}>\r\n              <div style={{ fontWeight: 700 }}>Users</div>\r\n              <label className=\"small\">\r\n                <input type=\"checkbox\" checked={showUnassigned} onChange={(e) => setShowUnassigned(e.target.checked)} />{\" \"}\r\n                Unassigned only\r\n              </label>\r\n            </div>\r\n            <table className=\"table\" style={{ marginTop: 8 }}>\r\n              <thead>\r\n                <tr>\r\n                  <th>ID</th>\r\n                  <th>Name</th>\r\n                  <th>Email</th>\r\n                  <th>Role</th>\r\n                  <th>Reset</th>\r\n                  <th>Country</th>\r\n                  <th>Region</th>\r\n                  <th>Actions</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody>\r\n                {filteredUsers.length === 0 ? (\r\n                  <tr>\r\n                    <td colSpan=\"8\" className=\"small\">\r\n                      No users found.\r\n                    </td>\r\n                  </tr>\r\n                ) : (\r\n                  filteredUsers.map((u) => (\r\n                    <tr key={u.id}>\r\n                      <td className=\"small\">{u.id}</td>\r\n                      <td>{u.full_name || \"-\"}</td>\r\n                      <td>{u.email}</td>\r\n                      <td className=\"small\">{u.role}</td>\r\n                      <td>{u.must_reset_password ? <span className=\"badge\">Yes</span> : <span className=\"small\">No</span>}</td>\r\n                      <td>\r\n                        {u.country_name ? <span>{u.country_name} ({u.country_code})</span> : <span className=\"badge\">Unassigned</span>}\r\n                      </td>\r\n                      <td>{u.region || \"-\"}</td>\r\n                      <td>\r\n                        <div className=\"row\">\r\n                          <button className=\"btn\" onClick={() => setAssignUserId(String(u.id))}>\r\n                            Edit\r\n                          </button>\r\n                          <button\r\n                            className=\"btn\"\r\n                            onClick={() => resetPasswordForUser(u)}\r\n                            disabled={Boolean(resetLoadingId)}\r\n                          >\r\n                            Reset password\r\n                          </button>\r\n                          <button className=\"btn\" onClick={() => deleteUser(u)}>\r\n                            Delete\r\n                          </button>\r\n                        </div>\r\n                      </td>\r\n                    </tr>\r\n                  ))\r\n                )}\r\n              </tbody>\r\n            </table>\r\n            <div className=\"small\" style={{ marginTop: 8 }}>\r\n              Delete is blocked if the user has created or updated records.\r\n            </div>\r\n          </div>\r\n        </>\r\n      )}\r\n\r\n      {activeTab === \"countries\" && (\r\n        <>\r\n          <div className=\"card\" style={{ marginTop: 12 }}>\r\n            <div style={{ fontWeight: 700, marginBottom: 8 }}>Create Country</div>\r\n            <div className=\"row\">\r\n              <input\r\n                className=\"input\"\r\n                placeholder=\"Country name\"\r\n                value={countryName}\r\n                onChange={(e) => setCountryName(e.target.value)}\r\n              />\r\n              <input\r\n                className=\"input sm\"\r\n                placeholder=\"Code\"\r\n                value={countryCode}\r\n                onChange={(e) => setCountryCode(e.target.value.toUpperCase())}\r\n              />\r\n              <input\r\n                className=\"input\"\r\n                placeholder=\"Region\"\r\n                value={countryRegion}\r\n                onChange={(e) => setCountryRegion(e.target.value)}\r\n              />\r\n              <button className=\"btn primary\" onClick={createCountry} disabled={loading}>\r\n                Create\r\n              </button>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"card\" style={{ marginTop: 12 }}>\r\n            <div style={{ fontWeight: 700, marginBottom: 8 }}>Countries</div>\r\n            <table className=\"table\">\r\n              <thead>\r\n                <tr>\r\n                  <th>ID</th>\r\n                  <th>Name</th>\r\n                  <th>Code</th>\r\n                  <th>Region</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody>\r\n                {countries.length === 0 ? (\r\n                  <tr>\r\n                    <td colSpan=\"4\" className=\"small\">\r\n                      No countries yet.\r\n                    </td>\r\n                  </tr>\r\n                ) : (\r\n                  countries.map((c) => (\r\n                    <tr key={c.id}>\r\n                      <td className=\"small\">{c.id}</td>\r\n                      <td>{c.name}</td>\r\n                      <td className=\"small\">{c.code}</td>\r\n                      <td>{c.region}</td>\r\n                    </tr>\r\n                  ))\r\n                )}\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n\r\n          <div className=\"card\" style={{ marginTop: 12 }}>\r\n            <div style={{ fontWeight: 700, marginBottom: 8 }}>Country Schools</div>\r\n            <div className=\"row\" style={{ marginBottom: 10 }}>\r\n              <select\r\n                className=\"input\"\r\n                value={schoolsCountryId}\r\n                onChange={(e) => setSchoolsCountryId(e.target.value)}\r\n              >\r\n                <option value=\"\">Select a country</option>\r\n                {countries.map((c) => (\r\n                  <option key={c.id} value={c.id}>\r\n                    {c.name}\r\n                  </option>\r\n                ))}\r\n              </select>\r\n              <input\r\n                className=\"input\"\r\n                placeholder=\"Search schools\"\r\n                value={schoolsSearch}\r\n                onChange={(e) => setSchoolsSearch(e.target.value)}\r\n                disabled={!schoolsCountryId}\r\n              />\r\n            </div>\r\n\r\n            <div className=\"row\" style={{ marginBottom: 10 }}>\r\n              <input\r\n                className=\"input\"\r\n                placeholder=\"New school name\"\r\n                value={newSchoolName}\r\n                onChange={(e) => setNewSchoolName(e.target.value)}\r\n                disabled={!schoolsCountryId || schoolCreateLoading}\r\n              />\r\n              <button\r\n                className=\"btn primary\"\r\n                onClick={createCountrySchool}\r\n                disabled={!schoolsCountryId || schoolCreateLoading}\r\n              >\r\n                {schoolCreateLoading ? \"Creating...\" : \"Create\"}\r\n              </button>\r\n            </div>\r\n\r\n            {!selectedSchoolsCountry ? (\r\n              <div className=\"small\">Select a country to manage its schools.</div>\r\n            ) : (\r\n              <table className=\"table\">\r\n                <thead>\r\n                  <tr>\r\n                    <th>Name</th>\r\n                    <th>Status</th>\r\n                    <th>Created At</th>\r\n                    <th>Closed At</th>\r\n                    <th>Principals</th>\r\n                    <th>Actions</th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody>\r\n                  {countrySchoolsLoading ? (\r\n                    <tr>\r\n                      <td colSpan=\"6\" className=\"small\">\r\n                        Loading...\r\n                      </td>\r\n                    </tr>\r\n                  ) : filteredCountrySchools.length === 0 ? (\r\n                    <tr>\r\n                      <td colSpan=\"6\" className=\"small\">\r\n                        No schools found.\r\n                      </td>\r\n                    </tr>\r\n                  ) : (\r\n                    filteredCountrySchools.map((school) => {\r\n                      const statusMeta = getSchoolStatusMeta(school.status);\r\n                      const draftName = schoolNameDrafts[school.id] ?? school.name ?? \"\";\r\n                      const isSaving = schoolSavingId === school.id;\r\n\r\n                      return (\r\n                        <tr key={school.id}>\r\n                          <td>{school.name}</td>\r\n                          <td>\r\n                            <span className={`status-badge ${statusMeta.className}`}>\r\n                              {statusMeta.label}\r\n                            </span>\r\n                          </td>\r\n                          <td className=\"small\">{formatDateTime(school.created_at)}</td>\r\n                          <td className=\"small\">{formatDateTime(school.closed_at)}</td>\r\n                          {/* Principals column: show assigned principal names */}\r\n                          <td>\r\n                            {Array.isArray(principalLists[school.id]) && principalLists[school.id].length > 0 ? (\r\n                              <span>{principalLists[school.id].map((u) => u.full_name || u.email).join(\", \")}</span>\r\n                            ) : (\r\n                              <span className=\"small muted\">-</span>\r\n                            )}\r\n                          </td>\r\n                          <td>\r\n                            {/* School name edit and status toggle */}\r\n                            <div className=\"row\">\r\n                              <input\r\n                                className=\"input sm\"\r\n                                value={draftName}\r\n                                onChange={(e) =>\r\n                                  setSchoolNameDrafts((prev) => ({\r\n                                    ...prev,\r\n                                    [school.id]: e.target.value,\r\n                                  }))\r\n                                }\r\n                                disabled={isSaving}\r\n                              />\r\n                              <button\r\n                                className=\"btn primary\"\r\n                                onClick={() => saveSchoolName(school)}\r\n                                disabled={isSaving}\r\n                              >\r\n                                Save\r\n                              </button>\r\n                              <button\r\n                                className=\"btn\"\r\n                                onClick={() => toggleSchoolStatus(school)}\r\n                                disabled={isSaving}\r\n                              >\r\n                                {school.status === \"closed\" ? \"Reopen\" : \"Close\"}\r\n                              </button>\r\n                            </div>\r\n                            {/* Principal assignment editor */}\r\n                            <div className=\"row\" style={{ marginTop: 4 }}>\r\n                              <select\r\n                                multiple\r\n                                className=\"input sm\"\r\n                                value={(principalDrafts[school.id] || []).map(String)}\r\n                                onChange={(e) => {\r\n                                  const opts = Array.from(e.target.selectedOptions || []);\r\n                                  const values = opts.map((o) => o.value);\r\n                                  handlePrincipalSelectionChange(school.id, values);\r\n                                }}\r\n                              >\r\n                                {users\r\n                                  .filter((u) => u.role === \"principal\")\r\n                                  .map((u) => (\r\n                                    <option key={u.id} value={u.id}>\r\n                                      {u.email} {u.full_name ? `(${u.full_name})` : \"\"} #{u.id}\r\n                                    </option>\r\n                                  ))}\r\n                              </select>\r\n                              <button\r\n                                className=\"btn\"\r\n                                onClick={() => savePrincipalAssignments(school.id)}\r\n                                disabled={Boolean(principalSaving[school.id])}\r\n                              >\r\n                                {principalSaving[school.id] ? \"Saving...\" : \"Save\"}\r\n                              </button>\r\n                            </div>\r\n                          </td>\r\n                        </tr>\r\n                      );\r\n                    })\r\n                  )}\r\n                </tbody>\r\n              </table>\r\n            )}\r\n          </div>\r\n        </>\r\n      )}\r\n\r\n      {activeTab === \"progress\" && (\r\n        <div style={{ marginTop: 12 }}>\r\n          <div className=\"card\">\r\n            <div className=\"row\" style={{ justifyContent: \"space-between\", alignItems: \"center\" }}>\r\n              <div>\r\n                <div style={{ fontWeight: 700 }}>Progress Tracking</div>\r\n                <div className=\"small\">Configure per-field requirements by country.</div>\r\n              </div>\r\n              <div className=\"row\">\r\n                <select\r\n                  className=\"input sm\"\r\n                  value={progressCountryId}\r\n                  onChange={(e) => setProgressCountryId(e.target.value)}\r\n                >\r\n                  <option value=\"\">Select country</option>\r\n                  {countries.map((c) => (\r\n                    <option key={c.id} value={c.id}>\r\n                      {c.name}\r\n                    </option>\r\n                  ))}\r\n                </select>\r\n                <input\r\n                  className=\"input sm\"\r\n                  placeholder=\"Search fields\"\r\n                  value={progressSearch}\r\n                  onChange={(e) => setProgressSearch(e.target.value)}\r\n                />\r\n                <button\r\n                  className=\"btn primary\"\r\n                  onClick={saveProgressConfig}\r\n                  disabled={!progressCountryId || progressSaving || progressLoading}\r\n                >\r\n                  {progressSaving ? \"Saving...\" : \"Save\"}\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"card\" style={{ marginTop: 12 }}>\r\n            <div style={{ fontWeight: 700, marginBottom: 8 }}>Apply to multiple countries</div>\r\n            <div className=\"row\" style={{ alignItems: \"center\", flexWrap: \"wrap\", marginBottom: 10 }}>\r\n              <input\r\n                className=\"input sm\"\r\n                placeholder=\"Search countries\"\r\n                value={progressCountryListSearch}\r\n                onChange={(e) => setProgressCountryListSearch(e.target.value)}\r\n              />\r\n              <button\r\n                className=\"btn\"\r\n                onClick={selectAllTargets}\r\n                disabled={filteredCountriesForApply.length === 0 || progressBulkSaving}\r\n              >\r\n                Select all\r\n              </button>\r\n              <button\r\n                className=\"btn\"\r\n                onClick={clearTargets}\r\n                disabled={progressTargetCount === 0 || progressBulkSaving}\r\n              >\r\n                Clear\r\n              </button>\r\n              <button\r\n                className=\"btn primary\"\r\n                onClick={applyProgressConfigToSelectedCountries}\r\n                disabled={progressBulkDisabled}\r\n              >\r\n                {progressBulkSaving ? \"Applying...\" : `Apply to Selected (${progressTargetCount})`}\r\n              </button>\r\n            </div>\r\n\r\n            <div\r\n              style={{\r\n                border: \"1px solid #e5e7eb\",\r\n                borderRadius: 10,\r\n                padding: 10,\r\n                background: \"#fff\",\r\n                maxHeight: 240,\r\n                overflowY: \"auto\",\r\n              }}\r\n            >\r\n              {filteredCountriesForApply.length === 0 ? (\r\n                <div className=\"small\">No countries found.</div>\r\n              ) : (\r\n                filteredCountriesForApply.map((country) => {\r\n                  const id = Number(country.id);\r\n                  const checked = progressTargetIds.has(id);\r\n                  return (\r\n                    <label\r\n                      key={country.id}\r\n                      style={{ display: \"flex\", gap: 8, alignItems: \"center\", padding: \"6px 0\" }}\r\n                    >\r\n                      <input\r\n                        type=\"checkbox\"\r\n                        checked={checked}\r\n                        onChange={() => toggleTargetCountry(id)}\r\n                      />\r\n                      <span>{country.name || \"-\"}</span>\r\n                    </label>\r\n                  );\r\n                })\r\n              )}\r\n            </div>\r\n          </div>\r\n\r\n          {!progressCountryId ? (\r\n            <div className=\"card\" style={{ marginTop: 12 }}>\r\n              <div className=\"small\">Select a country to edit progress rules.</div>\r\n            </div>\r\n          ) : (\r\n            <div className=\"card\" style={{ marginTop: 12 }}>\r\n              {progressLoading ? (\r\n                <div className=\"small\">Loading...</div>\r\n              ) : (\r\n                <div style={{ display: \"grid\", gap: 12 }}>\r\n                  {progressCatalog.tabs.map((tab) => {\r\n                    const tabSections = progressCatalog.sections.filter((s) => s.tabKey === tab.key);\r\n                    const visibleSections = tabSections.filter((section) => {\r\n                      if (!progressSearchValue) return true;\r\n                      const sectionMatch = String(section.label || \"\").toLowerCase().includes(progressSearchValue);\r\n                      const fields = (section.fields || [])\r\n                        .map((id) => progressCatalog.fieldsById[id])\r\n                        .filter(Boolean);\r\n                      const fieldMatch = fields.some((f) => {\r\n                        const label = String(f.label || \"\").toLowerCase();\r\n                        const id = String(f.id || \"\").toLowerCase();\r\n                        return label.includes(progressSearchValue) || id.includes(progressSearchValue);\r\n                      });\r\n                      return sectionMatch || fieldMatch;\r\n                    });\r\n\r\n                    if (!visibleSections.length) return null;\r\n                    const tabExpanded = expandedProgressTabs.has(tab.key) || Boolean(progressSearchValue);\r\n\r\n                    return (\r\n                      <div key={tab.key} style={{ border: \"1px solid #e5e7eb\", borderRadius: 10, padding: 10 }}>\r\n                        <div className=\"row\" style={{ justifyContent: \"space-between\" }}>\r\n                          <div className=\"row\">\r\n                            <button\r\n                              type=\"button\"\r\n                              className=\"btn\"\r\n                              onClick={() => toggleProgressTab(tab.key)}\r\n                            >\r\n                              {tabExpanded ? \"-\" : \"+\"}\r\n                            </button>\r\n                            <div style={{ fontWeight: 700 }}>{tab.label}</div>\r\n                          </div>\r\n                          <div className=\"small\">{tabSections.length} sections</div>\r\n                        </div>\r\n\r\n                        {tabExpanded ? (\r\n                          <div style={{ display: \"grid\", gap: 10, marginTop: 10 }}>\r\n                            {visibleSections.map((section) => {\r\n                              const sectionConfig = progressConfigNormalized.sections?.[section.id] || {};\r\n                              const sectionEnabled = sectionConfig.enabled !== false;\r\n                              const sectionMode = String(sectionConfig.mode || section.modeDefault || \"ALL\").toUpperCase();\r\n                              const sectionMin =\r\n                                Number.isFinite(Number(sectionConfig.min)) && Number(sectionConfig.min) > 0\r\n                                  ? Number(sectionConfig.min)\r\n                                  : section.minDefault || 1;\r\n\r\n                              const allFields = (section.fields || [])\r\n                                .map((id) => progressCatalog.fieldsById[id])\r\n                                .filter(Boolean);\r\n                              const filteredFields = progressSearchValue\r\n                                ? allFields.filter((field) => {\r\n                                  const label = String(field.label || \"\").toLowerCase();\r\n                                  const id = String(field.id || \"\").toLowerCase();\r\n                                  return label.includes(progressSearchValue) || id.includes(progressSearchValue);\r\n                                })\r\n                                : allFields;\r\n\r\n                              if (!filteredFields.length && progressSearchValue) return null;\r\n\r\n                              const sectionExpanded = expandedProgressSections.has(section.id) || Boolean(progressSearchValue);\r\n                              const fieldIdsForBulk = (progressSearchValue ? filteredFields : allFields).map((f) => f.id);\r\n                              const selectedCount = allFields.filter(\r\n                                (field) => sectionConfig.selectedFields?.[field.id] !== false\r\n                              ).length;\r\n                              const totalCount = allFields.length;\r\n                              const showOnlySelected = Boolean(showOnlySelectedBySection[section.id]);\r\n                              const visibleFields = showOnlySelected\r\n                                ? filteredFields.filter((field) => sectionConfig.selectedFields?.[field.id] !== false)\r\n                                : filteredFields;\r\n                              const minValue = sectionMode === \"MIN\" ? sectionMin : null;\r\n                              const minTooHigh = sectionMode === \"MIN\" && minValue > selectedCount;\r\n                              const ruleSummary =\r\n                                sectionMode === \"ALL\"\r\n                                  ? ` Rule: Must complete ALL selected fields (${selectedCount} selected)`\r\n                                  : minTooHigh\r\n                                    ? ` MIN (${minValue}) is greater than selected (${selectedCount}). It will behave like ALL.`\r\n                                    : ` Rule: Must complete AT LEAST ${minValue} of ${selectedCount} selected fields`;\r\n                              const requiredCount = sectionMode === \"MIN\" ? minValue : selectedCount;\r\n\r\n                              return (\r\n                                <div key={section.id} style={{ borderTop: \"1px solid #eef2f7\", paddingTop: 10 }}>\r\n                                  <div className=\"row\" style={{ justifyContent: \"space-between\", alignItems: \"center\" }}>\r\n                                    <div className=\"row\">\r\n                                      <button\r\n                                        type=\"button\"\r\n                                        className=\"btn\"\r\n                                        onClick={() => toggleProgressSection(section.id)}\r\n                                      >\r\n                                        {sectionExpanded ? \"-\" : \"+\"}\r\n                                      </button>\r\n                                      <div style={{ fontWeight: 700 }}>{section.label}</div>\r\n                                      <span className={`status-badge ${sectionEnabled ? \"is-ok\" : \"is-muted\"}`}>\r\n                                        {sectionEnabled ? \"Enabled\" : \"Disabled\"}\r\n                                      </span>\r\n                                      <span className=\"small\">\r\n                                        {selectedCount}/{allFields.length || 0} selected\r\n                                      </span>\r\n                                    </div>\r\n\r\n                                    <div className=\"row\">\r\n                                      <label className=\"small\">\r\n                                        <input\r\n                                          type=\"checkbox\"\r\n                                          checked={showOnlySelected}\r\n                                          onChange={() =>\r\n                                            setShowOnlySelectedBySection((prev) => ({\r\n                                              ...prev,\r\n                                              [section.id]: !prev?.[section.id],\r\n                                            }))\r\n                                          }\r\n                                        />{\" \"}\r\n                                        Show only selected\r\n                                      </label>\r\n                                      <label className=\"small\">\r\n                                        <input\r\n                                          type=\"checkbox\"\r\n                                          checked={sectionEnabled}\r\n                                          onChange={(e) => setProgressSectionEnabled(section.id, e.target.checked)}\r\n                                        />{\" \"}\r\n                                        Enabled\r\n                                      </label>\r\n                                      <select\r\n                                        className=\"input xs\"\r\n                                        value={sectionMode}\r\n                                        onChange={(e) => setProgressSectionMode(section.id, e.target.value)}\r\n                                      >\r\n                                        <option value=\"ALL\">ALL</option>\r\n                                        <option value=\"MIN\">MIN</option>\r\n                                      </select>\r\n                                      {sectionMode === \"MIN\" ? (\r\n                                        <input\r\n                                          className=\"input xs\"\r\n                                          type=\"number\"\r\n                                          min=\"1\"\r\n                                          value={sectionMin}\r\n                                          onChange={(e) => setProgressSectionMin(section.id, e.target.value)}\r\n                                        />\r\n                                      ) : null}\r\n                                      <button\r\n                                        className=\"btn\"\r\n                                        onClick={() => selectAllSectionFields(section.id, fieldIdsForBulk)}\r\n                                        disabled={!fieldIdsForBulk.length}\r\n                                      >\r\n                                        Select all\r\n                                      </button>\r\n                                      <button\r\n                                        className=\"btn\"\r\n                                        onClick={() => unselectAllSectionFields(section.id, fieldIdsForBulk)}\r\n                                        disabled={!fieldIdsForBulk.length}\r\n                                      >\r\n                                        Unselect all\r\n                                      </button>\r\n                                    </div>\r\n                                  </div>\r\n                                  <div className=\"small\" style={{ marginTop: 6 }}>\r\n                                    {ruleSummary}\r\n                                  </div>\r\n                                  <div className=\"small\" style={{ marginTop: 4, color: \"#6b7280\" }}>\r\n                                    Selected: {selectedCount}/{totalCount}  Mode: {sectionMode}  Required: {requiredCount}\r\n                                  </div>\r\n\r\n                                  {sectionExpanded ? (\r\n                                    <div style={{ marginTop: 8 }}>\r\n                                      {!visibleFields.length ? (\r\n                                        <div className=\"small\">No fields available for this section.</div>\r\n                                      ) : (\r\n                                        <div className=\"grid2\" style={{ gap: 8 }}>\r\n                                          {visibleFields.map((field) => {\r\n                                            const checked = sectionConfig.selectedFields?.[field.id] !== false;\r\n                                            const dynamicHint = getDynamicHint(section.id, field);\r\n                                            return (\r\n                                              <label\r\n                                                key={field.id}\r\n                                                className=\"small\"\r\n                                                style={{\r\n                                                  display: \"flex\",\r\n                                                  gap: 8,\r\n                                                  alignItems: \"center\",\r\n                                                  justifyContent: \"space-between\",\r\n                                                  width: \"100%\",\r\n                                                }}\r\n                                              >\r\n                                                <span style={{ display: \"inline-flex\", gap: 8, alignItems: \"center\" }}>\r\n                                                  <input\r\n                                                    type=\"checkbox\"\r\n                                                    checked={checked}\r\n                                                    onChange={(e) =>\r\n                                                      setProgressFieldSelected(section.id, field.id, e.target.checked)\r\n                                                    }\r\n                                                    disabled={!sectionEnabled}\r\n                                                  />\r\n                                                  <span>{field.label || field.id}</span>\r\n                                                </span>\r\n                                                {dynamicHint ? (\r\n                                                  <span\r\n                                                    style={{\r\n                                                      padding: \"2px 8px\",\r\n                                                      borderRadius: 999,\r\n                                                      background: \"#eef2f7\",\r\n                                                      color: \"#374151\",\r\n                                                      fontSize: 11,\r\n                                                      lineHeight: 1.4,\r\n                                                      whiteSpace: \"nowrap\",\r\n                                                    }}\r\n                                                  >\r\n                                                    Dynamic: {dynamicHint}\r\n                                                  </span>\r\n                                                ) : null}\r\n                                              </label>\r\n                                            );\r\n                                          })}\r\n                                        </div>\r\n                                      )}\r\n                                    </div>\r\n                                  ) : null}\r\n                                </div>\r\n                              );\r\n                            })}\r\n                          </div>\r\n                        ) : null}\r\n                      </div>\r\n                    );\r\n                  })}\r\n                </div>\r\n              )}\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n\r\n      {activeTab === \"approvals\" && (\r\n        <div className=\"card\" style={{ marginTop: 12 }}>\r\n          <div className=\"row\" style={{ justifyContent: \"space-between\", alignItems: \"flex-end\" }}>\r\n            <div>\r\n              <div style={{ fontWeight: 700 }}>alma Listeleri</div>\r\n              <div className=\"small\">Review submitted scenarios and approve for rollups.</div>\r\n            </div>\r\n            <div className=\"row admin-filter-row\">\r\n              <select\r\n                className=\"input sm\"\r\n                value={queueFilters.status}\r\n                onChange={(e) => setQueueFilters((prev) => ({ ...prev, status: e.target.value }))}\r\n              >\r\n                <option value=\"\">All</option>\r\n                <option value=\"sent_for_approval\">Sent for approval</option>\r\n                <option value=\"approved\">Approved</option>\r\n                <option value=\"revision_requested\">Revision requested</option>\r\n                <option value=\"draft\">Draft</option>\r\n              </select>\r\n              <input\r\n                className=\"input sm\"\r\n                placeholder=\"Academic year\"\r\n                value={queueFilters.academicYear}\r\n                onChange={(e) => setQueueFilters((prev) => ({ ...prev, academicYear: e.target.value }))}\r\n              />\r\n              <select\r\n                className=\"input sm\"\r\n                value={queueFilters.region}\r\n                onChange={(e) => setQueueFilters((prev) => ({ ...prev, region: e.target.value, countryId: \"\" }))}\r\n              >\r\n                <option value=\"\">All regions</option>\r\n                {regionOptions.map((r) => (\r\n                  <option key={r} value={r}>\r\n                    {r}\r\n                  </option>\r\n                ))}\r\n              </select>\r\n              <select\r\n                className=\"input sm\"\r\n                value={queueFilters.countryId}\r\n                onChange={(e) => setQueueFilters((prev) => ({ ...prev, countryId: e.target.value }))}\r\n              >\r\n                <option value=\"\">All countries</option>\r\n                {queueCountryOptions.map((c) => (\r\n                  <option key={c.id} value={c.id}>\r\n                    {c.name}\r\n                  </option>\r\n                ))}\r\n              </select>\r\n\r\n              {/*  don't pass click event */}\r\n              <button className=\"btn\" onClick={() => loadQueue(queueFilters)} disabled={queueLoading}>\r\n                Apply\r\n              </button>\r\n            </div>\r\n          </div>\r\n\r\n          <table className=\"table admin-approvals-table\" style={{ marginTop: 12 }}>\r\n            <thead>\r\n              <tr>\r\n                <th aria-sort={ariaSort(\"country_name\")}>\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={() => toggleQueueSort(\"country_name\")}\r\n                    style={{\r\n                      display: \"inline-flex\",\r\n                      alignItems: \"center\",\r\n                      gap: 6,\r\n                      background: \"none\",\r\n                      border: \"none\",\r\n                      padding: 0,\r\n                      cursor: \"pointer\",\r\n                      font: \"inherit\",\r\n                    }}\r\n                    title=\"Sort\"\r\n                  >\r\n                    lke <span aria-hidden>{sortIndicator(\"country_name\")}</span>\r\n                  </button>\r\n                </th>\r\n                <th aria-sort={ariaSort(\"school_name\")}>\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={() => toggleQueueSort(\"school_name\")}\r\n                    style={{\r\n                      display: \"inline-flex\",\r\n                      alignItems: \"center\",\r\n                      gap: 6,\r\n                      background: \"none\",\r\n                      border: \"none\",\r\n                      padding: 0,\r\n                      cursor: \"pointer\",\r\n                      font: \"inherit\",\r\n                    }}\r\n                    title=\"Sort\"\r\n                  >\r\n                    School <span aria-hidden>{sortIndicator(\"school_name\")}</span>\r\n                  </button>\r\n                </th>\r\n                <th aria-sort={ariaSort(\"scenario_name\")}>\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={() => toggleQueueSort(\"scenario_name\")}\r\n                    style={{\r\n                      display: \"inline-flex\",\r\n                      alignItems: \"center\",\r\n                      gap: 6,\r\n                      background: \"none\",\r\n                      border: \"none\",\r\n                      padding: 0,\r\n                      cursor: \"pointer\",\r\n                      font: \"inherit\",\r\n                    }}\r\n                    title=\"Sort\"\r\n                  >\r\n                    Scenario <span aria-hidden>{sortIndicator(\"scenario_name\")}</span>\r\n                  </button>\r\n                </th>\r\n                <th aria-sort={ariaSort(\"academic_year\")}>\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={() => toggleQueueSort(\"academic_year\")}\r\n                    style={{\r\n                      display: \"inline-flex\",\r\n                      alignItems: \"center\",\r\n                      gap: 6,\r\n                      background: \"none\",\r\n                      border: \"none\",\r\n                      padding: 0,\r\n                      cursor: \"pointer\",\r\n                      font: \"inherit\",\r\n                    }}\r\n                    title=\"Sort\"\r\n                  >\r\n                    Academic Year <span aria-hidden>{sortIndicator(\"academic_year\")}</span>\r\n                  </button>\r\n                </th>\r\n                <th aria-sort={ariaSort(\"submitted_at\")}>\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={() => toggleQueueSort(\"submitted_at\")}\r\n                    style={{\r\n                      display: \"inline-flex\",\r\n                      alignItems: \"center\",\r\n                      gap: 6,\r\n                      background: \"none\",\r\n                      border: \"none\",\r\n                      padding: 0,\r\n                      cursor: \"pointer\",\r\n                      font: \"inherit\",\r\n                    }}\r\n                    title=\"Sort\"\r\n                  >\r\n                    Submitted <span aria-hidden>{sortIndicator(\"submitted_at\")}</span>\r\n                  </button>\r\n                </th>\r\n                <th aria-sort={ariaSort(\"status\")}>\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={() => toggleQueueSort(\"status\")}\r\n                    style={{\r\n                      display: \"inline-flex\",\r\n                      alignItems: \"center\",\r\n                      gap: 6,\r\n                      background: \"none\",\r\n                      border: \"none\",\r\n                      padding: 0,\r\n                      cursor: \"pointer\",\r\n                      font: \"inherit\",\r\n                    }}\r\n                    title=\"Sort\"\r\n                  >\r\n                    Status <span aria-hidden>{sortIndicator(\"status\")}</span>\r\n                  </button>\r\n                </th>\r\n                <th>Progress</th>\r\n                <th>Y1 KPIs</th>\r\n                <th>Y2 KPIs</th>\r\n                <th>Y3 KPIs</th>\r\n                <th>Actions</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              {queueLoading ? (\r\n                <tr>\r\n                  <td colSpan=\"11\" className=\"small\">\r\n                    Loading...\r\n                  </td>\r\n                </tr>\r\n              ) : sortedQueueRows.length === 0 ? (\r\n                <tr>\r\n                  <td colSpan=\"11\" className=\"small\">\r\n                    No scenarios found.\r\n                  </td>\r\n                </tr>\r\n              ) : (\r\n                sortedQueueRows.map((row) => {\r\n                  const statusMeta = getStatusMeta(row.scenario);\r\n                  const canApprove =\r\n                    row.scenario?.status === 'sent_for_approval' || row.scenario?.status === 'submitted';\r\n                  const canRevise = ['sent_for_approval', 'approved', 'submitted'].includes(row.scenario?.status);\r\n                  const missing = row.missingKpis?.y1 || row.missingKpis?.y2 || row.missingKpis?.y3;\r\n                  const progressPct = Number.isFinite(Number(row.scenario?.progress_pct))\r\n                    ? Math.round(Number(row.scenario.progress_pct))\r\n                    : null;\r\n                  const progressLines = row.scenario?.progress_json?.missingDetailsLines;\r\n                  const progressTooltipLines =\r\n                    progressPct == null\r\n                      ? []\r\n                      : Array.isArray(progressLines) && progressLines.length\r\n                        ? [\"Eksik:\", ...progressLines]\r\n                        : [\"Tum tablar tamamlandi\"];\r\n\r\n                  return (\r\n                    <tr key={row.scenario?.id || `${row.school?.id}-${row.scenario?.name}`}>\r\n                      <td>\r\n                        <div style={{ fontWeight: 700 }}>{row.country?.name || \"-\"}</div>\r\n                        {row.country?.region ? <div className=\"small\">{row.country.region}</div> : null}\r\n                      </td>\r\n                      <td>\r\n                        <div style={{ fontWeight: 700 }}>{row.school?.name || \"-\"}</div>\r\n                      </td>\r\n                      <td>\r\n                        <div>{row.scenario?.name || \"-\"}</div>\r\n                        {missing ? <span className=\"status-badge is-bad\">Missing KPIs</span> : null}\r\n                      </td>\r\n                      <td className=\"small\">{row.scenario?.academic_year || \"-\"}</td>\r\n                      <td className=\"small\">{formatDateTime(row.scenario?.submitted_at)}</td>\r\n                      <td>\r\n                        <span className={`status-badge ${statusMeta.className}`}>{statusMeta.label}</span>\r\n                      </td>\r\n                      <td>\r\n                        {progressPct == null ? (\r\n                          <span className=\"small\">-</span>\r\n                        ) : (\r\n                          <Tooltip lines={progressTooltipLines}>\r\n                            <span className=\"badge\">{progressPct}%</span>\r\n                          </Tooltip>\r\n                        )}\r\n                      </td>\r\n                      <td>{renderQueueKpis(row.kpis?.y1)}</td>\r\n                      <td>{renderQueueKpis(row.kpis?.y2)}</td>\r\n                      <td>{renderQueueKpis(row.kpis?.y3)}</td>\r\n                      <td>\r\n                        <div className=\"row\">\r\n                          <button\r\n                            className=\"btn primary\"\r\n                            onClick={() => openReviewModal(row, \"approve\")}\r\n                            disabled={!canApprove || reviewSaving}\r\n                          >\r\n                            Onayla\r\n                          </button>\r\n                          <button\r\n                            className=\"btn\"\r\n                            onClick={() => openReviewModal(row, \"revise\")}\r\n                            disabled={!canRevise || reviewSaving}\r\n                          >\r\n                            Revizyon ste\r\n                          </button>\r\n                        </div>\r\n                      </td>\r\n                    </tr>\r\n                  );\r\n                })\r\n              )}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n      )}\r\n\r\n      {activeTab === \"reports\" && (\r\n        <div style={{ marginTop: 12 }}>\r\n          <div className=\"card\">\r\n            <div className=\"row\" style={{ justifyContent: \"space-between\" }}>\r\n              <div>\r\n                <div style={{ fontWeight: 700 }}>Rollup Reports</div>\r\n                <div className=\"small\">Approved scenarios only. Select an academic year.</div>\r\n              </div>\r\n              <div className=\"row\">\r\n                <input\r\n                  className=\"input sm\"\r\n                  placeholder=\"Academic year\"\r\n                  value={rollupYear}\r\n                  onChange={(e) => setRollupYear(e.target.value)}\r\n                />\r\n                <button className=\"btn\" onClick={() => loadRollup(rollupYear)} disabled={rollupLoading}>\r\n                  {rollupLoading ? \"Loading...\" : \"Load\"}\r\n                </button>\r\n\r\n                <div className=\"action-menu\" ref={rollupExportRef}>\r\n                  <button\r\n                    type=\"button\"\r\n                    className=\"btn\"\r\n                    onClick={() => {\r\n                      if (rollupExportDisabled) return;\r\n                      setRollupExportOpen((prev) => !prev);\r\n                    }}\r\n                    disabled={rollupExportDisabled}\r\n                    aria-haspopup=\"menu\"\r\n                    aria-expanded={rollupExportOpen}\r\n                  >\r\n                    Export\r\n                  </button>\r\n                  {rollupExportOpen ? (\r\n                    <div className=\"action-menu-panel\" role=\"menu\">\r\n                      <button\r\n                        type=\"button\"\r\n                        className=\"action-menu-item\"\r\n                        onClick={() => {\r\n                          setRollupExportOpen(false);\r\n                          if (!rollupXlsxReady) return;\r\n                          const url = api.adminExportRollupXlsxUrl(rollupYear.trim());\r\n                          window.location.assign(url);\r\n                        }}\r\n                        disabled={!rollupXlsxReady}\r\n                        title={rollupXlsxReady ? \"Download Excel\" : \"Excel export coming soon\"}\r\n                        role=\"menuitem\"\r\n                      >\r\n                        Excel (.xlsx){rollupXlsxReady ? \"\" : \" (coming soon)\"}\r\n                      </button>\r\n                      <button type=\"button\" className=\"action-menu-item\" disabled role=\"menuitem\">\r\n                        PDF (coming soon)\r\n                      </button>\r\n                    </div>\r\n                  ) : null}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {rollupData ? (\r\n            <>\r\n              <div className=\"card\" style={{ marginTop: 12 }}>\r\n                <div style={{ fontWeight: 700 }}>Consolidated KPIs</div>\r\n                <div className=\"admin-kpi-strip\" style={{ marginTop: 10 }}>\r\n                  {YEAR_KEYS.map((key) => (\r\n                    <div key={key} className=\"admin-kpi-year\">\r\n                      <div className=\"admin-kpi-year-title\">{key.toUpperCase()}</div>\r\n                      <div className=\"admin-kpi-grid\">\r\n                        <div className=\"admin-kpi\">\r\n                          <div className=\"admin-kpi-label\">Net ciro</div>\r\n                          <div className=\"admin-kpi-value\">{fmt(rollupData.totals?.[key]?.net_ciro)}</div>\r\n                        </div>\r\n                        <div className=\"admin-kpi\">\r\n                          <div className=\"admin-kpi-label\">Net income</div>\r\n                          <div className=\"admin-kpi-value\">{fmt(rollupData.totals?.[key]?.net_income)}</div>\r\n                        </div>\r\n                        <div className=\"admin-kpi\">\r\n                          <div className=\"admin-kpi-label\">Expenses</div>\r\n                          <div className=\"admin-kpi-value\">{fmt(rollupData.totals?.[key]?.total_expenses)}</div>\r\n                        </div>\r\n                        <div className=\"admin-kpi\">\r\n                          <div className=\"admin-kpi-label\">Net result</div>\r\n                          <div className=\"admin-kpi-value\">{fmt(rollupData.totals?.[key]?.net_result)}</div>\r\n                        </div>\r\n                        <div className=\"admin-kpi\">\r\n                          <div className=\"admin-kpi-label\">Margin</div>\r\n                          <div className=\"admin-kpi-value\">{fmtPct(rollupData.totals?.[key]?.profitMargin)}</div>\r\n                        </div>\r\n                        <div className=\"admin-kpi\">\r\n                          <div className=\"admin-kpi-label\">Students</div>\r\n                          <div className=\"admin-kpi-value\">{fmt(rollupData.totals?.[key]?.students_total)}</div>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"card\" style={{ marginTop: 12 }}>\r\n                <div style={{ fontWeight: 700 }}>Rollup Tree</div>\r\n                <div className=\"small\" style={{ marginTop: 4 }}>\r\n                  Only approved scenarios are consolidated. Excluded years show as blank.\r\n                </div>\r\n\r\n                <div className=\"rollup-table-wrap\" style={{ marginTop: 10 }}>\r\n                  <table className=\"table rollup-table\">\r\n                    <thead>\r\n                      <tr>\r\n                        <th style={{ minWidth: 220 }}>Unit</th>\r\n                        <th style={{ minWidth: 220 }}>Y1</th>\r\n                        <th style={{ minWidth: 220 }}>Y2</th>\r\n                        <th style={{ minWidth: 220 }}>Y3</th>\r\n                      </tr>\r\n                    </thead>\r\n                    <tbody>\r\n                      <tr className=\"rollup-row rollup-total\">\r\n                        <td className=\"rollup-name\">Totals</td>\r\n                        <td>{renderYearCell(rollupData.totals?.y1)}</td>\r\n                        <td>{renderYearCell(rollupData.totals?.y2)}</td>\r\n                        <td>{renderYearCell(rollupData.totals?.y3)}</td>\r\n                      </tr>\r\n\r\n                      {rollupData.regions?.map((region) => {\r\n                        const regionKey = region.region || \"Unknown\";\r\n                        const regionExpanded = expandedRegions.has(regionKey);\r\n                        return (\r\n                          <React.Fragment key={`region-${regionKey}`}>\r\n                            <tr className=\"rollup-row rollup-region\">\r\n                              <td className=\"rollup-name\">\r\n                                <button\r\n                                  type=\"button\"\r\n                                  className=\"tree-toggle\"\r\n                                  onClick={() => toggleRegion(regionKey)}\r\n                                  aria-label=\"Toggle region\"\r\n                                >\r\n                                  {regionExpanded ? \"-\" : \"+\"}\r\n                                </button>\r\n                                <span className=\"rollup-title\">{region.region || \"Unknown region\"}</span>\r\n                              </td>\r\n                              <td>{renderYearCell(region.years?.y1)}</td>\r\n                              <td>{renderYearCell(region.years?.y2)}</td>\r\n                              <td>{renderYearCell(region.years?.y3)}</td>\r\n                            </tr>\r\n\r\n                            {regionExpanded\r\n                              ? region.countries?.map((country) => {\r\n                                const countryKey = `${regionKey}::${country.id}`;\r\n                                const countryExpanded = expandedCountries.has(countryKey);\r\n                                return (\r\n                                  <React.Fragment key={countryKey}>\r\n                                    <tr className=\"rollup-row rollup-country\">\r\n                                      <td className=\"rollup-name level-1\">\r\n                                        <button\r\n                                          type=\"button\"\r\n                                          className=\"tree-toggle\"\r\n                                          onClick={() => toggleCountry(regionKey, country.id)}\r\n                                          aria-label=\"Toggle country\"\r\n                                        >\r\n                                          {countryExpanded ? \"-\" : \"+\"}\r\n                                        </button>\r\n                                        <span className=\"rollup-title\">{country.name}</span>\r\n                                      </td>\r\n                                      <td>{renderYearCell(country.years?.y1)}</td>\r\n                                      <td>{renderYearCell(country.years?.y2)}</td>\r\n                                      <td>{renderYearCell(country.years?.y3)}</td>\r\n                                    </tr>\r\n\r\n                                    {countryExpanded\r\n                                      ? country.schools?.map((school) => (\r\n                                        <tr key={`school-${school.id}`} className=\"rollup-row rollup-school\">\r\n                                          <td className=\"rollup-name level-2\">\r\n                                            {school.name}\r\n                                            {school.included_years?.length ? (\r\n                                              <span className=\"rollup-sub\">({school.included_years.join(\", \")})</span>\r\n                                            ) : null}\r\n                                          </td>\r\n                                          <td>{renderYearCell(school.years?.y1)}</td>\r\n                                          <td>{renderYearCell(school.years?.y2)}</td>\r\n                                          <td>{renderYearCell(school.years?.y3)}</td>\r\n                                        </tr>\r\n                                      ))\r\n                                      : null}\r\n                                  </React.Fragment>\r\n                                );\r\n                              })\r\n                              : null}\r\n                          </React.Fragment>\r\n                        );\r\n                      })}\r\n                    </tbody>\r\n                  </table>\r\n                </div>\r\n              </div>\r\n\r\n              {rollupData.missingNoApproved?.length ? (\r\n                <div className=\"card admin-alert\" style={{ marginTop: 12 }}>\r\n                  <div className=\"admin-alert-title\">Schools without an approved scenario</div>\r\n                  <ul>\r\n                    {rollupData.missingNoApproved.map((row) => (\r\n                      <li key={`missing-${row.id}`}>\r\n                        {row.name} ({row.country_name})\r\n                      </li>\r\n                    ))}\r\n                  </ul>\r\n                </div>\r\n              ) : null}\r\n\r\n              {rollupData.missingKpis?.length ? (\r\n                <div className=\"card admin-alert\" style={{ marginTop: 12 }}>\r\n                  <div className=\"admin-alert-title\">Approved scenarios missing KPI snapshots</div>\r\n                  <ul>\r\n                    {rollupData.missingKpis.map((row) => (\r\n                      <li key={`missing-kpi-${row.scenario_id}`}>\r\n                        Scenario #{row.scenario_id} (School #{row.school_id}) - missing {row.missingYears.join(\", \")}\r\n                      </li>\r\n                    ))}\r\n                  </ul>\r\n                </div>\r\n              ) : null}\r\n            </>\r\n          ) : (\r\n            <div className=\"card\" style={{ marginTop: 12 }}>\r\n              <div className=\"small\">Select an academic year to view the rollup report.</div>\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n    </div>\r\n    </>\r\n  );\r\n}\r\n"],"names":["YEAR_KEYS","REQUIRED_WORK_IDS","WORK_ID_LABELS","temel_bilgiler","kapasite","DEFAULT_ADMIN_TAB","_ADMIN_TABS$","ADMIN_TABS","key","isValidAdminTab","value","some","tab","getTabFromSearch","search","URLSearchParams","get","fmt","v","n","Number","isFinite","toLocaleString","undefined","maximumFractionDigits","fmtPct","formatDateTime","d","Date","getTime","SAMPLE_DISCOUNTS","normalizeProgressConfig","config","defaults","DEFAULT_PROGRESS_CONFIG","input","sectionsInput","sections","out","version","Object","keys","forEach","id","base","incoming","enabled","mode","min","selectedFields","AdminPage","_auth$user2","_auth$user4","_reviewModal$row2","_reviewModal$row2$sch","_reviewModal$row3","_reviewModal$row3$sce","_rollupData$totals7","_rollupData$totals8","_rollupData$totals9","_rollupData$regions","_rollupData$missingNo","_rollupData$missingKp","forcedTab","arguments","length","auth","useAuth","outlet","useOutletContext","location","useLocation","normalizedForcedTab","activeTab","setActiveTab","useState","fromSearch","stored","localStorage","getItem","_","useEffect","setItem","countries","setCountries","users","setUsers","loading","setLoading","userUpdateLoading","setUserUpdateLoading","confirmAssign","setConfirmAssign","confirmDelete","setConfirmDelete","confirmReset","setConfirmReset","resetResult","setResetResult","resetLoadingId","setResetLoadingId","countryName","setCountryName","countryCode","setCountryCode","countryRegion","setCountryRegion","newUserName","setNewUserName","newUserEmail","setNewUserEmail","newUserPassword","setNewUserPassword","newUserRole","setNewUserRole","newUserCountryId","setNewUserCountryId","assignUserId","setAssignUserId","assignCountryId","setAssignCountryId","showUnassigned","setShowUnassigned","schoolsCountryId","setSchoolsCountryId","countrySchools","setCountrySchools","countrySchoolsLoading","setCountrySchoolsLoading","schoolsSearch","setSchoolsSearch","newSchoolName","setNewSchoolName","schoolCreateLoading","setSchoolCreateLoading","schoolSavingId","setSchoolSavingId","schoolNameDrafts","setSchoolNameDrafts","progressCountryId","setProgressCountryId","progressConfig","setProgressConfig","progressLoading","setProgressLoading","progressSaving","setProgressSaving","progressSearch","setProgressSearch","progressTargetIds","setProgressTargetIds","Set","progressCountryListSearch","setProgressCountryListSearch","progressBulkSaving","setProgressBulkSaving","showOnlySelectedBySection","setShowOnlySelectedBySection","expandedProgressTabs","setExpandedProgressTabs","expandedProgressSections","setExpandedProgressSections","queueRows","setQueueRows","permissionsCatalog","setPermissionsCatalog","permissionSelections","setPermissionSelections","permissionScopes","setPermissionScopes","permissionsLoading","setPermissionsLoading","permissionsSaving","setPermissionsSaving","userSchools","setUserSchools","roleOptions","useMemo","label","roleUpdating","setRoleUpdating","principalLists","setPrincipalLists","principalDrafts","setPrincipalDrafts","principalSaving","setPrincipalSaving","queueLoading","setQueueLoading","queueFilters","setQueueFilters","status","academicYear","region","countryId","queueSort","setQueueSort","dir","reviewModal","setReviewModal","reviewNote","setReviewNote","reviewIncludedYears","setReviewIncludedYears","y1","y2","y3","reviewRevisionSelection","setReviewRevisionSelection","initial","selectAllRevisionWork","useCallback","next","clearRevisionWork","reviewSaving","setReviewSaving","rollupYear","setRollupYear","rollupData","setRollupData","rollupLoading","setRollupLoading","rollupExportOpen","setRollupExportOpen","rollupExportRef","useRef","expandedRegions","setExpandedRegions","expandedCountries","setExpandedCountries","document","title","setHeaderMeta","subtitle","_outlet$clearHeaderMe","clearHeaderMeta","call","queueFiltersRef","current","selectedUser","find","u","String","selectedCountry","c","selectedSchoolsCountry","Array","isArray","school","list","api","adminGetSchoolPrincipals","prev","_objectSpread","ids","map","e","console","error","userId","country_id","Promise","all","adminGetPermissionsCatalog","adminGetUserPermissions","adminListCountrySchools","resolve","then","_ref","catalogData","userPerms","schoolsData","schoolsList","items","sel","scopeMap","p","concat","resource","action","scope_school_id","catch","toast","message","finally","progressCatalogInputs","discounts","name","ratio","progressCatalog","buildProgressCatalog","inputs","norm","progressConfigNormalized","isSameCountry","currentAssignmentLabel","country_name","country_code","newAssignmentLabel","code","actionLabel","filteredUsers","filter","regionOptions","set","add","from","sort","permissionsGrouped","reduce","acc","perm","grp","group","push","queueCountryOptions","toggleQueueSort","cycles","academic_year","school_name","scenario_name","submitted_at","cycle","i","indexOf","sortIndicator","ariaSort","sortedQueueRows","getValue","row","_row$country","_row$school","_row$scenario","_row$scenario2","_row$scenario3","_row$scenario4","country","scenario","raw","trim","nums","match","a","b","toLowerCase","parseAcademicYear","Infinity","dirMul","cmpStr","localeCompare","sensitivity","decorated","idx","val","A","B","av","bv","_av$a","_bv$a","_av$b","_bv$b","progressSearchValue","filteredCountriesForApply","q","includes","progressTargetCount","size","progressBulkDisabled","filteredCountrySchools","s","load","async","countriesRows","userData","listCountries","listUsers","limit","offset","fields","order","loadCountrySchools","countryIdArg","rows","includeClosed","loadProgressRequirements","data","adminGetProgressRequirements","loadQueue","f","filtersArg","params","adminGetScenarioQueue","loadRollup","academicYearArg","adminGetRollup","adminResetUserPassword","token","k","_window","_window$localStorage","window","_unused","getAuthTokenFromStorage","res","fetch","method","headers","Authorization","body","JSON","stringify","json","_unused2","ok","_data","_data2","msg","details","Error","_auth$user","user","role","_auth$user3","handleClick","event","el","contains","target","handleKey","addEventListener","removeEventListener","regions","regionSet","countrySet","updateProgressSection","sectionId","updater","_next$sections","structuredClone","section","openReviewModal","closeReviewModal","reset","renderQueueKpis","kpi","_jsx","className","children","margin","net_ciro","net_result","_jsxs","renderYearCell","year","net_income","total_expenses","profitMargin","students_total","handleRefresh","style","fontWeight","marginTop","Link","to","rollupExportDisabled","refreshDisabled","renderRefreshButton","onClick","disabled","_Fragment","headerPortalEl","createPortal","justifyContent","fontSize","ToastContainer","position","autoClose","newestOnTop","closeOnClick","pauseOnFocusLoss","pauseOnHover","width","padding","textAlign","height","borderRadius","border","borderTopColor","animation","marginBottom","email","currentLabel","nextLabel","assignUserCountry","nextId","success","hadCountry","confirmAssignCountry","deleteUser","confirmDeleteUser","Boolean","full_name","temporary_password","confirmResetPassword","maxWidth","background","alignItems","fontFamily","text","navigator","clipboard","writeText","_unused3","ta","createElement","left","appendChild","select","execCommand","removeChild","_unused4","copyText","display","gap","type","checked","onChange","toUpperCase","flexWrap","minHeight","_reviewModal$row","_reviewModal$row$scen","note","payload","includedYears","revisionWorkIds","adminReviewScenario","gridTemplateColumns","placeholder","fullName","password","createUser","color","marginRight","adminUpdateUserRole","updateSelectedUserRole","opt","entries","_ref2","groupName","perms","isSelected","scopeValue","flexGrow","togglePermission","changePermissionScope","split","scopeVal","scope_country_id","startsWith","idStr","sid","adminSetUserPermissions","permissions","updated","colSpan","must_reset_password","resetPasswordForUser","createCountry","adminCreateCountrySchool","_ref3","_schoolNameDrafts$sch","statusMeta","draftName","isSaving","created_at","closed_at","join","draft","nextName","adminUpdateSchool","saveSchoolName","nextStatus","toggleSchoolStatus","multiple","values","selectedOptions","o","schoolId","valueIds","handlePrincipalSelectionChange","userIds","adminSetSchoolPrincipals","newList","savePrincipalAssignments","saved","adminSaveProgressRequirements","selectAllTargets","clearTargets","uniqueIds","confirm","result","adminBulkSaveProgressRequirements","updatedCount","maxHeight","overflowY","has","delete","toggleTargetCountry","tabs","tabSections","tabKey","visibleSections","sectionMatch","fieldMatch","fieldsById","tabExpanded","toggleProgressTab","_progressConfigNormal","sectionConfig","sectionEnabled","sectionMode","modeDefault","sectionMin","minDefault","allFields","filteredFields","field","sectionExpanded","fieldIdsForBulk","selectedCount","_sectionConfig$select","totalCount","showOnlySelected","visibleFields","_sectionConfig$select2","minValue","minTooHigh","ruleSummary","requiredCount","borderTop","paddingTop","toggleProgressSection","setProgressSectionEnabled","setProgressSectionMode","setProgressSectionMin","num","Math","max","selectAllSectionFields","fieldIds","unselectAllSectionFields","_sectionConfig$select3","dynamicHint","getDynamicHint","setProgressFieldSelected","fieldId","lineHeight","whiteSpace","r","cursor","font","_row$scenario5","_row$scenario6","_row$scenario7","_row$missingKpis","_row$missingKpis2","_row$missingKpis3","_row$scenario8","_row$scenario9","_row$scenario9$progre","_row$scenario0","_row$school2","_row$scenario1","_row$country2","_row$country3","_row$school3","_row$scenario10","_row$scenario11","_row$scenario12","_row$kpis","_row$kpis2","_row$kpis3","scenarioOrStatus","obj","sentAt","sent_at","getStatusMeta","canApprove","canRevise","missing","missingKpis","progressPct","progress_pct","round","progressLines","progress_json","missingDetailsLines","progressTooltipLines","Tooltip","lines","kpis","ref","_rollupData$totals","_rollupData$totals$ke","_rollupData$totals2","_rollupData$totals2$k","_rollupData$totals3","_rollupData$totals3$k","_rollupData$totals4","_rollupData$totals4$k","_rollupData$totals5","_rollupData$totals5$k","_rollupData$totals6","_rollupData$totals6$k","totals","minWidth","_region$years","_region$years2","_region$years3","_region$countries","regionKey","regionExpanded","React","toggleRegion","years","_country$years","_country$years2","_country$years3","_country$schools","countryKey","countryExpanded","toggleCountry","schools","_school$included_year","_school$years","_school$years2","_school$years3","included_years","missingNoApproved","scenario_id","school_id","missingYears"],"ignoreList":[],"sourceRoot":""}