{"version":3,"file":"static/js/693.20581853.chunk.js","mappings":"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","sources":["hooks/useScenarioUIState.js","utils/scenarioProgress.js","pages/SchoolPage.jsx","utils/programType.js"],"sourcesContent":["import { useEffect, useMemo, useRef, useState } from \"react\";\r\nimport { useLocation } from \"react-router-dom\";\r\n\r\n// Per school + per scenario persistence.\r\n// We scope by current URL (pathname + search). In your app, this URL already contains\r\n// schoolId and scenarioId (either in params or querystring), so each school/scenario\r\n// gets its own remembered UI state.\r\n\r\nconst DEFAULT_PREFIX = \"fizizbilite\";\r\n\r\nfunction safeRead(key, fallback) {\r\n  try {\r\n    const raw = window.localStorage.getItem(key);\r\n    if (raw == null) return fallback;\r\n    return JSON.parse(raw);\r\n  } catch {\r\n    return fallback;\r\n  }\r\n}\r\n\r\nfunction safeWrite(key, value) {\r\n  try {\r\n    window.localStorage.setItem(key, JSON.stringify(value));\r\n  } catch {\r\n    // ignore quota / privacy mode errors\r\n  }\r\n}\r\n\r\nexport function useScenarioScopeKey(prefix = DEFAULT_PREFIX, scopeOverride) {\r\n  const loc = useLocation();\r\n  return useMemo(() => {\r\n    const override = typeof scopeOverride === \"string\" ? scopeOverride.trim() : \"\";\r\n    const scope = override || (loc.pathname + (loc.search || \"\"));\r\n    return prefix + \":\" + scope;\r\n  }, [prefix, scopeOverride, loc.pathname, loc.search]);\r\n}\r\n\r\n/**\r\n * Generic persisted state hook (localStorage), scoped by current scenario URL.\r\n *\r\n * NOTE: We intentionally avoid writing to a *new* scope key until we've loaded that\r\n * key's stored value. This prevents \"old state\" from being written into a newly\r\n * navigated scenario.\r\n */\r\nexport function useScenarioUiState(name, defaultValue, { prefix = DEFAULT_PREFIX, scope } = {}) {\r\n  const scopeKey = useScenarioScopeKey(prefix, scope);\r\n  const storageKey = useMemo(() => `${scopeKey}:ui:${name}`, [scopeKey, name]);\r\n\r\n  const loadedKeyRef = useRef(null);\r\n\r\n  const [state, setState] = useState(() => safeRead(storageKey, defaultValue));\r\n\r\n  // Load when the scope (school/scenario) changes\r\n  useEffect(() => {\r\n    loadedKeyRef.current = storageKey;\r\n    setState(safeRead(storageKey, defaultValue));\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [storageKey]);\r\n\r\n  // Persist changes (only after we loaded for this key)\r\n  useEffect(() => {\r\n    if (loadedKeyRef.current !== storageKey) return;\r\n    safeWrite(storageKey, state);\r\n  }, [storageKey, state]);\r\n\r\n  return [state, setState, storageKey];\r\n}\r\n\r\nexport function useScenarioUiFlag(name, defaultValue = false, opts) {\r\n  const [v, setV] = useScenarioUiState(name, !!defaultValue, opts);\r\n  const setFlag = (next) => setV(!!(typeof next === \"function\" ? next(v) : next));\r\n  return [!!v, setFlag];\r\n}\r\n\r\nexport function useScenarioUiString(name, defaultValue = \"\", opts) {\r\n  const [v, setV] = useScenarioUiState(name, String(defaultValue ?? \"\"), opts);\r\n  const setStr = (next) => setV(String(typeof next === \"function\" ? next(v) : next));\r\n  return [String(v ?? \"\"), setStr];\r\n}\r\n\r\nexport function useScenarioUiNumber(name, defaultValue = 0, opts) {\r\n  const [v, setV] = useScenarioUiState(name, Number(defaultValue ?? 0), opts);\r\n  const setNum = (next) => {\r\n    const raw = typeof next === \"function\" ? next(v) : next;\r\n    const n = Number(raw);\r\n    setV(Number.isFinite(n) ? n : 0);\r\n  };\r\n  return [Number(v ?? 0), setNum];\r\n}\r\n","import {\n  DEFAULT_PROGRESS_CONFIG,\n  buildProgressCatalog,\n  isNonEmptyString,\n  safeGet,\n  toNum,\n} from \"./progressCatalog\";\n\nfunction isFilled(value, type) {\n  if (type === \"string\") return isNonEmptyString(value);\n  // For boolean fields we accept both true/false as \"filled\".\n  // Only null/undefined should be treated as missing.\n  if (type === \"boolean\") return typeof value === \"boolean\";\n  const n = toNum(value);\n  return n > 0;\n}\n\nfunction normalizeConfig(config) {\n  const defaults = DEFAULT_PROGRESS_CONFIG();\n  const input = config && typeof config === \"object\" ? config : {};\n  const sectionsInput = input.sections && typeof input.sections === \"object\" ? input.sections : {};\n  const out = { version: defaults.version, sections: {} };\n\n  Object.keys(defaults.sections).forEach((id) => {\n    const base = defaults.sections[id] || {};\n    const incoming = sectionsInput[id] && typeof sectionsInput[id] === \"object\" ? sectionsInput[id] : {};\n    out.sections[id] = {\n      enabled: typeof incoming.enabled === \"boolean\" ? incoming.enabled : base.enabled !== false,\n      mode: typeof incoming.mode === \"string\" && incoming.mode ? incoming.mode : base.mode,\n      min: incoming.min != null ? Number(incoming.min) : base.min,\n      selectedFields:\n        incoming.selectedFields && typeof incoming.selectedFields === \"object\" ? incoming.selectedFields : {},\n    };\n  });\n\n  return out;\n}\n\nexport function computeScenarioProgress({ inputs, norm, config, scenario } = {}) {\n  const catalog = buildProgressCatalog({ inputs, norm, scenario });\n  const normalizedConfig = normalizeConfig(config);\n\n  const sectionsById = new Map(catalog.sections.map((s) => [s.id, s]));\n  const sectionResults = new Map();\n  let totalUnits = 0;\n  let doneUnits = 0;\n\n  catalog.sections.forEach((section) => {\n    const cfg = normalizedConfig.sections[section.id] || {};\n    if (cfg.enabled === false) {\n      sectionResults.set(section.id, { enabled: false });\n      return;\n    }\n\n    const requiresKademe = section.requiresKademe === true;\n    const hasKademeSelection = catalog.context?.hasKademeSelection;\n    if (requiresKademe && !hasKademeSelection) {\n      sectionResults.set(section.id, {\n        enabled: true,\n        done: false,\n        doneUnits: 0,\n        totalUnits: 1,\n        missingReasons: [\"Kademeler secilmedi\"],\n      });\n      totalUnits += 1;\n      return;\n    }\n\n    const fieldIds = Array.isArray(section.fields) ? section.fields : [];\n    const selectedIds = fieldIds.filter((id) => cfg.selectedFields?.[id] !== false);\n    const applicable = selectedIds\n      .map((id) => catalog.fieldsById[id])\n      .filter(Boolean)\n      .filter((field) => {\n        if (typeof field.appliesIf !== \"function\") return true;\n        try {\n          return field.appliesIf(inputs, norm, scenario) !== false;\n        } catch (_) {\n          return true;\n        }\n      });\n\n    const filled = [];\n    const missing = [];\n\n    applicable.forEach((field) => {\n      let value = null;\n      try {\n        value = field.getValue ? field.getValue(inputs, norm) : null;\n      } catch (_) {\n        value = null;\n      }\n      const ok = isFilled(value, field.type);\n      if (ok) filled.push(field);\n      else missing.push(field);\n    });\n\n    const filledCount = filled.length;\n    const mode = String(cfg.mode || section.modeDefault || \"ALL\").toUpperCase();\n    const minRequired = Number.isFinite(Number(cfg.min)) ? Number(cfg.min) : section.minDefault;\n\n    if (mode === \"MIN\") {\n      const min = Math.max(1, Number.isFinite(minRequired) ? minRequired : 1);\n      const done = filledCount >= min;\n      const doneCount = Math.min(filledCount, min);\n      sectionResults.set(section.id, {\n        enabled: true,\n        done,\n        doneUnits: doneCount,\n        totalUnits: min,\n        missingReasons: done ? [] : [`En az ${min} alan`],\n      });\n      totalUnits += min;\n      doneUnits += doneCount;\n      return;\n    }\n\n    const total = applicable.length;\n    if (total === 0) {\n      if (section.allowEmpty === false) {\n        sectionResults.set(section.id, {\n          enabled: true,\n          done: false,\n          doneUnits: 0,\n          totalUnits: 1,\n          missingReasons: [section.label || \"Eksik\"],\n        });\n        totalUnits += 1;\n      } else {\n        sectionResults.set(section.id, {\n          enabled: true,\n          done: true,\n          doneUnits: 0,\n          totalUnits: 0,\n          missingReasons: [],\n        });\n      }\n      return;\n    }\n\n    const done = filledCount === total;\n    const missingReasons = done\n      ? []\n      : missing.map((field) => field.label).filter(Boolean);\n\n    sectionResults.set(section.id, {\n      enabled: true,\n      done,\n      doneUnits: filledCount,\n      totalUnits: total,\n      missingReasons,\n    });\n    totalUnits += total;\n    doneUnits += filledCount;\n  });\n\n  const tabs = catalog.tabs.map((tab) => {\n    const sections = tab.sectionIds || [];\n    const enabledSections = sections\n      .map((id) => ({ id, result: sectionResults.get(id), def: sectionsById.get(id) }))\n      .filter((s) => s.result && s.result.enabled !== false);\n\n    let tabTotal = 0;\n    let tabDone = 0;\n    const missingLines = [];\n    let allDone = true;\n\n    enabledSections.forEach((s) => {\n      const res = s.result || {};\n      if (!res.done) allDone = false;\n      const t = Number(res.totalUnits || 0);\n      const d = Number(res.doneUnits || 0);\n      if (t > 0) {\n        tabTotal += t;\n        tabDone += d;\n      }\n      if (Array.isArray(res.missingReasons) && res.missingReasons.length) {\n        missingLines.push(...res.missingReasons);\n      }\n    });\n\n    const pct = tabTotal ? Math.round((tabDone / tabTotal) * 100) : 0;\n    const missingPreview = missingLines.length ? missingLines.join(\" / \") : \"\";\n\n    return {\n      key: tab.key,\n      label: tab.label,\n      pct,\n      done: allDone,\n      missingPreview,\n      missingLines,\n    };\n  });\n\n  const pct = totalUnits ? Math.round((doneUnits / totalUnits) * 100) : 0;\n  const missingDetailsLines = tabs\n    .filter((t) => !t.done)\n    .map((t) => {\n      const reasons = t.missingPreview || \"Eksik alanlar\";\n      return `${t.label}: ${reasons}`;\n    });\n\n  const completedCount = tabs.filter((t) => t.done).length;\n  const totalCount = tabs.length;\n\n  return {\n    pct,\n    completedCount,\n    totalCount,\n    tabs,\n    missingDetailsLines,\n  };\n}\n\nexport { safeGet, toNum, isNonEmptyString };\n","// frontend/src/pages/SchoolPage.jsx\r\n\r\nimport React, { useCallback, useEffect, useMemo, useRef, useState } from \"react\";\r\nimport { Outlet, useLocation, useNavigate, useOutletContext, useParams } from \"react-router-dom\";\r\nimport { ToastContainer, toast } from \"react-toastify\";\r\nimport { api } from \"../api\";\r\nimport Tooltip from \"../components/ui/Tooltip\";\r\nimport { can } from \"../utils/permissions\";\r\nimport { getGradeOptions, normalizeKademeConfig, summarizeGradesByKademe } from \"../utils/kademe\";\r\nimport { computeScenarioProgress } from \"../utils/scenarioProgress\";\r\nimport { useScenarioUiState, useScenarioUiString } from \"../hooks/useScenarioUIState\";\r\nimport { FaCalculator, FaCheckCircle, FaFileExport, FaPaperPlane, FaSave } from \"react-icons/fa\";\r\nimport {\r\n  readLastVisitedPath,\r\n  readSelectedScenarioId,\r\n  writeLastVisitedPath,\r\n  writeSelectedScenarioId,\r\n  writeGlobalLastRouteSegment,\r\n} from \"../utils/schoolNavStorage\";\r\nimport { getProgramType, mapBaseKademeToVariant, normalizeProgramType } from \"../utils/programType\";\r\n\r\n// Helper: Convert dirty input paths to permission resource keys for modifiedResources.\r\n// It strips a leading 'inputs.' prefix (if present), converts camelCase\r\n// tokens to snake_case, and returns page-level and section-level resources.\r\n// Example: 'inputs.gelirler.unitFee'  ['page.gelirler','section.gelirler.unit_fee'].\r\n/**\r\n * Convert a dirty input path into a list of permission resources.  The\r\n * function returns at most two resources: a pagelevel resource (always)\r\n * and, when a known mapping exists, a sectionlevel resource.  It\r\n * normalizes camelCase tokens to snake_case and applies custom\r\n * section mappings to ensure that generated section keys align with the\r\n * backend permissions catalog.  Unknown sections fall back to pagelevel\r\n * only.\r\n *\r\n * For example:\r\n *   'inputs.gelirler.tuition.rows.0.amount'  ['page.gelirler','section.gelirler.unit_fee']\r\n *   'inputs.temelBilgiler.performans.degerlendirme'  ['page.temel_bilgiler','section.temel_bilgiler.performans']\r\n *   'inputs.ik.years.y1'  ['page.ik','section.ik.local_staff']\r\n *\r\n * The SECTION_KEY_MAPPING constant below defines mappings from secondlevel\r\n * keys to canonical section names per page.  A wildcard '*' entry may be\r\n * used to map any key to a default section.  A mapping value of null\r\n * indicates that no sectionlevel resource should be generated for that key.\r\n *\r\n * @param {string} path Dirty input path (e.g. 'inputs.gelirler.tuition.rows.0.amount')\r\n * @returns {string[]} List of permission resource keys\r\n */\r\nfunction pathToResources(path) {\r\n  const result = [];\r\n  if (!path) return result;\r\n  const tokens = String(path).split('.');\r\n  // Strip a leading 'inputs.' prefix to isolate the module and section keys.\r\n  if (tokens.length > 0 && tokens[0] === 'inputs') {\r\n    tokens.shift();\r\n  }\r\n  if (tokens.length === 0) return result;\r\n  // Normalize the module (page) token from camelCase to snake_case.\r\n  const pageRaw = tokens[0];\r\n  let page = pageRaw.replace(/([a-z0-9])([A-Z])/g, '$1_$2').toLowerCase();\r\n  const PAGE_ALIASES = {\r\n    grades_years: \"grades_plan\",\r\n    grades_current: \"grades_plan\",\r\n    grades: \"grades_plan\",\r\n  };\r\n  if (Object.prototype.hasOwnProperty.call(PAGE_ALIASES, page)) {\r\n    page = PAGE_ALIASES[page];\r\n  }\r\n  if (!page) return result;\r\n  // If a section token exists, map it to a canonical section resource key.  If\r\n  // mapping yields a non-null value, return only the section-level resource.\r\n  // Otherwise, fall back to the page-level resource.  This avoids sending\r\n  // both the page and section resources for the same change, which would\r\n  // incorrectly require the user to have write access on both resources.\r\n  if (tokens.length >= 2) {\r\n    const sectionRaw = tokens[1];\r\n    const sectionSnake = sectionRaw.replace(/([a-z0-9])([A-Z])/g, '$1_$2').toLowerCase();\r\n    const SECTION_KEY_MAPPING = {\r\n      temel_bilgiler: {\r\n        inflation: 'inflation',\r\n        ucret_artis_oranlari: 'inflation',\r\n        okul_ucretleri_hesaplama: 'inflation',\r\n        ik_mevcut: 'ik_mevcut',\r\n        burs_indirim_ogrenci_sayilari: 'burs_ogr',\r\n        burs_ogr: 'burs_ogr',\r\n        rakip_analizi: 'rakip',\r\n        rakip: 'rakip',\r\n        performans: 'performans',\r\n        degerlendirme: 'performans',\r\n        okul_egitim_bilgileri: 'okul_egitim',\r\n        yetkililer: null,\r\n        kademeler: null,\r\n        program_type: null,\r\n      },\r\n      gelirler: {\r\n        '*': 'unit_fee',\r\n      },\r\n      giderler: {\r\n        '*': 'isletme',\r\n      },\r\n      ik: {\r\n        '*': 'local_staff',\r\n      },\r\n      discounts: {\r\n        '*': 'discounts',\r\n      },\r\n      norm: {\r\n        '*': 'ders_dagilimi',\r\n      },\r\n      grades_plan: {\r\n        '*': 'plan',\r\n      },\r\n      kapasite: {\r\n        '*': 'caps',\r\n      },\r\n    };\r\n    const pageMap = SECTION_KEY_MAPPING[page];\r\n    let mapped = null;\r\n    if (pageMap) {\r\n      if (Object.prototype.hasOwnProperty.call(pageMap, sectionSnake)) {\r\n        mapped = pageMap[sectionSnake];\r\n      } else if (Object.prototype.hasOwnProperty.call(pageMap, '*')) {\r\n        mapped = pageMap['*'];\r\n      } else {\r\n        // If no explicit mapping exists, use the normalized section name directly.\r\n        mapped = sectionSnake;\r\n      }\r\n    } else {\r\n      // For pages with no mapping defined, use the normalized section name.\r\n      mapped = sectionSnake;\r\n    }\r\n    if (mapped) {\r\n      // When a section-level mapping exists (mapped !== null), return only\r\n      // the section-level resource.  Do not include the page-level resource\r\n      // because a section write implicitly requires only section permission.\r\n      result.push(`section.${page}.${mapped}`);\r\n      return result;\r\n    }\r\n  }\r\n  // Fall back to the page-level resource if no section mapping applies.\r\n  result.push(`page.${page}`);\r\n  return result;\r\n}\r\n\r\nfunction isScenarioLocked(scenario) {\r\n  const status = String(scenario?.status || \"draft\");\r\n  const submittedAt = scenario?.submitted_at != null;\r\n  const sentAt = scenario?.sent_at != null;\r\n  return (\r\n    status === \"sent_for_approval\" ||\r\n    status === \"submitted\" ||\r\n    (status === \"approved\" && sentAt) ||\r\n    (status === \"in_review\" && submittedAt)\r\n  );\r\n}\r\n\r\n\r\n\r\nconst INPUT_HEADER_TABS = new Set([\"basics\", \"kapasite\", \"income\", \"expenses\", \"norm\", \"hr\", \"detailedReport\", \"report\"]);\r\nconst TAB_TO_ROUTE = {\r\n  basics: \"temel-bilgiler\",\r\n  kapasite: \"kapasite\",\r\n  norm: \"norm\",\r\n  hr: \"ik\",\r\n  income: \"gelirler\",\r\n  expenses: \"giderler\",\r\n  detailedReport: \"detayli-rapor\",\r\n  report: \"rapor\",\r\n};\r\nconst ROUTE_TO_TAB = Object.fromEntries(Object.entries(TAB_TO_ROUTE).map(([key, value]) => [value, key]));\r\nconst TAB_TO_WORK_ID = {\r\n  basics: \"temel_bilgiler\",\r\n  kapasite: \"kapasite\",\r\n  norm: \"norm.ders_dagilimi\",\r\n  hr: \"ik.local_staff\",\r\n  income: \"gelirler.unit_fee\",\r\n  expenses: \"giderler.isletme\",\r\n};\r\n\r\nfunction parseAcademicYear(academicYear) {\r\n  const s = String(academicYear || \"\").trim();\r\n  const range = s.match(/(\\d{4})\\s*-\\s*(\\d{4})/);\r\n  if (range) {\r\n    const startYear = Number(range[1]);\r\n    const endYear = Number(range[2]);\r\n    if (Number.isFinite(startYear) && Number.isFinite(endYear)) {\r\n      return { startYear, endYear };\r\n    }\r\n  }\r\n  const single = s.match(/^(\\d{4})$/);\r\n  if (single) {\r\n    const startYear = Number(single[1]);\r\n    if (Number.isFinite(startYear)) return { startYear, endYear: startYear };\r\n  }\r\n  return { startYear: null, endYear: null };\r\n}\r\n\r\nfunction pctValue(tab) {\r\n  const n = Number(tab?.pct);\r\n  return Number.isFinite(n) ? n : 0;\r\n}\r\n\r\nfunction mergeMissingLines(a, b) {\r\n  const out = [];\r\n  const seen = new Set();\r\n  [a, b].forEach((list) => {\r\n    if (!Array.isArray(list)) return;\r\n    list.forEach((line) => {\r\n      const val = String(line || \"\").trim();\r\n      if (!val || seen.has(val)) return;\r\n      seen.add(val);\r\n      out.push(val);\r\n    });\r\n  });\r\n  return out.slice(0, 15);\r\n}\r\n\r\nfunction findArrayItemIndex(arr, part) {\r\n  if (!Array.isArray(arr)) return -1;\r\n  const byKey = arr.findIndex(\r\n    (item) => item && typeof item === \"object\" && \"key\" in item && String(item.key) === part\r\n  );\r\n  if (byKey !== -1) return byKey;\r\n  const byName = arr.findIndex(\r\n    (item) => item && typeof item === \"object\" && \"name\" in item && String(item.name) === part\r\n  );\r\n  if (byName !== -1) return byName;\r\n  const byGrade = arr.findIndex(\r\n    (item) => item && typeof item === \"object\" && \"grade\" in item && String(item.grade) === part\r\n  );\r\n  if (byGrade !== -1) return byGrade;\r\n  const idx = Number(part);\r\n  if (Number.isInteger(idx) && String(idx) === part && idx >= 0 && idx < arr.length) return idx;\r\n  return -1;\r\n}\r\n\r\nfunction setValueAtPath(obj, parts, value) {\r\n  if (!obj || !Array.isArray(parts) || !parts.length) return false;\r\n  let cur = obj;\r\n  for (let i = 0; i < parts.length - 1; i++) {\r\n    const part = parts[i];\r\n    if (cur == null) return false;\r\n    if (Array.isArray(cur)) {\r\n      const idx = findArrayItemIndex(cur, part);\r\n      if (idx < 0) return false;\r\n      if (cur[idx] == null || typeof cur[idx] !== \"object\") cur[idx] = {};\r\n      cur = cur[idx];\r\n      continue;\r\n    }\r\n    if (typeof cur !== \"object\") return false;\r\n    if (cur[part] == null || typeof cur[part] !== \"object\") cur[part] = {};\r\n    cur = cur[part];\r\n  }\r\n  const last = parts[parts.length - 1];\r\n  if (Array.isArray(cur)) {\r\n    const idx = findArrayItemIndex(cur, last);\r\n    if (idx < 0) return false;\r\n    cur[idx] = value;\r\n    return true;\r\n  }\r\n  if (cur == null || typeof cur !== \"object\") return false;\r\n  cur[last] = value;\r\n  return true;\r\n}\r\n\r\nexport default function SchoolPage() {\r\n  const { id } = useParams();\r\n  const location = useLocation();\r\n  const navigate = useNavigate();\r\n  const outlet = useOutletContext();\r\n  const schoolId = Number(id);\r\n\r\n  const [school, setSchool] = useState(null);\r\n  const [err, setErr] = useState(\"\");\r\n\r\n  // user profile (region, country, etc.)\r\n  const [me, setMe] = useState(null);\r\n\r\n  useEffect(() => {\r\n    const base = \"Feasibility Studio\";\r\n    document.title = school?.name ? `${school.name}  ${base}` : `School  ${base}`;\r\n  }, [school?.name]);\r\n\r\n  // Selected scenario meta and related state must be defined before\r\n  // they are referenced in refreshWorkItems and submitWorkItem.\r\n  const [selectedScenario, setSelectedScenario] = useState(null);\r\n  const [prevReport, setPrevReport] = useState(null);\r\n  const [prevScenarioMeta, setPrevScenarioMeta] = useState(null);\r\n  // Work items list for the currently selected scenario.  Each entry\r\n  // represents a module (e.g. gelirler.unit_fee) and tracks its\r\n  // workflow state.  When the selected scenario changes the list is\r\n  // reloaded from the server.  Principals and HR users can submit\r\n  // modules for review via submitWorkItem, which will refresh this list.\r\n  const [workItems, setWorkItems] = useState([]);\r\n  const [workItemsLoaded, setWorkItemsLoaded] = useState(false);\r\n  const [scenarioMetaLoaded, setScenarioMetaLoaded] = useState(false);\r\n  const [reviewingWorkItem, setReviewingWorkItem] = useState(false);\r\n\r\n  // scenarios\r\n  const [scenarios, setScenarios] = useState([]);\r\n  const [selectedScenarioId, setSelectedScenarioId] = useState(() => readSelectedScenarioId(schoolId));\r\n  const [pendingTabAfterSelect, setPendingTabAfterSelect] = useState(null);\r\n\r\n\r\n  // Refresh the work items for the current scenario.  This helper\r\n  // fetches the work item list from the backend and updates state.\r\n  // It is memoized on schoolId and selectedScenario.id to avoid\r\n  // unnecessary re-renders.  When no scenario is selected, it\r\n  // clears the list.\r\n  const refreshWorkItems = useCallback(async () => {\r\n    const sid = selectedScenario?.id;\r\n    if (!sid || !schoolId) {\r\n      setWorkItems([]);\r\n      setWorkItemsLoaded(false);\r\n      return;\r\n    }\r\n    try {\r\n      const data = await api.listWorkItems(schoolId, sid);\r\n      setWorkItems(Array.isArray(data?.workItems) ? data.workItems : []);\r\n      setWorkItemsLoaded(true);\r\n    } catch (_) {\r\n      // ignore errors, keep existing list\r\n      setWorkItemsLoaded(true);\r\n    }\r\n  }, [schoolId, selectedScenario?.id]);\r\n\r\n  // Refresh scenario metadata (status/sent_at/checked_at) without touching inputs/report.\r\n  const refreshScenarioMeta = useCallback(async () => {\n    if (!schoolId) return;\n    setScenarioMetaLoaded(false);\n    try {\n      const data = await api.listScenarios(schoolId, {\n        limit: 50,\n        offset: 0,\n        fields: \"brief\",\n        order: \"created_at:desc\",\n      });\n      const list = Array.isArray(data?.items) ? data.items : [];\n      setScenarios(list);\n      const scenarioId = selectedScenarioId ?? selectedScenario?.id;\r\n      if (scenarioId != null) {\r\n        const nextScenario = list.find((item) => String(item?.id) === String(scenarioId));\r\n        if (nextScenario) {\r\n          setSelectedScenario((prev) => (prev ? { ...prev, ...nextScenario } : nextScenario));\r\n        }\r\n      }\r\n      setScenarioMetaLoaded(true);\r\n    } catch (_) {\r\n      // ignore errors, keep existing meta\r\n      setScenarioMetaLoaded(false);\r\n    }\r\n  }, [schoolId, selectedScenarioId, selectedScenario?.id]);\r\n\r\n  // Submit a work item for review.  Accepts a workId string.  On\r\n  // success the work items are refreshed and a toast is shown.\r\n  const submitWorkItem = useCallback(\r\n    async (workId) => {\r\n      const sid = selectedScenario?.id;\r\n      if (!sid || !schoolId || !workId) return;\r\n      try {\r\n        await api.submitWorkItem(schoolId, sid, workId);\r\n        await refreshWorkItems();\r\n        await refreshScenarioMeta();\r\n        toast.success(\"Modl gnderildi.\");\r\n      } catch (e) {\r\n        toast.error(e.message || \"Gnderme baarsz\");\r\n      }\r\n    },\r\n    [schoolId, selectedScenario?.id, refreshWorkItems, refreshScenarioMeta]\r\n  );\r\n\r\n\r\n  // Fetch work items whenever the selected scenario changes.  If there\r\n  // is no scenario selected the list is cleared.  The refreshWorkItems\r\n  // dependency ensures that any changes to schoolId or scenario id are\r\n  // respected.\r\n  useEffect(() => {\r\n    if (!selectedScenario?.id) {\r\n      setWorkItems([]);\r\n      setWorkItemsLoaded(false);\r\n      setScenarioMetaLoaded(false);\r\n      return;\r\n    }\r\n    setWorkItemsLoaded(false);\r\n    setScenarioMetaLoaded(false);\r\n    refreshWorkItems();\r\n  }, [selectedScenario?.id, refreshWorkItems]);\r\n\r\n  // removed duplicate declarations for selectedScenario, prevReport,\r\n  // prevScenarioMeta, and workItems. These are now defined earlier\r\n  // before they are used in callbacks.\r\n\r\n  // norm\r\n  const [norm, setNorm] = useState(null);\r\n  const [progressConfig, setProgressConfig] = useState(null);\r\n\r\n  // inputs\r\n  const [inputs, setInputs] = useState(null);\r\n  const [inputsSaving, setInputsSaving] = useState(false);\r\n  const [dirtyPaths, setDirtyPaths] = useState(() => new Set());\r\n  const [baselineInputs, setBaselineInputs] = useState(null);\r\n  const [baselineNorm, setBaselineNorm] = useState(null);\r\n  const clearDirtyPrefix = useCallback((prefix) => {\r\n    setDirtyPaths((prev) => {\r\n      if (!prev.size) return prev;\r\n      let changed = false;\r\n      const next = new Set();\r\n      for (const path of prev) {\r\n        if (path.startsWith(prefix)) {\r\n          changed = true;\r\n          continue;\r\n        }\r\n        next.add(path);\r\n      }\r\n      return changed ? next : prev;\r\n    });\r\n  }, []);\r\n  const hasDirtyPrefix = useCallback(\r\n    (prefix) => {\r\n      for (const path of dirtyPaths) {\r\n        if (path === prefix || path.startsWith(prefix)) return true;\r\n      }\r\n      return false;\r\n    },\r\n    [dirtyPaths]\r\n  );\r\n  // report\r\n  const [report, setReport] = useState(null);\r\n  const [calculating, setCalculating] = useState(false);\r\n  const [lastSavedAt, setLastSavedAt] = useState(null);\r\n  const [lastCalculatedAt, setLastCalculatedAt] = useState(null);\r\n  const [nowTick, setNowTick] = useState(0);\r\n  const [exportOpen, setExportOpen] = useState(false);\r\n  const exportMenuRef = useRef(null);\r\n  const reportExportRef = useRef(null);\r\n  const [exportingPdf, setExportingPdf] = useState(false);\r\n  // Page boot loading (used to show a spinner while auto-starting the scenario wizard)\r\n  const [bootLoading, setBootLoading] = useState(true);\r\n  const [bootLoadingLabel, setBootLoadingLabel] = useState(\"Okul ailiyor...\");\r\n\r\n  useEffect(() => {\r\n    setSelectedScenarioId(readSelectedScenarioId(schoolId));\r\n  }, [schoolId]);\r\n\r\n  const uiScopeKey = useMemo(\r\n    () => `school:${schoolId}:scenario:${selectedScenarioId ?? \"none\"}`,\r\n    [schoolId, selectedScenarioId]\r\n  );\r\n  const [reportCurrency, setReportCurrency] = useScenarioUiState(\"report.currency\", \"usd\", { scope: uiScopeKey });\r\n  const reportCurrencyDefaultedForRef = useRef(null);\r\n  const [reportMode, setReportMode] = useScenarioUiState(\"report.mode\", \"original\", { scope: uiScopeKey });\r\n  const [reportModeLoading, setReportModeLoading] = useState(false);\r\n  const [detailedReportMode, setDetailedReportMode] = useScenarioUiString(\"school.detailedReportMode\", \"detailed\", { scope: uiScopeKey });\r\n  const activeRouteSegment = useMemo(() => {\r\n    const base = `/schools/${schoolId}/`;\r\n    if (!location.pathname.startsWith(base)) return \"\";\r\n    return location.pathname.slice(base.length).split(\"/\")[0] || \"\";\r\n  }, [location.pathname, schoolId]);\r\n  const tab = ROUTE_TO_TAB[activeRouteSegment] || \"\";\r\n  const activeWorkId = TAB_TO_WORK_ID[tab] || null;\r\n  const activeWorkItem = useMemo(() => {\r\n    if (!activeWorkId || !Array.isArray(workItems)) return null;\r\n    return workItems.find((item) => String(item?.work_id) === String(activeWorkId)) || null;\r\n  }, [activeWorkId, workItems]);\r\n  const activeWorkState = activeWorkItem?.state ? String(activeWorkItem.state) : \"not_started\";\r\n  const moduleLocked = [\"submitted\", \"approved\"].includes(activeWorkState);\r\n  const setTab = React.useCallback(\r\n    (nextTab) => {\r\n      const segment = TAB_TO_ROUTE[nextTab];\r\n      if (!segment) return;\r\n      navigate(`/schools/${schoolId}/${segment}`);\r\n    },\r\n    [navigate, schoolId]\r\n  );\r\n\r\n  useEffect(() => {\r\n    // Persist the current route segment for the given school and scenario. When\r\n    // no scenario is selected (`selectedScenarioId` is null) the helper will\r\n    // store the path under a \"none\" scenario key. This ensures that we\r\n    // remember the last page even before a scenario is chosen.\r\n    if (!ROUTE_TO_TAB[activeRouteSegment]) return;\r\n    writeLastVisitedPath(schoolId, selectedScenarioId, activeRouteSegment);\r\n  }, [activeRouteSegment, schoolId, selectedScenarioId]);\r\n\r\n  // Persist the current route segment globally so that when switching between\r\n  // schools or scenarios the user returns to the same sidebar page. This is\r\n  // independent of school or scenario context.\r\n  useEffect(() => {\r\n    if (!ROUTE_TO_TAB[activeRouteSegment]) return;\r\n    writeGlobalLastRouteSegment(activeRouteSegment);\r\n  }, [activeRouteSegment]);\r\n\r\n  useEffect(() => {\r\n    // When the user loads the base school path (e.g. `/schools/4`), redirect to\r\n    // the last visited route for the current school and scenario. If no\r\n    // scenario is selected we still look up the \"none\" scenario key. If\r\n    // nothing is recorded, default to the basics tab.\r\n    const base = `/schools/${schoolId}`;\r\n    if (location.pathname !== base && location.pathname !== `${base}/`) return;\r\n    const last = readLastVisitedPath(schoolId, selectedScenarioId);\r\n    const targetSegment = last || TAB_TO_ROUTE.basics;\r\n    const target = `${base}/${targetSegment}`;\r\n    navigate(target, { replace: true });\r\n  }, [location.pathname, navigate, schoolId, selectedScenarioId]);\r\n\r\n  useEffect(() => {\r\n    setBootLoading(true);\r\n    setBootLoadingLabel(\"Okul ailiyor...\");\r\n  }, [schoolId]);\r\n\r\n  useEffect(() => {\r\n    if (!pendingTabAfterSelect) return;\r\n    if (!selectedScenarioId) return;\r\n    if (String(selectedScenarioId) !== String(pendingTabAfterSelect.scenarioId)) return;\r\n    setTab(pendingTabAfterSelect.tab);\r\n    setPendingTabAfterSelect(null);\r\n  }, [pendingTabAfterSelect, selectedScenarioId, setTab]);\r\n\r\n  useEffect(() => {\r\n    const id = setInterval(() => setNowTick(Date.now()), 30000);\r\n    return () => clearInterval(id);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (!exportOpen) return;\r\n    const handleClick = (event) => {\r\n      const el = exportMenuRef.current;\r\n      if (!el || el.contains(event.target)) return;\r\n      setExportOpen(false);\r\n    };\r\n    const handleKey = (event) => {\r\n      if (event.key === \"Escape\") setExportOpen(false);\r\n    };\r\n    document.addEventListener(\"mousedown\", handleClick);\r\n    document.addEventListener(\"keydown\", handleKey);\r\n    return () => {\r\n      document.removeEventListener(\"mousedown\", handleClick);\r\n      document.removeEventListener(\"keydown\", handleKey);\r\n    };\r\n  }, [exportOpen]);\r\n\r\n\r\n  const scenarioYears = parseAcademicYear(selectedScenario?.academic_year);\r\n  const baseYear = scenarioYears.startYear;\r\n  const inputCurrencyCode =\r\n    selectedScenario?.input_currency === \"LOCAL\"\r\n      ? (selectedScenario.local_currency_code || \"LOCAL\")\r\n      : \"USD\";\r\n  const isLocalScenario = selectedScenario?.input_currency === \"LOCAL\";\r\n  const prevRealFxValue = Number(inputs?.temelBilgiler?.performans?.prevYearRealizedFxUsdToLocal || 0);\r\n  const prevRealFxMissing = isLocalScenario && !(Number.isFinite(prevRealFxValue) && prevRealFxValue > 0);\r\n\r\n  const programType = useMemo(() => getProgramType(inputs, selectedScenario), [inputs, selectedScenario]);\r\n  const permissionScope = useMemo(() => {\r\n    const countryId = school?.country_id ?? me?.country_id ?? null;\r\n    return { schoolId, countryId };\r\n  }, [schoolId, school?.country_id, me?.country_id]);\r\n  const canReadNorm = useMemo(() => {\r\n    try {\r\n      return can(me, \"page.norm\", \"read\", permissionScope);\r\n    } catch {\r\n      return false;\r\n    }\r\n  }, [me, permissionScope]);\r\n  const canWriteGiderler = useMemo(() => {\r\n    try {\r\n      if (can(me, \"section.giderler.isletme\", \"write\", permissionScope)) return true;\r\n      return can(me, \"page.giderler\", \"write\", permissionScope);\r\n    } catch {\r\n      return false;\r\n    }\r\n  }, [me, permissionScope]);\r\n  const ignoreNormProgress = !norm && !canReadNorm;\r\n\r\n  const scenarioProgress = useMemo(\r\n    () => computeScenarioProgress({ inputs, norm, config: progressConfig, scenario: selectedScenario }),\r\n    [inputs, norm, progressConfig, selectedScenario]\r\n  );\r\n  const progMap = useMemo(\r\n    () => Object.fromEntries((scenarioProgress?.tabs || []).map((t) => [t.key, t])),\r\n    [scenarioProgress]\r\n  );\r\n  const normAvgPct = useMemo(() => {\r\n    const a = pctValue(progMap.gradesPlan);\r\n    const b = ignoreNormProgress ? a : pctValue(progMap.norm);\r\n    return Math.round((a + b) / 2);\r\n  }, [progMap, ignoreNormProgress]);\r\n  const expensesAvgPct = useMemo(() => {\r\n    const a = pctValue(progMap.giderler);\r\n    // Use the new discounts key instead of the legacy indirimler key.  If the\r\n    // discounts tab is missing, default to 0 for the percentage value.\r\n    const b = pctValue(progMap.discounts);\r\n    return Math.round((a + b) / 2);\r\n  }, [progMap]);\r\n  const normMissingLines = useMemo(\r\n    () => mergeMissingLines(progMap.gradesPlan?.missingLines, progMap.norm?.missingLines),\r\n    [progMap]\r\n  );\r\n  const expensesMissingLines = useMemo(\r\n    () => mergeMissingLines(progMap.giderler?.missingLines, progMap.discounts?.missingLines),\r\n    [progMap]\r\n  );\r\n\r\n  const fetchScenarioReport = useCallback(\r\n    async (mode) => {\r\n      if (!selectedScenarioId) return;\r\n      const nextMode = String(mode || \"original\");\r\n      setReportModeLoading(true);\r\n      setErr(\"\");\r\n      try {\r\n        const data = await api.getScenarioReport(schoolId, selectedScenarioId, nextMode);\r\n        setReport(data?.results || null);\r\n      } catch (e) {\r\n        setErr(e.message || \"Report fetch failed\");\r\n      } finally {\r\n        setReportModeLoading(false);\r\n      }\r\n    },\r\n    [schoolId, selectedScenarioId]\r\n  );\r\n\r\n  const handleReportModeChange = useCallback(\r\n    async (mode) => {\r\n      const nextMode = String(mode || \"original\");\r\n      if (nextMode === reportMode && report) return;\r\n      setReportMode(nextMode);\r\n      await fetchScenarioReport(nextMode);\r\n    },\r\n    [fetchScenarioReport, reportMode, report, setReportMode]\r\n  );\r\n  useEffect(() => {\r\n    if (!outlet?.setHeaderMeta) return;\r\n    outlet.setHeaderMeta({\r\n      title: school?.name ? school.name : \"Okul\",\r\n      subtitle: selectedScenario\r\n        ? `${selectedScenario.name}${selectedScenario.academic_year ? `  ${selectedScenario.academic_year}` : \"\"}`\r\n        : \"Senaryo sein\",\r\n      hideDefault: false,\r\n      centered: true,\r\n    });\r\n    return () => {\r\n      outlet.clearHeaderMeta?.();\r\n    };\r\n  }, [outlet, selectedScenario, school?.name]);\r\n\r\n  // A) Helper: HR(IK) -> Expenses(Isletme) 5 salary rows auto patch (uses 1.Yil / y1)\r\n  const applyIkSalariesToGiderler = useCallback((inInputs) => {\r\n    const src = inInputs || {};\r\n    const ik = src.ik || {};\r\n    const yearIK = ik?.years?.y1 ? ik.years.y1 : ik; // legacy support\r\n\r\n    const unitCosts = yearIK?.unitCosts || {};\r\n    const headcountsByLevel = yearIK?.headcountsByLevel || {};\r\n\r\n    const roles = [\r\n      \"turk_mudur\",\r\n      \"turk_mdyard\",\r\n      \"turk_egitimci\",\r\n      \"turk_temsil\",\r\n      \"yerel_yonetici_egitimci\",\r\n      \"yerel_destek\",\r\n      \"yerel_ulke_temsil_destek\",\r\n      \"int_yonetici_egitimci\",\r\n    ];\r\n\r\n    const levels = [\r\n      \"okulOncesi\",\r\n      \"ilkokulYerel\",\r\n      \"ilkokulInt\",\r\n      \"ortaokulYerel\",\r\n      \"ortaokulInt\",\r\n      \"liseYerel\",\r\n      \"liseInt\",\r\n    ];\r\n\r\n    const roleAnnual = {};\r\n    for (const r of roles) {\r\n      let count = 0;\r\n      for (const lvl of levels) count += Number(headcountsByLevel?.[lvl]?.[r] || 0);\r\n      roleAnnual[r] = Number(unitCosts?.[r] || 0) * count;\r\n    }\r\n\r\n    const patch = {\r\n      turkPersonelMaas:\r\n        (roleAnnual.turk_mudur || 0) +\r\n        (roleAnnual.turk_mdyard || 0) +\r\n        (roleAnnual.turk_egitimci || 0),\r\n      turkDestekPersonelMaas: roleAnnual.turk_temsil || 0,\r\n      yerelPersonelMaas: roleAnnual.yerel_yonetici_egitimci || 0,\r\n      yerelDestekPersonelMaas:\r\n        (roleAnnual.yerel_destek || 0) + (roleAnnual.yerel_ulke_temsil_destek || 0),\r\n      internationalPersonelMaas: roleAnnual.int_yonetici_egitimci || 0,\r\n    };\r\n\r\n    const prevItems = src?.giderler?.isletme?.items || {};\r\n    const keys = Object.keys(patch);\r\n\r\n    let changed = false;\r\n    for (const k of keys) {\r\n      const a = Number(prevItems?.[k] || 0);\r\n      const b = Number(patch?.[k] || 0);\r\n      if (Math.abs(a - b) > 1e-6) {\r\n        changed = true;\r\n        break;\r\n      }\r\n    }\r\n    if (!changed) return src;\r\n\r\n    const next = structuredClone(src);\r\n    next.giderler = next.giderler || {};\r\n    next.giderler.isletme = next.giderler.isletme || {};\r\n    next.giderler.isletme.items = next.giderler.isletme.items || {};\r\n    for (const k of keys) next.giderler.isletme.items[k] = Number(patch[k] || 0);\r\n    return next;\r\n  }, []);\r\n\r\n  const normalizeCapacityInputs = useCallback((src) => {\r\n    const safeNum = (v) => {\r\n      const n = Number(v);\r\n      return Number.isFinite(n) ? n : 0;\r\n    };\r\n\r\n    const s = src || {};\r\n    const legacy = safeNum(s.schoolCapacity);\r\n\r\n    const cap = s.kapasite && typeof s.kapasite === \"object\" ? s.kapasite : {};\r\n    const years = cap.years && typeof cap.years === \"object\" ? cap.years : {};\r\n\r\n    const y1 = safeNum(years.y1 != null ? years.y1 : legacy);\r\n    const y2 = safeNum(years.y2 != null ? years.y2 : y1);\r\n    const y3 = safeNum(years.y3 != null ? years.y3 : y1);\r\n\r\n    const currentStudents = safeNum(cap.currentStudents);\r\n    const byKademe = cap.byKademe && typeof cap.byKademe === \"object\" ? cap.byKademe : {};\r\n\r\n    const needsPatch =\r\n      \"schoolCapacity\" in s ||\r\n      !s.kapasite ||\r\n      typeof s.kapasite !== \"object\" ||\r\n      !cap.years ||\r\n      typeof cap.years !== \"object\" ||\r\n      safeNum(cap?.years?.y1) !== y1 ||\r\n      safeNum(cap?.years?.y2) !== y2 ||\r\n      safeNum(cap?.years?.y3) !== y3 ||\r\n      safeNum(cap?.currentStudents) !== currentStudents ||\r\n      !cap.byKademe ||\r\n      typeof cap.byKademe !== \"object\";\r\n\r\n    if (!needsPatch) return s;\r\n\r\n    const next = structuredClone(s);\r\n    next.kapasite = {\r\n      ...(cap || {}),\r\n      currentStudents,\r\n      years: { y1, y2, y3 },\r\n      byKademe,\r\n    };\r\n    if (\"schoolCapacity\" in next) delete next.schoolCapacity;\r\n    return next;\r\n  }, []);\r\n\r\n\r\n  const normalizeTemelBilgilerInputs = (src) => {\r\n    const s = src || {};\r\n    const t = s.temelBilgiler && typeof s.temelBilgiler === \"object\" ? s.temelBilgiler : {};\r\n    const next = structuredClone(s);\r\n\r\n    // inflation defaults\r\n    const inf = t.inflation && typeof t.inflation === \"object\" ? t.inflation : {};\r\n    const toFinite = (v) => (Number.isFinite(Number(v)) ? Number(v) : 0);\r\n    next.temelBilgiler = {\r\n      inflation: {\r\n        ...inf,\r\n        expenseDeviationPct: toFinite(inf.expenseDeviationPct),\r\n        y2023: toFinite(inf.y2023),\r\n        y2024: toFinite(inf.y2024),\r\n        y2025: toFinite(inf.y2025),\r\n        y1: toFinite(inf.y1),\r\n        y2: toFinite(inf.y2),\r\n        y3: toFinite(inf.y3),\r\n        currentSeasonAvgFee: toFinite(inf.currentSeasonAvgFee),\r\n      },\r\n      yetkililer: t.yetkililer || { mudur: \"\", ulkeTemsilcisi: \"\", raporuHazirlayan: \"\" },\r\n      okulEgitimBilgileri: t.okulEgitimBilgileri || {\r\n        egitimBaslamaTarihi: \"\",\r\n        zorunluEgitimDonemleri: \"\",\r\n        birDersSuresiDakika: 0,\r\n        gunlukDersSaati: 0,\r\n        haftalikDersSaatiToplam: 0,\r\n        sabahciOglenci: \"\",\r\n        ogretmenHaftalikDersOrt: 0,\r\n        gecisSinaviBilgisi: \"\",\r\n        uygulananProgram: \"\",\r\n      },\r\n      kademeler: normalizeKademeConfig(t.kademeler),\r\n      programType: normalizeProgramType(t.programType),\r\n      okulUcretleriHesaplama: typeof t.okulUcretleriHesaplama === \"boolean\" ? t.okulUcretleriHesaplama : true,\r\n      ucretArtisOranlari: t.ucretArtisOranlari || {\r\n        okulOncesi: 0,\r\n        ilkokulYerel: 0,\r\n        ilkokulInt: 0,\r\n        ortaokulYerel: 0,\r\n        ortaokulInt: 0,\r\n        liseYerel: 0,\r\n        liseInt: 0,\r\n      },\r\n      ikMevcut: t.ikMevcut || {\r\n        turkPersonelYoneticiEgitimci: 0,\r\n        turkPersonelTemsilcilik: 0,\r\n        yerelKadroluEgitimci: 0,\r\n        yerelUcretliVakaterEgitimci: 0,\r\n        yerelDestek: 0,\r\n        yerelTemsilcilik: 0,\r\n        international: 0,\r\n      },\r\n      bursIndirimOgrenciSayilari: t.bursIndirimOgrenciSayilari || {\r\n        magisBasariBursu: 0,\r\n        maarifYetenekBursu: 0,\r\n        ihtiyacBursu: 0,\r\n        okulBasariBursu: 0,\r\n        tamEgitimBursu: 0,\r\n        barinmaBursu: 0,\r\n        turkceBasariBursu: 0,\r\n        uluslararasiYukumlulukIndirimi: 0,\r\n        vakifCalisaniIndirimi: 0,\r\n        kardesIndirimi: 0,\r\n        erkenKayitIndirimi: 0,\r\n        pesinOdemeIndirimi: 0,\r\n        kademeGecisIndirimi: 0,\r\n        temsilIndirimi: 0,\r\n        kurumIndirimi: 0,\r\n        istisnaiIndirim: 0,\r\n        yerelMevzuatIndirimi: 0,\r\n      },\r\n      rakipAnalizi: t.rakipAnalizi || {\r\n        okulOncesi: { a: 0, b: 0, c: 0 },\r\n        ilkokul: { a: 0, b: 0, c: 0 },\r\n        ortaokul: { a: 0, b: 0, c: 0 },\r\n        lise: { a: 0, b: 0, c: 0 },\r\n      },\r\n      performans: t.performans || {\r\n        gerceklesen: { ogrenciSayisi: 0, gelirler: 0, giderler: 0, karZarar: 0, bursVeIndirimler: 0 },\r\n      },\r\n      degerlendirme: typeof t.degerlendirme === \"string\" ? t.degerlendirme : \"\",\r\n    };\r\n\r\n    return next;\r\n  };\r\n\r\n  const normalizeGradesInputs = useCallback((src) => {\r\n    const s = src || {};\r\n    const defaultGrades = getGradeOptions().map((g) => ({ grade: g, branchCount: 0, studentsPerBranch: 0 }));\r\n    const baseGrades = Array.isArray(s.grades) ? s.grades : defaultGrades;\r\n    const years = s.gradesYears && typeof s.gradesYears === \"object\" ? s.gradesYears : {};\r\n\r\n    const y1 = Array.isArray(years.y1) ? years.y1 : baseGrades;\r\n    const y2 = Array.isArray(years.y2) ? years.y2 : y1;\r\n    const y3 = Array.isArray(years.y3) ? years.y3 : y1;\r\n\r\n    const normalizeRow = (row) => ({\r\n      grade: String(row?.grade ?? \"\"),\r\n      branchCount: Number(row?.branchCount ?? 0),\r\n      studentsPerBranch: Number(row?.studentsPerBranch ?? 0),\r\n    });\r\n\r\n    const toMap = (list) => {\r\n      const m = new Map();\r\n      (Array.isArray(list) ? list : []).forEach((row) => {\r\n        const r = normalizeRow(row);\r\n        if (!r.grade) return;\r\n        m.set(r.grade, r);\r\n      });\r\n      return m;\r\n    };\r\n\r\n    const areGradesEqual = (a, b) => {\r\n      if (!Array.isArray(a) || !Array.isArray(b)) return false;\r\n      const ma = toMap(a);\r\n      const mb = toMap(b);\r\n      if (ma.size !== mb.size) return false;\r\n      for (const [grade, ra] of ma.entries()) {\r\n        const rb = mb.get(grade);\r\n        if (!rb) return false;\r\n        if (Number(ra.branchCount) !== Number(rb.branchCount)) return false;\r\n        if (Number(ra.studentsPerBranch) !== Number(rb.studentsPerBranch)) return false;\r\n      }\r\n      return true;\r\n    };\r\n\r\n    const needsPatch =\r\n      !s.gradesYears ||\r\n      !Array.isArray(s.grades) ||\r\n      !Array.isArray(years.y1) ||\r\n      !Array.isArray(years.y2) ||\r\n      !Array.isArray(years.y3) ||\r\n      !areGradesEqual(s.grades, y1);\r\n\r\n    if (!needsPatch) return s;\r\n\r\n    const next = structuredClone(s);\r\n    next.gradesYears = {\r\n      y1: structuredClone(y1),\r\n      y2: structuredClone(y2),\r\n      y3: structuredClone(y3),\r\n    };\r\n    next.grades = structuredClone(next.gradesYears.y1);\r\n    return next;\r\n  }, []);\r\n\r\n  const applyTuitionStudentCounts = useCallback((src) => {\r\n    const s = src && typeof src === \"object\" ? src : {};\r\n    const grades = s?.gradesYears?.y1 || s?.grades || [];\r\n    const sums = summarizeGradesByKademe(grades, s?.temelBilgiler?.kademeler);\r\n    const programType = getProgramType(s);\r\n    const variantCounts = {\r\n      okulOncesi: Number(sums.okulOncesi || 0),\r\n      ilkokulYerel: 0,\r\n      ilkokulInt: 0,\r\n      ortaokulYerel: 0,\r\n      ortaokulInt: 0,\r\n      liseYerel: 0,\r\n      liseInt: 0,\r\n    };\r\n    variantCounts[mapBaseKademeToVariant(\"ilkokul\", programType)] = Number(sums.ilkokul || 0);\r\n    variantCounts[mapBaseKademeToVariant(\"ortaokul\", programType)] = Number(sums.ortaokul || 0);\r\n    variantCounts[mapBaseKademeToVariant(\"lise\", programType)] = Number(sums.lise || 0);\r\n\r\n    const syncRows = (rows, getCount) => {\r\n      if (!Array.isArray(rows)) return { rows, changed: false };\r\n      let changed = false;\r\n      const nextRows = rows.map((r) => {\r\n        const key = String(r?.key ?? \"\");\r\n        const nextCount = getCount(key);\r\n        if (nextCount == null) return r;\r\n        const current = Number(r?.studentCount ?? 0);\r\n        if (Math.abs(current - nextCount) < 1e-6) return r;\r\n        changed = true;\r\n        return { ...r, studentCount: nextCount };\r\n      });\r\n      return { rows: changed ? nextRows : rows, changed };\r\n    };\r\n\r\n    const tuitionSync = syncRows(s?.gelirler?.tuition?.rows, (key) =>\r\n      Object.prototype.hasOwnProperty.call(variantCounts, key) ? variantCounts[key] : null\r\n    );\r\n\r\n    if (!tuitionSync.changed) return s;\r\n\r\n    const next = structuredClone(s);\r\n    next.gelirler = next.gelirler || {};\r\n    if (tuitionSync.changed) {\r\n      next.gelirler.tuition = next.gelirler.tuition || {};\r\n      next.gelirler.tuition.rows = tuitionSync.rows;\r\n    }\r\n    return next;\r\n  }, []);\r\n\r\n\r\n  async function loadAll() {\r\n    setErr(\"\");\r\n    setBootLoading(true);\r\n    setBootLoadingLabel(\"Okul ailiyor...\");\r\n    try {\r\n      const s = await api.getSchool(schoolId);\r\n      setSchool(s);\r\n\r\n      // load current user profile (region/country)\r\n      try {\r\n        const meInfo = await api.getMe();\r\n        setMe(meInfo);\r\n      } catch (_) {\r\n        // ignore (e.g., token missing)\r\n      }\r\n\r\n      setBootLoadingLabel(\"Senaryolar kontrol ediliyor...\");\n      const sc = await api.listScenarios(schoolId, {\n        limit: 50,\n        offset: 0,\n        fields: \"brief\",\n        order: \"created_at:desc\",\n      });\n      const rows = Array.isArray(sc?.items) ? sc.items : [];\n      setScenarios(rows);\n      if (selectedScenarioId != null) {\n        const exists = rows.some((x) => String(x.id) === String(selectedScenarioId));\n        if (!exists) {\n          writeSelectedScenarioId(schoolId, null);\n          setSelectedScenarioId(null);\n        }\n      }\n      setBootLoading(false);\r\n\r\n    } catch (e) {\r\n      setErr(e.message || \"Failed to load school\");\r\n      setBootLoading(false);\r\n    }\r\n  }\r\n\r\n  useEffect(() => {\r\n    let active = true;\r\n    async function loadProgressConfig() {\r\n      try {\r\n        const data = await api.getProgressRequirements();\r\n        if (!active) return;\r\n        setProgressConfig(data?.config || data || null);\r\n      } catch (_) {\r\n        if (!active) return;\r\n        setProgressConfig(null);\r\n      }\r\n    }\r\n    loadProgressConfig();\r\n    return () => {\r\n      active = false;\r\n    };\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    loadAll(); /* eslint-disable-next-line */\r\n  }, [schoolId]);\r\n\r\n  useEffect(() => {\r\n    async function loadScenario() {\r\n      if (!selectedScenarioId) {\r\n        setSelectedScenario(null);\r\n        setInputs(null);\r\n        setBaselineInputs(null);\r\n        setReport(null);\r\n        setPrevReport(null);\r\n        setPrevScenarioMeta(null);\r\n        setNorm(null);\r\n        setBaselineNorm(null);\r\n        clearDirtyPrefix(\"inputs.\");\r\n        clearDirtyPrefix(\"norm.\");\r\n        return;\r\n      }\r\n      setErr(\"\");\n      setReport(null);\n      setLastSavedAt(null);\n      setLastCalculatedAt(null);\n      try {\n        const data = await api.getScenarioContext(schoolId, selectedScenarioId);\n\n        // IMPORTANT FIX:\n        setSelectedScenario(data?.scenario || null);\n\n        // IMPORTANT FIX:\n        // If backend returns null/undefined inputs, don't convert it to {}.\n        const raw = data?.inputs;\n        const normalized =\r\n          raw && typeof raw === \"object\"\r\n            ? normalizeGradesInputs(normalizeTemelBilgilerInputs(normalizeCapacityInputs(raw)))\r\n            : raw;\r\n        setInputs(normalized);\n        setBaselineInputs(normalized && typeof normalized === \"object\" ? structuredClone(normalized) : normalized);\n        clearDirtyPrefix(\"inputs.\");\n\n        const n = data?.norm ?? null;\n        setNorm(n);\n        setBaselineNorm(n ? structuredClone(n) : null);\n        clearDirtyPrefix(\"norm.\");\n      } catch (e) {\n        setErr(e.message || \"Failed to load scenario inputs\");\n      }\n    }\n    loadScenario();\r\n  }, [\r\n    schoolId,\r\n    selectedScenarioId,\r\n    clearDirtyPrefix,\r\n    normalizeCapacityInputs,\r\n    normalizeGradesInputs,\r\n  ]);\r\n\r\n  useEffect(() => {\r\n    if (!selectedScenarioId) {\r\n      reportCurrencyDefaultedForRef.current = null;\r\n      return;\r\n    }\r\n    const scenarioId = selectedScenario?.id;\r\n    if (!scenarioId || String(scenarioId) !== String(selectedScenarioId)) return;\r\n\r\n    const isLocal =\r\n      selectedScenario?.input_currency === \"LOCAL\" &&\r\n      Number(selectedScenario?.fx_usd_to_local) > 0 &&\r\n      selectedScenario?.local_currency_code;\r\n    const scenarioKey = String(scenarioId);\r\n\r\n    if (reportCurrencyDefaultedForRef.current !== scenarioKey) {\r\n      setReportCurrency(isLocal ? \"local\" : \"usd\");\r\n      reportCurrencyDefaultedForRef.current = scenarioKey;\r\n      return;\r\n    }\r\n\r\n    if (!isLocal && reportCurrency !== \"usd\") {\r\n      setReportCurrency(\"usd\");\r\n    }\r\n  }, [\r\n    selectedScenarioId,\r\n    selectedScenario?.id,\r\n    selectedScenario?.input_currency,\r\n    selectedScenario?.fx_usd_to_local,\r\n    selectedScenario?.local_currency_code,\r\n    reportCurrency,\r\n    setReportCurrency,\r\n  ]);\r\n\r\n  // Load previous year's report (used in TEMEL BILGILER: performans planlanan)\r\n  useEffect(() => {\r\n    async function loadPrev() {\r\n      try {\r\n        setPrevReport(null);\r\n        setPrevScenarioMeta(null);\r\n        const year = selectedScenario?.academic_year;\r\n        if (!year || !scenarios?.length) return;\r\n\r\n        const { startYear, endYear } = parseAcademicYear(year);\r\n        if (!startYear) return;\r\n        const prevStartYear = startYear - 1;\r\n        const prevEndYear = (endYear ?? startYear) - 1;\r\n\r\n        const prevScenario = scenarios.find((s) => {\r\n          const parsed = parseAcademicYear(s?.academic_year);\r\n          return parsed.startYear === prevStartYear && parsed.endYear === prevEndYear;\r\n        });\r\n        if (!prevScenario) return;\r\n\r\n        setPrevScenarioMeta(prevScenario);\r\n        const data = await api.calculateScenario(schoolId, prevScenario.id);\r\n        setPrevReport(data?.results || null);\r\n      } catch (_) {\r\n        setPrevReport(null);\r\n      }\r\n    }\r\n    loadPrev();\r\n  }, [schoolId, selectedScenario?.academic_year, scenarios]);\r\n\r\n  const scenarioLocked = isScenarioLocked(selectedScenario);\r\n  const inputsLocked = scenarioLocked || moduleLocked;\r\n\r\n  const saveNormConfig = useCallback(async () => {\r\n    if (!norm || !selectedScenarioId) return;\r\n    const payload = norm?.years\r\n      ? { years: norm.years }\r\n      : {\r\n        teacherWeeklyMaxHours: norm.teacherWeeklyMaxHours,\r\n        curriculumWeeklyHours: norm.curriculumWeeklyHours,\r\n      };\r\n    await api.saveNormConfig(schoolId, selectedScenarioId, payload);\r\n    const n = await api.getNormConfig(schoolId, selectedScenarioId);\r\n    setNorm(n);\r\n    setBaselineNorm(n ? structuredClone(n) : null);\r\n    clearDirtyPrefix(\"norm.\");\r\n  }, [norm, selectedScenarioId, schoolId, clearDirtyPrefix]);\r\n\r\n  // B) Save inputs with HR->Expenses salary patch applied + Capacity normalization\r\n  const saveInputs = useCallback(async () => {\r\n    if (!selectedScenarioId || !inputs) return false;\r\n    if (inputsLocked) {\r\n      setErr(scenarioLocked ? \"Senaryo kilitli. Inceleme bekleniyor.\" : \"Modul kilitli. Inceleme bekleniyor.\");\r\n      return false;\r\n    }\r\n    const shouldSaveInputs = hasDirtyPrefix(\"inputs.\");\r\n    const shouldSaveNorm = hasDirtyPrefix(\"norm.\");\r\n    if (!shouldSaveInputs && !shouldSaveNorm) return true;\r\n    setInputsSaving(true);\r\n    setErr(\"\");\r\n    try {\r\n      if (shouldSaveInputs) {\r\n        let patched = applyIkSalariesToGiderler(inputs);\r\n        patched = normalizeCapacityInputs(patched);\r\n        patched = normalizeGradesInputs(patched);\r\n        patched = applyTuitionStudentCounts(patched);\r\n\r\n        if (patched !== inputs) setInputs(patched);\r\n\r\n        // Build the list of modified permission resources from the dirty input paths.  Only\r\n        // consider dirty paths that affect scenario inputs (prefixed with \"inputs.\").  Dirty\r\n        // paths under the \"norm.\" prefix are handled separately when saving the norm config.\r\n        const modifiedResourcesSet = new Set();\r\n        const inputDirty = [];\r\n        for (const p of dirtyPaths) {\r\n          const pathStr = String(p || '');\r\n          if (!pathStr.startsWith('inputs.')) continue;\r\n          inputDirty.push(pathStr);\r\n          for (const r of pathToResources(pathStr)) {\r\n            modifiedResourcesSet.add(r);\r\n          }\r\n        }\r\n        const modifiedResources = Array.from(modifiedResourcesSet);\r\n        await api.saveScenarioInputs(\r\n          schoolId,\r\n          selectedScenarioId,\r\n          patched,\r\n          modifiedResources,\r\n          inputDirty\r\n        );\r\n        setBaselineInputs(patched && typeof patched === \"object\" ? structuredClone(patched) : patched);\r\n        clearDirtyPrefix(\"inputs.\");\r\n      }\r\n\r\n      if (shouldSaveNorm) {\r\n        await saveNormConfig();\r\n      }\r\n      setLastSavedAt(Date.now());\r\n      return true;\r\n    } catch (e) {\r\n      const fallback =\r\n        shouldSaveInputs && shouldSaveNorm\r\n          ? \"Save failed\"\r\n          : shouldSaveNorm\r\n            ? \"Save norm failed\"\r\n            : \"Save inputs failed\";\r\n      setErr(e.message || fallback);\r\n      return false;\r\n    } finally {\r\n      setInputsSaving(false);\r\n    }\r\n  }, [\r\n    applyIkSalariesToGiderler,\r\n    applyTuitionStudentCounts,\r\n    normalizeCapacityInputs,\r\n    normalizeGradesInputs,\r\n    selectedScenarioId,\r\n    inputs,\r\n    inputsLocked,\r\n    scenarioLocked,\r\n    hasDirtyPrefix,\r\n    dirtyPaths,\r\n    schoolId,\r\n    clearDirtyPrefix,\r\n    saveNormConfig,\r\n  ]);\r\n\r\n\r\n  // --- Guard: prevent calculating / submitting if Y2 & Y3 planned student totals are missing ---\r\n  function sumPlannedStudents(grades) {\r\n    const list = Array.isArray(grades) ? grades : [];\r\n    let sum = 0;\r\n    for (const row of list) {\r\n      const n = Number(row?.studentsPerBranch ?? 0);\r\n      if (Number.isFinite(n)) sum += n;\r\n    }\r\n    return sum;\r\n  }\r\n\r\n  function getPlannedStudentTotalsByYear(srcInputs) {\r\n    const s = srcInputs && typeof srcInputs === \"object\" ? srcInputs : {};\r\n    const years = s.gradesYears && typeof s.gradesYears === \"object\" ? s.gradesYears : {};\r\n    return {\r\n      y1: sumPlannedStudents(Array.isArray(years.y1) ? years.y1 : s.grades),\r\n      y2: sumPlannedStudents(years.y2),\r\n      y3: sumPlannedStudents(years.y3),\r\n    };\r\n  }\r\n\r\n\r\n  function showBlockingToast(message, toastId = \"blocking-toast\") {\r\n    // Small bottom-right notification (does not affect page layout)\r\n    toast.warn(message, {\r\n      toastId,\r\n      position: \"bottom-right\",\r\n      autoClose: false,\r\n      closeOnClick: false,\r\n      draggable: true,\r\n      icon: \"??\",\r\n      style: {\r\n        background: \"rgba(15, 23, 42, 0.96)\",\r\n        color: \"#f8fafc\",\r\n        border: \"1px solid rgba(251, 191, 36, 0.35)\",\r\n        boxShadow: \"0 18px 40px rgba(0,0,0,.28)\",\r\n        borderRadius: 14,\r\n      },\r\n    });\r\n  }\r\n\r\n  function ensurePlanningStudentsForY2Y3(actionLabel = \"Islem\") {\r\n    // If inputs are not loaded yet, don't block here (other guards will handle it)\r\n    if (!inputs) return true;\r\n\r\n    const totals = getPlannedStudentTotalsByYear(inputs);\r\n    const missing = [];\r\n    if (!(totals.y2 > 0)) missing.push(\"Y2\");\r\n    if (!(totals.y3 > 0)) missing.push(\"Y3\");\r\n    if (!missing.length) return true;\r\n\r\n    const msg =\r\n      `${actionLabel} yapilamaz: Norm > Planlanan Donem Bilgileri bolumunde ` +\r\n      `${missing.join(\" ve \")} toplam ogrenci 0 gorunuyor. Lutfen Y2/Y3 ogrenci sayilarini girin.`;\r\n\r\n    // Do NOT set page-level err here (it breaks layout). Use toast only.\r\n    setErr(\"\");\r\n    showBlockingToast(msg, \"norm-y2y3-missing\");\r\n\r\n    if (tab !== \"norm\") setTab(\"norm\");\r\n    return false;\r\n  }\r\n\r\n  function ensurePrevRealFxForLocal(actionLabel = \"Islem\") {\r\n    if (!inputs) return true;\r\n    if (!isLocalScenario) return true;\r\n    if (!prevRealFxMissing) return true;\r\n\r\n    const msg =\r\n      `${actionLabel} yapilamaz: Temel Bilgiler > Performans alanindaki ` +\r\n      `\"Onceki Donem Ortalama Kur (Gerceklesen)\" girilmelidir.`;\r\n\r\n    setErr(\"\");\r\n    showBlockingToast(msg, \"prev-realized-fx-missing\");\r\n    if (tab !== \"basics\") setTab(\"basics\");\r\n    return false;\r\n  }\r\n\r\n\r\n  async function calculate(options = {}) {\r\n    if (!selectedScenarioId) return false;\r\n    if (!ensurePrevRealFxForLocal(\"Hesaplama\")) return false;\r\n    if (!options.skipPlanValidation && !ensurePlanningStudentsForY2Y3(\"Hesaplama\")) return false;\r\n    setCalculating(true);\r\n    setErr(\"\");\r\n    let ok = false;\r\n    try {\r\n      const data = await api.calculateScenario(schoolId, selectedScenarioId);\r\n      if (reportMode === \"distributed\") {\r\n        await fetchScenarioReport(\"distributed\");\r\n      } else {\r\n        setReport(data.results);\r\n      }\r\n      if (!options.keepTab) setTab(\"report\");\r\n      setLastCalculatedAt(Date.now());\r\n      if (typeof window !== \"undefined\") {\r\n        // Debug hook: inspect KPI calc payload/results in devtools\r\n        console.log(\"[kpi] calculate ok\", {\r\n          scenarioId: selectedScenarioId,\r\n          hasResults: Boolean(data?.results),\r\n        });\r\n      }\r\n      ok = true;\r\n    } catch (e) {\r\n      setErr(e.message || \"Calculation failed\");\r\n      if (typeof window !== \"undefined\") {\r\n        console.log(\"[kpi] calculate failed\", {\r\n          scenarioId: selectedScenarioId,\r\n          error: e?.message || e,\r\n        });\r\n      }\r\n    } finally {\r\n      setCalculating(false);\r\n    }\r\n    return ok;\r\n  }\r\n\r\n  async function handleExport() {\r\n    if (!selectedScenarioId) return;\r\n    setErr(\"\");\r\n    try {\r\n      await api.downloadXlsx(schoolId, selectedScenarioId, reportCurrency, reportMode);\r\n    } catch (e) {\r\n      setErr(e.message || \"Download failed\");\r\n    }\r\n  }\r\n\r\n  async function handleExportPdf() {\r\n    if (!selectedScenarioId) return;\r\n    setErr(\"\");\r\n    setExportingPdf(true);\r\n    try {\r\n      await api.downloadPdf(schoolId, selectedScenarioId, reportCurrency, reportMode);\r\n    } catch (e) {\r\n      setErr(e.message || \"PDF export failed\");\r\n    } finally {\r\n      setExportingPdf(false);\r\n    }\r\n  }\r\n\r\n  function setField(path, value) {\r\n    if (inputsLocked) return;\r\n    const next = structuredClone(inputs || {});\r\n    const keys = path.split(\".\");\r\n    let obj = next;\r\n    for (let i = 0; i < keys.length - 1; i++) {\r\n      obj[keys[i]] = obj[keys[i]] || {};\r\n      obj = obj[keys[i]];\r\n    }\r\n    obj[keys[keys.length - 1]] = value;\r\n    setInputs(next);\r\n  }\r\n\r\n  function areSetsEqual(a, b) {\r\n    if (a === b) return true;\r\n    if (a.size !== b.size) return false;\r\n    for (const v of a) {\r\n      if (!b.has(v)) return false;\r\n    }\r\n    return true;\r\n  }\r\n\r\n  function valuesEqual(a, b) {\r\n    if (a == null && b == null) return true;\r\n    if (typeof a === \"number\" || typeof b === \"number\") return Number(a) === Number(b);\r\n    if (typeof a === \"boolean\" || typeof b === \"boolean\") return Boolean(a) === Boolean(b);\r\n    return Object.is(a, b);\r\n  }\r\n\r\n  function getValueAtPath(obj, parts) {\r\n    let cur = obj;\r\n    for (const part of parts) {\r\n      if (cur == null) return undefined;\r\n\r\n      if (Array.isArray(cur)) {\r\n        const byKey = cur.find((item) => item && typeof item === \"object\" && \"key\" in item && String(item.key) === part);\r\n        if (byKey) {\r\n          cur = byKey;\r\n          continue;\r\n        }\r\n\r\n        const byName = cur.find((item) => item && typeof item === \"object\" && \"name\" in item && String(item.name) === part);\r\n        if (byName) {\r\n          cur = byName;\r\n          continue;\r\n        }\r\n\r\n        const byGrade = cur.find((item) => item && typeof item === \"object\" && \"grade\" in item && String(item.grade) === part);\r\n        if (byGrade) {\r\n          cur = byGrade;\r\n          continue;\r\n        }\r\n\r\n        const idx = Number(part);\r\n        if (Number.isInteger(idx) && String(idx) === part) {\r\n          cur = cur[idx];\r\n          continue;\r\n        }\r\n\r\n        return undefined;\r\n      }\r\n\r\n      if (typeof cur !== \"object\") return undefined;\r\n      cur = cur[part];\r\n    }\r\n    return cur;\r\n  }\r\n\r\n  // ...existing code...\r\n  const getBaselineValue = useCallback(\r\n    (path) => {\r\n      if (!path) return undefined;\r\n      const parts = path.split(\".\");\r\n      if (!parts.length) return undefined;\r\n      if (parts[0] === \"inputs\") {\r\n        const val = getValueAtPath(baselineInputs, parts.slice(1));\r\n        if (val !== undefined) return val;\r\n\r\n        const last = parts[parts.length - 1];\r\n\r\n        // If field ends with Y2/Y3 try base field fallback (e.g. unitCostY2 -> unitCost)\r\n        if (last.endsWith(\"Y2\") || last.endsWith(\"Y3\")) {\r\n          const suffix = last.endsWith(\"Y2\") ? \"Y2\" : \"Y3\";\r\n          const baseField = last.slice(0, -2);\r\n          const baseVal = getValueAtPath(baselineInputs, parts.slice(1, -1).concat(baseField));\r\n          if (baseVal !== undefined) {\r\n            // For unitCost-like fields, return the inflation-adjusted derived value so UI matches display logic\r\n            if (baseField === \"unitCost\" || baseField.startsWith(\"unitCost\")) {\r\n              const infl = getValueAtPath(baselineInputs, [\"temelBilgiler\", \"inflation\"]) || {};\r\n              const y2f = 1 + Number(infl?.y2 || 0);\r\n              const y3f = y2f * (1 + Number(infl?.y3 || 0));\r\n              return suffix === \"Y2\" ? Number(baseVal) * y2f : Number(baseVal) * y3f;\r\n            }\r\n            // Other Y2/Y3 fields (studentCountY2, ratioY2, valueY2, etc.) fall back to base field\r\n            return baseVal;\r\n          }\r\n        }\r\n\r\n        // studentCountY2/Y3 fallback -> studentCount\r\n        if ((last === \"studentCountY2\" || last === \"studentCountY3\") && baselineInputs) {\r\n          const parent = getValueAtPath(baselineInputs, parts.slice(1, -1));\r\n          if (parent && typeof parent === \"object\") {\r\n            const sc = parent.studentCount;\r\n            if (sc != null) return sc;\r\n          }\r\n        }\r\n\r\n        // kapasite / year fallbacks handled elsewhere above; generic years fallback:\r\n        const yearsIdx = parts.indexOf(\"years\");\r\n        if (yearsIdx >= 0 && parts.length > yearsIdx + 1 && baselineInputs) {\r\n          const yearKey = parts[yearsIdx + 1]; // e.g. 'y1','y2','y3'\r\n          if (yearKey === \"y2\" || yearKey === \"y3\") {\r\n            const altParts = [...parts];\r\n            altParts[yearsIdx + 1] = \"y1\";\r\n            const altVal = getValueAtPath(baselineInputs, altParts.slice(1));\r\n            if (altVal !== undefined) {\r\n              if (parts.includes(\"ik\") && parts.includes(\"unitCosts\")) {\r\n                const ratio = getValueAtPath(baselineInputs, [\"ik\", \"unitCostRatio\"]);\r\n                const r = Number(ratio);\r\n                if (Number.isFinite(r)) {\r\n                  const base = Number(altVal);\r\n                  const multiplier = yearKey === \"y2\" ? r : r * r;\r\n                  return Number.isFinite(base) ? base * multiplier : undefined;\r\n                }\r\n              }\r\n              return altVal;\r\n            }\r\n          }\r\n        }\r\n\r\n        // ik specific fallbacks:\r\n        if (parts.slice(1, 3).join(\".\") === \"ik.years\" && baselineInputs) {\r\n          if (parts.includes(\"unitCostRatio\")) {\r\n            const u = getValueAtPath(baselineInputs, [\"ik\", \"unitCostRatio\"]);\r\n            if (u !== undefined) return u;\r\n            return 1;\r\n          }\r\n          const leafCandidates = [\"unitCosts\", \"headcountsByLevel\"];\r\n          if (leafCandidates.some((c) => parts.includes(c))) {\r\n            return 0;\r\n          }\r\n        }\r\n\r\n        // generic kapasite fallbacks (years.cur/y1/y2/y3 etc.)\r\n        if ((last === \"y1\" || last === \"y2\" || last === \"y3\") && baselineInputs) {\r\n          const parent = getValueAtPath(baselineInputs, parts.slice(1, -1));\r\n          if (parent && typeof parent === \"object\" && parent.y1 != null) return parent.y1;\r\n\r\n          const byIdx = parts.indexOf(\"byKademe\");\r\n          if (byIdx >= 1 && parts.length > byIdx + 1) {\r\n            const lvlKey = parts[byIdx + 1];\r\n            const per = getValueAtPath(baselineInputs, [\"kapasite\", \"byKademe\", lvlKey, \"caps\", \"y1\"]);\r\n            if (per !== undefined) return per;\r\n          }\r\n\r\n          const yearsY1 = getValueAtPath(baselineInputs, [\"kapasite\", \"years\", \"y1\"]);\r\n          if (yearsY1 !== undefined) return yearsY1;\r\n        }\r\n\r\n        // cur fallback for kapasite -> per-kademe caps.cur or kapasite.currentStudents\r\n        if (last === \"cur\" && baselineInputs) {\r\n          const byIdx = parts.indexOf(\"byKademe\");\r\n          if (byIdx >= 1 && parts.length > byIdx + 1) {\r\n            const lvlKey = parts[byIdx + 1];\r\n            const per = getValueAtPath(baselineInputs, [\"kapasite\", \"byKademe\", lvlKey, \"caps\", \"cur\"]);\r\n            if (per !== undefined) return per;\r\n          }\r\n          const curAll = getValueAtPath(baselineInputs, [\"kapasite\", \"currentStudents\"]);\r\n          if (curAll !== undefined) return curAll;\r\n        }\r\n\r\n        return undefined;\r\n      }\r\n      if (parts[0] === \"norm\") return getValueAtPath(baselineNorm, parts.slice(1));\r\n      return undefined;\r\n    },\r\n    [baselineInputs, baselineNorm]\r\n  );\r\n  // ...existing code...\r\n\r\n  const inputsDirty = hasDirtyPrefix(\"inputs.\") || hasDirtyPrefix(\"norm.\");\r\n  const submitActiveWorkItem = useCallback(async () => {\r\n    if (!activeWorkId) return;\r\n    if (inputsDirty) {\r\n      const ok = await saveInputs();\r\n      if (!ok) return;\r\n    }\r\n    await submitWorkItem(activeWorkId);\r\n  }, [activeWorkId, inputsDirty, saveInputs, submitWorkItem]);\r\n  const reviewActiveWorkItem = useCallback(\r\n    async (action = \"approve\") => {\r\n      if (!activeWorkId || !selectedScenario?.id) return;\r\n      if (reviewingWorkItem) return;\r\n      setReviewingWorkItem(true);\r\n      try {\r\n        await api.reviewWorkItem(schoolId, selectedScenario.id, activeWorkId, { action });\r\n        toast.success(action === \"approve\" ? \"Onayland\" : \"Revize istendi\");\r\n        await refreshWorkItems();\r\n        await refreshScenarioMeta();\r\n      } catch (e) {\r\n        toast.error(e?.message || \"lem baarsz\");\r\n      } finally {\r\n        setReviewingWorkItem(false);\r\n      }\r\n    },\r\n    [activeWorkId, selectedScenario?.id, reviewingWorkItem, schoolId, refreshWorkItems, refreshScenarioMeta]\r\n  );\r\n  const role = String(me?.role || \"\");\r\n  const isAccountant = role === \"accountant\";\r\n  const suppressUnsavedWarning =\r\n    activeWorkId && activeWorkState === \"submitted\" && role && !isAccountant;\r\n  const warnUnsavedChanges = inputsDirty && !suppressUnsavedWarning;\r\n  const moduleLockReason =\r\n    activeWorkState === \"submitted\"\r\n      ? \"Modul incelemede\"\r\n      : activeWorkState === \"approved\"\r\n        ? \"Modul onaylandi\"\r\n        : \"Modul kilitli\";\r\n  const inputsLockedReason = scenarioLocked\r\n    ? \"Senaryo kilitli\"\r\n    : moduleLocked\r\n      ? moduleLockReason\r\n      : \"\";\r\n  const canSubmitWorkItem =\r\n    activeWorkId &&\r\n    !scenarioLocked &&\r\n    [\"not_started\", \"in_progress\", \"needs_revision\"].includes(activeWorkState);\r\n  const markDirty = useCallback(\r\n    (path, value) => {\r\n      if (!path) return;\r\n      if (inputsLocked && (path.startsWith(\"inputs.\") || path.startsWith(\"norm.\"))) return;\r\n      if (path.startsWith(\"inputs.\")) {\r\n        setInputs((prev) => {\r\n          if (!prev) return prev;\r\n          const parts = path.split(\".\");\r\n          const current = getValueAtPath(prev, parts.slice(1));\r\n          if (valuesEqual(current, value)) return prev;\r\n          const next = structuredClone(prev);\r\n          const ok = setValueAtPath(next, parts.slice(1), value);\r\n          return ok ? next : prev;\r\n        });\r\n      }\r\n      const baselineValue = getBaselineValue(path);\r\n      const same = valuesEqual(value, baselineValue);\r\n      setDirtyPaths((prev) => {\r\n        const next = new Set(prev);\r\n        if (same) next.delete(path);\r\n        else next.add(path);\r\n        return areSetsEqual(prev, next) ? prev : next;\r\n      });\r\n    },\r\n    [inputsLocked, getBaselineValue, setInputs]\r\n  );\r\n\r\n  // --------------------------------------------------------------\r\n  // Warn the user when navigating away with unsaved changes.\r\n  //\r\n  // React Router does not automatically prompt the user when leaving\r\n  // a page with unsaved changes. To ensure users do not lose their\r\n  // work, hook into the native `beforeunload` event. When there are\r\n  // dirty inputs (i.e. the user has modified fields that have not\r\n  // yet been saved), we register a `beforeunload` handler that\r\n  // prevents the default navigation and sets the `returnValue` on\r\n  // the event. Browsers display a generic confirmation dialog to\r\n  // confirm whether the user really wants to leave the page.\r\n  //\r\n  // Without this handler the browser will navigate away silently\r\n  // resulting in lost changes. By registering the handler only\r\n  // when there are unsaved changes and cleaning it up when there\r\n  // are none, we avoid unnecessary prompts.\r\n  useEffect(() => {\r\n    // Handler for the `beforeunload` event. This fires when the\r\n    // user attempts to close or navigate away from the page (e.g.\r\n    // by closing the tab, refreshing or navigating to another URL).\r\n    const handleBeforeUnload = (event) => {\r\n      // If there are unsaved changes, prevent the unload and set\r\n      // `returnValue` to an empty string. The exact message is\r\n      // ignored by most modern browsers, but setting this triggers\r\n      // the confirmation dialog.\r\n      if (warnUnsavedChanges) {\r\n        event.preventDefault();\r\n        // Chrome requires returnValue to be set.\r\n        event.returnValue = \"\";\r\n      }\r\n    };\r\n\r\n    // Register the event listener when there are unsaved changes.\r\n    if (warnUnsavedChanges) {\r\n      window.addEventListener(\"beforeunload\", handleBeforeUnload);\r\n    }\r\n\r\n    // Cleanup: always remove the listener to avoid multiple handlers\r\n    // and to ensure we do not prompt when there are no dirty inputs.\r\n    return () => {\r\n      window.removeEventListener(\"beforeunload\", handleBeforeUnload);\r\n    };\r\n  }, [warnUnsavedChanges]);\r\n\r\n  // --------------------------------------------------------------\r\n  // Expose a global flag for unsaved changes.\r\n  //\r\n  // When navigating between different sections of the application (e.g. via\r\n  // sidebar links) we need to know if there are unsaved changes in the\r\n  // current School page. We write a boolean flag on the `window` object\r\n  // whenever the `inputsDirty` state changes so that other components such\r\n  // as the sidebar navigation can read this value and display a prompt if\r\n  // necessary. When the component unmounts, we clear the flag.\r\n  useEffect(() => {\r\n    try {\r\n      window.__fsUnsavedChanges = warnUnsavedChanges;\r\n    } catch (_) {\r\n      // In non-browser environments `window` may not exist.\r\n    }\r\n    return () => {\r\n      try {\r\n        // Clear the flag on unmount or when navigating away from this page.\r\n        window.__fsUnsavedChanges = false;\r\n      } catch (_) { }\r\n    };\r\n  }, [warnUnsavedChanges]);\r\n  const handleIkSalaryComputed = React.useCallback(\r\n    (salaryByYear) => {\r\n      if (inputsLocked) return;\r\n      const patch = salaryByYear?.y1 || {};\r\n      const keys = [\r\n        \"turkPersonelMaas\",\r\n        \"turkDestekPersonelMaas\",\r\n        \"yerelPersonelMaas\",\r\n        \"yerelDestekPersonelMaas\",\r\n        \"internationalPersonelMaas\",\r\n      ];\r\n\r\n      setInputs((prev) => {\r\n        const p = prev || {};\r\n        const prevItems = p?.giderler?.isletme?.items || {};\r\n\r\n        let changed = false;\r\n        for (const k of keys) {\r\n          const a = Number(prevItems?.[k] || 0);\r\n          const b = Number(patch?.[k] || 0);\r\n          if (Math.abs(a - b) > 1e-6) {\r\n            changed = true;\r\n            break;\r\n          }\r\n        }\r\n        if (!changed) return prev;\r\n\r\n        const next = structuredClone(p);\r\n        next.giderler = next.giderler || {};\r\n        next.giderler.isletme = next.giderler.isletme || {};\r\n        next.giderler.isletme.items = next.giderler.isletme.items || {};\r\n        for (const k of keys) next.giderler.isletme.items[k] = Number(patch?.[k] || 0);\r\n        if (canWriteGiderler) {\r\n          // Derived salary totals should not require Giderler write permission\r\n          // for HR users; only mark dirty when the user can write expenses.\r\n          for (const k of keys) {\r\n            markDirty(`inputs.giderler.isletme.items.${k}`, Number(patch?.[k] || 0));\r\n          }\r\n        }\r\n        return next;\r\n      });\r\n    },\r\n    [inputsLocked, markDirty, canWriteGiderler]\r\n  );\r\n  const handlePlanningGradesChange = React.useCallback(\r\n    (v) => {\r\n      if (inputsLocked) return;\r\n      if (!v || typeof v !== \"object\") return;\r\n      setInputs((prev) => {\r\n        const p = prev || {};\r\n        let next = structuredClone(p);\r\n        next.gradesYears = v;\r\n        if (Array.isArray(v.y1)) next.grades = structuredClone(v.y1);\r\n        next = applyTuitionStudentCounts(next);\r\n        return next;\r\n      });\r\n    },\r\n    [applyTuitionStudentCounts, inputsLocked]\r\n  );\r\n  const setNormSafe = useCallback(\r\n    (updater) => {\r\n      if (inputsLocked) return;\r\n      setNorm((prev) => (typeof updater === \"function\" ? updater(prev) : updater));\r\n    },\r\n    [inputsLocked, setNorm]\r\n  );\r\n  const showInputsHeader = INPUT_HEADER_TABS.has(tab);\r\n  const exportDisabled = inputsSaving || calculating || exportingPdf || !report;\r\n  const formatRelative = (ms) => {\r\n    if (!ms) return \"\";\r\n    const diff = Math.max(0, (nowTick || Date.now()) - ms);\r\n    if (diff < 60000) return \"az once\";\r\n    if (diff < 3600000) return `${Math.floor(diff / 60000)} dk once`;\r\n    return `${Math.floor(diff / 3600000)} saat once`;\r\n  };\r\n\r\n  // Determine the display label and style for a scenario based on its\r\n  // workflow status and timestamps.  When a scenario is approved but\r\n  // has not yet been forwarded to the central office (sent_at is null),\r\n  // it is considered Kontrol edildi.  Once sent_at is set, the\r\n  // scenario is locked and considered Onayland.  The draft state\r\n  // optionally distinguishes Hazrlanyor when progress exists, but\r\n  // falls back to Taslak otherwise.\r\n  useEffect(() => {\r\n    if (exportDisabled) setExportOpen(false);\r\n  }, [exportDisabled]);\r\n\r\n\r\n\r\n  function getScenarioStageLabel(s, progressPct) {\r\n    if (!s) return null;\r\n    const status = String(s.status || \"draft\");\r\n    // Show \"Taslak\" when no progress; \"Hazrlanyor\" when progress exists\r\n    if (status === \"draft\") {\r\n      const pct = Number(progressPct);\r\n      if (Number.isFinite(pct) && pct > 0) return \"Hazrlanyor\";\r\n      return \"Taslak\";\r\n    }\r\n    if (status === \"in_review\") return \"ncelemede\";\r\n    if (status === \"revision_requested\") return \"Revize istendi\";\r\n    if (status === \"sent_for_approval\" || status === \"submitted\") return \"Merkeze iletildi\";\r\n    if (status === \"approved\") {\r\n      // Sent_at indicates final approval\r\n      if (s.sent_at) return \"Onayland\";\r\n      return \"Kontrol edildi\";\r\n    }\r\n    return \"Taslak\";\r\n  }\r\n  function getScenarioStageClass(label) {\r\n    switch (label) {\r\n      case \"Revize istendi\":\r\n        return \"is-bad\";\r\n      case \"Merkeze iletildi\":\r\n      case \"ncelemede\":\r\n      case \"Hazrlanyor\":\r\n        return \"is-warn\";\r\n      case \"Kontrol edildi\":\r\n      case \"Onayland\":\r\n        return \"is-ok\";\r\n      case \"Taslak\":\r\n      default:\r\n        return \"is-muted\";\r\n    }\r\n  }\r\n  function getWorkItemStageLabel(state) {\r\n    switch (String(state || \"not_started\")) {\r\n      case \"approved\":\r\n        return \"Kontrol edildi\";\r\n      case \"needs_revision\":\r\n        return \"Revize istendi\";\r\n      case \"submitted\":\r\n        return \"ncelemede\";\r\n      case \"in_progress\":\r\n        return \"Hazrlanyor\";\r\n      default:\r\n        return \"Taslak\";\r\n    }\r\n  }\r\n  function getModuleStatusClass(state, scenarioStatus, scenarioSentAt) {\r\n    if (scenarioStatus === \"approved\" && scenarioSentAt) {\r\n      return \"is-final\";\r\n    }\r\n    if ([\"sent_for_approval\", \"submitted\"].includes(String(scenarioStatus || \"\"))) {\r\n      return \"is-forwarded\";\r\n    }\r\n    switch (String(state || \"not_started\")) {\r\n      case \"needs_revision\":\r\n        return \"is-revision\";\r\n      case \"approved\":\r\n        return \"is-approved\";\r\n      case \"submitted\":\r\n        return \"is-review\";\r\n      case \"in_progress\":\r\n      case \"not_started\":\r\n      default:\r\n        return \"is-draft\";\r\n    }\r\n  }\r\n\r\n  function renderStickyFooter() {\r\n    if (!showInputsHeader) return null;\r\n    // Build module progress segments.  Each segment uses the pct from progMap\r\n    // and averages for the combined \"norm\" and \"gider\" modules.\r\n    const moduleKeyToWorkId = {\r\n      temel: \"temel_bilgiler\",\r\n      kapasite: \"kapasite\",\r\n      norm: \"norm.ders_dagilimi\",\r\n      ik: \"ik.local_staff\",\r\n      gelir: \"gelirler.unit_fee\",\r\n      gider: \"giderler.isletme\",\r\n    };\r\n    const getModuleWorkState = (moduleKey) => {\r\n      if (!moduleKey) return \"not_started\";\r\n      if (!workItemsLoaded) return \"not_started\";\r\n      const workId = moduleKeyToWorkId[moduleKey];\r\n      if (!workId) return \"not_started\";\r\n      const item = Array.isArray(workItems)\r\n        ? workItems.find((w) => String(w?.work_id) === String(workId))\r\n        : null;\r\n      return item?.state ? String(item.state) : \"not_started\";\r\n    };\r\n    const footerModules = [];\r\n    if (progMap && progMap.temelBilgiler) {\r\n      footerModules.push({\r\n        key: \"temel\",\r\n        label: \"Temel\",\r\n        labelShort: \"Temel\",\r\n        pct: pctValue(progMap.temelBilgiler),\r\n        done: progMap.temelBilgiler.done === true,\r\n      });\r\n    }\r\n    if (progMap && progMap.kapasite) {\r\n      footerModules.push({\r\n        key: \"kapasite\",\r\n        label: \"Kapasite\",\r\n        labelShort: \"Kap\",\r\n        pct: pctValue(progMap.kapasite),\r\n        done: progMap.kapasite.done === true,\r\n      });\r\n    }\r\n    // Combine gradesPlan and norm into a single \"Norm\" segment.  Use normAvgPct for pct.\r\n    const normDone = ignoreNormProgress\r\n      ? (progMap?.gradesPlan?.done === true || progMap?.gradesPlan?.done === undefined)\r\n      : (progMap?.gradesPlan?.done === true || progMap?.gradesPlan?.done === undefined) &&\r\n        (progMap?.norm?.done === true || progMap?.norm?.done === undefined);\r\n    footerModules.push({\r\n      key: \"norm\",\r\n      label: \"Norm\",\r\n      labelShort: \"Norm\",\r\n      pct: Number.isFinite(normAvgPct) ? normAvgPct : 0,\r\n      done: normDone,\r\n    });\r\n    if (progMap && progMap.ik) {\r\n      footerModules.push({\r\n        key: \"ik\",\r\n        label: \"K\",\r\n        labelShort: \"K\",\r\n        pct: pctValue(progMap.ik),\r\n        done: progMap.ik.done === true,\r\n      });\r\n    }\r\n    if (progMap && progMap.gelirler) {\r\n      footerModules.push({\r\n        key: \"gelir\",\r\n        label: \"Gelir\",\r\n        labelShort: \"Gel\",\r\n        pct: pctValue(progMap.gelirler),\r\n        done: progMap.gelirler.done === true,\r\n      });\r\n    }\r\n    // Combine giderler and discounts into a single \"Gider\" segment.  Use expensesAvgPct.\r\n    const giderDone =\r\n      (progMap?.giderler?.done === true || progMap?.giderler?.done === undefined) &&\r\n      (progMap?.discounts?.done === true || progMap?.discounts?.done === undefined);\r\n    footerModules.push({\r\n      key: \"gider\",\r\n      label: \"Gider\",\r\n      labelShort: \"Gid\",\r\n      pct: Number.isFinite(expensesAvgPct) ? expensesAvgPct : 0,\r\n      done: giderDone,\r\n    });\r\n    const allModulesDone = footerModules.every((m) => m.done);\r\n    // Determine scenario progress pct for label heuristics\r\n    const scenarioProgressPct = selectedScenario?.progress_pct;\r\n    // Determine status pills: scenario-first when workflow advanced beyond draft,\r\n    // but prefer module-level \"approved/revision\" states.\r\n    const scenarioStageLabel = selectedScenario ? getScenarioStageLabel(selectedScenario, scenarioProgressPct) : null;\r\n    const scenarioDisplayLabel =\r\n      scenarioStageLabel &&\r\n      [\"ncelemede\", \"Revize istendi\", \"Merkeze iletildi\", \"Kontrol edildi\", \"Onayland\"].includes(\r\n        scenarioStageLabel\r\n      )\r\n        ? scenarioStageLabel\r\n        : null;\r\n    const scenarioDisplayClass = scenarioDisplayLabel ? getScenarioStageClass(scenarioDisplayLabel) : null;\r\n    const workItemLabel = workItemsLoaded && activeWorkId ? getWorkItemStageLabel(activeWorkState) : null;\r\n    const workItemClass = workItemLabel ? getScenarioStageClass(workItemLabel) : null;\r\n    const hasActiveWorkLabel = Boolean(activeWorkId && workItemLabel);\r\n\r\n    let scenarioTooltip = null;\r\n    if (scenarioDisplayLabel === \"Kontrol edildi\" && selectedScenario?.checked_at) {\r\n      const d = new Date(selectedScenario.checked_at);\r\n      scenarioTooltip = `Kontrol: ${Number.isFinite(d.getTime()) ? d.toLocaleString() : \"\"}`;\r\n    } else if (scenarioDisplayLabel === \"Merkeze iletildi\" && selectedScenario?.sent_at) {\r\n      const d = new Date(selectedScenario.sent_at);\r\n      scenarioTooltip = `letildi: ${Number.isFinite(d.getTime()) ? d.toLocaleString() : \"\"}`;\r\n    } else if (scenarioDisplayLabel === \"Onayland\" && selectedScenario?.reviewed_at) {\r\n      const d = new Date(selectedScenario.reviewed_at);\r\n      scenarioTooltip = `Onay: ${Number.isFinite(d.getTime()) ? d.toLocaleString() : \"\"}`;\r\n    }\r\n\r\n    let primaryPill = null;\r\n    let secondaryPill = null;\r\n\r\n    const scenarioIsFinal = scenarioDisplayLabel === \"Merkeze iletildi\" || scenarioDisplayLabel === \"Onayland\";\r\n    const allowScenarioPill =\r\n      scenarioIsFinal || !activeWorkId || (workItemsLoaded && scenarioMetaLoaded);\r\n    const scenarioPillLabel = allowScenarioPill ? scenarioDisplayLabel : null;\r\n    const scenarioPillClass = allowScenarioPill ? scenarioDisplayClass : null;\r\n    const scenarioPillTooltip = allowScenarioPill ? scenarioTooltip : null;\r\n\r\n    if (scenarioIsFinal && scenarioPillLabel) {\r\n      primaryPill = { label: scenarioPillLabel, className: scenarioPillClass, tooltip: scenarioPillTooltip };\r\n    } else if (hasActiveWorkLabel) {\r\n      primaryPill = { label: workItemLabel, className: workItemClass };\r\n      const suppressScenarioPill =\r\n        (scenarioPillLabel === \"Revize istendi\" && activeWorkState !== \"needs_revision\") ||\r\n        (scenarioPillLabel === \"Kontrol edildi\" && activeWorkState === \"needs_revision\") ||\r\n        (scenarioPillLabel === \"ncelemede\" && activeWorkState === \"approved\");\r\n      if (scenarioPillLabel && scenarioPillLabel !== workItemLabel && !suppressScenarioPill) {\r\n        secondaryPill = { label: scenarioPillLabel, className: scenarioPillClass, tooltip: scenarioPillTooltip };\r\n      }\r\n    } else if (scenarioPillLabel) {\r\n      primaryPill = { label: scenarioPillLabel, className: scenarioPillClass, tooltip: scenarioPillTooltip };\r\n      if (workItemLabel && workItemLabel !== scenarioPillLabel) {\r\n        secondaryPill = { label: workItemLabel, className: workItemClass };\r\n      }\r\n    } else if (workItemLabel) {\r\n      primaryPill = { label: workItemLabel, className: workItemClass };\r\n    }\r\n    // Determine footer meta text\r\n    const footerMetaBits = [];\r\n    if (lastSavedAt) footerMetaBits.push(`Kaydedildi ${formatRelative(lastSavedAt)}`);\r\n    if (lastCalculatedAt) footerMetaBits.push(`Hesapland ${formatRelative(lastCalculatedAt)}`);\r\n    let showDebug = false;\r\n    try {\r\n      showDebug = window?.localStorage?.getItem(\"fs_debug_kpi\") === \"1\";\r\n    } catch (_) {\r\n      showDebug = false;\r\n    }\r\n    if (showDebug) {\r\n      const debugBits = [\r\n        `calc:${calculating ? \"1\" : \"0\"}`,\r\n        `lastCalc:${lastCalculatedAt ? new Date(lastCalculatedAt).toLocaleTimeString() : \"none\"}`,\r\n        `report:${report ? \"yes\" : \"no\"}`,\r\n      ];\r\n      footerMetaBits.push(`DEBUG ${debugBits.join(\"  \")}`);\r\n    }\r\n    const footerMetaText = footerMetaBits.join(\"  \");\r\n    const hasFooterMeta = Boolean(footerMetaText);\r\n    // Determine primary action\r\n    // We compute role-aware capability flags above.  The final action\r\n    // selection must respect the following priority order:\r\n    // 1. Admin \"Onayla\" > 2. Accountant/Manager \"Merkeze ilet\" > 3. Principal/HR \"Gnder\".\r\n    const role = String(me?.role || \"\");\r\n    // Build scope options for permission checks.  Include the countryId if\r\n    // available (via the loaded school or current user) so that\r\n    // country-scoped permissions can match.  Without a countryId, a\r\n    // permission entry with a non-null scope_country_id will not match.\r\n    const countryIdForScope = school?.country_id ?? me?.country_id ?? null;\r\n    const scopeOpts = { schoolId, countryId: countryIdForScope };\r\n    const scenarioStatus = selectedScenario?.status;\r\n    const hasScenario = selectedScenario && selectedScenario.id;\r\n    // Helper to check permission using can()\r\n    const userCan = (res, action) => {\r\n      try {\r\n        return can(me, res, action, scopeOpts);\r\n      } catch {\r\n        return false;\r\n      }\r\n    };\r\n    const moduleKeyToTab = {\r\n      temel: \"basics\",\r\n      kapasite: \"kapasite\",\r\n      norm: \"norm\",\r\n      ik: \"hr\",\r\n      gelir: \"income\",\r\n      gider: \"expenses\",\r\n    };\r\n    const moduleKeyToPageKey = {\r\n      temel: \"temel_bilgiler\",\r\n      kapasite: \"kapasite\",\r\n      norm: \"norm\",\r\n      ik: \"ik\",\r\n      gelir: \"gelirler\",\r\n      gider: \"giderler\",\r\n    };\r\n    const canNavigateModule = (moduleKey) => {\r\n      const pageKey = moduleKeyToPageKey[moduleKey];\r\n      if (!pageKey) return false;\r\n      if (userCan(`page.${pageKey}`, \"read\")) return true;\r\n      const perms = Array.isArray(me?.permissions) ? me.permissions : [];\r\n      const countryId = scopeOpts.countryId;\r\n      return perms.some((perm) => {\r\n        if (perm.action !== \"read\" && perm.action !== \"write\") return false;\r\n        const res = String(perm.resource || \"\");\r\n        if (!res.startsWith(`section.${pageKey}.`)) return false;\r\n        const permCountry = perm.scope_country_id != null ? Number(perm.scope_country_id) : null;\r\n        const permSchool = perm.scope_school_id != null ? Number(perm.scope_school_id) : null;\r\n        if (permCountry != null && countryId != null && Number(permCountry) !== Number(countryId)) return false;\r\n        if (permSchool != null && schoolId != null && Number(permSchool) !== Number(schoolId)) return false;\r\n        if (permSchool != null && schoolId == null) return false;\r\n        if (permCountry != null && countryId == null) return false;\r\n        return true;\r\n      });\r\n    };\r\n    // Determine if user can perform scenario-level or module-level actions\r\n    // Scenario can only be sent when the active module is completed.\r\n    // Map active work ID to internal module key and to page permission resource\r\n    const workIdToKey = {\r\n      \"temel_bilgiler\": \"temel\",\r\n      \"kapasite\": \"kapasite\",\r\n      \"norm.ders_dagilimi\": \"norm\",\r\n      \"ik.local_staff\": \"ik\",\r\n      \"gelirler.unit_fee\": \"gelir\",\r\n      \"giderler.isletme\": \"gider\",\r\n    };\r\n    // Define the potential permission resources for each work item.  A module may\r\n    // have both a page-level and a section-level resource; having write\r\n    // permission on any of these resources allows the user to submit the\r\n    // module.  The order is from most specific (section-level) to page-level.\r\n    const workIdToWriteResources = {\r\n      \"temel_bilgiler\": [\"page.temel_bilgiler\"],\r\n      \"kapasite\": [\"section.kapasite.caps\", \"page.kapasite\"],\r\n      \"norm.ders_dagilimi\": [\"section.norm.ders_dagilimi\", \"page.norm\"],\r\n      \"ik.local_staff\": [\"section.ik.local_staff\", \"page.ik\"],\r\n      \"gelirler.unit_fee\": [\"section.gelirler.unit_fee\", \"page.gelirler\"],\r\n      \"giderler.isletme\": [\"section.giderler.isletme\", \"page.giderler\"],\r\n    };\r\n    const activeModuleKey = workIdToKey[String(activeWorkId || \"\")] || null;\r\n    const activeModuleObj = footerModules.find((m) => m.key === activeModuleKey);\r\n    const activeModuleDone = activeModuleObj ? activeModuleObj.done === true : false;\r\n    // Determine whether the user may attempt to submit (at least show the button).\r\n    // Principals/HR may submit when the scenario is in draft, in_review, or revision_requested.\r\n    // We only check module write permission and activeWorkId when enabling the button.\r\n    const canSubmitScenarioBase =\r\n      hasScenario &&\r\n      [\"draft\", \"in_review\", \"revision_requested\"].includes(scenarioStatus) &&\r\n      (role === \"principal\" || role === \"hr\" || role === \"manager\" || role === \"accountant\");\r\n    // Map active work ID to the corresponding page permission resource (if any)\r\n    const writeResources = activeWorkId ? workIdToWriteResources[String(activeWorkId)] || [] : [];\r\n    const userHasModuleWrite = writeResources.some((res) => {\r\n      try {\r\n        return userCan(res, \"write\");\r\n      } catch {\r\n        return false;\r\n      }\r\n    });\r\n    // Full submit flag: base permission and active module completed\r\n    // Determine if the user can actually submit the module right now.\r\n    // Must have base submit rights, an active work item, write permission on that module, and the module must be completed.\r\n    const canForwardScenario =\r\n      hasScenario &&\r\n      (role === \"accountant\" || role === \"manager\" || userCan(\"scenario.forward\", \"write\")) &&\r\n      scenarioStatus === \"approved\" &&\r\n      !selectedScenario?.sent_at &&\r\n      selectedScenario?.checked_at;\r\n    const canApproveScenario =\r\n      hasScenario &&\r\n      (role === \"admin\" || userCan(\"admin.scenario.review\", \"write\")) &&\r\n      scenarioStatus === \"sent_for_approval\";\r\n    const canReviewWorkItem =\r\n      hasScenario &&\r\n      activeWorkId &&\r\n      activeWorkState === \"submitted\" &&\r\n      (role === \"admin\" ||\r\n        role === \"manager\" ||\r\n        role === \"accountant\" ||\r\n        userCan(\"page.manage_permissions\", \"read\") ||\r\n        userCan(\"page.manage_permissions\", \"write\"));\r\n    const reviewDisabled =\r\n      reviewingWorkItem || inputsSaving || calculating || inputsDirty;\r\n    let reviewTooltip = \"Modl onayla\";\r\n    if (inputsDirty) {\r\n      reviewTooltip = \"nce deiiklikleri kaydedin.\";\r\n    } else if (inputsSaving) {\r\n      reviewTooltip = \"Kaydetme devam ediyor.\";\r\n    } else if (calculating) {\r\n      reviewTooltip = \"Hesaplama devam ediyor.\";\r\n    } else if (reviewingWorkItem) {\r\n      reviewTooltip = \"Onaylanyor...\";\r\n    }\r\n\r\n    // Calculate button permission: user must have write permissions on *all* modules\r\n    // Define the list of module page resources that correspond to scenario modules.\r\n    const moduleResources = [\r\n      \"page.temel_bilgiler\",\r\n      \"page.kapasite\",\r\n      \"page.norm\",\r\n      \"page.ik\",\r\n      \"page.gelirler\",\r\n      \"page.giderler\",\r\n    ];\r\n    const hasAllModuleWritePermissions = moduleResources.every((res) => {\r\n      try {\r\n        return can(me, res, \"write\", scopeOpts);\r\n      } catch {\r\n        return false;\r\n      }\r\n    });\r\n    // Determine disabled reasons\r\n    const primaryTooltipReasons = [];\r\n    let primaryDisabled = true;\r\n    let primaryLabel = \"\";\r\n    let primaryIcon = null;\r\n    let primaryOnClick = null;\r\n    // We evaluate actions in priority: Admin > Manager > Principal.\r\n    if (canApproveScenario) {\r\n      // Admin final approval\r\n      primaryLabel = \"Onayla\";\r\n      primaryIcon = <FaCheckCircle aria-hidden=\"true\" />;\r\n      primaryDisabled = false;\r\n      // Admin page rarely allows editing; still guard against concurrent save/calc\r\n      if (inputsSaving) {\r\n        primaryDisabled = true;\r\n        primaryTooltipReasons.push(\"Kaydetme devam ediyor.\");\r\n      }\r\n      if (calculating) {\r\n        primaryDisabled = true;\r\n        primaryTooltipReasons.push(\"Hesaplama devam ediyor.\");\r\n      }\r\n      if (!primaryDisabled) {\r\n        primaryOnClick = async () => {\r\n          try {\r\n            await api.adminReviewScenario(selectedScenario.id, { action: \"approve\" });\r\n            toast.success(\"Onayland\");\r\n            await refreshWorkItems();\r\n            await refreshScenarioMeta();\r\n          } catch (e) {\r\n            toast.error(e?.message || \"Onay baarsz\");\r\n          }\r\n        };\r\n      }\r\n    } else if (canForwardScenario) {\r\n      // Accountant/manager forward to admin\r\n      primaryLabel = \"Merkeze ilet\";\r\n      primaryIcon = <FaPaperPlane aria-hidden=\"true\" />;\r\n      primaryDisabled = false;\r\n      // disallow if modules incomplete or there are pending changes or locks\r\n      if (!allModulesDone) {\r\n        primaryDisabled = true;\r\n        const incomplete = footerModules.filter((m) => !m.done);\r\n        primaryTooltipReasons.push(\r\n          \"Tm modller tamamlanmal: \" +\r\n            incomplete.map((m) => `${m.label} ${m.pct}%`).join(\", \")\r\n        );\r\n      }\r\n      if (inputsDirty) {\r\n        primaryDisabled = true;\r\n        primaryTooltipReasons.push(\"nce deiiklikleri kaydedin.\");\r\n      }\r\n      if (inputsSaving) {\r\n        primaryDisabled = true;\r\n        primaryTooltipReasons.push(\"Kaydetme devam ediyor.\");\r\n      }\r\n      if (calculating) {\r\n        primaryDisabled = true;\r\n        primaryTooltipReasons.push(\"Hesaplama devam ediyor.\");\r\n      }\r\n      if (scenarioLocked) {\r\n        primaryDisabled = true;\r\n        primaryTooltipReasons.push(\"Senaryo kilitli.\");\r\n      }\r\n      if (!primaryDisabled) {\r\n        primaryOnClick = async () => {\r\n          try {\r\n            if (!ensurePrevRealFxForLocal(\"Hesaplama\")) return;\r\n            if (!ensurePlanningStudentsForY2Y3(\"Hesaplama\")) return;\r\n            // Save and recalc if needed\r\n            if (inputsDirty) {\r\n              const ok = await saveInputs();\r\n              if (!ok) return;\r\n            }\r\n            // Always calculate before sending so KPIs are up to date\r\n            const calcOk = await calculate({ keepTab: true });\r\n            if (!calcOk) return;\r\n            await api.sendForApproval(schoolId, selectedScenario.id);\r\n            toast.success(\"Merkeze iletildi\");\r\n            await refreshWorkItems();\r\n            await refreshScenarioMeta();\r\n          } catch (e) {\r\n            toast.error(e?.message || \"letme baarsz\");\r\n          }\r\n        };\r\n      }\r\n    } else if (canSubmitScenarioBase) {\r\n      // Principal/HR submit to manager (module-level). Show button even if disabled.\r\n      primaryLabel = \"Gnder\";\r\n      primaryIcon = <FaPaperPlane aria-hidden=\"true\" />;\r\n      primaryDisabled = false;\r\n      // Validate prerequisites for module submission.  If any check fails we still show\r\n      // the button but keep it disabled with an explanatory tooltip.\r\n      if (!activeWorkId) {\r\n        primaryDisabled = true;\r\n        primaryTooltipReasons.push(\"Gnderilecek bir modl yok.\");\r\n      }\r\n      // User must have write permission on the active module's resource (page or section).\r\n      if (activeWorkId && !userHasModuleWrite) {\r\n        primaryDisabled = true;\r\n        primaryTooltipReasons.push(\"Bu modl gnderme yetkiniz yok.\");\r\n      }\r\n      // Module must be in a state that allows submission (not submitted or approved).\r\n      if (activeWorkId && !canSubmitWorkItem) {\r\n        primaryDisabled = true;\r\n        primaryTooltipReasons.push(moduleLockReason || \"Modl gnderilemez\");\r\n      }\r\n      // Module must be completed before sending.\r\n      if (!activeModuleDone) {\r\n        primaryDisabled = true;\r\n        primaryTooltipReasons.push(\"Bu modl tamamlanmal.\");\r\n      }\r\n      // Cannot submit while there are unsaved changes.\r\n      if (inputsDirty) {\r\n        primaryDisabled = true;\r\n        primaryTooltipReasons.push(\"nce deiiklikleri kaydedin.\");\r\n      }\r\n      if (inputsSaving) {\r\n        primaryDisabled = true;\r\n        primaryTooltipReasons.push(\"Kaydetme devam ediyor.\");\r\n      }\r\n      if (calculating) {\r\n        primaryDisabled = true;\r\n        primaryTooltipReasons.push(\"Hesaplama devam ediyor.\");\r\n      }\r\n      if (scenarioLocked) {\r\n        primaryDisabled = true;\r\n        primaryTooltipReasons.push(\"Senaryo kilitli.\");\r\n      }\r\n      if (!primaryDisabled && activeWorkId && userHasModuleWrite && canSubmitWorkItem && activeModuleDone) {\r\n        // For module-level submission, submit only the active work item.\r\n        primaryOnClick = async () => {\r\n          await submitActiveWorkItem();\r\n        };\r\n      }\r\n    }\r\n    const primaryTooltip =\r\n      primaryTooltipReasons.length > 0 ? primaryTooltipReasons.join(\"  \") : undefined;\r\n    // Determine calculate and export labels as before\r\n    const hasReport = Boolean(report);\r\n    const calculateLabel = inputsDirty ? \"Kaydet & Hesapla\" : hasReport ? \"Yeniden Hesapla\" : \"Hesapla\";\r\n    const exportLabel = exportingPdf ? \"PDF hazirlaniyor...\" : \"Disa Aktar\";\r\n    const showExportButton = tab === \"report\" || hasReport;\r\n    return (\r\n      <div className=\"school-sticky-footer\" role=\"region\" aria-label=\"Scenario actions\">\r\n        <div className=\"school-sticky-footer-inner\">\r\n          <div className=\"school-footer-left\">\r\n            {/* Status chips */}\r\n            <div className=\"school-footer-pills\" role=\"status\" aria-live=\"polite\">\r\n              {primaryPill ? (\r\n                <span className={`school-pill ${primaryPill.className}`} title={primaryPill.tooltip}>\r\n                  {primaryPill.label}\r\n                </span>\r\n              ) : null}\r\n              {secondaryPill ? (\r\n                <span className={`school-pill ${secondaryPill.className}`} title={secondaryPill.tooltip}>\r\n                  {secondaryPill.label}\r\n                </span>\r\n              ) : null}\r\n              {inputs ? (\r\n                <span\r\n                  className={`school-pill is-warn ${inputsDirty ? \"\" : \"is-placeholder\"}`}\r\n                  title={inputsDirty ? \"Kaydedilmemi deiiklikler var\" : undefined}\r\n                  aria-hidden={inputsDirty ? undefined : \"true\"}\r\n                >\r\n                   Deiiklik var\r\n                </span>\r\n              ) : null}\r\n            </div>\r\n            {inputs ? (\r\n              <div\r\n                className={`school-footer-meta small ${hasFooterMeta ? \"\" : \"is-placeholder\"}`}\r\n                title={hasFooterMeta ? footerMetaText : undefined}\r\n                aria-hidden={hasFooterMeta ? undefined : \"true\"}\r\n              >\r\n                {hasFooterMeta ? footerMetaText : \"Kaydedildi\"}\r\n              </div>\r\n            ) : null}\r\n          </div>\r\n\r\n      {inputs ? (\r\n        <>\r\n          {/* Middle section: progress bar sits in its own container between status and buttons */}\r\n          <div className=\"school-footer-middle\">\r\n            <div className=\"module-progress\" role=\"progressbar\" aria-valuemin=\"0\" aria-valuemax=\"100\">\r\n              {footerModules.map((m) => {\r\n                const tabKey = moduleKeyToTab[m.key];\r\n                const canNav = Boolean(tabKey && canNavigateModule(m.key));\r\n                const isActive = activeModuleKey === m.key;\r\n                const workState = getModuleWorkState(m.key);\r\n                const statusClass = getModuleStatusClass(\r\n                  workState,\r\n                  selectedScenario?.status,\r\n                  selectedScenario?.sent_at\r\n                );\r\n                const SegmentTag = canNav ? \"button\" : \"div\";\r\n                return (\r\n                  <SegmentTag\r\n                    key={m.key}\r\n                    type={canNav ? \"button\" : undefined}\r\n                    onClick={canNav ? () => setTab(tabKey) : undefined}\r\n                    className={`module-seg ${canNav ? \"is-clickable\" : \"\"} ${isActive ? \"is-active\" : \"\"}`}\r\n                    title={`${m.label}: ${Math.round(m.pct)}% ${m.done ? \"Tamamland\" : \"Eksik\"}`}\r\n                    aria-disabled={canNav ? undefined : \"true\"}\r\n                  >\r\n                    <div className=\"module-title\">{m.labelShort}</div>\r\n                    <div className=\"module-bar\">\r\n                      <div\r\n                        className={`module-fill ${statusClass}`}\r\n                        style={{ width: `${Math.min(100, Math.max(0, Math.round(m.pct)))}%` }}\r\n                      />\r\n                      <span className=\"module-percent\">{Math.round(m.pct)}%</span>\r\n                    </div>\r\n                  </SegmentTag>\r\n                );\r\n              })}\r\n            </div>\r\n          </div>\r\n          {/* Right section: action buttons aligned to the far right */}\r\n          <div className=\"school-footer-right\">\r\n            {canReviewWorkItem ? (\r\n              <Tooltip lines={reviewTooltip ? [reviewTooltip] : []}>\r\n                <button\r\n                  type=\"button\"\r\n                  className=\"topbar-btn is-primary\"\r\n                  onClick={() => reviewActiveWorkItem(\"approve\")}\r\n                  disabled={reviewDisabled}\r\n                  title={reviewTooltip}\r\n                >\r\n                  <FaCheckCircle aria-hidden=\"true\" />\r\n                  <span>{reviewingWorkItem ? \"Onaylanyor...\" : \"Onayla\"}</span>\r\n                </button>\r\n              </Tooltip>\r\n            ) : null}\r\n            {primaryLabel ? (\r\n              <Tooltip lines={primaryTooltip ? [primaryTooltip] : []}>\r\n                <button\r\n                  type=\"button\"\r\n                  className=\"topbar-btn is-primary\"\r\n                  onClick={primaryOnClick}\r\n                  disabled={primaryDisabled}\r\n                  title={primaryTooltip}\r\n                >\r\n                  {primaryIcon}\r\n                  <span>{primaryLabel}</span>\r\n                </button>\r\n              </Tooltip>\r\n            ) : null}\r\n            <button\r\n              type=\"button\"\r\n              className={\"topbar-btn \" + (inputsDirty && !inputsSaving ? \"is-save\" : \"is-ghost\")}\r\n              onClick={saveInputs}\r\n              disabled={!inputsDirty || inputsSaving || inputsLocked}\r\n              title={\r\n                inputsLocked\r\n                  ? inputsLockedReason\r\n                  : inputsDirty\r\n                    ? \"Deiiklikleri kaydet\"\r\n                    : \"Kaydedilecek deiiklik yok\"\r\n              }\r\n            >\r\n              <FaSave aria-hidden=\"true\" />\r\n              <span>{inputsSaving ? \"Kaydediliyor...\" : inputsDirty ? \"Kaydet\" : \"Kaydedildi\"}</span>\r\n            </button>\r\n\r\n            {hasAllModuleWritePermissions ? (\r\n              <button\r\n                type=\"button\"\r\n                className=\"topbar-btn is-primary\"\r\n                onClick={async () => {\r\n                  if (inputsSaving || calculating) return;\r\n                  if (!ensurePrevRealFxForLocal(\"Hesaplama\")) return;\r\n                  if (!ensurePlanningStudentsForY2Y3(\"Hesaplama\")) return;\r\n                  if (inputsDirty) {\r\n                    const ok = await saveInputs();\r\n                    if (ok) await calculate();\r\n                    return;\r\n                  }\r\n                  await calculate();\r\n                }}\r\n                disabled={inputsSaving || calculating}\r\n                title={calculateLabel}\r\n              >\r\n                <FaCalculator aria-hidden=\"true\" />\r\n                <span>{calculating ? \"Hesaplanyor...\" : calculateLabel}</span>\r\n              </button>\r\n            ) : null}\r\n\r\n            {showExportButton ? (\r\n              <div className=\"action-menu\" ref={exportMenuRef}>\r\n                <button\r\n                  type=\"button\"\r\n                  className={`topbar-btn is-ghost ${exportingPdf ? \"is-loading\" : \"\"}`}\r\n                  onClick={() => {\r\n                    if (exportDisabled) return;\r\n                    setExportOpen((prev) => !prev);\r\n                  }}\r\n                  disabled={exportDisabled}\r\n                  aria-haspopup=\"menu\"\r\n                  aria-expanded={exportOpen}\r\n                  aria-busy={exportingPdf ? \"true\" : undefined}\r\n                >\r\n                  {exportingPdf ? <span className=\"pdf-export-spinner\" aria-hidden=\"true\" /> : null}\r\n                  {!exportingPdf ? <FaFileExport aria-hidden=\"true\" /> : null}\r\n                  <span>{exportLabel}</span>\r\n                </button>\r\n\r\n                {exportOpen ? (\r\n                  <div className=\"action-menu-panel action-menu-panel--up\" role=\"menu\">\r\n                    <button\r\n                      type=\"button\"\r\n                      className=\"action-menu-item\"\r\n                      onClick={() => {\r\n                        setExportOpen(false);\r\n                        handleExport();\r\n                      }}\r\n                      disabled={exportDisabled}\r\n                      role=\"menuitem\"\r\n                    >\r\n                      Excel (.xlsx)\r\n                    </button>\r\n                    <button\r\n                      type=\"button\"\r\n                      className=\"action-menu-item\"\r\n                      onClick={() => {\r\n                        setExportOpen(false);\r\n                        handleExportPdf();\r\n                      }}\r\n                      disabled={exportDisabled}\r\n                      role=\"menuitem\"\r\n                    >\r\n                      PDF (.pdf)\r\n                    </button>\r\n                  </div>\r\n                ) : null}\r\n              </div>\r\n            ) : null}\r\n          </div>\r\n        </>\r\n      ) : (\r\n        <div className=\"school-footer-right\">\r\n          <div className=\"school-footer-hint small\">nce bir senaryo sein.</div>\r\n        </div>\r\n      )}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const outletContextValue = {\r\n    schoolId,\r\n    school,\r\n    me,\r\n    inputs,\r\n    setField,\r\n    norm,\r\n    setNorm: setNormSafe,\r\n    handlePlanningGradesChange,\r\n    dirtyPaths,\r\n    markDirty,\r\n    baseYear,\r\n    programType,\r\n    inputCurrencyCode,\r\n    selectedScenario,\r\n    prevReport,\r\n    prevScenarioMeta,\r\n    report,\r\n    reportCurrency,\r\n    setReportCurrency,\r\n    reportMode,\r\n    reportModeLoading,\r\n    handleReportModeChange,\r\n    detailedReportMode,\r\n    setDetailedReportMode,\r\n    reportExportRef,\r\n    progMap,\r\n    normAvgPct,\r\n    expensesAvgPct,\r\n    normMissingLines,\r\n    expensesMissingLines,\r\n    uiScopeKey,\r\n    handleIkSalaryComputed,\r\n\r\n    // Work item workflow context\r\n    workItems,\r\n    refreshWorkItems,\r\n    submitWorkItem,\r\n  };\r\n\r\n  return (\r\n    <div className=\"container school-page\">\r\n      <ToastContainer position=\"bottom-right\" autoClose={3500} newestOnTop closeOnClick pauseOnFocusLoss pauseOnHover hideProgressBar theme=\"dark\" />\r\n      <style>{`@keyframes schoolSpin{to{transform:rotate(360deg)}}`}</style>\r\n      {bootLoading ? (\r\n        <div className=\"modal-backdrop\" role=\"status\" aria-live=\"polite\" aria-busy=\"true\">\r\n          <div\r\n            className=\"card\"\r\n            style={{\r\n              width: \"min(420px, 92vw)\",\r\n              padding: \"18px 16px\",\r\n              textAlign: \"center\",\r\n            }}\r\n          >\r\n            <div\r\n              aria-hidden\r\n              style={{\r\n                width: 36,\r\n                height: 36,\r\n                margin: \"0 auto\",\r\n                borderRadius: \"50%\",\r\n                border: \"3px solid rgba(0,0,0,.15)\",\r\n                borderTopColor: \"rgba(0,0,0,.75)\",\r\n                animation: \"schoolSpin .8s linear infinite\",\r\n              }}\r\n            />\r\n            <div style={{ fontWeight: 800, marginTop: 12 }}>\r\n              {bootLoadingLabel || \"Yukleniyor...\"}\r\n            </div>\r\n            <div className=\"small muted\" style={{ marginTop: 6 }}>\r\n              Lutfen bekleyin...\r\n            </div>\r\n          </div>\r\n        </div>\r\n      ) : null}\r\n\r\n      {err ? (\r\n        <div\r\n          className=\"card\"\r\n          style={{\r\n            marginTop: 10,\r\n            background: \"#fff1f2\",\r\n            borderColor: \"#fecaca\",\r\n          }}\r\n        >\r\n          {err}\r\n        </div>\r\n      ) : null}\r\n\r\n      {!selectedScenarioId ? (\r\n        <div className=\"card\" style={{ marginTop: 12 }}>\r\n          <div style={{ fontWeight: 700 }}>Okul & Senaryo Sec</div>\r\n          <div className=\"small\" style={{ marginTop: 6 }}>\r\n            Bu bolumu acmak icin once okul ve senaryo secin.\r\n          </div>\r\n          <button\r\n            type=\"button\"\r\n            className=\"btn primary\"\r\n            style={{ marginTop: 12 }}\r\n            onClick={() => navigate(`/select?schoolId=${schoolId}`)}\r\n          >\r\n            Okul & Senaryo Sec\r\n          </button>\r\n        </div>\r\n      ) : (\r\n        <Outlet context={outletContextValue} />\r\n      )}\r\n      {renderStickyFooter()}\r\n    </div>\r\n  );\r\n}\r\n\r\n","const PROGRAM_TYPES = {\r\n  LOCAL: \"local\",\r\n  INTERNATIONAL: \"international\",\r\n};\r\n\r\nconst ALLOWED_PROGRAM_TYPES = new Set(Object.values(PROGRAM_TYPES));\r\n\r\nfunction normalizeProgramType(value) {\r\n  const raw = String(value || \"\").trim().toLowerCase();\r\n  if (ALLOWED_PROGRAM_TYPES.has(raw)) return raw;\r\n  return PROGRAM_TYPES.LOCAL;\r\n}\r\n\r\nfunction getProgramType(inputs = {}, scenario = null) {\r\n  const programFromInputs =\r\n    inputs?.temelBilgiler?.programType ?? inputs?.programType ?? inputs?.program_type;\r\n  if (programFromInputs) {\r\n    return normalizeProgramType(programFromInputs);\r\n  }\r\n  const programFromScenario = scenario?.program_type || scenario?.programType;\r\n  if (programFromScenario) return normalizeProgramType(programFromScenario);\r\n  return PROGRAM_TYPES.LOCAL;\r\n}\r\n\r\nfunction isKademeKeyVisible(key, programType = PROGRAM_TYPES.LOCAL) {\r\n  const type = normalizeProgramType(programType);\r\n  if (!key) return true;\r\n  if (key === \"okulOncesi\") return true;\r\n  if (key.endsWith(\"Yerel\")) return type === PROGRAM_TYPES.LOCAL;\r\n  if (key.endsWith(\"Int\")) return type === PROGRAM_TYPES.INTERNATIONAL;\r\n  return true;\r\n}\r\n\r\nfunction mapBaseKademeToVariant(baseKademe, programType = PROGRAM_TYPES.LOCAL) {\r\n  const type = normalizeProgramType(programType);\r\n  if (baseKademe === \"okulOncesi\") return \"okulOncesi\";\r\n  const suffix = type === PROGRAM_TYPES.INTERNATIONAL ? \"Int\" : \"Yerel\";\r\n  return `${baseKademe}${suffix}`;\r\n}\r\n\r\nfunction getVariantKeysForProgramType(programType = PROGRAM_TYPES.LOCAL) {\r\n  const type = normalizeProgramType(programType);\r\n  return new Set([\r\n    \"okulOncesi\",\r\n    `ilkokul${type === PROGRAM_TYPES.INTERNATIONAL ? \"Int\" : \"Yerel\"}`,\r\n    `ortaokul${type === PROGRAM_TYPES.INTERNATIONAL ? \"Int\" : \"Yerel\"}`,\r\n    `lise${type === PROGRAM_TYPES.INTERNATIONAL ? \"Int\" : \"Yerel\"}`,\r\n  ]);\r\n}\r\n\r\nexport {\r\n  PROGRAM_TYPES,\r\n  ALLOWED_PROGRAM_TYPES,\r\n  getProgramType,\r\n  normalizeProgramType,\r\n  isKademeKeyVisible,\r\n  mapBaseKademeToVariant,\r\n  getVariantKeysForProgramType,\r\n};\r\n"],"names":["DEFAULT_PREFIX","safeRead","key","fallback","raw","window","localStorage","getItem","JSON","parse","_unused","useScenarioUiState","name","defaultValue","prefix","scope","arguments","length","undefined","scopeKey","scopeOverride","loc","useLocation","useMemo","trim","pathname","search","useScenarioScopeKey","storageKey","concat","loadedKeyRef","useRef","state","setState","useState","useEffect","current","value","setItem","stringify","_unused2","safeWrite","useScenarioUiFlag","opts","v","setV","next","useScenarioUiString","String","computeScenarioProgress","inputs","norm","config","scenario","catalog","buildProgressCatalog","normalizedConfig","defaults","DEFAULT_PROGRESS_CONFIG","input","sectionsInput","sections","out","version","Object","keys","forEach","id","base","incoming","enabled","mode","min","Number","selectedFields","normalizeConfig","sectionsById","Map","map","s","sectionResults","totalUnits","doneUnits","section","_catalog$context","cfg","set","requiresKademe","hasKademeSelection","context","done","missingReasons","applicable","Array","isArray","fields","filter","_cfg$selectedFields","fieldsById","Boolean","field","appliesIf","_","filled","missing","getValue","ok","type","isNonEmptyString","toNum","isFilled","push","filledCount","modeDefault","toUpperCase","minRequired","isFinite","minDefault","Math","max","doneCount","total","allowEmpty","label","tabs","tab","enabledSections","sectionIds","result","get","def","tabTotal","tabDone","missingLines","allDone","res","t","d","pct","round","missingPreview","join","missingDetailsLines","reasons","completedCount","totalCount","pathToResources","path","tokens","split","shift","page","replace","toLowerCase","PAGE_ALIASES","grades_years","grades_current","grades","prototype","hasOwnProperty","call","sectionSnake","pageMap","temel_bilgiler","inflation","ucret_artis_oranlari","okul_ucretleri_hesaplama","ik_mevcut","burs_indirim_ogrenci_sayilari","burs_ogr","rakip_analizi","rakip","performans","degerlendirme","okul_egitim_bilgileri","yetkililer","kademeler","program_type","gelirler","giderler","ik","discounts","grades_plan","kapasite","mapped","INPUT_HEADER_TABS","Set","TAB_TO_ROUTE","basics","hr","income","expenses","detailedReport","report","ROUTE_TO_TAB","fromEntries","entries","_ref","TAB_TO_WORK_ID","parseAcademicYear","academicYear","range","match","startYear","endYear","single","pctValue","n","mergeMissingLines","a","b","seen","list","line","val","has","add","slice","findArrayItemIndex","arr","part","byKey","findIndex","item","byName","byGrade","grade","idx","isInteger","SchoolPage","_inputs$temelBilgiler","_inputs$temelBilgiler2","useParams","location","navigate","useNavigate","outlet","useOutletContext","schoolId","school","setSchool","err","setErr","me","setMe","document","title","selectedScenario","setSelectedScenario","prevReport","setPrevReport","prevScenarioMeta","setPrevScenarioMeta","workItems","setWorkItems","workItemsLoaded","setWorkItemsLoaded","scenarioMetaLoaded","setScenarioMetaLoaded","reviewingWorkItem","setReviewingWorkItem","scenarios","setScenarios","selectedScenarioId","setSelectedScenarioId","readSelectedScenarioId","pendingTabAfterSelect","setPendingTabAfterSelect","refreshWorkItems","useCallback","async","sid","data","api","listWorkItems","refreshScenarioMeta","listScenarios","limit","offset","order","items","scenarioId","nextScenario","find","prev","_objectSpread","submitWorkItem","workId","toast","success","e","error","message","setNorm","progressConfig","setProgressConfig","setInputs","inputsSaving","setInputsSaving","dirtyPaths","setDirtyPaths","baselineInputs","setBaselineInputs","baselineNorm","setBaselineNorm","clearDirtyPrefix","size","changed","startsWith","hasDirtyPrefix","setReport","calculating","setCalculating","lastSavedAt","setLastSavedAt","lastCalculatedAt","setLastCalculatedAt","nowTick","setNowTick","exportOpen","setExportOpen","exportMenuRef","reportExportRef","exportingPdf","setExportingPdf","bootLoading","setBootLoading","bootLoadingLabel","setBootLoadingLabel","uiScopeKey","reportCurrency","setReportCurrency","reportCurrencyDefaultedForRef","reportMode","setReportMode","reportModeLoading","setReportModeLoading","detailedReportMode","setDetailedReportMode","activeRouteSegment","activeWorkId","activeWorkItem","work_id","activeWorkState","moduleLocked","includes","setTab","React","nextTab","segment","writeLastVisitedPath","writeGlobalLastRouteSegment","targetSegment","readLastVisitedPath","target","setInterval","Date","now","clearInterval","handleClick","event","el","contains","handleKey","addEventListener","removeEventListener","baseYear","academic_year","inputCurrencyCode","input_currency","local_currency_code","isLocalScenario","prevRealFxValue","temelBilgiler","prevYearRealizedFxUsdToLocal","prevRealFxMissing","programType","getProgramType","permissionScope","_ref2","_school$country_id","countryId","country_id","canReadNorm","can","canWriteGiderler","ignoreNormProgress","scenarioProgress","progMap","normAvgPct","gradesPlan","expensesAvgPct","normMissingLines","_progMap$gradesPlan","_progMap$norm","expensesMissingLines","_progMap$giderler","_progMap$discounts","fetchScenarioReport","nextMode","getScenarioReport","results","handleReportModeChange","setHeaderMeta","subtitle","hideDefault","centered","_outlet$clearHeaderMe","clearHeaderMeta","applyIkSalariesToGiderler","inInputs","_ik$years","_src$giderler","_src$giderler$isletme","src","yearIK","years","y1","unitCosts","headcountsByLevel","roles","levels","roleAnnual","r","count","lvl","_headcountsByLevel$lv","patch","turkPersonelMaas","turk_mudur","turk_mdyard","turk_egitimci","turkDestekPersonelMaas","turk_temsil","yerelPersonelMaas","yerel_yonetici_egitimci","yerelDestekPersonelMaas","yerel_destek","yerel_ulke_temsil_destek","internationalPersonelMaas","int_yonetici_egitimci","prevItems","isletme","k","abs","structuredClone","normalizeCapacityInputs","_cap$years","_cap$years2","_cap$years3","safeNum","legacy","schoolCapacity","cap","y2","y3","currentStudents","byKademe","normalizeGradesInputs","defaultGrades","getGradeOptions","g","branchCount","studentsPerBranch","baseGrades","gradesYears","toMap","m","row","_row$grade","_row$branchCount","_row$studentsPerBranc","normalizeRow","areGradesEqual","ma","mb","ra","rb","applyTuitionStudentCounts","_s$gradesYears","_s$temelBilgiler","_s$gelirler","_s$gelirler$tuition","sums","summarizeGradesByKademe","variantCounts","okulOncesi","ilkokulYerel","ilkokulInt","ortaokulYerel","ortaokulInt","liseYerel","liseInt","mapBaseKademeToVariant","ilkokul","ortaokul","lise","tuitionSync","syncRows","rows","getCount","nextRows","_r$key","_r$studentCount","nextCount","studentCount","tuition","active","getProgressRequirements","loadProgressConfig","getSchool","meInfo","getMe","sc","some","x","writeSelectedScenarioId","loadAll","_data$norm","getScenarioContext","normalized","inf","toFinite","expenseDeviationPct","y2023","y2024","y2025","currentSeasonAvgFee","mudur","ulkeTemsilcisi","raporuHazirlayan","okulEgitimBilgileri","egitimBaslamaTarihi","zorunluEgitimDonemleri","birDersSuresiDakika","gunlukDersSaati","haftalikDersSaatiToplam","sabahciOglenci","ogretmenHaftalikDersOrt","gecisSinaviBilgisi","uygulananProgram","normalizeKademeConfig","normalizeProgramType","okulUcretleriHesaplama","ucretArtisOranlari","ikMevcut","turkPersonelYoneticiEgitimci","turkPersonelTemsilcilik","yerelKadroluEgitimci","yerelUcretliVakaterEgitimci","yerelDestek","yerelTemsilcilik","international","bursIndirimOgrenciSayilari","magisBasariBursu","maarifYetenekBursu","ihtiyacBursu","okulBasariBursu","tamEgitimBursu","barinmaBursu","turkceBasariBursu","uluslararasiYukumlulukIndirimi","vakifCalisaniIndirimi","kardesIndirimi","erkenKayitIndirimi","pesinOdemeIndirimi","kademeGecisIndirimi","temsilIndirimi","kurumIndirimi","istisnaiIndirim","yerelMevzuatIndirimi","rakipAnalizi","c","gerceklesen","ogrenciSayisi","karZarar","bursVeIndirimler","normalizeTemelBilgilerInputs","loadScenario","isLocal","fx_usd_to_local","scenarioKey","year","prevStartYear","prevEndYear","prevScenario","parsed","calculateScenario","loadPrev","scenarioLocked","status","submittedAt","submitted_at","sentAt","sent_at","isScenarioLocked","inputsLocked","saveNormConfig","payload","teacherWeeklyMaxHours","curriculumWeeklyHours","getNormConfig","saveInputs","shouldSaveInputs","shouldSaveNorm","patched","modifiedResourcesSet","inputDirty","p","pathStr","modifiedResources","from","saveScenarioInputs","sumPlannedStudents","sum","_row$studentsPerBranc2","showBlockingToast","toastId","warn","position","autoClose","closeOnClick","draggable","icon","style","background","color","border","boxShadow","borderRadius","ensurePlanningStudentsForY2Y3","actionLabel","totals","srcInputs","getPlannedStudentTotalsByYear","msg","ensurePrevRealFxForLocal","calculate","options","skipPlanValidation","keepTab","console","log","hasResults","valuesEqual","is","getValueAtPath","obj","parts","cur","getBaselineValue","last","endsWith","suffix","baseField","baseVal","infl","y2f","y3f","parent","yearsIdx","indexOf","yearKey","altParts","altVal","ratio","multiplier","u","byIdx","lvlKey","per","yearsY1","curAll","inputsDirty","submitActiveWorkItem","reviewActiveWorkItem","action","reviewWorkItem","role","warnUnsavedChanges","moduleLockReason","inputsLockedReason","canSubmitWorkItem","markDirty","i","setValueAtPath","baselineValue","same","delete","areSetsEqual","handleBeforeUnload","preventDefault","returnValue","__fsUnsavedChanges","handleIkSalaryComputed","salaryByYear","_p$giderler","_p$giderler$isletme","handlePlanningGradesChange","setNormSafe","updater","showInputsHeader","exportDisabled","formatRelative","ms","diff","floor","getScenarioStageClass","outletContextValue","setField","_jsxs","className","children","_jsx","ToastContainer","newestOnTop","pauseOnFocusLoss","pauseOnHover","hideProgressBar","theme","width","padding","textAlign","height","margin","borderTopColor","animation","fontWeight","marginTop","borderColor","Outlet","onClick","_progMap$gradesPlan2","_progMap$gradesPlan3","_progMap$gradesPlan4","_progMap$gradesPlan5","_progMap$norm2","_progMap$norm3","_progMap$giderler2","_progMap$giderler3","_progMap$discounts2","_progMap$discounts3","_ref3","_school$country_id2","moduleKeyToWorkId","temel","gelir","gider","footerModules","labelShort","normDone","giderDone","allModulesDone","every","scenarioProgressPct","progress_pct","scenarioStageLabel","progressPct","getScenarioStageLabel","scenarioDisplayLabel","scenarioDisplayClass","workItemLabel","getWorkItemStageLabel","workItemClass","hasActiveWorkLabel","scenarioTooltip","checked_at","getTime","toLocaleString","reviewed_at","primaryPill","secondaryPill","scenarioIsFinal","allowScenarioPill","scenarioPillLabel","scenarioPillClass","scenarioPillTooltip","tooltip","footerMetaBits","showDebug","_window","_window$localStorage","debugBits","toLocaleTimeString","footerMetaText","hasFooterMeta","countryIdForScope","scopeOpts","scenarioStatus","hasScenario","userCan","_unused3","moduleKeyToTab","moduleKeyToPageKey","activeModuleKey","activeModuleObj","activeModuleDone","canSubmitScenarioBase","userHasModuleWrite","_unused4","canForwardScenario","canApproveScenario","canReviewWorkItem","reviewDisabled","reviewTooltip","hasAllModuleWritePermissions","_unused5","primaryTooltipReasons","primaryDisabled","primaryLabel","primaryIcon","primaryOnClick","FaCheckCircle","adminReviewScenario","FaPaperPlane","incomplete","sendForApproval","primaryTooltip","hasReport","calculateLabel","exportLabel","showExportButton","_Fragment","tabKey","canNav","moduleKey","pageKey","perms","permissions","perm","resource","permCountry","scope_country_id","permSchool","scope_school_id","canNavigateModule","isActive","statusClass","scenarioSentAt","getModuleStatusClass","w","getModuleWorkState","SegmentTag","Tooltip","lines","disabled","FaSave","FaCalculator","ref","FaFileExport","downloadXlsx","handleExport","downloadPdf","handleExportPdf","renderStickyFooter","PROGRAM_TYPES","LOCAL","INTERNATIONAL","ALLOWED_PROGRAM_TYPES","values","programFromInputs","programFromScenario","isKademeKeyVisible","baseKademe"],"ignoreList":[],"sourceRoot":""}