"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[810],{4405(e,i,l){l.d(i,{A:()=>n});l(5043);var r=l(579);function n(e){let{text:i,lines:l,children:n,className:a=""}=e;const t=function(e,i){return Array.isArray(e)?e.map(e=>String(e)).filter(e=>e.trim().length>0):"string"===typeof i?i.split("\n").map(e=>e.trim()).filter(Boolean):[]}(l,i);return t.length?(0,r.jsxs)("span",{className:"tooltip-wrap ".concat(a).trim(),children:[n,(0,r.jsx)("span",{className:"tooltip-bubble",role:"tooltip",children:t.map((e,i)=>(0,r.jsx)("div",{className:"tooltip-line",children:e},"".concat(i,"-").concat(e)))})]}):n}},6037(e,i,l){l.d(i,{Ds:()=>d,In:()=>m,VJ:()=>u,aW:()=>o,jc:()=>c,oP:()=>p,qV:()=>y});var r=l(2555);const n=["KG","1","2","3","4","5","6","7","8","9","10","11","12"],a=[{key:"okulOncesi",label:"Okul \xd6ncesi",defaultFrom:"KG",defaultTo:"KG"},{key:"ilkokul",label:"\u0130lkokul",defaultFrom:"1",defaultTo:"5"},{key:"ortaokul",label:"Ortaokul",defaultFrom:"6",defaultTo:"9"},{key:"lise",label:"Lise",defaultFrom:"10",defaultTo:"12"}];function t(e){const i=String(e||"").trim().toUpperCase();if("KG"===i)return"KG";if(!/^\d{1,2}$/.test(i))return null;const l=Number(i);return!Number.isFinite(l)||l<1||l>12?null:String(l)}function s(e){const i=t(e);return i?n.indexOf(i):-1}function o(){return a.map(e=>(0,r.A)({},e))}function c(){const e={};return a.forEach(i=>{e[i.key]={enabled:!0,from:i.defaultFrom,to:i.defaultTo}}),e}function d(e){const i=e&&"object"===typeof e?e:{},l={};return a.forEach(e=>{const n=i[e.key]&&"object"===typeof i[e.key]?i[e.key]:{},a=!1!==n.enabled,o=function(e,i,l){var r,n;const a=null!==(r=t(e))&&void 0!==r?r:l.defaultFrom,o=null!==(n=t(i))&&void 0!==n?n:l.defaultTo,c=s(a),d=s(o);return c<0||d<0?{from:l.defaultFrom,to:l.defaultTo}:c<=d?{from:a,to:o}:{from:o,to:a}}(n.from,n.to,e);l[e.key]=(0,r.A)({enabled:a},o)}),l}function u(e,i,l){const r=function(e,i){if(!a.find(e=>e.key===i))return"";const l=d(e)[i];return null!==l&&void 0!==l&&l.enabled?l.from===l.to?l.from:"".concat(l.from,"-").concat(l.to):""}(i,l);return r?"".concat(e," (").concat(r,")"):e}function m(e,i){const l=s(e);if(l<0)return null;const r=d(i);for(const n of a){const e=r[n.key];if(null===e||void 0===e||!e.enabled)continue;const i=s(e.from),a=s(e.to);if(i<=l&&l<=a)return n.key}return null}function y(e,i){const l=Array.isArray(e)?e:[],r={okulOncesi:0,ilkokul:0,ortaokul:0,lise:0,total:0};for(const n of l){const e=Number((null===n||void 0===n?void 0:n.studentsPerBranch)||0);if(!Number.isFinite(e))continue;r.total+=e;const l=m(null===n||void 0===n?void 0:n.grade,i);l&&Object.prototype.hasOwnProperty.call(r,l)&&(r[l]+=e)}return r}function p(){return n.map(e=>e)}},7452(e,i,l){l.d(i,{A:()=>a});l(5043);var r=l(4405),n=l(579);function a(e){let{value:i=0,label:l="",tooltipLines:a}=e;const t=Number(i),s=Number.isFinite(t)?Math.max(0,Math.min(100,t)):0,o=function(e){return e?Array.isArray(e)?e.map(e=>String(e)):"string"===typeof e?e.split("\n"):[]:[]}(a).filter(e=>String(e).trim().length>0),c=(0,n.jsx)("div",{className:"progress-track",children:(0,n.jsx)("div",{className:"progress-bar",role:"progressbar","aria-valuenow":s,"aria-valuemin":0,"aria-valuemax":100,children:(0,n.jsx)("div",{className:"progress-bar-fill",style:{width:"".concat(s,"%")}})})});return(0,n.jsxs)("div",{className:"progress-row",children:[l?(0,n.jsx)("div",{className:"progress-label",children:l}):null,o.length?(0,n.jsx)(r.A,{lines:o,className:"progress-tooltip",children:c}):c,(0,n.jsxs)("div",{className:"progress-value",children:[Math.round(s),"%"]})]})}},7810(e,i,l){l.r(i),l.d(i,{default:()=>R});var r=l(2555),n=l(5043),a=l(5685),t=l(2115),s=l(3204),o=l(7559),c=l(3182),d=l(7452),u=l(579);const m=[{key:"ulkeTemsilciligi",label:"\xdclke Temsilciligi Giderleri"},{key:"genelYonetim",label:"Genel Y\xf6netim Giderleri"},{key:"kira",label:"Isletme Giderleri (Kira)"},{key:"emsalKira",label:"Isletme Giderleri (Emsal Kira)"},{key:"enerjiKantin",label:"Isletme Giderleri (Elektrik, Su, vb.)"},{key:"turkPersonelMaas",label:"Yurt disi T\xdcRK Personel Maas Giderleri"},{key:"turkDestekPersonelMaas",label:"Yurt disi T\xdcRK DESTEK Personel Maas Giderleri"},{key:"yerelPersonelMaas",label:"Yurt disi YEREL Personel Maas Giderleri"},{key:"yerelDestekPersonelMaas",label:"Yurt disi YEREL DESTEK Personel Maas Giderleri"},{key:"internationalPersonelMaas",label:"Yurt disi INTERNATIONAL Personel Maas Giderleri"},{key:"disaridanHizmet",label:"Disaridan Saglanan Mal ve Hizmet Alimlari"},{key:"egitimAracGerec",label:"Egitim Ara\xe7 ve Gere\xe7leri"},{key:"finansalGiderler",label:"Finansal Giderler"},{key:"egitimAmacliHizmet",label:"Egitim Ama\xe7li Hizmet Alimlari"},{key:"temsilAgirlama",label:"Temsil ve Agirlama"},{key:"ulkeIciUlasim",label:"\xdclke I\xe7i Ulasim ve Konaklama"},{key:"ulkeDisiUlasim",label:"\xdclke Disi Ulasim ve Konaklama"},{key:"vergilerResmiIslemler",label:"Vergiler Resmi Islemler"},{key:"vergiler",label:"Vergiler"},{key:"demirbasYatirim",label:"Demirbas ve Yatirimlar"},{key:"rutinBakim",label:"Rutin Bakim ve Onarim"},{key:"pazarlamaOrganizasyon",label:"Pazarlama Organizasyon"},{key:"reklamTanitim",label:"Reklam ve Tanitim"},{key:"tahsilEdilemeyenGelirler",label:"Tahsil Edilemeyen Gelirler"},{key:"yemek",label:"Yemek"},{key:"uniforma",label:"\xdcniforma"},{key:"kitapKirtasiye",label:"Kitap-K\u0131rtasiye"},{key:"ulasimServis",label:"Servis / Ula\u015f\u0131m"},{key:"yurtGiderleri",label:"Yurt Giderleri (Kampus giderleri i\xe7inde g\xf6sterilmeyecek)"},{key:"digerYurt",label:"Di\u011fer (Yaz okulu giderleri vb.)"},{key:"discountsTotal",label:"Burs ve \u0130ndirimler (Toplam)"}],y=m.map(e=>e.key),p=new Map(m.map(e=>[e.key,e])),g=new Map(m.map(e=>[e.key,e.label])),h=[{id:"isletme",label:"\u0130\u015fletme Giderleri",groups:[{label:"\u0130\u015fletme Giderleri",keys:["ulkeTemsilciligi","genelYonetim","temsilAgirlama","ulkeIciUlasim","ulkeDisiUlasim","vergilerResmiIslemler","vergiler","demirbasYatirim","rutinBakim","pazarlamaOrganizasyon","reklamTanitim","tahsilEdilemeyenGelirler"]},{label:"E\u011fitim Maliyetleri",keys:["kira","emsalKira","enerjiKantin","turkPersonelMaas","turkDestekPersonelMaas","yerelPersonelMaas","yerelDestekPersonelMaas","internationalPersonelMaas","disaridanHizmet","egitimAracGerec","finansalGiderler","egitimAmacliHizmet"]}]},{id:"ogrenimDisi",label:"\xd6\u011frenim D\u0131\u015f\u0131 Hizmetler",keys:["yemek","uniforma","kitapKirtasiye","ulasimServis"]},{id:"yurtKonaklama",label:"Yurt / Konaklama",keys:["yurtGiderleri","digerYurt"]},{id:"bursIndirim",label:"Burs ve \u0130ndirimler",keys:["discountsTotal"]}].map(e=>{if(Array.isArray(e.groups)){const i=e.groups.filter(e=>e.keys.length),l=i.flatMap(e=>e.keys);return(0,r.A)((0,r.A)({},e),{},{groups:i,keys:l})}return(0,r.A)((0,r.A)({},e),{},{keys:e.keys})}).filter(e=>e.keys.length),v=function(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return Number.isFinite(Number(e))?Number(e).toLocaleString(void 0,{maximumFractionDigits:i}):"-"};function f(e,i){if(!e)return null;if("start"===i||"end"===i){const{startYear:l,endYear:r}=function(e){const i=String(e||"").trim(),l=i.match(/^(\d{4})\s*-\s*(\d{4})$/);if(l){const e=Number(l[1]),i=Number(l[2]);if(Number.isFinite(e)&&Number.isFinite(i))return{startYear:String(e),endYear:String(i)}}const r=i.match(/^(\d{4})$/);if(r){const e=Number(r[1]);if(Number.isFinite(e))return{startYear:String(e),endYear:String(e)}}return{startYear:null,endYear:null}}(e);return"start"===i?l:r}return e}function b(e){var i;let{open:l,onClose:a,onApplied:c,sourceScenario:d,sourceSchoolId:m,sourceSchoolName:b}=e;const[x,j]=(0,n.useState)([]),[k,S]=(0,n.useState)(!1),[N,C]=(0,n.useState)(""),[A,w]=(0,n.useState)(new Set),[L,I]=(0,n.useState)("students"),[T,B]=(0,n.useState)("y1"),[O,_]=(0,n.useState)("academic"),[z,Y]=(0,n.useState)(new Set),[F,D]=(0,n.useState)(null),[E,K]=(0,n.useState)(!1),[U,M]=(0,n.useState)(!1),[P,G]=(0,n.useState)(!1),[H,R]=(0,n.useState)(!1),[W,$]=(0,n.useState)(new Set),[V,q]=(0,n.useState)(!0),[Z,X]=(0,n.useState)(!0),[J,Q]=(0,n.useState)(null),ee=(0,n.useRef)(!1),ie={fontSize:12,height:30,padding:"4px 8px",lineHeight:"20px",boxSizing:"border-box"},le=(0,n.useMemo)(()=>Array.from(A).sort().join(","),[A]),re=(0,n.useMemo)(()=>Array.from(z).sort().join(","),[z]);(0,n.useEffect)(()=>{l&&(C(""),w(new Set),Y(new Set),I("students"),B("y1"),_("academic"),D(null),G(!1),Q(null),ee.current=!1)},[l,null===d||void 0===d?void 0:d.id]),(0,n.useEffect)(()=>{D(null),R(!1),$(new Set),q(!0),X(!0)},[L,T,O,le,re]),(0,n.useEffect)(()=>{let e=!0;return async function(){if(!l||null===d||void 0===d||!d.academic_year)return;const i=f(d.academic_year,O);if(i){S(!0);try{const l=await o.FH.expenseSplitTargets(i,O);if(!e)return;const r=(Array.isArray(l)?l:[]).filter(e=>String(e.scenarioId)!==String(null===d||void 0===d?void 0:d.id));j(r)}catch(r){e&&t.oR.error(r.message||"Hedef senaryolar alinamadi")}finally{e&&S(!1)}}}(),()=>{e=!1}},[l,null===d||void 0===d?void 0:d.academic_year,null===d||void 0===d?void 0:d.id,O]),(0,n.useEffect)(()=>{let e=!0;return async function(){if(l&&null!==d&&void 0!==d&&d.id&&m)try{const i=await o.FH.getExpenseSplitLastScope(m,d.id);if(!e)return;Q((null===i||void 0===i?void 0:i.scope)||null)}catch(i){e&&Q(null)}}(),()=>{e=!1}},[l,null===d||void 0===d?void 0:d.id,m]),(0,n.useEffect)(()=>{if(!l||ee.current)return;if(k)return;if(!J||"object"!==typeof J)return;const e=String(J.basis||"").toLowerCase(),i=String(J.basisYearKey||"").toLowerCase();"students"!==e&&"revenue"!==e||I(e),["y1","y2","y3"].includes(i)&&B(i);const r=new Set(y),n=Array.isArray(J.expenseKeys)?J.expenseKeys.filter(e=>r.has(e)):[];Y(new Set(n));const a=new Set(x.map(e=>String(e.scenarioId))),t=(Array.isArray(J.targetScenarioIds)?J.targetScenarioIds.map(e=>String(e)):[]).filter(e=>a.has(e));w(new Set(t)),ee.current=!0},[l,k,J,x]);const ne=(0,n.useMemo)(()=>{const e=N.trim().toLowerCase();return e?x.filter(i=>{const l=String((null===i||void 0===i?void 0:i.schoolName)||"").toLowerCase(),r=String((null===i||void 0===i?void 0:i.scenarioName)||"").toLowerCase();return l.includes(e)||r.includes(e)}):x},[x,N]);(0,n.useEffect)(()=>{if(!x.length)return void w(e=>e.size?new Set:e);const e=new Set(x.map(e=>String(e.scenarioId)));w(i=>{if(!i||0===i.size)return i;const l=new Set(Array.from(i).filter(i=>e.has(String(i))));return l.size===i.size?i:l})},[x]);const ae=e=>{w(i=>{const l=new Set(i),r=String(e);return l.has(r)?l.delete(r):l.add(r),l})},te=e=>{Y(i=>{const l=new Set(i);return l.has(e)?l.delete(e):l.add(e),l})},se=(e,i)=>{Array.isArray(e)&&e.length&&Y(l=>{const r=new Set(l);return e.forEach(e=>{i?r.add(e):r.delete(e)}),r})},oe=(0,n.useMemo)(()=>Array.isArray(null===F||void 0===F?void 0:F.targets)?F.targets:[],[F]),ce=(0,n.useMemo)(()=>Array.isArray(null===F||void 0===F?void 0:F.pools)?F.pools:[],[F]),de=(0,n.useMemo)(()=>Array.isArray(null===F||void 0===F?void 0:F.allocations)?F.allocations:[],[F]),ue=(0,n.useMemo)(()=>Array.isArray(null===F||void 0===F?void 0:F.warnings)?F.warnings:[],[F]),me=b||(null===d||void 0===d?void 0:d.schoolName)||(null===d||void 0===d||null===(i=d.school)||void 0===i?void 0:i.name)||"",ye=(0,n.useMemo)(()=>{const e=new Map;return de.forEach(i=>{const l=String(i.targetScenarioId),r=e.get(l)||[];r.push({expenseLabel:g.get(i.expenseKey)||i.expenseKey,amount:i.allocatedAmount}),e.set(l,r)}),e},[de]),pe=y.length,ge=z.size,he=pe>0&&ge===pe,ve=ge>0&&!he,fe=!A.size||!z.size||E||U||P,be=h.find(e=>"isletme"===e.id)||null,xe=h.filter(e=>"isletme"!==e.id),je=e=>{if(!e)return null;const i=e.keys.length,l=e.keys.reduce((e,i)=>e+(z.has(i)?1:0),0),r=i>0&&l===i,n=l>0&&!r;return(0,u.jsxs)("div",{className:"card",style:{padding:"10px 12px",background:"#f8fafc"},children:[(0,u.jsxs)("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center"},children:[(0,u.jsxs)("label",{className:"row small",style:{gap:6,alignItems:"center",fontWeight:700},children:[(0,u.jsx)("input",{type:"checkbox",checked:r,ref:e=>{e&&(e.indeterminate=n)},onChange:i=>se(e.keys,i.target.checked)}),(0,u.jsx)("span",{children:e.label})]}),(0,u.jsxs)("div",{className:"row",style:{gap:6},children:[(0,u.jsx)("button",{className:"btn",type:"button",style:{padding:"4px 10px"},onClick:()=>se(e.keys,!0),disabled:!i,children:"Sec"}),(0,u.jsx)("button",{className:"btn",type:"button",style:{padding:"4px 10px"},onClick:()=>se(e.keys,!1),disabled:!l,children:"Temizle"})]})]}),(0,u.jsxs)("div",{className:"small muted",style:{marginTop:4},children:["Secili: ",l,"/",i]}),Array.isArray(e.groups)?(0,u.jsx)("div",{style:{marginTop:8},children:e.groups.map(e=>(0,u.jsxs)("div",{style:{marginTop:8},children:[(0,u.jsx)("div",{className:"small",style:{fontWeight:700,marginBottom:6},children:e.label}),(0,u.jsx)("div",{className:"grid2",style:{gap:8},children:e.keys.map(e=>{const i=p.get(e),l=(null===i||void 0===i?void 0:i.label)||e;return(0,u.jsxs)("label",{className:"row",style:{gap:6,alignItems:"center"},children:[(0,u.jsx)("input",{type:"checkbox",checked:z.has(e),onChange:()=>te(e)}),(0,u.jsx)("span",{className:"small",children:l})]},e)})})]},e.label))}):(0,u.jsx)("div",{className:"grid2",style:{gap:8,marginTop:8},children:e.keys.map(e=>{const i=p.get(e),l=(null===i||void 0===i?void 0:i.label)||e;return(0,u.jsxs)("label",{className:"row",style:{gap:6,alignItems:"center"},children:[(0,u.jsx)("input",{type:"checkbox",checked:z.has(e),onChange:()=>te(e)}),(0,u.jsx)("span",{className:"small",children:l})]},e)})})]},e.id)};return l?(0,u.jsx)("div",{className:"modal-backdrop",role:"dialog","aria-modal":"true",onClick:a,children:(0,u.jsxs)("div",{className:"modal",style:{width:"min(980px, 96vw)",maxHeight:"86vh",overflowY:"auto",position:"relative"},onClick:e=>e.stopPropagation(),children:[(0,u.jsx)("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center"},children:(0,u.jsx)("button",{className:"btn",onClick:a,disabled:U||E||P,style:{position:"absolute",top:10,right:10,background:"#111827",borderColor:"#111827",color:"#fff"},children:"Kapat"})}),d?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("div",{style:{marginTop:2},children:(0,u.jsxs)("div",{className:"row",style:{gap:12,alignItems:"flex-end",flexWrap:"wrap"},children:[(0,u.jsxs)("div",{style:{minWidth:170},children:[(0,u.jsx)("div",{className:"small",style:{fontWeight:700,marginBottom:6},children:"Basis"}),(0,u.jsxs)("select",{className:"input sm",style:ie,value:L,onChange:e=>I(e.target.value),children:[(0,u.jsx)("option",{value:"students",children:"Students"}),(0,u.jsx)("option",{value:"revenue",children:"Revenue"})]})]}),(0,u.jsxs)("div",{style:{minWidth:160},children:[(0,u.jsx)("div",{className:"small",style:{fontWeight:700,marginBottom:6},children:"Basis Yil"}),(0,u.jsxs)("select",{className:"input sm",style:ie,value:T,onChange:e=>B(e.target.value),children:[(0,u.jsx)("option",{value:"y1",children:"Y1"}),(0,u.jsx)("option",{value:"y2",children:"Y2"}),(0,u.jsx)("option",{value:"y3",children:"Y3"})]})]}),(0,u.jsxs)("div",{style:{minWidth:210},children:[(0,u.jsx)("div",{className:"small",style:{fontWeight:700,marginBottom:6},children:"Yil ortasi donemleri"}),(0,u.jsxs)("select",{className:"input sm",style:ie,value:O,onChange:e=>_(e.target.value),children:[(0,u.jsx)("option",{value:"academic",children:"Ayrik (2024-2025)"}),(0,u.jsx)("option",{value:"start",children:"Baslangic yilina dahil"}),(0,u.jsx)("option",{value:"end",children:"Bitis yilina dahil"})]})]}),(0,u.jsxs)("div",{style:{flex:"1 1 220px"},children:[(0,u.jsx)("div",{className:"small",style:{fontWeight:700,marginBottom:6},children:"Hedef Ara"}),(0,u.jsx)("input",{className:"input sm",style:ie,placeholder:"Okul veya senaryo ara",value:N,onChange:e=>C(e.target.value)})]})]})}),(0,u.jsxs)("div",{style:{marginTop:5},children:[(0,u.jsx)("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center",cursor:"pointer"},onClick:()=>q(e=>!e),children:(0,u.jsxs)("div",{className:"row",style:{gap:6,alignItems:"center"},children:[V?(0,u.jsx)(s.Vr3,{"aria-hidden":"true"}):(0,u.jsx)(s.X6T,{"aria-hidden":"true"}),(0,u.jsx)("div",{className:"small",style:{fontWeight:700},children:"Hedef Senaryolar"})]})}),V?k?(0,u.jsx)("div",{className:"small",children:"Yukleniyor..."}):(0,u.jsx)("div",{className:"table-scroll",style:{maxHeight:260},children:(0,u.jsxs)("table",{className:"table",style:{fontSize:12},children:[(0,u.jsx)("thead",{children:(0,u.jsxs)("tr",{children:[(0,u.jsx)("th",{style:{width:40}}),(0,u.jsx)("th",{style:{fontSize:12,padding:"6px 8px"},children:"Okul"}),(0,u.jsx)("th",{style:{fontSize:12,padding:"6px 8px"},children:"Senaryo"}),(0,u.jsx)("th",{style:{fontSize:12,padding:"6px 8px"},children:"Yil"}),(0,u.jsx)("th",{style:{fontSize:12,padding:"6px 8px"},children:"Para Birimi"})]})}),(0,u.jsx)("tbody",{children:0===ne.length?(0,u.jsx)("tr",{children:(0,u.jsx)("td",{colSpan:"5",className:"small",style:{padding:"6px 8px"},children:"Hedef bulunamadi."})}):ne.map(e=>{const i=String(e.scenarioId),l=A.has(i),n="LOCAL"===String(e.input_currency||"USD")?"".concat(e.input_currency,"/").concat(e.local_currency_code||"LOCAL"):e.input_currency||"USD";return(0,u.jsxs)("tr",{onClick:()=>ae(i),style:(0,r.A)({cursor:"pointer"},l?{background:"#eef2ff"}:{}),children:[(0,u.jsx)("td",{style:{padding:"6px 8px"},children:(0,u.jsx)("input",{type:"checkbox",checked:l,onClick:e=>e.stopPropagation(),onChange:()=>ae(i)})}),(0,u.jsx)("td",{style:{padding:"6px 8px"},children:e.schoolName}),(0,u.jsx)("td",{style:{padding:"6px 8px"},children:e.scenarioName}),(0,u.jsx)("td",{style:{padding:"6px 8px"},children:e.academic_year}),(0,u.jsx)("td",{style:{padding:"6px 8px"},children:n})]},e.scenarioId)})})]})}):null]}),(0,u.jsxs)("div",{style:{marginTop:16},children:[(0,u.jsxs)("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center",cursor:"pointer"},onClick:()=>X(e=>!e),children:[(0,u.jsxs)("div",{className:"row",style:{gap:6,alignItems:"center"},children:[Z?(0,u.jsx)(s.Vr3,{"aria-hidden":"true"}):(0,u.jsx)(s.X6T,{"aria-hidden":"true"}),(0,u.jsx)("div",{className:"small",style:{fontWeight:700},children:"Gider Kalemleri"})]}),(0,u.jsxs)("div",{className:"row",style:{gap:6},children:[(0,u.jsx)("button",{className:"btn",type:"button",style:{padding:"4px 10px"},onClick:e=>{e.stopPropagation(),se(y,!0)},disabled:!pe,children:"Tumunu Sec"}),(0,u.jsx)("button",{className:"btn",type:"button",style:{padding:"4px 10px"},onClick:e=>{e.stopPropagation(),se(y,!1)},disabled:!ge,children:"Temizle"})]})]}),Z?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("div",{className:"row",style:{gap:10,alignItems:"center",marginTop:8},children:(0,u.jsxs)("label",{className:"row small",style:{gap:6,alignItems:"center"},children:[(0,u.jsx)("input",{type:"checkbox",checked:he,ref:e=>{e&&(e.indeterminate=ve)},onChange:e=>se(y,e.target.checked)}),(0,u.jsxs)("span",{children:["Toplam Secili: ",ge,"/",pe]})]})}),(0,u.jsxs)("div",{className:"row",style:{alignItems:"flex-start",gap:12,marginTop:10},children:[(0,u.jsx)("div",{style:{flex:"1 1 0",minWidth:320},children:je(be)}),(0,u.jsx)("div",{style:{flex:"1 1 0",minWidth:320,display:"grid",gap:12},children:xe.map(e=>je(e))})]})]}):null]}),(0,u.jsxs)("div",{className:"row",style:{justifyContent:"flex-end",marginTop:16,gap:8},children:[(0,u.jsx)("button",{className:"btn",onClick:async()=>{if(null===d||void 0===d||!d.id||!m)return;const e={targetScenarioIds:Array.from(A).map(e=>Number(e)),basis:L,basisYearKey:T,expenseKeys:Array.from(z)};q(!1),X(!1),K(!0);try{const i=await o.FH.previewExpenseSplit(m,d.id,e);D(i||null)}catch(i){t.oR.error(i.message||"\xd6nizleme alinamadi")}finally{K(!1)}},disabled:fe,children:E?"\xd6nizleme...":"\xd6nizle"}),(0,u.jsx)("button",{className:"btn primary",onClick:async()=>{if(null===d||void 0===d||!d.id||!m)return;const e={targetScenarioIds:Array.from(A).map(e=>Number(e)),basis:L,basisYearKey:T,expenseKeys:Array.from(z)};M(!0);try{await o.FH.applyExpenseSplit(m,d.id,e),t.oR.success("Gider dagitimi kaydedildi."),null===c||void 0===c||c({sourceScenarioId:d.id,targetScenarioIds:e.targetScenarioIds}),null===a||void 0===a||a()}catch(i){t.oR.error(i.message||"Dagitim uygulanamadi")}finally{M(!1)}},disabled:U||P||E||!A.size||!z.size,children:U?"Uygulaniyor...":"Uygula"}),J?(0,u.jsx)("button",{className:"btn danger",onClick:async()=>{if(null===d||void 0===d||!d.id||!m)return;if(!A.size||P||U)return;if(window.confirm("Secili hedefler icin gider dagitimi geri alinsin mi?")){G(!0);try{const e=Array.from(A).map(e=>Number(e)),i=await o.FH.revertExpenseSplit(m,d.id,{targetScenarioIds:e}),l=Array.isArray(null===i||void 0===i?void 0:i.removedTargetScenarioIds)?i.removedTargetScenarioIds:[];l.length&&w(e=>{const i=new Set(e);return l.forEach(e=>i.delete(String(e))),i}),null!==i&&void 0!==i&&i.deletedSet&&(Q(null),Y(new Set)),t.oR.success("Gider dagitimi geri alindi.")}catch(e){t.oR.error(e.message||"Geri alma basarisiz")}finally{G(!1)}}},disabled:!A.size||U||P,children:P?"Geri Aliniyor...":"Gider Dagitimini Geri Al"}):null]}),ue.length>0?(0,u.jsxs)("div",{className:"card",style:{marginTop:12,background:"#fff7ed",borderColor:"#fed7aa"},children:[(0,u.jsx)("div",{style:{fontWeight:700,marginBottom:6},children:"Uyarilar"}),ue.map((e,i)=>(0,u.jsxs)("div",{className:"small",children:["\u2022 ",e]},i))]}):null,F?(0,u.jsxs)("div",{style:{marginTop:16},children:[ce.length>0?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center",marginBottom:6,cursor:"pointer"},onClick:()=>R(e=>!e),children:(0,u.jsxs)("div",{className:"row",style:{gap:6,alignItems:"center"},children:[H?(0,u.jsx)(s.Vr3,{"aria-hidden":"true"}):(0,u.jsx)(s.X6T,{"aria-hidden":"true"}),(0,u.jsxs)("div",{className:"small",style:{fontWeight:700},children:["Havuz Tutarlari",me?" (".concat(me,")"):""]})]})}),H?(0,u.jsx)("div",{className:"table-scroll",children:(0,u.jsxs)("table",{className:"table",children:[(0,u.jsx)("thead",{children:(0,u.jsxs)("tr",{children:[(0,u.jsx)("th",{children:"Gider"}),(0,u.jsx)("th",{children:"Havuz Tutari"})]})}),(0,u.jsx)("tbody",{children:ce.map(e=>(0,u.jsxs)("tr",{children:[(0,u.jsx)("td",{children:g.get(e.expenseKey)||e.expenseKey}),(0,u.jsx)("td",{children:v(e.poolAmount)})]},e.expenseKey))})]})}):null]}):null,oe.length>0?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("div",{className:"small",style:{fontWeight:700,margin:"12px 0 6px"},children:"Agirliklar (satira tiklayin)"}),(0,u.jsx)("div",{className:"table-scroll",children:(0,u.jsxs)("table",{className:"table",children:[(0,u.jsx)("thead",{children:(0,u.jsxs)("tr",{children:[(0,u.jsx)("th",{style:{width:28}}),(0,u.jsx)("th",{children:"Okul"}),(0,u.jsx)("th",{children:"Senaryo"}),(0,u.jsx)("th",{children:"Basis"}),(0,u.jsx)("th",{children:"Agirlik"})]})}),(0,u.jsx)("tbody",{children:oe.map(e=>{const i=String(e.targetScenarioId),l=W.has(i),r=ye.get(i)||[];return(0,u.jsxs)(n.Fragment,{children:[(0,u.jsxs)("tr",{onClick:()=>{return i=e.targetScenarioId,void $(e=>{const l=new Set(e),r=String(i);return l.has(r)?l.delete(r):l.add(r),l});var i},style:{cursor:"pointer"},children:[(0,u.jsx)("td",{style:{textAlign:"center"},children:l?(0,u.jsx)(s.Vr3,{"aria-hidden":"true"}):(0,u.jsx)(s.X6T,{"aria-hidden":"true"})}),(0,u.jsx)("td",{children:e.schoolName}),(0,u.jsx)("td",{children:e.scenarioName}),(0,u.jsx)("td",{children:v(e.basisValue)}),(0,u.jsx)("td",{children:(a=e.weight,Number.isFinite(Number(a))?"".concat((100*Number(a)).toFixed(2),"%"):"-")})]}),l?(0,u.jsx)("tr",{children:(0,u.jsx)("td",{colSpan:5,children:r.length?(0,u.jsxs)("table",{className:"table",style:{margin:0},children:[(0,u.jsx)("thead",{children:(0,u.jsxs)("tr",{children:[(0,u.jsx)("th",{children:"Gider"}),(0,u.jsx)("th",{children:"Tutar"})]})}),(0,u.jsx)("tbody",{children:r.map((e,l)=>(0,u.jsxs)("tr",{children:[(0,u.jsx)("td",{children:e.expenseLabel}),(0,u.jsx)("td",{children:v(e.amount)})]},"".concat(i,"-").concat(e.expenseLabel,"-").concat(l)))})]}):(0,u.jsx)("div",{className:"small is-muted",children:"Dagitim bulunamadi."})})}):null]},e.targetScenarioId);var a})})]})})]}):null]}):null]}):(0,u.jsx)("div",{className:"small",style:{marginTop:10},children:"Kaynak senaryo se\xe7ilmedi."})]})}):null}function x(e){var i;let{open:l,onClose:r,countryId:a}=e;const[s,c]=(0,n.useState)(!1),[d,m]=(0,n.useState)(null),[y,p]=(0,n.useState)(""),[g,h]=(0,n.useState)([]),[v,f]=(0,n.useState)(!1),[b,x]=(0,n.useState)(""),[j,k]=(0,n.useState)(!1),[S,N]=(0,n.useState)(!1),[C,A]=(0,n.useState)(!1),[w,L]=(0,n.useState)(null),[I,T]=(0,n.useState)(""),[B,O]=(0,n.useState)("academic"),_=(0,n.useCallback)(async()=>{if(l&&a&&I.trim()){p(""),c(!0);try{const e=await o.FH.countryApprovalBatchPreview(a,I.trim(),B);m(e||{rows:[]})}catch(e){p(e.message||"Onizleme alinamadi")}finally{c(!1)}L(null)}},[l,a,I,B]),z=(0,n.useCallback)(async()=>{if(l&&a){f(!0),p("");try{const e=await o.FH.countryApprovalBatchYears(a,B),i=Array.isArray(null===e||void 0===e?void 0:e.years)?e.years:Array.isArray(e)?e:[];h(i),T(e=>e&&i.includes(e)?e:i[0]||"")}catch(e){p(e.message||"Yillar alinamadi"),h([])}finally{f(!1)}}},[l,a,B]);(0,n.useEffect)(()=>{l&&(m(null),p(""),L(null),h([]),z())},[l,z]),(0,n.useEffect)(()=>{l&&I&&(v||g.length&&!g.includes(I)||_())},[l,I,_,v,g]);const Y=(0,n.useMemo)(()=>Array.isArray(null===d||void 0===d?void 0:d.rows)?d.rows:[],[null===d||void 0===d?void 0:d.rows]),F=!(null===d||void 0===d||!d.bulkDisabledDueToStaleSource),D=Array.isArray(null===d||void 0===d?void 0:d.staleSources)?d.staleSources:[],E=b.trim().toLowerCase(),K=(0,n.useMemo)(()=>Y.filter(e=>{if(j&&!e.eligible)return!1;if(S&&e.sentAt)return!1;if(!E)return!0;const i=String(e.schoolName||"").toLowerCase(),l=String(e.scenarioName||"").toLowerCase();return i.includes(E)||l.includes(E)}),[Y,j,S,E]);return l?(0,u.jsx)("div",{className:"modal-backdrop",role:"dialog","aria-modal":"true",onClick:r,children:(0,u.jsxs)("div",{className:"modal",style:{width:"min(1100px, 96vw)",maxHeight:"86vh",overflowY:"auto"},onClick:e=>e.stopPropagation(),children:[(0,u.jsxs)("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center"},children:[(0,u.jsx)("div",{style:{fontWeight:700},children:"Ulke Onay Paketi Gonder"}),(0,u.jsx)("button",{className:"btn",onClick:r,disabled:C,children:"Kapat"})]}),(0,u.jsxs)("div",{className:"row",style:{gap:10,alignItems:"center",marginTop:12,flexWrap:"wrap"},children:[(0,u.jsx)("select",{className:"input sm",style:{minWidth:200},value:I,onChange:e=>T(e.target.value),disabled:v||!g.length,children:g.length?g.map(e=>(0,u.jsx)("option",{value:e,children:e},e)):(0,u.jsx)("option",{value:"",children:"Akademik yil yok"})}),(0,u.jsxs)("label",{className:"row small",style:{gap:6,alignItems:"center"},children:[(0,u.jsx)("span",{children:"Yil ortasi donemleri:"}),(0,u.jsxs)("select",{className:"input sm",value:B,onChange:e=>O(e.target.value),disabled:v,children:[(0,u.jsx)("option",{value:"academic",children:"Ayrik (2024-2025)"}),(0,u.jsx)("option",{value:"start",children:"Baslangic yilina dahil"}),(0,u.jsx)("option",{value:"end",children:"Bitis yilina dahil"})]})]}),(0,u.jsx)("button",{className:"btn",type:"button",onClick:_,disabled:s||!I.trim(),children:"Onizleme"}),(0,u.jsx)("input",{className:"input sm",style:{minWidth:220},placeholder:"Ara: okul veya senaryo",value:b,onChange:e=>x(e.target.value)}),(0,u.jsxs)("label",{className:"row small",style:{gap:6,alignItems:"center"},children:[(0,u.jsx)("input",{type:"checkbox",checked:j,onChange:e=>k(e.target.checked)}),(0,u.jsx)("span",{children:"Uygun olmayanlari gizle"})]}),(0,u.jsxs)("label",{className:"row small",style:{gap:6,alignItems:"center"},children:[(0,u.jsx)("input",{type:"checkbox",checked:S,onChange:e=>N(e.target.checked)}),(0,u.jsx)("span",{children:"Gonderilenleri gizle"})]})]}),F?(0,u.jsxs)("div",{className:"card",style:{marginTop:10,background:"#fff1f2",borderColor:"#fecaca"},children:[(0,u.jsx)("div",{style:{fontWeight:700},children:"Gider paylastirma guncel degil. Kaynak senaryolar guncellenmeden gonderim yapilamaz."}),D.length?(0,u.jsx)("div",{className:"small",style:{marginTop:6},children:D.map(e=>(0,u.jsxs)("div",{children:[e.schoolName," - ",e.scenarioName," (",e.yearText,")"]},"".concat(e.schoolId,"-").concat(e.scenarioId)))}):null]}):null,y?(0,u.jsx)("div",{className:"card",style:{marginTop:10,background:"#fff1f2",borderColor:"#fecaca"},children:y}):null,d?(0,u.jsx)("div",{className:"table-scroll",style:{marginTop:10},children:(0,u.jsxs)("table",{className:"table",style:{fontSize:12},children:[(0,u.jsx)("thead",{children:(0,u.jsxs)("tr",{children:[(0,u.jsx)("th",{children:"Okul"}),(0,u.jsx)("th",{children:"Senaryo"}),(0,u.jsx)("th",{children:"Yil"}),(0,u.jsx)("th",{children:"Durum"}),(0,u.jsx)("th",{children:"Ilerleme"}),(0,u.jsx)("th",{children:"Split"}),(0,u.jsx)("th",{children:"Uygun"}),(0,u.jsx)("th",{children:"Nedenler"})]})}),(0,u.jsx)("tbody",{children:s?(0,u.jsx)("tr",{children:(0,u.jsx)("td",{colSpan:"8",className:"small",children:"Yukleniyor..."})}):0===K.length?(0,u.jsx)("tr",{children:(0,u.jsx)("td",{colSpan:"8",className:"small",children:"Gosterilecek satir yok."})}):K.map(e=>{const i=Array.isArray(e.reasons)&&e.reasons.length?e.reasons.join(", "):"-",l=null!==e.progress&&void 0!==e.progress&&Number.isFinite(Number(e.progress))?"".concat(Math.round(Number(e.progress)),"%"):"-";return(0,u.jsxs)("tr",{children:[(0,u.jsx)("td",{children:e.schoolName}),(0,u.jsx)("td",{children:e.scenarioName||"-"}),(0,u.jsx)("td",{children:e.academicYear||"-"}),(0,u.jsx)("td",{children:(n=e.status,"approved"===n?"Kontrol edildi":"sent_for_approval"===n?"Merkeze iletildi":n||"-")}),(0,u.jsx)("td",{children:l}),(0,u.jsx)("td",{children:(r=e.splitStatus,"ok"===r?"OK":"stale"===r?"Stale":"none")}),(0,u.jsx)("td",{children:e.eligible?"Evet":"Hayir"}),(0,u.jsx)("td",{className:"small",children:i})]},"".concat(e.schoolId,"-").concat(e.scenarioId||"none"));var r,n})})]})}):(0,u.jsx)("div",{className:"card",style:{marginTop:10},children:"Once akademik yil girip onizleme alin."}),w?(0,u.jsxs)("div",{className:"card",style:{marginTop:12,background:"#ecfeff",borderColor:"#cffafe"},children:[(0,u.jsx)("div",{style:{fontWeight:700},children:"Sonuc"}),(0,u.jsxs)("div",{className:"small",children:["Gonderilen senaryo sayisi: ",null!==(i=w.scenarioCount)&&void 0!==i?i:0," (Batch #",w.batchId,")"]})]}):null,(0,u.jsx)("div",{className:"row",style:{justifyContent:"flex-end",marginTop:12,gap:8},children:(0,u.jsx)("button",{className:"btn primary",onClick:async()=>{if(!C&&null!==d&&void 0!==d&&d.canSubmit&&I.trim()){p(""),A(!0);try{const e=await o.FH.countryApprovalBatchSend(a,I.trim(),B);L(e||null),t.oR.success("Ulke onay paketi gonderildi"),await _()}catch(e){p(e.message||"Gonderim basarisiz")}finally{A(!1)}}},disabled:!(null!==d&&void 0!==d&&d.canSubmit)||F||C,children:C?"Gonderiliyor...":"Merkeze Ilet"})})]})}):null}var j=l(6037),k=l(9322),S=l(5534),N=l(8345),C=l(1298);const A=[{key:"temel",label:"Temel Bilgiler",sections:[{id:"temel.core",label:"Kademeler + Program"},{id:"temel.pricing",label:"Enflasyon + Ucret Artis Oranlari + Ucret Hesaplama Ayari"},{id:"temel.schoolInfo",label:"Yetkililer + Okul/Egitim Bilgileri"},{id:"temel.discountsMeta",label:"IK Mevcut + Burs/Indirim Ogrenci Sayilari"},{id:"temel.competitors",label:"Rakip Analizi"},{id:"temel.performance",label:"Performans + Degerlendirme"}]},{key:"kapasite",label:"Kapasite",sections:[{id:"kapasite.all",label:"Kapasite (tumu)"}]},{key:"norm",label:"Norm",sections:[{id:"norm.planned",label:"Planlanan donem bilgileri"},{id:"norm.current",label:"Mevcut donem bilgileri"},{id:"norm.lessonY1",label:"Ders dagilimi (yalnizca Y1)"}]},{key:"hr",label:"IK (HR)",sections:[{id:"hr.ik",label:"IK Plan (tumu)"}]},{key:"gelirler",label:"Gelirler",sections:[{id:"income.gelirler",label:"Gelirler (tumu)"}]},{key:"giderler",label:"Giderler",sections:[{id:"expenses.giderler",label:"Giderler (tumu)"},{id:"expenses.discounts",label:"BURS VE INDIRIMLER / YIL"}]}],w={"temel.core":["page.temel_bilgiler"],"temel.pricing":["section.temel_bilgiler.inflation"],"temel.schoolInfo":["page.temel_bilgiler"],"temel.discountsMeta":["section.temel_bilgiler.ik_mevcut","section.temel_bilgiler.burs_ogr"],"temel.competitors":["section.temel_bilgiler.rakip"],"temel.performance":["section.temel_bilgiler.performans"],"kapasite.all":["section.kapasite.caps"],"norm.planned":["page.norm"],"norm.current":["page.norm"],"norm.lessonY1":["section.norm.ders_dagilimi"],"hr.ik":["section.ik.local_staff"],"income.gelirler":["section.gelirler.unit_fee"],"expenses.giderler":["section.giderler.isletme"],"expenses.discounts":["section.discounts.discounts"]};function L(e){const i=String((null===e||void 0===e?void 0:e.status)||"draft"),l=null!=(null===e||void 0===e?void 0:e.submitted_at),r=null!=(null===e||void 0===e?void 0:e.sent_at);return"sent_for_approval"===i||"submitted"===i||"approved"===i&&r||"in_review"===i&&l}const I="2026",T="2027",B=/^[A-Z0-9]{2,10}$/,O=["USD","EUR","TRY","GBP","JPY","CNY","INR","RUB","AED","SAR","AFN"];function _(e){const i=String(e||"").trim();return/^\d{4}$/.test(i)?Number(i):null}function z(e){const i=String(e||"").trim(),l=i.match(/^(\d{4})$/);if(l){const e=Number(l[1]);return Number.isFinite(e)?String(e+1):""}const r=i.match(/^(\d{4})\s*-\s*(\d{4})$/);if(r){const e=Number(r[1]),i=Number(r[2]);if(Number.isFinite(e)&&Number.isFinite(i))return"".concat(e+1,"-").concat(i+1)}return""}function Y(){return A.flatMap(e=>e.sections.map(e=>e.id))}function F(e){const i=(0,r.A)({},e||{}),l=!!i["hr.ik"],n=!!i["expenses.giderler"];if(l!==n){const e=l||n;i["hr.ik"]=e,i["expenses.giderler"]=e}return i}function D(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"all";const i=Y(),l=Object.fromEntries(i.map(e=>[e,!1]));return"all"===e?i.forEach(e=>{l[e]=!0}):"structure"===e?["temel.core","kapasite.all","norm.planned","norm.lessonY1"].forEach(e=>{l[e]=!0}):"financial"===e&&["temel.core","income.gelirler","expenses.discounts","hr.ik","expenses.giderler"].forEach(e=>{l[e]=!0}),F(l)}function E(){const e={};return(0,j.oP)().forEach(i=>{e[i]={}}),e}function K(e){return{teacherWeeklyMaxHours:Number.isFinite(e)&&e>0?e:24,curriculumWeeklyHours:E()}}function U(e,i){var l;const r=Number(i);if(!Number.isFinite(r)||r<=0)return e;const n=e=>{const i=Number(e);return Number.isFinite(i)?Math.round(i*r*100)/100:e};if(null!==e&&void 0!==e&&e.gelirler){var a,t,s,o;const i=e.gelirler,l=e=>{Array.isArray(e)&&e.forEach(e=>{e&&"object"===typeof e&&("unitFee"in e&&(e.unitFee=n(e.unitFee)),"amount"in e&&(e.amount=n(e.amount)))})};l(null===i||void 0===i||null===(a=i.tuition)||void 0===a?void 0:a.rows),l(null===i||void 0===i||null===(t=i.nonEducationFees)||void 0===t?void 0:t.rows),l(null===i||void 0===i||null===(s=i.dormitory)||void 0===s?void 0:s.rows),l(null===i||void 0===i||null===(o=i.otherInstitutionIncome)||void 0===o?void 0:o.rows),null!=(null===i||void 0===i?void 0:i.governmentIncentives)&&(i.governmentIncentives=n(i.governmentIncentives))}null!==e&&void 0!==e&&e.giderler&&"object"===typeof e.giderler&&Object.values(e.giderler).forEach(e=>{e&&"object"===typeof e&&e.items&&"object"===typeof e.items&&Object.keys(e.items).forEach(i=>{e.items[i]=n(e.items[i])})}),null!==e&&void 0!==e&&null!==(l=e.ik)&&void 0!==l&&l.years&&"object"===typeof e.ik.years&&Object.values(e.ik.years).forEach(e=>{e&&"object"===typeof e&&e.unitCosts&&"object"===typeof e.unitCosts&&Object.keys(e.unitCosts).forEach(i=>{e.unitCosts[i]=n(e.unitCosts[i])})}),Array.isArray(null===e||void 0===e?void 0:e.discounts)&&e.discounts.forEach(e=>{e&&"object"===typeof e&&"amount"===String(e.mode||"").toLowerCase()&&(e.value=n(e.value))});const c=null===e||void 0===e?void 0:e.temelBilgiler;var d,u;c&&(null!=(null===c||void 0===c||null===(d=c.inflation)||void 0===d?void 0:d.currentSeasonAvgFee)&&(c.inflation.currentSeasonAvgFee=n(c.inflation.currentSeasonAvgFee)),null!==c&&void 0!==c&&c.rakipAnalizi&&"object"===typeof c.rakipAnalizi&&Object.values(c.rakipAnalizi).forEach(e=>{e&&"object"===typeof e&&["a","b","c"].forEach(i=>{i in e&&(e[i]=n(e[i]))})}),null!==c&&void 0!==c&&null!==(u=c.performans)&&void 0!==u&&u.gerceklesen&&"object"===typeof c.performans.gerceklesen&&Object.keys(c.performans.gerceklesen).forEach(e=>{c.performans.gerceklesen[e]=n(c.performans.gerceklesen[e])}));return e}function M(e){let{size:i=12}=e;return(0,u.jsx)("span",{"aria-hidden":!0,style:{width:i,height:i,borderRadius:"50%",border:"2px solid rgba(0,0,0,0.18)",borderTopColor:"rgba(0,0,0,0.65)",display:"inline-block",animation:"schoolSpin .8s linear infinite"}})}function P(e){var i,l,n;const a=e=>{const i=Number(e);return Number.isFinite(i)?i:0},t=e||{},s=a(t.schoolCapacity),o=t.kapasite&&"object"===typeof t.kapasite?t.kapasite:{},c=o.years&&"object"===typeof o.years?o.years:{},d=a(null!=c.y1?c.y1:s),u=a(null!=c.y2?c.y2:d),m=a(null!=c.y3?c.y3:d),y=a(o.currentStudents),p=o.byKademe&&"object"===typeof o.byKademe?o.byKademe:{};if(!("schoolCapacity"in t||!t.kapasite||"object"!==typeof t.kapasite||!o.years||"object"!==typeof o.years||a(null===o||void 0===o||null===(i=o.years)||void 0===i?void 0:i.y1)!==d||a(null===o||void 0===o||null===(l=o.years)||void 0===l?void 0:l.y2)!==u||a(null===o||void 0===o||null===(n=o.years)||void 0===n?void 0:n.y3)!==m||a(null===o||void 0===o?void 0:o.currentStudents)!==y||!o.byKademe||"object"!==typeof o.byKademe))return t;const g=structuredClone(t);return g.kapasite=(0,r.A)((0,r.A)({},o||{}),{},{currentStudents:y,years:{y1:d,y2:u,y3:m},byKademe:p}),"schoolCapacity"in g&&delete g.schoolCapacity,g}function G(e){const i=e||{},l=i.temelBilgiler&&"object"===typeof i.temelBilgiler?i.temelBilgiler:{},n=structuredClone(i),a=l.inflation&&"object"===typeof l.inflation?l.inflation:{},t=e=>Number.isFinite(Number(e))?Number(e):0;return n.temelBilgiler={inflation:(0,r.A)((0,r.A)({},a),{},{expenseDeviationPct:t(a.expenseDeviationPct),y2023:t(a.y2023),y2024:t(a.y2024),y2025:t(a.y2025),y1:t(a.y1),y2:t(a.y2),y3:t(a.y3),currentSeasonAvgFee:t(a.currentSeasonAvgFee)}),yetkililer:l.yetkililer||{mudur:"",ulkeTemsilcisi:"",raporuHazirlayan:""},okulEgitimBilgileri:l.okulEgitimBilgileri||{egitimBaslamaTarihi:"",zorunluEgitimDonemleri:"",birDersSuresiDakika:0,gunlukDersSaati:0,haftalikDersSaatiToplam:0,sabahciOglenci:"",ogretmenHaftalikDersOrt:0,gecisSinaviBilgisi:"",uygulananProgram:""},kademeler:(0,j.Ds)(l.kademeler),programType:(0,k.wN)(l.programType),okulUcretleriHesaplama:"boolean"!==typeof l.okulUcretleriHesaplama||l.okulUcretleriHesaplama,ucretArtisOranlari:l.ucretArtisOranlari||{okulOncesi:0,ilkokulYerel:0,ilkokulInt:0,ortaokulYerel:0,ortaokulInt:0,liseYerel:0,liseInt:0},ikMevcut:l.ikMevcut||{turkPersonelYoneticiEgitimci:0,turkPersonelTemsilcilik:0,yerelKadroluEgitimci:0,yerelUcretliVakaterEgitimci:0,yerelDestek:0,yerelTemsilcilik:0,international:0},bursIndirimOgrenciSayilari:l.bursIndirimOgrenciSayilari||{magisBasariBursu:0,maarifYetenekBursu:0,ihtiyacBursu:0,okulBasariBursu:0,tamEgitimBursu:0,barinmaBursu:0,turkceBasariBursu:0,uluslararasiYukumlulukIndirimi:0,vakifCalisaniIndirimi:0,kardesIndirimi:0,erkenKayitIndirimi:0,pesinOdemeIndirimi:0,kademeGecisIndirimi:0,temsilIndirimi:0,kurumIndirimi:0,istisnaiIndirim:0,yerelMevzuatIndirimi:0},rakipAnalizi:l.rakipAnalizi||{okulOncesi:{a:0,b:0,c:0},ilkokul:{a:0,b:0,c:0},ortaokul:{a:0,b:0,c:0},lise:{a:0,b:0,c:0}},performans:l.performans||{gerceklesen:{ogrenciSayisi:0,gelirler:0,giderler:0,karZarar:0,bursVeIndirimler:0}},degerlendirme:"string"===typeof l.degerlendirme?l.degerlendirme:""},n}function H(e){const i=e||{},l=(0,j.oP)().map(e=>({grade:e,branchCount:0,studentsPerBranch:0})),r=Array.isArray(i.grades)?i.grades:l,n=i.gradesYears&&"object"===typeof i.gradesYears?i.gradesYears:{},a=Array.isArray(n.y1)?n.y1:r,t=Array.isArray(n.y2)?n.y2:a,s=Array.isArray(n.y3)?n.y3:a,o=e=>{const i=new Map;return(Array.isArray(e)?e:[]).forEach(e=>{const l=(e=>{var i,l,r;return{grade:String(null!==(i=null===e||void 0===e?void 0:e.grade)&&void 0!==i?i:""),branchCount:Number(null!==(l=null===e||void 0===e?void 0:e.branchCount)&&void 0!==l?l:0),studentsPerBranch:Number(null!==(r=null===e||void 0===e?void 0:e.studentsPerBranch)&&void 0!==r?r:0)}})(e);l.grade&&i.set(l.grade,l)}),i};if(!(!i.gradesYears||!Array.isArray(i.grades)||!Array.isArray(n.y1)||!Array.isArray(n.y2)||!Array.isArray(n.y3)||!((e,i)=>{if(!Array.isArray(e)||!Array.isArray(i))return!1;if(e.length!==i.length)return!1;const l=o(e),r=o(i);if(l.size!==r.size)return!1;for(const[n,a]of l.entries()){const e=r.get(n);if(!e)return!1;if(Number(a.branchCount)!==Number(e.branchCount))return!1;if(Number(a.studentsPerBranch)!==Number(e.studentsPerBranch))return!1}return!0})(i.grades,a)))return i;const c=structuredClone(i);return c.gradesYears={y1:structuredClone(a),y2:structuredClone(t),y3:structuredClone(s)},c.grades=structuredClone(c.gradesYears.y1),c}function R(){var e,i,l,m,y,p,g,h;const v=(0,a.Zp)(),f=(0,a.KC)(),[R,W]=(0,a.ok)(),$=(0,c.A)(),[V,q]=(0,n.useState)([]),[Z,X]=(0,n.useState)([]),[J,Q]=(0,n.useState)(null),[ee,ie]=(0,n.useState)(null),[le,re]=(0,n.useState)(null),[ne,ae]=(0,n.useState)(null),[te,se]=(0,n.useState)(null),[,oe]=(0,n.useState)(null),[ce,de]=(0,n.useState)(""),[ue,me]=(0,n.useState)(!1),[ye,pe]=(0,n.useState)(!1),[ge,he]=(0,n.useState)({}),[ve,fe]=(0,n.useState)(!1),[be,xe]=(0,n.useState)({}),[je,ke]=(0,n.useState)({}),[Se,Ne]=(0,n.useState)(!1),[Ce,Ae]=(0,n.useState)(""),[we,Le]=(0,n.useState)("split"),[Ie,Te]=(0,n.useState)(I),[Be,Oe]=(0,n.useState)(T),[_e,ze]=(0,n.useState)((0,j.jc)()),[Ye,Fe]=(0,n.useState)(!1),[De,Ee]=(0,n.useState)("USD"),[Ke,Ue]=(0,n.useState)(""),[Me,Pe]=(0,n.useState)(""),[Ge,He]=(0,n.useState)(null),[Re,We]=(0,n.useState)(0),[$e,Ve]=(0,n.useState)(!1),[qe,Ze]=(0,n.useState)("create"),[Xe,Je]=(0,n.useState)(null),[Qe,ei]=(0,n.useState)(!1),[ii,li]=(0,n.useState)(!1),[ri,ni]=(0,n.useState)({key:null,dir:"asc"}),[ai,ti]=(0,n.useState)(null),[si,oi]=(0,n.useState)(null),[ci,di]=(0,n.useState)(null),[ui,mi]=(0,n.useState)(null),[yi,pi]=(0,n.useState)(!1),[gi,hi]=(0,n.useState)(!1),[vi,fi]=(0,n.useState)(!1),[bi,xi]=(0,n.useState)(""),[ji,ki]=(0,n.useState)(null),[Si,Ni]=(0,n.useState)(""),[Ci,Ai]=(0,n.useState)("USD"),[wi,Li]=(0,n.useState)(""),[Ii,Ti]=(0,n.useState)(""),[Bi,Oi]=(0,n.useState)(""),[_i,zi]=(0,n.useState)(!1),Yi=(0,n.useRef)(null),Fi=(0,n.useRef)(null);(0,n.useEffect)(()=>{if(null!==f&&void 0!==f&&f.setHeaderMeta)return f.setHeaderMeta({title:"Okul & Senaryo Sec",subtitle:"Okul ve senaryoyu secip Uygula'ya basin.",centered:!0}),()=>{var e;null===(e=f.clearHeaderMeta)||void 0===e||e.call(f)}},[f]);const Di=(0,n.useCallback)(async()=>{de(""),me(!0);try{const e=await o.FH.listSchools({limit:50,offset:0,fields:"brief",order:"name:asc"});q(Array.isArray(null===e||void 0===e?void 0:e.items)?e.items:[])}catch(e){de(e.message||"Okullar yuklenemedi.")}finally{me(!1)}},[]);(0,n.useEffect)(()=>{Di()},[Di]);const Ei=(0,n.useCallback)(async e=>{if(Array.isArray(e)&&e.length){fe(!0);try{const i=e.map(e=>e.id),l=await o.FH.getSchoolsProgressBulk(i),r=null!==l&&void 0!==l&&l.progressBySchoolId&&"object"===typeof l.progressBySchoolId?l.progressBySchoolId:{};he(r)}catch(i){const l={};e.forEach(e=>{l[e.id]={state:"error",label:"\u0130lerleme hesaplanamad\u0131"}}),he(l)}finally{fe(!1)}}else he({})},[]),Ki=(0,n.useCallback)(async e=>{if(Array.isArray(e)&&e.length)try{const i=e.map(e=>e.id),l=await o.FH.getSchoolsExpenseSplitStale(i),r=null!==l&&void 0!==l&&l.staleBySchoolId&&"object"===typeof l.staleBySchoolId?l.staleBySchoolId:{};xe(r)}catch(i){xe({})}else xe({})},[]);(0,n.useEffect)(()=>{if(!V.length)return he({}),void fe(!1);Ei(V)},[V,Ei]),(0,n.useEffect)(()=>{V.length?Ki(V):xe({})},[V,Ki]),(0,n.useEffect)(()=>{const e=R.get("schoolId"),i=Number(e||0);e&&Number.isFinite(i)&&V.length&&V.some(e=>String(e.id)===String(i))&&ie(e=>String(e)===String(i)?e:(X([]),Q(null),ke({}),Ne(!1),i))},[R,V]);const Ui=(0,n.useCallback)(e=>{const i=String(ee)!==String(e);i&&(re(null),ae(null),se(null),oe(null),X([]),Q(null),ke({}),Ne(!1)),ie(e),i&&W(i=>{const l=new URLSearchParams(i);return l.set("schoolId",String(e)),l})},[ee,W]),Mi=(0,n.useCallback)(()=>{ie(null),re(null),ae(null),se(null),oe(null),X([]),Q(null),ke({}),W(e=>{const i=new URLSearchParams(e);return i.delete("schoolId"),i})},[W]),Pi=(0,n.useCallback)(()=>{re(null),ae(null),se(null),oe(null)},[]);(0,n.useEffect)(()=>{if(!ee)return X([]),Q(null),re(null),ae(null),se(null),oe(null),ke({}),Ne(!1),void pe(!1);re(null),ae(null),se(null),oe(null),X([]),Q(null),ke({}),Ne(!1);let e=!0;return de(""),pe(!0),async function(){try{const i=await o.FH.listScenarios(ee,{limit:50,offset:0,fields:"brief",order:"created_at:desc"});if(!e)return;const l=Array.isArray(null===i||void 0===i?void 0:i.items)?i.items:[];X(l),Q(ee),re(e=>{if(l.some(i=>String(i.id)===String(e)))return e;const i=(0,S.Rj)(ee);return null!=i&&l.some(e=>String(e.id)===String(i))?i:null})}catch(i){if(!e)return;de(i.message||"Senaryolar yuklenemedi."),X([])}finally{e&&pe(!1)}}(),()=>{e=!1}},[ee]),(0,n.useEffect)(()=>{if(!ee)return ke({}),void Ne(!1);if(null!=J&&String(J)!==String(ee))return ke({}),void Ne(!1);if(!Z.length)return ke({}),void Ne(!1);let e=!0;return Ne(!0),async function(){try{const i=await Promise.all(Z.map(async e=>{try{var i;const l=await o.FH.getScenarioProgress(ee,e.id),r=null===l||void 0===l?void 0:l.progress;if(!r)return{id:e.id,error:!0};const n=Array.isArray(r.missingDetailsLines)?r.missingDetailsLines:[],a=n.length?["Eksik:",...n]:["T\xfcm tablolar tamamland\u0131"];return{id:e.id,pct:null!==(i=r.pct)&&void 0!==i?i:0,tooltipLines:a}}catch(l){return{id:e.id,error:!0}}}));if(!e)return;const l={};i.forEach(e=>{l[e.id]=e}),ke(l)}finally{e&&Ne(!1)}}(),()=>{e=!1}},[ee,Z,J]),(0,n.useEffect)(()=>{if(!ee||!le)return ae(null),se(null),void oe(null);let e=!0;return de(""),async function(){try{const i=await o.FH.getScenarioInputs(ee,le);if(!e)return;ae((null===i||void 0===i?void 0:i.scenario)||null);const l=null===i||void 0===i?void 0:i.inputs,r=l&&"object"===typeof l?H(G(P(l))):l;se(r);const n=(0,N.B)(r);(0,S.X3)(ee,le,{isHeadquarter:n}),oe(null)}catch(i){if(!e)return;de(i.message||"Senaryo yuklenemedi.")}}(),()=>{e=!1}},[ee,le]);const Gi=(0,n.useCallback)(async()=>{if(!ee)return null;try{const e=await o.FH.listScenarios(ee,{limit:50,offset:0,fields:"brief",order:"created_at:desc"}),i=Array.isArray(null===e||void 0===e?void 0:e.items)?e.items:[];return X(i),Q(ee),i}catch(e){return null}},[ee]),Hi=(0,n.useCallback)(function(){let{sourceScenarioId:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e&&(X(i=>Array.isArray(i)?i.map(i=>String(i.id)!==String(e)?i:(0,r.A)((0,r.A)({},i),{},{expense_split_applied:!0,expense_split_stale:!1})):i),Gi(),Ki(V))},[Gi,Ki,V]),Ri=(0,n.useMemo)(()=>(0,j.aW)(),[]),Wi=(0,n.useMemo)(()=>(0,j.oP)(),[]),$i=_(Ie),Vi=_(Be),qi=function(e,i,l){const r=_(i);if(!r)return"";if("full"===e)return String(r);const n=_(l);return n?"".concat(r,"-").concat(n):""}(we,Ie,Be),Zi="full"===we||null!=$i&&Vi===$i+1,Xi=(0,n.useMemo)(()=>{if(!qi)return!1;const e="edit"===qe?Number((null===Xe||void 0===Xe?void 0:Xe.id)||le||0):null;return Z.some(i=>String((null===i||void 0===i?void 0:i.academic_year)||"").trim()===String(qi).trim()&&(null==e||Number(null===i||void 0===i?void 0:i.id)!==e))},[qi,Z,qe,null===Xe||void 0===Xe?void 0:Xe.id,le]),Ji=(0,n.useMemo)(()=>(0,j.Ds)(_e),[_e]),Qi=(0,n.useMemo)(()=>Object.values(Ji).some(e=>e&&e.enabled),[Ji]),el=Ye||Qi,il=String(Ke||"").trim().toUpperCase(),ll="LOCAL"!==De||B.test(il),rl=Number(Me),nl="LOCAL"!==De||Number.isFinite(rl)&&rl>0,al="USD"===De||ll&&nl,tl=Boolean(Ce.trim())&&Boolean(qi)&&Zi&&!Xi&&el&&al,sl=[!0,al,Boolean(Ge),Boolean(qi)&&Zi&&!Xi,el,tl],ol=Boolean(si||ai||ci||ii||Qe),cl=null!==(e=null!==(i=null!==si&&void 0!==si?si:ai)&&void 0!==i?i:ci)&&void 0!==e?e:null,dl=(0,n.useMemo)(()=>Z.find(e=>String(e.id)===String(le))||null,[Z,le]),ul=(0,n.useMemo)(()=>{const e=V.find(e=>String(e.id)===String(ee));return(null===e||void 0===e?void 0:e.name)||""},[V,ee]),ml=(0,n.useMemo)(()=>{if(!ri.key)return Z;const e=Z.map((e,i)=>({s:e,idx:i})),i="asc"===ri.dir?1:-1,l=e=>{const i=String(e||"").match(/(\d{4})(?:\s*-\s*(\d{4}))?/),l=i?Number(i[1]):0;return[l||0,(i&&i[2]?Number(i[2]):l)||0]},r=e=>"LOCAL"===String(e.input_currency||"USD").toUpperCase()?String(e.local_currency_code||"LOCAL").toUpperCase():"USD",n=e=>{switch(e){case"in_review":return"\u0130ncelemede";case"sent_for_approval":return"Onaya Gonderildi";case"submitted":return"Gonderildi";case"revision_requested":return"Revizyon Istendi";case"approved":return"Onaylandi";default:return"Taslak"}};return e.sort((e,a)=>{const t=e.s,s=a.s;let o=0;switch(ri.key){case"name":o=String(t.name||"").localeCompare(String(s.name||""),"tr",{sensitivity:"base",numeric:!0});break;case"year":{const[e,i]=l(t.academic_year),[r,n]=l(s.academic_year);o=e-r||i-n;break}case"currency":o=r(t).localeCompare(r(s),"tr",{sensitivity:"base",numeric:!0});break;case"status":o=n(t.status).localeCompare(n(s.status),"tr",{sensitivity:"base",numeric:!0});break;case"date":o=new Date(t.created_at).getTime()-new Date(s.created_at).getTime();break;default:o=0}return 0===o&&(o=e.idx-a.idx),o*i}),e.map(e=>e.s)},[Z,ri]),yl=e=>{ni(i=>i.key===e?{key:e,dir:"asc"===i.dir?"desc":"asc"}:{key:e,dir:"asc"})},pl=e=>ri.key!==e?"none":"asc"===ri.dir?"ascending":"descending",gl=e=>ri.key!==e?(0,u.jsx)("span",{className:"sort-icon is-idle",children:(0,u.jsx)(s.MjW,{"aria-hidden":"true"})}):(0,u.jsx)("span",{className:"sort-icon",children:"asc"===ri.dir?(0,u.jsx)(s.XhJ,{"aria-hidden":"true"}):(0,u.jsx)(s.GOR,{"aria-hidden":"true"})}),hl=(0,n.useMemo)(()=>Y(),[]),vl=ji?hl.reduce((e,i)=>e+(ji[i]?1:0),0):0,fl=!(null===ji||void 0===ji||!ji["hr.ik"])===!(null===ji||void 0===ji||!ji["expenses.giderler"]),bl=String((null===ne||void 0===ne?void 0:ne.input_currency)||"USD").toUpperCase(),xl="LOCAL"===(null===ne||void 0===ne?void 0:ne.input_currency)?ne.local_currency_code||"LOCAL":"USD",jl="LOCAL"===(null===ne||void 0===ne?void 0:ne.input_currency),kl=Number((null===te||void 0===te||null===(l=te.temelBilgiler)||void 0===l||null===(m=l.performans)||void 0===m?void 0:m.prevYearRealizedFxUsdToLocal)||0),Sl=jl&&!(Number.isFinite(kl)&&kl>0),Nl=(0,n.useMemo)(()=>{var e,i;return{countryId:null!==(e=null===(i=$.user)||void 0===i?void 0:i.country_id)&&void 0!==e?e:null,schoolId:null!=ee?Number(ee):null}},[null===(y=$.user)||void 0===y?void 0:y.country_id,ee]),Cl=String((null===(p=$.user)||void 0===p?void 0:p.role)||""),Al=(0,C.$3)($.user,"scenario.create","write",Nl),wl=(0,C.$3)($.user,"scenario.plan_edit","write",Nl),Ll=(0,C.$3)($.user,"scenario.copy","write",Nl),Il=(0,C.$3)($.user,"scenario.expense_split","write",Nl),Tl=(0,C.$3)($.user,"scenario.submit","write",Nl),Bl="manager"===Cl||"accountant"===Cl,Ol=(0,C.$3)($.user,"scenario.delete","write",Nl),_l=Boolean(dl)&&L(dl),zl=Boolean(dl)&&!_l&&wl,Yl=Boolean(dl)&&!_l&&Ol,Fl=Boolean(dl)&&("draft"===dl.status||"revision_requested"===dl.status),Dl=Fl&&Tl,El=Boolean(dl)&&te&&Ll,Kl=dl&&String(si)===String(dl.id),Ul=dl&&String(ai)===String(dl.id),Ml=dl&&String(ci)===String(dl.id),Pl=dl&&je?je[dl.id]:null,Gl=Pl&&!Pl.error?Number(null!==(g=Pl.pct)&&void 0!==g?g:0):null,Hl=Number.isFinite(Gl)&&Gl>=100,Rl=Boolean(dl)&&Hl;let Wl="Onaya Gonder";Dl&&!Rl&&(Wl=Se?"Ilerleme hesaplan\u0131yor.":!Pl||Pl.error?"Ilerleme bilgisi alinmadi.":"Ilerleme %100 degil.");const $l=e=>{Ee(e),"LOCAL"!==e&&(Ue(""),Pe(""))},Vl=e=>{if(Le(e),"split"===e){const e=_(Ie);null!=e&&Oe(String(e+1))}},ql=e=>{if(Te(e),"split"===we){const i=_(e);null!=i&&Oe(String(i+1))}};async function Zl(e){if(!wl)return;if(!ee)return;de("");const i=Z.find(i=>String(i.id)===String(e));if(i&&L(i))de("Senaryo onayda veya onaylandi, duzenlenemez.");else{re(e),Ze("edit"),Je(null),Ve(!0),ei(!0),We(0);try{var l,r;const i=await o.FH.getScenarioInputs(ee,e),n=null===i||void 0===i?void 0:i.scenario;if(!n)throw new Error("Senaryo bulunamadi.");Je(n),Ae(n.name||"");const a=function(e){const i=String(e||"").trim(),l=i.match(/(\d{4})\s*-\s*(\d{4})/);if(l){const e=Number(l[1]),i=Number(l[2]);if(Number.isFinite(e)&&Number.isFinite(i))return{startYear:e,endYear:i}}const r=i.match(/^(\d{4})$/);if(r){const e=Number(r[1]);if(Number.isFinite(e))return{startYear:e,endYear:e}}return{startYear:null,endYear:null}}(n.academic_year);a.startYear&&a.endYear&&a.endYear!==a.startYear?(Le("split"),Te(String(a.startYear)),Oe(String(a.endYear))):a.startYear?(Le("full"),Te(String(a.startYear)),Oe(String(a.startYear+1))):(Le("split"),Te(I),Oe(T));const t=null===i||void 0===i||null===(l=i.inputs)||void 0===l||null===(r=l.temelBilgiler)||void 0===r?void 0:r.kademeler,s=t?(0,j.Ds)(t):(0,j.jc)(),c=Object.values(s).some(e=>e&&e.enabled);ze(s),Fe(!c),Fi.current=c?structuredClone(s):null;const d=n.input_currency||"USD";Ee(d),Ue(n.local_currency_code||""),Pe(null!=n.fx_usd_to_local?String(n.fx_usd_to_local):""),He(n.program_type||k.Rw.LOCAL)}catch(n){de(n.message||"Senaryo yuklenemedi."),Ve(!1)}finally{ei(!1)}}}const Xl=(e,i)=>{ze(l=>{const n=(0,j.Ds)(l),a=(0,r.A)((0,r.A)({},n),{},{[e]:(0,r.A)((0,r.A)({},n[e]),i)});return(0,j.Ds)(a)})},Jl=e=>{const i=String(null!==e&&void 0!==e?e:"").trim();if(!i)return NaN;const l=i.replace(",",".").match(/-?\d+(?:\.\d+)?/);if(!l)return NaN;const r=Number.parseFloat(l[0]);return Number.isFinite(r)?r:NaN},Ql=e=>{ki(D(e)),Ni("")},er=(e,i)=>{ol||ki(l=>{const n=l||D("all"),a=(0,r.A)({},n);var t;return"hr.ik"===e||"expenses.giderler"===e?(a["hr.ik"]=i,a["expenses.giderler"]=i,t="IK ve Giderler birlikte ".concat(i?"secildi":"kaldirildi","."),Yi.current&&clearTimeout(Yi.current),Ni(t),Yi.current=setTimeout(()=>{Ni("")},2e3)):a[e]=i,F(a)})},ir=(e,i)=>{if(ol)return;const l=A.find(i=>i.key===e);l&&ki(e=>{const n=e||D("all"),a=(0,r.A)({},n);return l.sections.forEach(e=>{a[e.id]=i}),F(a)})};function lr(){pi(!1),xi("")}function rr(e){const i=Array.isArray(e)?e:[];let l=0;for(const n of i){var r;const e=Number(null!==(r=null===n||void 0===n?void 0:n.studentsPerBranch)&&void 0!==r?r:0);Number.isFinite(e)&&(l+=e)}return l}function nr(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"blocking-toast";t.oR.warn(e,{toastId:i,position:"bottom-right",autoClose:!1,closeOnClick:!1,draggable:!0,icon:"!",style:{background:"rgba(15, 23, 42, 0.96)",color:"#f8fafc",border:"1px solid rgba(251, 191, 36, 0.35)",boxShadow:"0 18px 40px rgba(0,0,0,.28)",borderRadius:14}})}function ar(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Islem";if(!te)return!0;if((0,N.B)(te))return!0;const i=function(e){const i=e&&"object"===typeof e?e:{},l=i.gradesYears&&"object"===typeof i.gradesYears?i.gradesYears:{};return{y1:rr(Array.isArray(l.y1)?l.y1:i.grades),y2:rr(l.y2),y3:rr(l.y3)}}(te),l=[];if(i.y2>0||l.push("Y2"),i.y3>0||l.push("Y3"),!l.length)return!0;const r="".concat(e," yapilamaz: Norm > Planlanan Donem Bilgileri bolumunde ")+"".concat(l.join(" ve ")," toplam ogrenci 0 gorunuyor. Lutfen Y2/Y3 ogrenci sayilarini girin.");return de(""),nr(r,"norm-y2y3-missing"),!1}function tr(){if(!te)return!0;if(!jl)return!0;if(!Sl)return!0;const e="".concat(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Islem"," yapilamaz: Temel Bilgiler > Performans alanindaki ")+'"Onceki Donem Ortalama Kur (Gerceklesen)" girilmelidir.';return de(""),nr(e,"prev-realized-fx-missing"),!1}async function sr(e){if(!Tl)return;if(!ee||!e||String(e)!==String(le))return;const i=String((null===dl||void 0===dl?void 0:dl.status)||(null===ne||void 0===ne?void 0:ne.status)||"draft");if(!["draft","revision_requested"].includes(i))return void de("Senaryo onayda veya onaylandi, gonderilemez.");if(!tr("Onaya gonderme"))return;if(!ar("Onaya gonderme"))return;if(ai)return;const l=await async function(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Gonderme",l=null;const r=null===je||void 0===je?void 0:je[e];if(r&&!r.error){var n;const e=Number(null!==(n=r.pct)&&void 0!==n?n:0);Number.isFinite(e)&&(l=e)}if(!Number.isFinite(l))try{if(ee){var a;const i=await o.FH.getScenarioProgress(ee,e),r=null===i||void 0===i?void 0:i.progress,n=Number(null!==(a=null===r||void 0===r?void 0:r.pct)&&void 0!==a?a:0);Number.isFinite(n)&&(l=n)}}catch(s){}if(!Number.isFinite(l)||l<100){const e="".concat(i," yapilamaz: Ilerleme %100 degil.");return t.oR.warn(e),!1}return!0}(e,"Onaya gonderme");if(l){de(""),ti(e);try{const i=await async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!ee||!le)return!1;if(!tr("Hesaplama"))return!1;if(!e.skipPlanValidation&&!ar("Hesaplama"))return!1;zi(!0),de("");let i=!1;try{const e=await o.FH.calculateScenario(ee,le);oe(e.results),i=!0}catch(l){de(l.message||"Calculation failed")}finally{zi(!1)}return i}({keepTab:!0});if(!i)return;const l=await o.FH.listWorkItems(ee,e),a=Array.isArray(null===l||void 0===l?void 0:l.requiredWorkIds)?l.requiredWorkIds:[],s=Array.isArray(null===l||void 0===l?void 0:l.workItems)?l.workItems:[],c=new Map(s.map(e=>[String(e.work_id),e])),d=a.filter(e=>{const i=c.get(String(e)),l=String((null===i||void 0===i?void 0:i.state)||"not_started");return["not_started","in_progress","needs_revision"].includes(l)});if(0===d.length)t.oR.warn("Gonderilecek modul yok.");else{const i=(await Promise.allSettled(d.map(i=>o.FH.submitWorkItem(ee,e,i)))).filter(e=>"rejected"===e.status);if(i.length){var n;const e=null===(n=i[0])||void 0===n?void 0:n.reason;t.oR.error((null===e||void 0===e?void 0:e.message)||"Moduller gonderilemedi.")}else t.oR.success("Moduller onaya gonderildi.")}const u=await Gi();if(Array.isArray(u)){const i=u.find(i=>String(i.id)===String(e));i&&ae(e=>e?(0,r.A)((0,r.A)({},e),i):e)}}catch(a){de(a.message||"Gonderme basarisiz")}finally{ti(null)}}}const or=null!=ui?Z.find(e=>String(e.id)===String(ui)):null,cr=null!==or&&void 0!==or&&or.name?'"'.concat(or.name,'"'):"Senaryo",dr=null!=ui&&String(ui)===String(le)&&Z.length<=1?"".concat(cr," son senaryo. Silerseniz senaryo secimi temizlenir."):"".concat(cr," silinecek. Devam edilsin mi?");return(0,u.jsxs)("div",{className:"container select-page",children:[(0,u.jsx)(t.N9,{position:"bottom-right",autoClose:3500,newestOnTop:!0,closeOnClick:!0,pauseOnFocusLoss:!0,pauseOnHover:!0,hideProgressBar:!0,theme:"dark"}),(0,u.jsx)("style",{children:"@keyframes schoolSpin{to{transform:rotate(360deg)}}"}),ce?(0,u.jsx)("div",{className:"card",style:{marginTop:10,background:"#fff1f2",borderColor:"#fecaca"},children:ce}):null,ui?(0,u.jsx)("div",{className:"modal-backdrop",role:"dialog","aria-modal":"true",children:(0,u.jsxs)("div",{className:"modal",children:[(0,u.jsx)("div",{style:{fontWeight:700,marginBottom:8},children:"Senaryo Sil"}),(0,u.jsx)("div",{className:"small",children:dr}),(0,u.jsxs)("div",{className:"row",style:{justifyContent:"flex-end",marginTop:12},children:[(0,u.jsx)("button",{className:"btn",onClick:()=>mi(null),disabled:ol,children:"Iptal"}),(0,u.jsx)("button",{className:"btn danger",onClick:async function(){if(!ui)return;const e=ui;mi(null),await async function(e){if(!Ol)return;if(!ee||!e)return;if(ol)return;const i=Z.find(i=>String(i.id)===String(e));if(!i)return;if(L(i))return void de("Senaryo onayda veya onaylandi, silinemez.");de(""),di(e);try{await o.FH.deleteScenario(ee,e);const i=await Gi();Array.isArray(i)&&(i.length?i.some(e=>String(e.id)===String(le))||re(i[0].id):(re(null),se(null),oe(null))),t.oR.success("Senaryo silindi.")}catch(l){de(l.message||"Senaryo silinemedi.")}finally{di(null)}}(e)},disabled:ol,children:"Sil"})]})]})}):null,yi?(0,u.jsx)("div",{className:"modal-backdrop",role:"dialog","aria-modal":"true",children:(0,u.jsxs)("div",{className:"modal",style:{width:"min(980px, 96vw)",maxHeight:"86vh",overflowY:"auto"},children:[(0,u.jsxs)("div",{className:"row",style:{justifyContent:"space-between"},children:[(0,u.jsx)("div",{style:{fontWeight:700},children:"Senaryo Kopyalama"}),(0,u.jsx)("button",{className:"btn",onClick:lr,disabled:ol,children:"Kapat"})]}),(0,u.jsx)("div",{className:"small",style:{marginTop:6},children:"Yeni senaryo icin para birimini secin."}),bi?(0,u.jsx)("div",{className:"card",style:{marginTop:10,background:"#fff1f2",borderColor:"#fecaca"},children:bi}):null,(0,u.jsxs)("div",{style:{marginTop:12},children:[(0,u.jsx)("div",{className:"small",style:{fontWeight:700,marginBottom:6},children:"Para Birimi"}),(0,u.jsxs)("div",{className:"row",style:{gap:12,alignItems:"center"},children:[(0,u.jsxs)("label",{className:"row",style:{gap:6,alignItems:"center"},children:[(0,u.jsx)("input",{type:"radio",name:"copy-currency",checked:"USD"===Ci,onChange:()=>{Ai("USD"),xi("")}}),(0,u.jsx)("span",{children:"USD"})]}),(0,u.jsxs)("label",{className:"row",style:{gap:6,alignItems:"center"},children:[(0,u.jsx)("input",{type:"radio",name:"copy-currency",checked:"LOCAL"===Ci,onChange:()=>{Ai("LOCAL"),xi("")}}),(0,u.jsx)("span",{children:"LOCAL"})]})]})]}),"USD"===bl&&"LOCAL"===Ci?(0,u.jsxs)("div",{style:{marginTop:12},children:[(0,u.jsxs)("div",{className:"row",style:{gap:8,alignItems:"center"},children:[(0,u.jsx)("div",{className:"small",style:{fontWeight:700},children:"Local currency code"}),(0,u.jsx)("input",{className:"input sm",list:"local-currency-codes-copy",placeholder:"TRY",value:wi,onChange:e=>Li(e.target.value.toUpperCase().replace(/[^A-Z0-9]/g,"").slice(0,10))}),(0,u.jsx)("datalist",{id:"local-currency-codes-copy",children:O.map(e=>(0,u.jsx)("option",{value:e},e))})]}),(0,u.jsxs)("div",{className:"row",style:{gap:8,alignItems:"center",marginTop:10},children:[(0,u.jsx)("span",{children:"1 USD ="}),(0,u.jsx)("input",{className:"input sm",type:"number",step:"0.000001",value:Ii,onChange:e=>Ti(e.target.value)}),(0,u.jsx)("span",{children:wi||"LOCAL"})]}),(0,u.jsx)("div",{className:"small muted",style:{marginTop:6},children:"Planlanan kur (senaryo ayarlari icin)."}),(0,u.jsxs)("div",{className:"row",style:{gap:8,alignItems:"center",marginTop:10},children:[(0,u.jsx)("span",{children:"Kopyalama kuru:"}),(0,u.jsx)("input",{className:"input sm",type:"number",step:"0.000001",value:Bi,onChange:e=>Oi(e.target.value)}),(0,u.jsx)("span",{children:wi||"LOCAL"})]}),(0,u.jsx)("div",{className:"small muted",style:{marginTop:6},children:"Kopyalama kuruna gore tum rakamlar cevrilir."})]}):null,"LOCAL"===bl&&"USD"===Ci?(0,u.jsxs)("div",{style:{marginTop:12},children:[(0,u.jsxs)("div",{className:"row",style:{gap:8,alignItems:"center"},children:[(0,u.jsx)("span",{children:"1 USD ="}),(0,u.jsx)("input",{className:"input sm",type:"number",step:"0.000001",value:Bi,onChange:e=>Oi(e.target.value)}),(0,u.jsx)("span",{children:xl})]}),(0,u.jsx)("div",{className:"small muted",style:{marginTop:6},children:"Kopyalama kuru (LOCAL -> USD)."})]}):null,Si?(0,u.jsx)("div",{className:"small",style:{marginTop:10,color:"#0369a1"},children:Si}):null,(0,u.jsxs)("div",{style:{marginTop:16},children:[(0,u.jsxs)("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center"},children:[(0,u.jsx)("div",{style:{fontWeight:700},children:"Kopyalanacak Bolumler"}),(0,u.jsxs)("div",{className:"row",style:{gap:6,alignItems:"center"},children:[(0,u.jsxs)("div",{className:"small muted",children:["Secili: ",vl]}),(0,u.jsx)("button",{type:"button",className:"btn",onClick:()=>Ql("all"),disabled:ol,children:"Tumu"}),(0,u.jsx)("button",{type:"button",className:"btn",onClick:()=>Ql("structure"),disabled:ol,children:"Yapisi"}),(0,u.jsx)("button",{type:"button",className:"btn",onClick:()=>Ql("financial"),disabled:ol,children:"Finans"})]})]}),(0,u.jsx)("div",{style:{marginTop:10,display:"grid",gap:12,gridTemplateColumns:"repeat(auto-fit, minmax(240px, 1fr))"},children:A.map(e=>(0,u.jsxs)("div",{className:"card",style:{padding:12},children:[(0,u.jsxs)("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center"},children:[(0,u.jsx)("div",{style:{fontWeight:700},children:e.label}),(0,u.jsxs)("div",{className:"row",style:{gap:4},children:[(0,u.jsx)("button",{type:"button",className:"btn",style:{padding:"2px 6px",fontSize:12},onClick:()=>ir(e.key,!0),disabled:ol,children:"Tumu"}),(0,u.jsx)("button",{type:"button",className:"btn",style:{padding:"2px 6px",fontSize:12},onClick:()=>ir(e.key,!1),disabled:ol,children:"Temizle"})]})]}),(0,u.jsx)("div",{style:{marginTop:8,display:"flex",flexDirection:"column",gap:6},children:e.sections.map(e=>(0,u.jsxs)("label",{className:"row",style:{gap:6,alignItems:"center"},children:[(0,u.jsx)("input",{type:"checkbox",checked:!(null===ji||void 0===ji||!ji[e.id]),onChange:i=>er(e.id,i.target.checked),disabled:ol}),(0,u.jsx)("span",{className:"small",children:e.label})]},e.id))})]},e.key))})]}),(0,u.jsxs)("div",{className:"row",style:{justifyContent:"flex-end",marginTop:14},children:[(0,u.jsx)("button",{className:"btn",onClick:lr,disabled:ol,children:"Iptal"}),(0,u.jsx)("button",{className:"btn primary",onClick:async function(){if(!ji)return;if(si)return;const e=F(ji),i=String(Ci||bl).toUpperCase();let l=null,r=null,n=null;if("USD"===bl&&"LOCAL"===i){const e=String(wi||"").toUpperCase().replace(/[^A-Z0-9]/g,"").slice(0,10);if(!B.test(e))return void xi("Local para birimi kodu gecersiz.");const i=Jl(Ii);if(!Number.isFinite(i)||i<=0)return void xi("Gecerli bir kur girilmelidir.");const a=Jl(Bi);if(!Number.isFinite(a)||a<=0)return void xi("Gecerli bir kopyalama kuru girilmelidir.");l=e,r=i,n=a}if("LOCAL"===bl&&"USD"===i){const e=Jl(Bi);if(!Number.isFinite(e)||e<=0)return void xi("Gecerli bir kopyalama kuru girilmelidir.");n=e}lr(),await async function(){var e,i,l;let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!Ll)return;if(!le||!ne||!te)return;if(si)return;if(!ne.academic_year)return void de("Akademik yil bulunamadi.");de("");const n=F((null===r||void 0===r?void 0:r.selection)||D("all"));if(!!n["hr.ik"]!==!!n["expenses.giderler"])return void t.oR.warn("IK ve Giderler birlikte secilmelidir.");const a=String((null===r||void 0===r?void 0:r.targetCurrency)||bl).toUpperCase();let s=null!==(e=null===r||void 0===r?void 0:r.localCurrencyCode)&&void 0!==e?e:null,c=null!==(i=null===r||void 0===r?void 0:r.plannedFxUsdToLocal)&&void 0!==i?i:null,d=null!==(l=null===r||void 0===r?void 0:r.copyFxUsdToLocal)&&void 0!==l?l:null,u=Jl(c),m=Jl(d);if("LOCAL"===bl&&"LOCAL"===a){var y,p,g;s=null!==(y=null!==(p=s)&&void 0!==p?p:ne.local_currency_code)&&void 0!==y?y:"",c=null!==(g=c)&&void 0!==g?g:ne.fx_usd_to_local,u=Jl(c)}if("LOCAL"===bl&&"USD"===a){var h;if(d=null!==(h=d)&&void 0!==h?h:ne.fx_usd_to_local,m=Jl(d),!Number.isFinite(m)||m<=0)return void t.oR.warn("Gecerli bir kopyalama kuru girilmelidir.")}if("USD"===bl&&"LOCAL"===a){if(!s||!B.test(s))return void t.oR.warn("Local para birimi kodu gecersiz.");if(!Number.isFinite(u)||u<=0)return void t.oR.warn("Gecerli bir kur girilmelidir.");if(!Number.isFinite(m)||m<=0)return void t.oR.warn("Gecerli bir kopyalama kuru girilmelidir.")}oi(le);try{var v;const e=ne.name||"Senaryo",i="".concat(e," (Kopya)");let l=z(ne.academic_year);if(!l)throw new Error("Akademik yil formati gecersiz.");let r=0;const c=e=>Z.some(i=>String((null===i||void 0===i?void 0:i.academic_year)||"").trim()===String(e).trim());for(;c(l);)if(l=z(l),r+=1,!l||r>20)throw new Error("Uygun yeni akademik yil bulunamadi.");const d=!!n["temel.core"],y=(0,j.Ds)(d&&(null===te||void 0===te||null===(v=te.temelBilgiler)||void 0===v?void 0:v.kademeler)||(0,j.jc)()),p=d&&(null===ne||void 0===ne?void 0:ne.program_type)||k.Rw.LOCAL,g="LOCAL"===a&&Number.isFinite(u)&&u>0?u:null,h=await o.FH.createScenario(ee,{name:i,academicYear:l,kademeConfig:y,inputCurrency:a,localCurrencyCode:"LOCAL"===a?s||"":null,fxUsdToLocal:g,programType:p});let S=function(e,i){var l;const r=i||{},n=e=>!!r[e],a=structuredClone(e||{}),t=()=>(0,j.oP)().map(e=>({grade:e,branchCount:0,studentsPerBranch:0})),s=null!==e&&void 0!==e&&e.gradesYears&&"object"===typeof e.gradesYears?e.gradesYears:{},o=Array.isArray(null===e||void 0===e?void 0:e.grades)?e.grades:null,c=Array.isArray(null===s||void 0===s?void 0:s.y1)?s.y1:Array.isArray(o)?o:t(),d=n("norm.planned"),u=n("norm.lessonY1"),m=Array.isArray(null===s||void 0===s?void 0:s.y2)?s.y2:u?c:t(),y=Array.isArray(null===s||void 0===s?void 0:s.y3)?s.y3:u?c:t();if(a.temelBilgiler=a.temelBilgiler||{},n("temel.core")||(delete a.temelBilgiler.kademeler,delete a.temelBilgiler.programType),n("temel.pricing")||(delete a.temelBilgiler.inflation,delete a.temelBilgiler.ucretArtisOranlari,delete a.temelBilgiler.okulUcretleriHesaplama),n("temel.schoolInfo")||(delete a.temelBilgiler.yetkililer,delete a.temelBilgiler.okulEgitimBilgileri),n("temel.discountsMeta")||(delete a.temelBilgiler.ikMevcut,delete a.temelBilgiler.bursIndirimOgrenciSayilari),n("temel.competitors")||delete a.temelBilgiler.rakipAnalizi,n("temel.performance")||(delete a.temelBilgiler.performans,delete a.temelBilgiler.degerlendirme),null!==(l=a.temelBilgiler)&&void 0!==l&&l.performans&&"object"===typeof a.temelBilgiler.performans&&delete a.temelBilgiler.performans.gerceklesen,n("kapasite.all")||(delete a.kapasite,delete a.schoolCapacity),n("norm.current")||delete a.gradesCurrent,d||u){const e=u?structuredClone(c):structuredClone(t()),i=d?structuredClone(m):structuredClone(t()),l=d?structuredClone(y):structuredClone(t());a.gradesYears={y1:e,y2:i,y3:l},u?a.grades=structuredClone(e):delete a.grades}else delete a.gradesYears,delete a.grades;return n("hr.ik")||delete a.ik,n("income.gelirler")||delete a.gelirler,n("expenses.giderler")||delete a.giderler,n("expenses.discounts")||delete a.discounts,a}(te,n);n["hr.ik"]&&n["expenses.giderler"]&&(S=function(e){var i,l,r;const n=e||{},a=n.ik||{},t=null!==a&&void 0!==a&&null!==(i=a.years)&&void 0!==i&&i.y1?a.years.y1:a,s=(null===t||void 0===t?void 0:t.unitCosts)||{},o=(null===t||void 0===t?void 0:t.headcountsByLevel)||{},c=["turk_mudur","turk_mdyard","turk_egitimci","turk_temsil","yerel_yonetici_egitimci","yerel_destek","yerel_ulke_temsil_destek","int_yonetici_egitimci"],d=["okulOncesi","ilkokulYerel","ilkokulInt","ortaokulYerel","ortaokulInt","liseYerel","liseInt"],u={};for(const f of c){let e=0;for(const i of d){var m;e+=Number((null===o||void 0===o||null===(m=o[i])||void 0===m?void 0:m[f])||0)}u[f]=Number((null===s||void 0===s?void 0:s[f])||0)*e}const y={turkPersonelMaas:(u.turk_mudur||0)+(u.turk_mdyard||0)+(u.turk_egitimci||0),turkDestekPersonelMaas:u.turk_temsil||0,yerelPersonelMaas:u.yerel_yonetici_egitimci||0,yerelDestekPersonelMaas:(u.yerel_destek||0)+(u.yerel_ulke_temsil_destek||0),internationalPersonelMaas:u.int_yonetici_egitimci||0},p=(null===n||void 0===n||null===(l=n.giderler)||void 0===l||null===(r=l.isletme)||void 0===r?void 0:r.items)||{},g=Object.keys(y);let h=!1;for(const f of g){const e=Number((null===p||void 0===p?void 0:p[f])||0),i=Number((null===y||void 0===y?void 0:y[f])||0);if(Math.abs(e-i)>1e-6){h=!0;break}}if(!h)return n;const v=structuredClone(n);v.giderler=v.giderler||{},v.giderler.isletme=v.giderler.isletme||{},v.giderler.isletme.items=v.giderler.isletme.items||{};for(const f of g)v.giderler.isletme.items[f]=Number(y[f]||0);return v}(S)),S=G(S),S=P(S),S=H(S),"USD"===bl&&"LOCAL"===a&&(S=U(S,m),S.temelBilgiler=S.temelBilgiler||{},S.temelBilgiler.performans=S.temelBilgiler.performans||{},S.temelBilgiler.performans.prevYearRealizedFxUsdToLocal=Number(m)),"LOCAL"===bl&&"USD"===a&&(S=function(e,i){const l=Number(i);return!Number.isFinite(l)||l<=0?e:U(e,1/l)}(S,m),S.temelBilgiler=S.temelBilgiler||{},S.temelBilgiler.performans=S.temelBilgiler.performans||{},S.temelBilgiler.performans.prevYearRealizedFxUsdToLocal=Number(m));const N=function(e){const i=new Set;return e&&"object"===typeof e?(Object.entries(e).forEach(e=>{let[l,r]=e;if(!r)return;const n=w[l];Array.isArray(n)&&n.forEach(e=>i.add(e))}),Array.from(i)):[]}(n);if(await o.FH.saveScenarioInputs(ee,h.id,S,N),n["norm.lessonY1"])try{const e=await o.FH.getNormConfig(ee,le);if(e){var f,b,x;const i=null!==e&&void 0!==e&&e.years&&"object"===typeof e.years?e.years:{},l=Number(null!==(f=null!==(b=null===i||void 0===i||null===(x=i.y1)||void 0===x?void 0:x.teacherWeeklyMaxHours)&&void 0!==b?b:null===e||void 0===e?void 0:e.teacherWeeklyMaxHours)&&void 0!==f?f:24),r={years:{y1:null!==i&&void 0!==i&&i.y1?structuredClone(i.y1):{teacherWeeklyMaxHours:Number.isFinite(l)&&l>0?l:24,curriculumWeeklyHours:null!==e&&void 0!==e&&e.curriculumWeeklyHours&&"object"===typeof e.curriculumWeeklyHours?structuredClone(e.curriculumWeeklyHours):E()},y2:K(l),y3:K(l)}};await o.FH.saveNormConfig(ee,h.id,r)}}catch(ce){console.warn("[copyScenario] norm copy skipped",ce)}await Gi(),re(h.id),t.oR.success("Senaryo kopyalandi.")}catch(S){de(S.message||"Scenario copy failed")}finally{oi(null)}}({targetCurrency:i,localCurrencyCode:l,plannedFxUsdToLocal:r,copyFxUsdToLocal:n,selection:e})},disabled:ol||si||!ji||!fl,children:si?(0,u.jsxs)("span",{style:{display:"inline-flex",gap:6,alignItems:"center"},children:[(0,u.jsx)(M,{}),(0,u.jsx)("span",{children:"Kopyalaniyor..."})]}):"Tamam"})]})]})}):null,gi?(0,u.jsx)(b,{open:gi,onClose:()=>hi(!1),onApplied:Hi,sourceScenario:dl,sourceSchoolId:ee,sourceSchoolName:ul}):null,vi?(0,u.jsx)(x,{open:vi,onClose:()=>fi(!1),countryId:null===(h=$.user)||void 0===h?void 0:h.country_id}):null,$e?(0,u.jsx)("div",{className:"modal-backdrop",role:"dialog","aria-modal":"true",children:(0,u.jsxs)("div",{className:"modal scenario-wizard-modal",children:[(0,u.jsxs)("div",{className:"scenario-wizard-header",children:[(0,u.jsxs)("div",{className:"row",style:{justifyContent:"space-between"},children:[(0,u.jsx)("div",{style:{fontWeight:700},children:"edit"===qe?"Senaryo Kurulumunu Duzenle":"Yeni Senaryo Kurulumu"}),(0,u.jsx)("button",{className:"btn",onClick:function(){de(""),Ve(!1),ei(!1),li(!1),We(0)},disabled:ii||Qe,children:"Kapat"})]}),(0,u.jsx)("div",{className:"small",style:{marginTop:6},children:"edit"===qe?"Senaryo ayarlarini guncelleyip kaydedebilirsiniz.":"Adim adim kurulum tamamlayin."})]}),(0,u.jsxs)("div",{className:"scenario-wizard-body",children:[ce?(0,u.jsx)("div",{className:"card",style:{marginTop:10,background:"#fff1f2",borderColor:"#fecaca"},children:ce}):null,Qe?(0,u.jsx)("div",{className:"card",style:{marginTop:12},children:"Yukleniyor..."}):(0,u.jsxs)("div",{style:{marginTop:12},children:[(0,u.jsxs)("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center"},children:[(0,u.jsx)("div",{style:{fontWeight:700},children:"Kurulum Adimi"}),(0,u.jsx)("div",{className:"small",children:"Adim ".concat(Re+1," / ").concat(6,": ").concat(["Donem Turu","Para Birimi","Program Turu","Yil","Kademeler","Senaryo Adi"][Re])})]}),0===Re&&(0,u.jsxs)("div",{style:{marginTop:10},children:[(0,u.jsx)("div",{className:"small",style:{fontWeight:700,marginBottom:6},children:"Donem Turu"}),(0,u.jsxs)("div",{className:"row",style:{gap:12,alignItems:"center"},children:[(0,u.jsxs)("label",{className:"row",style:{gap:6,alignItems:"center"},children:[(0,u.jsx)("input",{type:"radio",name:"scenario-period",checked:"full"===we,onChange:()=>Vl("full")}),(0,u.jsx)("span",{children:"Tam Yil (tek yil)"})]}),(0,u.jsxs)("label",{className:"row",style:{gap:6,alignItems:"center"},children:[(0,u.jsx)("input",{type:"radio",name:"scenario-period",checked:"split"===we,onChange:()=>Vl("split")}),(0,u.jsx)("span",{children:"Yil ortasinda baslar, sonraki yil biter"})]})]})]}),1===Re&&(0,u.jsxs)("div",{style:{marginTop:10},children:[(0,u.jsx)("div",{className:"small",style:{fontWeight:700,marginBottom:6},children:"Para Birimi"}),(0,u.jsxs)("div",{className:"row",style:{gap:12,alignItems:"center"},children:[(0,u.jsxs)("label",{className:"row",style:{gap:6,alignItems:"center"},children:[(0,u.jsx)("input",{type:"radio",name:"scenario-currency",checked:"USD"===De,onChange:()=>$l("USD"),disabled:"edit"===qe}),(0,u.jsx)("span",{children:"USD"})]}),(0,u.jsxs)("label",{className:"row",style:{gap:6,alignItems:"center"},children:[(0,u.jsx)("input",{type:"radio",name:"scenario-currency",checked:"LOCAL"===De,onChange:()=>$l("LOCAL"),disabled:"edit"===qe}),(0,u.jsx)("span",{children:"Local currency"})]})]}),"LOCAL"===De&&(0,u.jsxs)("div",{style:{marginTop:10},children:[(0,u.jsxs)("div",{className:"row",style:{gap:8,alignItems:"center"},children:[(0,u.jsx)("div",{className:"small",style:{fontWeight:700},children:"Local currency code"}),(0,u.jsx)("input",{className:"input sm",list:"local-currency-codes",placeholder:"TRY",value:Ke,onChange:e=>Ue(e.target.value.toUpperCase().replace(/[^A-Z0-9]/g,"").slice(0,10))}),(0,u.jsx)("datalist",{id:"local-currency-codes",children:O.map(e=>(0,u.jsx)("option",{value:e},e))})]}),ll?null:(0,u.jsx)("div",{className:"small",style:{color:"#b91c1c",marginTop:6},children:"Code 2-10 chars, A-Z0-9."}),(0,u.jsxs)("div",{className:"row",style:{gap:8,alignItems:"center",marginTop:10},children:[(0,u.jsx)("span",{children:"1 USD ="}),(0,u.jsx)("input",{className:"input sm",type:"number",step:"0.000001",value:Me,onChange:e=>Pe(e.target.value)}),(0,u.jsx)("span",{children:il||"LOCAL"})]}),nl?null:(0,u.jsx)("div",{className:"small",style:{color:"#b91c1c",marginTop:6},children:"FX rate must be > 0."}),(0,u.jsx)("div",{className:"small muted",style:{marginTop:6},children:"Kur formati: 1 USD = X LOCAL"})]})]}),2===Re&&(0,u.jsxs)("div",{style:{marginTop:10},children:[(0,u.jsx)("div",{className:"small",style:{fontWeight:700,marginBottom:6},children:"Program Turu"}),(0,u.jsx)("div",{className:"row",style:{gap:12},children:[{key:k.Rw.LOCAL,label:"Yerel",hint:"Yerel kademeleri planlayin"},{key:k.Rw.INTERNATIONAL,label:"International",hint:"Uluslararasi kademeleri planlayin"}].map(e=>(0,u.jsxs)("button",{type:"button",className:"btn ".concat(Ge===e.key?"primary":"ghost"),"aria-pressed":Ge===e.key,onClick:()=>He(e.key),children:[(0,u.jsx)("div",{style:{fontWeight:700},children:e.label}),(0,u.jsx)("div",{className:"small",style:{opacity:.75},children:e.hint})]},e.key))})]}),3===Re&&(0,u.jsxs)("div",{style:{marginTop:10},children:[(0,u.jsx)("div",{className:"small",style:{fontWeight:700,marginBottom:6},children:"Yil"}),"full"===we?(0,u.jsx)("input",{className:"input sm num-spin",type:"number",step:"1",placeholder:I,value:Ie,onChange:e=>ql(e.target.value)}):(0,u.jsxs)("div",{className:"row",style:{gap:8,alignItems:"center"},children:[(0,u.jsx)("input",{className:"input sm num-spin",type:"number",step:"1",placeholder:I,value:Ie,onChange:e=>ql(e.target.value)}),(0,u.jsx)("span",{className:"muted",children:"-"}),(0,u.jsx)("input",{className:"input sm num-spin",type:"number",step:"1",placeholder:T,value:Be,readOnly:!0})]}),(0,u.jsxs)("div",{className:"small muted",style:{marginTop:6},children:["Akademik yil: ",qi||"-","split"===we&&qi&&!Zi?(0,u.jsx)("span",{style:{color:"#b91c1c",marginLeft:8},children:"Bitis yili, baslangic yilindan 1 fazla olmali."}):null,qi&&Xi?(0,u.jsx)("span",{style:{color:"#b91c1c",marginLeft:8},children:"Bu yil turu icin zaten bir senaryo var."}):null]})]}),4===Re&&(0,u.jsxs)("div",{style:{marginTop:10},children:[(0,u.jsx)("div",{className:"small",style:{fontWeight:700,marginBottom:6},children:"Kademeler"}),(0,u.jsxs)("label",{className:"row small",style:{gap:8,alignItems:"center",marginBottom:8},children:[(0,u.jsx)("input",{type:"checkbox",checked:Ye,onChange:e=>(e=>{const i=Boolean(e);Fe(i),ze(e=>{const l=(0,j.Ds)(e);if(i)return Fi.current=structuredClone(l),Object.fromEntries(Object.entries(l).map(e=>{let[i,l]=e;return[i,(0,r.A)((0,r.A)({},l),{},{enabled:!1})]}));const n=Fi.current;return Fi.current=null,n?(0,j.Ds)(n):(0,j.jc)()})})(e.target.checked)}),(0,u.jsx)("span",{children:"Kademe yok (Merkez / Headquarter)"})]}),Ye?(0,u.jsx)("div",{className:"small muted",style:{marginBottom:8},children:"Bu senaryo icin kademe secmeye gerek yok. Kademe-bagimli alanlar ilerleme hesabina dahil edilmez."}):null,(0,u.jsxs)("table",{className:"table",children:[(0,u.jsx)("thead",{children:(0,u.jsxs)("tr",{children:[(0,u.jsx)("th",{children:"Kademe"}),(0,u.jsx)("th",{style:{width:120},children:"Aktif"}),(0,u.jsx)("th",{style:{width:160},children:"Baslangic"}),(0,u.jsx)("th",{style:{width:160},children:"Bitis"})]})}),(0,u.jsx)("tbody",{children:Ri.map(e=>{const i=Ji[e.key];return(0,u.jsxs)("tr",{children:[(0,u.jsx)("td",{style:{fontWeight:700},children:e.label}),(0,u.jsx)("td",{children:(0,u.jsx)("input",{type:"checkbox",checked:!(null===i||void 0===i||!i.enabled),disabled:Ye,onChange:i=>Xl(e.key,{enabled:i.target.checked})})}),(0,u.jsx)("td",{children:(0,u.jsx)("select",{className:"input sm",value:(null===i||void 0===i?void 0:i.from)||"",onChange:i=>Xl(e.key,{from:i.target.value}),disabled:Ye||!(null!==i&&void 0!==i&&i.enabled),children:Wi.map(e=>(0,u.jsx)("option",{value:e,children:e},e))})}),(0,u.jsx)("td",{children:(0,u.jsx)("select",{className:"input sm",value:(null===i||void 0===i?void 0:i.to)||"",onChange:i=>Xl(e.key,{to:i.target.value}),disabled:Ye||!(null!==i&&void 0!==i&&i.enabled),children:Wi.map(e=>(0,u.jsx)("option",{value:e,children:e},e))})})]},e.key)})})]}),Ye||Qi?null:(0,u.jsx)("div",{className:"small",style:{color:"#b91c1c"},children:"En az bir kademe secmelisiniz."})]}),5===Re&&(0,u.jsxs)("div",{style:{marginTop:10},children:[(0,u.jsx)("div",{className:"small",style:{fontWeight:700,marginBottom:6},children:"Senaryo Adi"}),(0,u.jsx)("div",{className:"row",children:(0,u.jsx)("input",{className:"input",placeholder:"Senaryo adi",value:Ce,onChange:e=>Ae(e.target.value)})}),Ce.trim()?null:(0,u.jsx)("div",{className:"small",style:{color:"#b91c1c",marginTop:6},children:"Senaryo adi zorunludur."})]})]})]}),Qe?null:(0,u.jsxs)("div",{className:"scenario-wizard-footer",children:[(0,u.jsx)("button",{className:"btn",onClick:function(){de(""),We(e=>Math.max(0,e-1))},disabled:0===Re||ii,children:"Geri"}),(0,u.jsx)("button",{className:"btn primary",onClick:function(){if(de(""),ii)return;const e=function(e){if(1===e&&"LOCAL"===De){if(!ll)return"Local currency code zorunludur.";if(!nl)return"Kur degeri zorunlu ve 0'dan buyuk olmali."}if(2===e&&!Ge)return"Program Turu secilmelidir.";if(3===e){if(!qi)return"Lutfen gecerli bir akademik yil girin.";if(!Zi)return"Bitis yili, baslangic yilindan 1 fazla olmali.";if(Xi)return"Bu yil turu icin zaten bir senaryo var. Lutfen baska bir yil secin."}return 4!==e||el?5!==e||Ce.trim()?"":"Senaryo adi zorunludur.":"En az bir kademe secmelisiniz."}(Re);e?de(e):Re<5?We(e=>Math.min(e+1,5)):async function(){if("edit"===qe)return void await async function(){if(!ee||null===Xe||void 0===Xe||!Xe.id)return;const e=Ce.trim();if(!e)return;if(!qi)return void de("Lutfen gecerli bir akademik yil girin.");if(!Zi)return void de("Bitis yili, baslangic yilindan 1 fazla olmali.");if(Xi)return void de("Bu yil turu icin zaten bir senaryo var. Lutfen baska bir yil secin.");if(!el)return void de("En az bir kademe secmelisiniz.");if("LOCAL"===(null===Xe||void 0===Xe?void 0:Xe.input_currency)){if(!ll)return void de("Local currency code zorunludur.");if(!nl)return void de("Kur degeri zorunlu ve 0'dan buyuk olmali.")}de(""),li(!0);try{const i=Ge||k.Rw.LOCAL,l=(0,j.Ds)(_e),n=Ye?Object.fromEntries(Object.entries(l).map(e=>{let[i,l]=e;return[i,(0,r.A)((0,r.A)({},l),{},{enabled:!1})]})):l;await o.FH.updateScenario(ee,Xe.id,{name:e,academicYear:qi,kademeConfig:n,programType:i,localCurrencyCode:"LOCAL"===(null===Xe||void 0===Xe?void 0:Xe.input_currency)?il:void 0,fxUsdToLocal:"LOCAL"===(null===Xe||void 0===Xe?void 0:Xe.input_currency)?Me:void 0}),await Gi(),re(Xe.id),ae(l=>l&&l.id===Xe.id?(0,r.A)((0,r.A)({},l),{},{name:e,academic_year:qi,program_type:i},"LOCAL"===(null===Xe||void 0===Xe?void 0:Xe.input_currency)?{local_currency_code:il,fx_usd_to_local:rl}:{}):l),se(e=>{if(!e||"object"!==typeof e)return e;const l=structuredClone(e);return l.temelBilgiler=l.temelBilgiler||{},l.temelBilgiler.kademeler=n,l.temelBilgiler.programType=i,l}),Ve(!1),We(0)}catch(i){de(i.message||"Senaryo guncellenemedi.")}finally{li(!1)}}();await async function(){if(!ee)return;const e=Ce.trim();if(!e)return;if(!qi)return void de("Lutfen gecerli bir akademik yil girin.");if(!Zi)return void de("Bitis yili, baslangic yilindan 1 fazla olmali.");if(Xi)return void de("Bu yil turu icin zaten bir senaryo var. Lutfen baska bir yil secin.");if(!el)return void de("En az bir kademe secmelisiniz.");if("LOCAL"===De){if(!ll)return void de("Local currency code zorunludur.");if(!nl)return void de("Kur degeri zorunlu ve 0'dan buyuk olmali.")}de(""),li(!0);try{const i=Ge||k.Rw.LOCAL,l=(0,j.Ds)(_e),n=Ye?Object.fromEntries(Object.entries(l).map(e=>{let[i,l]=e;return[i,(0,r.A)((0,r.A)({},l),{},{enabled:!1})]})):l,a=await o.FH.createScenario(ee,{name:e,academicYear:qi,kademeConfig:n,inputCurrency:De,localCurrencyCode:"LOCAL"===De?il:null,fxUsdToLocal:"LOCAL"===De?Me:null,programType:i});await Gi(),re(a.id),Ve(!1),We(0)}catch(i){de(i.message||"Senaryo olusturulamadi.")}finally{li(!1)}}()}()},disabled:ii||!sl[Re],children:ii?(0,u.jsxs)("span",{style:{display:"inline-flex",gap:6,alignItems:"center"},children:[(0,u.jsx)(M,{}),(0,u.jsx)("span",{children:"edit"===qe?"Kaydediliyor...":"Olusturuluyor..."})]}):Re<5?"Ileri":"edit"===qe?"Kaydet":"Bitir"})]})]})}):null,(0,u.jsxs)("div",{className:"row select-page-tables",style:{gap:12,alignItems:"stretch",flexWrap:"wrap"},children:[(0,u.jsxs)("div",{className:"card select-table-card",style:{flex:"1 1 320px",minWidth:280},children:[(0,u.jsx)("div",{style:{fontWeight:700,marginBottom:8},children:"Okullar"}),ue?(0,u.jsx)("div",{className:"small",children:"Yukleniyor..."}):(0,u.jsx)("div",{className:"select-table-body",children:(0,u.jsxs)("table",{className:"table select-school-table",children:[(0,u.jsxs)("colgroup",{children:[(0,u.jsx)("col",{style:{width:32}}),(0,u.jsx)("col",{style:{width:32}}),(0,u.jsx)("col",{}),(0,u.jsx)("col",{style:{width:180}})]}),(0,u.jsx)("thead",{children:(0,u.jsxs)("tr",{children:[(0,u.jsx)("th",{children:"#"}),(0,u.jsx)("th",{}),(0,u.jsx)("th",{children:"Okul"}),(0,u.jsx)("th",{children:"\u0130lerleme"})]})}),(0,u.jsx)("tbody",{children:0===V.length?(0,u.jsx)("tr",{children:(0,u.jsx)("td",{colSpan:"4",className:"small",children:"Okul bulunamadi."})}):V.map((e,i)=>{const l=String(ee)===String(e.id),r=!(null===be||void 0===be||!be[e.id]),n="scenario-row".concat(l?" is-selected":"").concat(r?" is-expense-split-stale":""),a=ge[e.id];return(0,u.jsxs)("tr",{className:n,style:{cursor:l?"default":"pointer"},onClick:()=>{l||Ui(e.id)},children:[(0,u.jsx)("td",{className:"small",style:{padding:"6px 8px"},children:i+1}),(0,u.jsx)("td",{onClick:e=>{e.stopPropagation()},children:(0,u.jsx)("input",{type:"checkbox",className:"select-checkbox",checked:l,"aria-label":"".concat(e.name," okulunu se\xe7"),onChange:i=>{i.stopPropagation(),l?Mi():Ui(e.id)}})}),(0,u.jsx)("td",{onClick:i=>{i.stopPropagation(),l||Ui(e.id)},style:{cursor:"pointer"},children:(0,u.jsx)("b",{children:e.name})}),(0,u.jsx)("td",{style:{minWidth:180},children:a?"active"===a.state?(0,u.jsx)(d.A,{value:a.pct,tooltipLines:a.tooltipLines}):(0,u.jsx)("div",{className:"small",children:a.label||"-"}):(0,u.jsx)("div",{className:"small",children:ve?"Hesaplan\u0131yor...":"-"})})]},e.id)})})]})}),Bl?(0,u.jsx)("div",{className:"row select-table-footer",style:{justifyContent:"flex-end"},children:(0,u.jsx)("button",{className:"btn primary",onClick:()=>fi(!0),disabled:!V.length||ue,children:"Ulke Onay Paketi Gonder"})}):null]}),(0,u.jsxs)("div",{className:"card select-table-card",style:{flex:"2 1 420px",minWidth:320},children:[(0,u.jsx)("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center",gap:12},children:(0,u.jsx)("div",{style:{fontWeight:700},children:"Senaryolar"})}),ee?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsxs)("div",{className:"scenario-toolbar",style:{marginTop:10},children:[Al?(0,u.jsx)("button",{type:"button",className:"btn primary",onClick:function(){Al&&(ee?(de(""),Ae(""),Le("split"),Te(I),Oe(T),ze((0,j.jc)()),Fe(!1),Fi.current=null,Ee("USD"),Ue(""),Pe(""),He(null),We(0),Ze("create"),Je(null),Ve(!0)):de("Once okul secin."))},disabled:!ee||ol,title:"Yeni Senaryo",children:(0,u.jsxs)("span",{className:"btn-inner",children:[(0,u.jsx)(s.OiG,{"aria-hidden":"true"}),(0,u.jsx)("span",{children:"Yeni Senaryo"})]})}):null,wl?(0,u.jsx)("button",{type:"button",className:"btn",onClick:()=>{dl&&Zl(dl.id)},disabled:!zl||ol,title:"Planlamayi Duzenle",children:(0,u.jsxs)("span",{className:"btn-inner",children:[(0,u.jsx)(s.uO9,{"aria-hidden":"true"}),(0,u.jsx)("span",{children:"Planlamayi Duzenle"})]})}):null,Ll?(0,u.jsx)("button",{type:"button",className:"btn",onClick:function(){Ll&&le&&ne&&te&&(si||(de(""),xi(""),ki(D("all")),Ni(""),Ai("LOCAL"===bl?"LOCAL":"USD"),Li(""),Ti(""),Oi(""),pi(!0)))},disabled:!El||_i||ol,title:"Kopyala",children:(0,u.jsxs)("span",{className:"btn-inner",children:[Kl?(0,u.jsx)(M,{}):(0,u.jsx)(s.paH,{"aria-hidden":"true"}),(0,u.jsx)("span",{children:"Kopyala"})]})}):null,Il?(0,u.jsx)("button",{type:"button",className:"btn",onClick:()=>hi(!0),disabled:!dl||ol,title:"Gider Payla\u015ft\u0131r",children:(0,u.jsxs)("span",{className:"btn-inner",children:[(0,u.jsx)(s.CbL,{"aria-hidden":"true"}),(0,u.jsx)("span",{children:"Gider Payla\u015ft\u0131r"})]})}):null,Tl&&Fl?(0,u.jsx)("button",{type:"button",className:"btn primary",onClick:()=>{dl&&sr(dl.id)},disabled:!Dl||!Rl||_i||ol,title:Wl,children:(0,u.jsxs)("span",{className:"btn-inner",children:[Ul?(0,u.jsx)(M,{}):(0,u.jsx)(s.A7C,{style:{marginRight:4}}),(0,u.jsx)("span",{children:"Onaya Gonder"})]})}):null,Ol?(0,u.jsx)("button",{type:"button",className:"btn danger",onClick:()=>{var e;dl&&(e=dl.id,Ol&&e&&!ol&&mi(e))},disabled:!Yl||_i||ol,title:"Sil",children:(0,u.jsxs)("span",{className:"btn-inner",children:[Ml?(0,u.jsx)(M,{}):(0,u.jsx)(s.qbC,{style:{marginRight:4}}),(0,u.jsx)("span",{children:"Sil"})]})}):null]}),(0,u.jsx)("div",{className:"select-table-body select-table-body-gap",children:(0,u.jsxs)("table",{className:"table scenario-table",children:[(0,u.jsx)("thead",{children:(0,u.jsxs)("tr",{children:[(0,u.jsx)("th",{}),(0,u.jsx)("th",{"aria-sort":pl("name"),children:(0,u.jsxs)("button",{type:"button",className:"sort-th",onClick:()=>yl("name"),"aria-label":"Sirala: Ad",children:[(0,u.jsx)("span",{children:"Ad"}),gl("name")]})}),(0,u.jsx)("th",{"aria-sort":pl("year"),children:(0,u.jsxs)("button",{type:"button",className:"sort-th",onClick:()=>yl("year"),"aria-label":"Sirala: Yil",children:[(0,u.jsx)("span",{children:"Yil"}),gl("year")]})}),(0,u.jsx)("th",{"aria-sort":pl("currency"),children:(0,u.jsxs)("button",{type:"button",className:"sort-th",onClick:()=>yl("currency"),"aria-label":"Sirala: Para Birimi",children:[(0,u.jsx)("span",{children:"Para Birimi"}),gl("currency")]})}),(0,u.jsx)("th",{"aria-sort":pl("status"),children:(0,u.jsxs)("button",{type:"button",className:"sort-th",onClick:()=>yl("status"),"aria-label":"Sirala: Durum",children:[(0,u.jsx)("span",{children:"Durum"}),gl("status")]})}),(0,u.jsx)("th",{children:"\u0130lerleme"}),(0,u.jsx)("th",{"aria-sort":pl("date"),children:(0,u.jsxs)("button",{type:"button",className:"sort-th",onClick:()=>yl("date"),"aria-label":"Sirala: Tarih",children:[(0,u.jsx)("span",{children:"Tarih"}),gl("date")]})})]})}),(0,u.jsx)("tbody",{children:ye?(0,u.jsx)("tr",{children:(0,u.jsx)("td",{colSpan:"7",className:"small",children:"Yukleniyor..."})}):0===ml.length?(0,u.jsx)("tr",{children:(0,u.jsx)("td",{colSpan:"7",className:"small",children:"Gosterilecek senaryo yok."})}):ml.map(e=>{const i=function(e){const i=e&&"object"===typeof e?e:{status:e},l=i.status,r=i.sent_at;switch(l){case"revision_requested":return{label:"Revize istendi",cls:"is-revision",help:"Revize istendi: senaryoda d\xfczeltme gerekiyor."};case"sent_for_approval":case"submitted":return{label:"Merkeze iletildi",cls:"is-submitted",help:"Merkeze iletildi: admin onay\u0131 bekleniyor."};case"approved":return r?{label:"Onayland\u0131",cls:"is-approved",help:"Onayland\u0131: admin taraf\u0131ndan onayland\u0131."}:{label:"Kontrol edildi",cls:"is-approved",help:"Kontrol edildi: y\xf6netici taraf\u0131ndan kontrol edildi."};case"in_review":return{label:"\u0130ncelemede",cls:"is-submitted",help:"\u0130ncelemede: y\xf6netici incelemesinde."};case"draft":return{label:"Taslak",cls:"is-draft",help:"Taslak: senaryo \xfczerinde \xe7al\u0131\u015f\u0131l\u0131yor."};default:return{label:l||"-",cls:"is-unknown",help:""}}}(e),l=String(le)===String(e.id),r=String(e.id)===String(cl),n=ol&&cl&&!r,a=ol,t="LOCAL"===e.input_currency?"".concat(e.local_currency_code||"LOCAL"," (LOCAL)"):"USD";return(0,u.jsxs)("tr",{className:"".concat(l?"scenario-row is-selected":"scenario-row").concat(null!==e&&void 0!==e&&e.expense_split_applied?null!==e&&void 0!==e&&e.expense_split_stale?" is-expense-split-stale":" is-expense-split":""),style:{opacity:n?.5:1,pointerEvents:n?"none":"auto",cursor:l||a||n?"default":"pointer"},onClick:()=>{l||a||n||re(e.id)},children:[(0,u.jsx)("td",{children:(0,u.jsx)("input",{type:"checkbox",className:"select-checkbox",checked:l,disabled:a||n,"aria-label":"".concat(e.name," senaryosunu se\xe7"),onChange:i=>{i.stopPropagation(),a||n||(l?Pi():re(e.id))}})}),(0,u.jsx)("td",{children:(0,u.jsx)("b",{className:"scenario-name",title:e.name,children:e.name})}),(0,u.jsx)("td",{children:e.academic_year}),(0,u.jsx)("td",{children:t}),(0,u.jsx)("td",{children:(0,u.jsx)("span",{className:"status-badge ".concat(i.cls),title:i.help,children:i.label})}),(0,u.jsx)("td",{style:{minWidth:160},children:je[e.id]&&!je[e.id].error?(0,u.jsx)(d.A,{value:je[e.id].pct,tooltipLines:je[e.id].tooltipLines}):(0,u.jsx)("span",{className:"small",children:Se?"Hesaplan\u0131yor...":"-"})}),(0,u.jsx)("td",{className:"small",children:new Date(e.created_at).toLocaleString()})]},e.id)})})]})})]}):(0,u.jsx)("div",{className:"small muted",style:{marginTop:10},children:"Once okul secin."}),(0,u.jsx)("div",{className:"row select-table-footer",style:{justifyContent:"flex-end"},children:(0,u.jsx)("button",{className:"btn primary",onClick:()=>{if(!ee||!le)return;(0,S.sE)(ee,le),(0,S.f)(ee);const e=(0,S.Mf)()||"temel-bilgiler";v("/schools/".concat(ee,"/").concat(e),{replace:!0})},disabled:!ee||!le,children:"Uygula"})})]})]})]})}},8345(e,i,l){l.d(i,{B:()=>n});const r=["okulOncesi","ilkokul","ortaokul","lise"];function n(e){var i;const l=null===e||void 0===e||null===(i=e.temelBilgiler)||void 0===i?void 0:i.kademeler;return!(!l||"object"!==typeof l)&&r.every(e=>{var i;return!1===(null===l||void 0===l||null===(i=l[e])||void 0===i?void 0:i.enabled)})}},9322(e,i,l){l.d(i,{Rw:()=>r,Z4:()=>o,ZG:()=>t,pb:()=>s,wN:()=>a});const r={LOCAL:"local",INTERNATIONAL:"international"},n=new Set(Object.values(r));function a(e){const i=String(e||"").trim().toLowerCase();return n.has(i)?i:r.LOCAL}function t(){var e,i,l;let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const s=null!==(e=null!==(i=null===n||void 0===n||null===(l=n.temelBilgiler)||void 0===l?void 0:l.programType)&&void 0!==i?i:null===n||void 0===n?void 0:n.programType)&&void 0!==e?e:null===n||void 0===n?void 0:n.program_type;if(s)return a(s);const o=(null===t||void 0===t?void 0:t.program_type)||(null===t||void 0===t?void 0:t.programType);return o?a(o):r.LOCAL}function s(e){const i=a(arguments.length>1&&void 0!==arguments[1]?arguments[1]:r.LOCAL);return!e||("okulOncesi"===e||(e.endsWith("Yerel")?i===r.LOCAL:!e.endsWith("Int")||i===r.INTERNATIONAL))}function o(e){const i=a(arguments.length>1&&void 0!==arguments[1]?arguments[1]:r.LOCAL);if("okulOncesi"===e)return"okulOncesi";const l=i===r.INTERNATIONAL?"Int":"Yerel";return"".concat(e).concat(l)}}}]);
//# sourceMappingURL=810.9f1b95e9.chunk.js.map