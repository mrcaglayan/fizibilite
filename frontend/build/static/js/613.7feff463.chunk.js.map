{"version":3,"file":"static/js/613.7feff463.chunk.js","mappings":"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","sources":["pages/AdminPage.jsx"],"sourcesContent":["//frontend/src/pages/AdminPage.jsx\r\n\r\nimport React, { useCallback, useEffect, useMemo, useRef, useState } from \"react\";\r\nimport { createPortal } from \"react-dom\";\r\nimport { Link, useLocation, useOutletContext } from \"react-router-dom\";\r\nimport { ToastContainer, toast } from \"react-toastify\";\r\nimport { FaSchool, FaUserPlus } from \"react-icons/fa\";\r\nimport { api } from \"../api\";\r\nimport { useAuth } from \"../auth/AuthContext\";\r\nimport Tooltip from \"../components/ui/Tooltip\";\r\nimport { buildProgressCatalog, DEFAULT_PROGRESS_CONFIG } from \"../utils/progressCatalog\";\r\nimport { ADMIN_TABS } from \"../data/adminTabs\";\r\n\r\n\r\n\r\nconst YEAR_KEYS = [\"y1\", \"y2\", \"y3\"];\r\n\r\n// Required module identifiers used in the scenario workflow.  When\r\n// requesting a revision, the admin can choose which of these modules\r\n// should be unlocked for editing.  These values must stay in sync\r\n// with the backend REQUIRED_WORK_IDS constant defined in\r\n// backend/src/utils/scenarioWorkflow.js.\r\nconst REQUIRED_WORK_IDS = [\r\n  \"temel_bilgiler\",\r\n  \"kapasite\",\r\n  \"norm.ders_dagilimi\",\r\n  \"ik.local_staff\",\r\n  \"gelirler.unit_fee\",\r\n  \"giderler.isletme\",\r\n];\r\n\r\n// Human-readable labels for each required module.  Used in the\r\n// admin revision modal to present checkboxes to select which\r\n// modules should be sent back for revision.\r\nconst WORK_ID_LABELS = {\r\n  temel_bilgiler: \"Temel Bilgiler\",\r\n  kapasite: \"Kapasite\",\r\n  \"norm.ders_dagilimi\": \"Norm\",\r\n  \"ik.local_staff\": \"K\",\r\n  \"gelirler.unit_fee\": \"Gelirler\",\r\n  \"giderler.isletme\": \"Giderler\",\r\n};\r\nconst DEFAULT_ADMIN_TAB = ADMIN_TABS[0]?.key || \"users\";\r\nconst isValidAdminTab = (value) => ADMIN_TABS.some((tab) => tab.key === value);\r\nconst getTabFromSearch = (search) => {\r\n  if (!search) return null;\r\n  const params = new URLSearchParams(search);\r\n  const value = params.get(\"tab\");\r\n  return isValidAdminTab(value) ? value : null;\r\n};\r\n\r\nconst fmt = (v) => {\r\n  const n = Number(v);\r\n  return Number.isFinite(n) ? n.toLocaleString(undefined, { maximumFractionDigits: 0 }) : \"-\";\r\n};\r\n\r\nconst fmtPct = (v) => {\r\n  const n = Number(v);\r\n  return Number.isFinite(n)\r\n    ? (n * 100).toLocaleString(undefined, { maximumFractionDigits: 2 }) + \"%\"\r\n    : \"-\";\r\n};\r\n\r\nconst formatDateTime = (value) => {\r\n  if (!value) return \"-\";\r\n  const d = new Date(value);\r\n  return Number.isFinite(d.getTime()) ? d.toLocaleString() : \"-\";\r\n};\r\n\r\nconst SAMPLE_DISCOUNTS = [\r\n  \"Magis Basari Bursu\",\r\n  \"Maarif Yetenek Bursu\",\r\n  \"Ihtiyac Bursu\",\r\n  \"Okul Basari Bursu\",\r\n  \"Tam Egitim Bursu\",\r\n  \"Barinma Bursu\",\r\n  \"Turkce Basari Bursu\",\r\n  \"Uluslararasi Yukumluluk Indirimi\",\r\n  \"Vakif Calisani Indirimi\",\r\n  \"Kardes Indirimi\",\r\n  \"Erken Kayit Indirimi\",\r\n  \"Pesin Odeme Indirimi\",\r\n  \"Kademe Gecis Indirimi\",\r\n  \"Temsil Indirimi\",\r\n  \"Kurum Indirimi\",\r\n  \"Istisnai Indirim\",\r\n  \"Yerel Mevzuat Indirimi\",\r\n];\r\n\r\nfunction normalizeProgressConfig(config) {\r\n  const defaults = DEFAULT_PROGRESS_CONFIG();\r\n  const input = config && typeof config === \"object\" ? config : {};\r\n  const sectionsInput = input.sections && typeof input.sections === \"object\" ? input.sections : {};\r\n  const out = { version: defaults.version, sections: {} };\r\n\r\n  Object.keys(defaults.sections).forEach((id) => {\r\n    const base = defaults.sections[id] || {};\r\n    const incoming = sectionsInput[id] && typeof sectionsInput[id] === \"object\" ? sectionsInput[id] : {};\r\n    out.sections[id] = {\r\n      enabled: typeof incoming.enabled === \"boolean\" ? incoming.enabled : base.enabled !== false,\r\n      mode: typeof incoming.mode === \"string\" && incoming.mode ? incoming.mode : base.mode,\r\n      min: incoming.min != null ? Number(incoming.min) : base.min,\r\n      selectedFields:\r\n        incoming.selectedFields && typeof incoming.selectedFields === \"object\" ? incoming.selectedFields : {},\r\n    };\r\n  });\r\n\r\n  return out;\r\n}\r\n\r\n// Compute status badge metadata for a scenario.  Accepts either a status\r\n// string or a full scenario object.  When a scenario is approved but\r\n// has not yet been forwarded to administrators (sent_at is null), it\r\n// is considered manager-approved (Kontrol edildi).\r\nconst getStatusMeta = (scenarioOrStatus) => {\n  const obj = scenarioOrStatus && typeof scenarioOrStatus === 'object' ? scenarioOrStatus : { status: scenarioOrStatus };\n  const status = obj.status;\n  const sentAt = obj.sent_at;\n  switch (status) {\r\n    case 'revision_requested':\r\n      return { label: 'Revize istendi', className: 'is-bad' };\r\n    case 'sent_for_approval':\r\n      return { label: 'Merkeze iletildi', className: 'is-warn' };\r\n    case 'approved':\r\n      if (sentAt) {\r\n        return { label: 'Onayland', className: 'is-ok' };\r\n      }\r\n      return { label: 'Kontrol edildi', className: 'is-ok' };\r\n    case 'in_review':\r\n      return { label: 'ncelemede', className: 'is-warn' };\r\n    case 'submitted':\r\n      return { label: 'Onayda', className: 'is-warn' };\r\n    case 'draft':\r\n      return { label: 'Taslak', className: 'is-muted' };\r\n    default:\n      return { label: 'Taslak', className: 'is-muted' };\n  }\n};\n\nconst getBatchStatusMeta = (status) => {\n  switch (String(status || \"\")) {\n    case \"revision_requested\":\n      return { label: \"Revize istendi\", className: \"is-bad\" };\n    case \"sent_for_approval\":\n      return { label: \"Merkeze iletildi\", className: \"is-warn\" };\n    case \"approved\":\n      return { label: \"Onayland\", className: \"is-ok\" };\n    default:\n      return { label: \"-\", className: \"is-muted\" };\n  }\n};\n\r\nconst getSchoolStatusMeta = (status) => {\r\n  if (status === \"closed\") return { label: \"Closed\", className: \"is-muted\" };\r\n  return { label: \"Active\", className: \"is-ok\" };\r\n};\r\n\r\nconst getDynamicHint = (sectionId, field) => {\r\n  if (!field) return null;\r\n  const id = String(field.id || \"\");\r\n  const label = String(field.label || \"\");\r\n  if (sectionId === \"gradesPlan.plan\") {\r\n    if (id.startsWith(\"gradesPlan.\") || label.includes(\"Plan \")) return \"grade\";\r\n  }\r\n  if (sectionId === \"ik.localStaff\" && id.startsWith(\"ik.headcount.\")) return \"type\";\r\n  if (sectionId === \"gelirler.unitFee\" && id.startsWith(\"gelirler.tuition.\")) return \"type\";\r\n  return null;\r\n};\r\n\r\nexport default function AdminPage({ forcedTab = null } = {}) {\r\n  const auth = useAuth();\r\n  const outlet = useOutletContext();\r\n  const location = useLocation();\r\n  const normalizedForcedTab = isValidAdminTab(forcedTab) ? forcedTab : null;\r\n  const [activeTab, setActiveTab] = useState(() => {\r\n    if (normalizedForcedTab) return normalizedForcedTab;\r\n    const fromSearch = getTabFromSearch(location.search);\r\n    if (fromSearch) return fromSearch;\r\n    try {\r\n      const stored = localStorage.getItem(\"admin.activeTab\");\r\n      if (isValidAdminTab(stored)) return stored;\r\n    } catch (_) {\r\n      // ignore\r\n    }\r\n    return DEFAULT_ADMIN_TAB;\r\n  });\r\n  useEffect(() => {\r\n    if (normalizedForcedTab) return;\r\n    const fromSearch = getTabFromSearch(location.search);\r\n    if (fromSearch && fromSearch !== activeTab) {\r\n      setActiveTab(fromSearch);\r\n      return;\r\n    }\r\n    if (!fromSearch && activeTab !== DEFAULT_ADMIN_TAB) {\r\n      setActiveTab(DEFAULT_ADMIN_TAB);\r\n    }\r\n  }, [location.search, activeTab, normalizedForcedTab]);\r\n  useEffect(() => {\r\n    if (!normalizedForcedTab) return;\r\n    if (activeTab !== normalizedForcedTab) setActiveTab(normalizedForcedTab);\r\n  }, [normalizedForcedTab, activeTab]);\r\n  useEffect(() => {\r\n    if (normalizedForcedTab) return;\r\n    try {\r\n      localStorage.setItem(\"admin.activeTab\", activeTab);\r\n    } catch (_) {\r\n      // ignore\r\n    }\r\n  }, [activeTab, normalizedForcedTab]);\r\n\r\n  const [countries, setCountries] = useState([]);\r\n  const [users, setUsers] = useState([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [userUpdateLoading, setUserUpdateLoading] = useState(false);\r\n  const [confirmAssign, setConfirmAssign] = useState(null);\r\n  const [confirmDelete, setConfirmDelete] = useState(null);\r\n  const [confirmReset, setConfirmReset] = useState(null);\r\n  const [resetResult, setResetResult] = useState(null);\r\n  const [resetLoadingId, setResetLoadingId] = useState(null);\r\n\r\n  const [countryName, setCountryName] = useState(\"\");\r\n  const [countryCode, setCountryCode] = useState(\"\");\r\n  const [countryRegion, setCountryRegion] = useState(\"\");\r\n\r\n  const [newUserName, setNewUserName] = useState(\"\");\r\n  const [newUserEmail, setNewUserEmail] = useState(\"\");\r\n  const [newUserPassword, setNewUserPassword] = useState(\"\");\r\n  const [newUserRole, setNewUserRole] = useState(\"user\");\r\n  const [newUserCountryId, setNewUserCountryId] = useState(\"\");\r\n\r\n  const [assignUserId, setAssignUserId] = useState(\"\");\r\n  const [assignCountryId, setAssignCountryId] = useState(\"\");\r\n  const [showUnassigned, setShowUnassigned] = useState(true);\r\n\r\n  const [schoolsCountryId, setSchoolsCountryId] = useState(\"\");\r\n  const [countrySchools, setCountrySchools] = useState([]);\r\n  const [countrySchoolsLoading, setCountrySchoolsLoading] = useState(false);\r\n  const [schoolsSearch, setSchoolsSearch] = useState(\"\");\r\n  const [newSchoolName, setNewSchoolName] = useState(\"\");\r\n  const [schoolCreateLoading, setSchoolCreateLoading] = useState(false);\r\n  const [schoolBulkCreateLoading, setSchoolBulkCreateLoading] = useState(false);\r\n  const [schoolCreateRows, setSchoolCreateRows] = useState([\"\"]);\r\n  const [schoolSavingId, setSchoolSavingId] = useState(null);\r\n  const [schoolNameDrafts, setSchoolNameDrafts] = useState({});\r\n\r\n  const [progressCountryId, setProgressCountryId] = useState(\"\");\r\n  const [progressConfig, setProgressConfig] = useState(null);\r\n  const [progressLoading, setProgressLoading] = useState(false);\r\n  const [progressSaving, setProgressSaving] = useState(false);\r\n  const [progressSearch, setProgressSearch] = useState(\"\");\r\n  const [progressTargetIds, setProgressTargetIds] = useState(() => new Set());\r\n  const [progressCountryListSearch, setProgressCountryListSearch] = useState(\"\");\r\n  const [progressBulkSaving, setProgressBulkSaving] = useState(false);\r\n  const [showOnlySelectedBySection, setShowOnlySelectedBySection] = useState({});\r\n  const [expandedProgressTabs, setExpandedProgressTabs] = useState(new Set());\n  const [expandedProgressSections, setExpandedProgressSections] = useState(new Set());\n\n  const [queueRows, setQueueRows] = useState([]);\n  const [approvalsView, setApprovalsView] = useState(\"scenarios\");\n  const [batchQueueRows, setBatchQueueRows] = useState([]);\n  const [batchQueueLoading, setBatchQueueLoading] = useState(false);\n  const [batchReviewModal, setBatchReviewModal] = useState(null);\n  const [batchReviewNote, setBatchReviewNote] = useState(\"\");\n  const [batchReviewIncludedYears, setBatchReviewIncludedYears] = useState({\n    y1: true,\n    y2: true,\n    y3: true,\n  });\n  const [batchReviewRevisionSelection, setBatchReviewRevisionSelection] = useState(() => {\n    const initial = {};\n    REQUIRED_WORK_IDS.forEach((id) => (initial[id] = false));\n    return initial;\n  });\n  const [batchReviewSaving, setBatchReviewSaving] = useState(false);\n  const [batchDetail, setBatchDetail] = useState(null);\n  const [batchDetailLoading, setBatchDetailLoading] = useState(false);\n\r\n  // Permissions catalog & user permissions state (for admin permission editor)\r\n  const [permissionsCatalog, setPermissionsCatalog] = useState(null);\r\n  // Map of permission key (resource|action) to boolean indicating selected for the current user\r\n  const [permissionSelections, setPermissionSelections] = useState({});\r\n  // Map of permission key to scope identifier: \"country\" or \"school:<id>\"\r\n  const [permissionScopes, setPermissionScopes] = useState({});\r\n  const [permissionsLoading, setPermissionsLoading] = useState(false);\r\n  const [permissionsSaving, setPermissionsSaving] = useState(false);\r\n  // List of schools in the selected user's country for scope selection\r\n  const [userSchools, setUserSchools] = useState([]);\r\n  // Define role options for admin when editing a user's role.  Admins can\r\n  // assign any role, including manager/accountant and admin.\r\n  const roleOptions = useMemo(\r\n    () => [\r\n      { value: \"user\", label: \"User\" },\r\n      { value: \"principal\", label: \"Principal\" },\r\n      { value: \"hr\", label: \"HR\" },\r\n      { value: \"manager\", label: \"Manager\" },\r\n      { value: \"accountant\", label: \"Accountant\" },\r\n      { value: \"admin\", label: \"Admin\" },\r\n    ],\r\n    []\r\n  );\r\n\r\n  // Track updating of a user's role when editing via the admin Users tab.\r\n  const [roleUpdating, setRoleUpdating] = useState(false);\r\n\r\n  // Principal assignments state per school\r\n  // principalLists maps schoolId -> array of user objects assigned as principals\r\n  const [principalLists, setPrincipalLists] = useState({});\r\n  // principalDrafts maps schoolId -> array of userIds currently selected in the editor\r\n  const [principalDrafts, setPrincipalDrafts] = useState({});\r\n  // Track saving state per school when updating principal assignments\r\n  const [principalSaving, setPrincipalSaving] = useState({});\r\n  const [queueLoading, setQueueLoading] = useState(false);\r\n  const [queueFilters, setQueueFilters] = useState({\r\n    status: \"\",\r\n    academicYear: \"\",\r\n    region: \"\",\r\n    countryId: \"\",\r\n  });\r\n\r\n  const [queueSort, setQueueSort] = useState({ key: null, dir: null });\r\n\r\n  const [reviewModal, setReviewModal] = useState(null);\r\n  const [reviewNote, setReviewNote] = useState(\"\");\r\n  const [reviewIncludedYears, setReviewIncludedYears] = useState({\r\n    y1: true,\r\n    y2: true,\r\n    y3: true,\r\n  });\r\n\r\n  // When the admin requests a revision on a scenario, they must select\r\n  // which modules should be reopened for editing.  This state maps\r\n  // module identifiers (work ids) to booleans indicating whether\r\n  // that module is selected for revision.  It is initialized when\r\n  // opening the revision modal.\r\n  const [reviewRevisionSelection, setReviewRevisionSelection] = useState(() => {\r\n    const initial = {};\r\n    REQUIRED_WORK_IDS.forEach((id) => (initial[id] = false));\r\n    return initial;\r\n  });\r\n\r\n  // Helpers to select or clear all modules in the revision selection.  These\r\n  // functions are memoized via useCallback to avoid re-creating on\r\n  // every render.\r\n  const selectAllRevisionWork = useCallback(() => {\r\n    const next = {};\r\n    REQUIRED_WORK_IDS.forEach((id) => (next[id] = true));\r\n    setReviewRevisionSelection(next);\r\n  }, []);\r\n\r\n  const clearRevisionWork = useCallback(() => {\n    const next = {};\n    REQUIRED_WORK_IDS.forEach((id) => (next[id] = false));\n    setReviewRevisionSelection(next);\n  }, []);\n  const [reviewSaving, setReviewSaving] = useState(false);\n\n  const selectAllBatchRevisionWork = useCallback(() => {\n    const next = {};\n    REQUIRED_WORK_IDS.forEach((id) => (next[id] = true));\n    setBatchReviewRevisionSelection(next);\n  }, []);\n\n  const clearBatchRevisionWork = useCallback(() => {\n    const next = {};\n    REQUIRED_WORK_IDS.forEach((id) => (next[id] = false));\n    setBatchReviewRevisionSelection(next);\n  }, []);\n\r\n  const [rollupYear, setRollupYear] = useState(\"\");\r\n  const [rollupData, setRollupData] = useState(null);\r\n  const [rollupLoading, setRollupLoading] = useState(false);\r\n  const [rollupExportOpen, setRollupExportOpen] = useState(false);\r\n  const rollupExportRef = useRef(null);\r\n  const [expandedRegions, setExpandedRegions] = useState(new Set());\r\n  const [expandedCountries, setExpandedCountries] = useState(new Set());\r\n\r\n  useEffect(() => {\r\n    document.title = \"Admin  Feasibility Studio\";\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    outlet?.setHeaderMeta({\r\n      title: \"Admin\",\r\n      subtitle: \"Create users, manage countries, and review scenarios.\",\r\n    });\r\n    return () => {\r\n      outlet?.clearHeaderMeta?.();\r\n    };\r\n  }, [outlet]);\r\n\r\n  // Keep latest queue filters without making loadQueue depend on queueFilters\r\n  const queueFiltersRef = useRef(queueFilters);\r\n  useEffect(() => {\r\n    queueFiltersRef.current = queueFilters;\r\n  }, [queueFilters]);\r\n\r\n  const selectedUser = useMemo(\r\n    () => users.find((u) => String(u.id) === String(assignUserId)) || null,\r\n    [users, assignUserId]\r\n  );\r\n\r\n  const selectedCountry = useMemo(\r\n    () => countries.find((c) => String(c.id) === String(assignCountryId)) || null,\r\n    [countries, assignCountryId]\r\n  );\r\n\r\n  const selectedSchoolsCountry = useMemo(\r\n    () => countries.find((c) => String(c.id) === String(schoolsCountryId)) || null,\r\n    [countries, schoolsCountryId]\r\n  );\r\n\r\n  // Load principal lists for each school when the country schools list changes\r\n  useEffect(() => {\r\n    // Only load when we are on the countries tab and have schools for the selected country\r\n    if (activeTab !== \"countries\") return;\r\n    if (!Array.isArray(countrySchools) || countrySchools.length === 0) return;\r\n    countrySchools.forEach((school) => {\r\n      const id = school.id;\r\n      // If we haven't loaded this school's principals yet, fetch them\r\n      if (principalLists[id] === undefined) {\r\n        (async () => {\r\n          try {\r\n            const list = await api.adminGetSchoolPrincipals(id);\r\n            setPrincipalLists((prev) => ({ ...prev, [id]: Array.isArray(list) ? list : [] }));\r\n            // Initialize draft selection with current principal IDs\r\n            const ids = Array.isArray(list) ? list.map((u) => u.id) : [];\r\n            setPrincipalDrafts((prev) => ({ ...prev, [id]: ids }));\r\n          } catch (e) {\r\n            console.error(e);\r\n            // Do not toast here to avoid spam; errors will be shown on save\r\n          }\r\n        })();\r\n      }\r\n    });\r\n  }, [activeTab, countrySchools, principalLists]);\r\n\r\n  // Load permissions catalog, user permissions, and schools list for the selected user\r\n  useEffect(() => {\r\n    // derive simple IDs from the selectedUser to avoid stale object dependencies\r\n    const userId = selectedUser?.id;\r\n    const countryId = selectedUser?.country_id;\r\n    // If no user selected, reset and exit early\r\n    if (!userId) {\r\n      setPermissionsCatalog(null);\r\n      setPermissionSelections({});\r\n      setPermissionScopes({});\r\n      setUserSchools([]);\r\n      return;\r\n    }\r\n    setPermissionsLoading(true);\r\n    Promise.all([\r\n      api.adminGetPermissionsCatalog(),\r\n      api.adminGetUserPermissions(userId),\r\n      countryId ? api.adminListCountrySchools(countryId) : Promise.resolve([]),\r\n    ])\r\n      .then(([catalogData, userPerms, schoolsData]) => {\r\n        setPermissionsCatalog(catalogData || null);\r\n        // Determine scope options: flatten schools list\r\n        let schoolsList = [];\r\n        if (Array.isArray(schoolsData)) {\r\n          schoolsList = schoolsData;\r\n        } else if (schoolsData && Array.isArray(schoolsData.items)) {\r\n          schoolsList = schoolsData.items;\r\n        }\r\n        setUserSchools(schoolsList);\r\n        // Initialize selection and scope state from existing user perms\r\n        const sel = {};\r\n        const scopeMap = {};\r\n        (userPerms || []).forEach((p) => {\r\n          const key = `${p.resource}|${p.action}`;\r\n          sel[key] = true;\r\n          if (p.scope_school_id != null) {\r\n            scopeMap[key] = `school:${p.scope_school_id}`;\r\n          } else {\r\n            scopeMap[key] = \"country\";\r\n          }\r\n        });\r\n        setPermissionSelections(sel);\r\n        setPermissionScopes(scopeMap);\r\n      })\r\n      .catch((e) => {\r\n        console.error(e);\r\n        toast.error(e?.message || \"Failed to load permissions\");\r\n      })\r\n      .finally(() => {\r\n        setPermissionsLoading(false);\r\n      });\r\n  }, [selectedUser]);\r\n\r\n  const progressCatalogInputs = useMemo(\r\n    () => ({\r\n      discounts: SAMPLE_DISCOUNTS.map((name) => ({ name, ratio: 0, value: 0 })),\r\n    }),\r\n    []\r\n  );\r\n\r\n  const progressCatalog = useMemo(\r\n    () => buildProgressCatalog({ inputs: progressCatalogInputs, norm: null }),\r\n    [progressCatalogInputs]\r\n  );\r\n\r\n  const progressConfigNormalized = useMemo(\r\n    () => normalizeProgressConfig(progressConfig),\r\n    [progressConfig]\r\n  );\r\n\r\n  const isSameCountry =\r\n    selectedUser &&\r\n    selectedCountry &&\r\n    selectedUser.country_id != null &&\r\n    String(selectedUser.country_id) === String(selectedCountry.id);\r\n\r\n  const currentAssignmentLabel = selectedUser\r\n    ? selectedUser.country_name\r\n      ? `${selectedUser.country_name} (${selectedUser.country_code})${selectedUser.region ? ` - ${selectedUser.region}` : \"\"\r\n      }`\r\n      : \"Unassigned\"\r\n    : \"Select a user\";\r\n\r\n  const newAssignmentLabel = selectedCountry\r\n    ? `${selectedCountry.name} (${selectedCountry.code})${selectedCountry.region ? ` - ${selectedCountry.region}` : \"\"\r\n    }`\r\n    : \"Select a country\";\r\n\r\n  const actionLabel = selectedUser?.country_id != null ? \"Update Country\" : \"Assign Country\";\r\n\r\n  const filteredUsers = useMemo(() => {\r\n    if (!showUnassigned) return users;\r\n    return users.filter((u) => u.country_id == null);\r\n  }, [users, showUnassigned]);\r\n\r\n  const regionOptions = useMemo(() => {\r\n    const set = new Set();\r\n    countries.forEach((c) => {\r\n      if (c.region) set.add(c.region);\r\n    });\r\n    return Array.from(set).sort();\r\n  }, [countries]);\r\n\r\n  // Group permissions by their catalog group for display\r\n  const permissionsGrouped = useMemo(() => {\r\n    // When no catalog loaded, return empty object\r\n    if (!permissionsCatalog) return {};\r\n    // Backend returns a grouped object (group -> array of permissions) via\r\n    // /admin/permissions/catalog. When it's already grouped, return it as is.\r\n    if (!Array.isArray(permissionsCatalog) && typeof permissionsCatalog === \"object\") {\r\n      return permissionsCatalog;\r\n    }\r\n    // Otherwise if an array is provided, group by the `group` property on each entry.\r\n    if (Array.isArray(permissionsCatalog)) {\r\n      return permissionsCatalog.reduce((acc, perm) => {\r\n        const grp = perm.group || \"Other\";\r\n        if (!acc[grp]) acc[grp] = [];\r\n        acc[grp].push(perm);\r\n        return acc;\r\n      }, {});\r\n    }\r\n    return {};\r\n  }, [permissionsCatalog]);\r\n\r\n  const queueCountryOptions = useMemo(() => {\r\n    if (!queueFilters.region) return countries;\r\n    return countries.filter((c) => c.region === queueFilters.region);\r\n  }, [countries, queueFilters.region]);\r\n\r\n  const toggleQueueSort = useCallback((key) => {\r\n    const cycles = {\r\n      academic_year: [\"desc\", \"asc\", null],\r\n      country_name: [\"asc\", \"desc\", null],\r\n      school_name: [\"asc\", \"desc\", null],\r\n      scenario_name: [\"asc\", \"desc\", null],\r\n      submitted_at: [\"desc\", \"asc\", null],\r\n      status: [\"asc\", \"desc\", null],\r\n    };\r\n\r\n    setQueueSort((prev) => {\r\n      const cycle = cycles[key] || [\"asc\", \"desc\", null];\r\n      if (prev.key !== key) return { key, dir: cycle[0] };\r\n\r\n      const i = cycle.indexOf(prev.dir);\r\n      const next = cycle[(i + 1) % cycle.length];\r\n      if (!next) return { key: null, dir: null };\r\n      return { key, dir: next };\r\n    });\r\n  }, [setQueueSort]);\r\n\r\n  const sortIndicator = useCallback(\r\n    (key) => {\r\n      if (queueSort.key !== key || !queueSort.dir) return \"\";\r\n      return queueSort.dir === \"asc\" ? \"\" : \"\";\r\n    },\r\n    [queueSort]\r\n  );\r\n\r\n  const ariaSort = useCallback(\r\n    (key) => {\r\n      if (queueSort.key !== key || !queueSort.dir) return \"none\";\r\n      return queueSort.dir === \"asc\" ? \"ascending\" : \"descending\";\r\n    },\r\n    [queueSort]\r\n  );\r\n\r\n  const sortedQueueRows = useMemo(() => {\r\n    const base = Array.isArray(queueRows) ? queueRows : [];\r\n    if (!queueSort?.key || !queueSort?.dir) return base;\r\n\r\n    const parseAcademicYear = (value) => {\r\n      const raw = String(value || \"\").trim();\r\n      const nums = raw.match(/\\d{4}/g) || [];\r\n      const a = nums[0] ? Number(nums[0]) : -1;\r\n      const b = nums[1] ? Number(nums[1]) : a;\r\n      return { a, b, raw: raw.toLowerCase() };\r\n    };\r\n\r\n    const getValue = (row) => {\r\n      switch (queueSort.key) {\r\n        case \"country_name\":\r\n          return String(row.country?.name || \"\");\r\n        case \"school_name\":\r\n          return String(row.school?.name || \"\");\r\n        case \"scenario_name\":\r\n          return String(row.scenario?.name || \"\");\r\n        case \"academic_year\":\r\n          return parseAcademicYear(row.scenario?.academic_year);\r\n        case \"submitted_at\":\r\n          return row.scenario?.submitted_at ? new Date(row.scenario.submitted_at).getTime() : -Infinity;\r\n        case \"status\":\r\n          return String(row.scenario?.status || \"\");\r\n        default:\r\n          return \"\";\r\n      }\r\n    };\r\n\r\n    const dirMul = queueSort.dir === \"desc\" ? -1 : 1;\r\n    const cmpStr = (a, b) =>\r\n      String(a || \"\").localeCompare(String(b || \"\"), undefined, { sensitivity: \"base\" });\r\n\r\n    const decorated = base.map((row, idx) => ({ row, idx, val: getValue(row) }));\r\n\r\n    decorated.sort((A, B) => {\r\n      let c = 0;\r\n      const av = A.val;\r\n      const bv = B.val;\r\n\r\n      if (queueSort.key === \"academic_year\") {\r\n        c = (av?.a ?? -1) - (bv?.a ?? -1);\r\n        if (c === 0) c = (av?.b ?? -1) - (bv?.b ?? -1);\r\n        if (c === 0) c = cmpStr(av?.raw, bv?.raw);\r\n      } else if (typeof av === \"number\" && typeof bv === \"number\") {\r\n        c = av - bv;\r\n      } else {\r\n        c = cmpStr(av, bv);\r\n      }\r\n\r\n      if (c === 0) return A.idx - B.idx; // back to server order\r\n      return c * dirMul;\r\n    });\r\n\r\n    return decorated.map((d) => d.row);\r\n  }, [queueRows, queueSort]);\r\n\r\n  const progressSearchValue = progressSearch.trim().toLowerCase();\r\n\r\n  const filteredCountriesForApply = useMemo(() => {\r\n    const q = progressCountryListSearch.trim().toLowerCase();\r\n    if (!q) return countries;\r\n    return countries.filter((c) => {\r\n      const name = String(c.name || \"\").toLowerCase();\r\n      const code = String(c.code || \"\").toLowerCase();\r\n      return name.includes(q) || code.includes(q);\r\n    });\r\n  }, [countries, progressCountryListSearch]);\r\n\r\n  const progressTargetCount = progressTargetIds.size;\r\n  const progressBulkDisabled =\r\n    !progressCountryId ||\r\n    progressTargetCount === 0 ||\r\n    progressSaving ||\r\n    progressLoading ||\r\n    progressBulkSaving;\r\n\r\n  const filteredCountrySchools = useMemo(() => {\r\n    const q = schoolsSearch.trim().toLowerCase();\r\n    if (!q) return countrySchools;\r\n    return countrySchools.filter((s) => String(s.name || \"\").toLowerCase().includes(q));\r\n  }, [countrySchools, schoolsSearch]);\r\n\r\n  const schoolCreateBusy = schoolCreateLoading || schoolBulkCreateLoading;\r\n  const bulkCreateCount = schoolCreateRows.reduce(\r\n    (count, name) => (String(name || \"\").trim() ? count + 1 : count),\r\n    0\r\n  );\r\n\r\n  const load = useCallback(async () => {\r\n    setLoading(true);\r\n    try {\r\n      const [countriesRows, userData] = await Promise.all([\r\n        api.listCountries(),\r\n        api.listUsers({ limit: 50, offset: 0, fields: \"brief\", order: \"id:desc\" }),\r\n      ]);\r\n      setCountries(countriesRows);\r\n      setUsers(Array.isArray(userData?.items) ? userData.items : []);\r\n    } catch (e) {\r\n      toast.error(e.message || \"Failed to load admin data\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, []);\r\n\r\n  const loadCountrySchools = useCallback(async (countryIdArg) => {\r\n    const countryId = Number(countryIdArg);\r\n    if (!Number.isFinite(countryId)) {\r\n      setCountrySchools([]);\r\n      return;\r\n    }\r\n    setCountrySchoolsLoading(true);\r\n    try {\r\n      const rows = await api.adminListCountrySchools(countryId, { includeClosed: 1 });\r\n      setCountrySchools(Array.isArray(rows) ? rows : []);\r\n    } catch (e) {\r\n      toast.error(e.message || \"Failed to load schools\");\r\n    } finally {\r\n      setCountrySchoolsLoading(false);\r\n    }\r\n  }, []);\r\n\r\n  const loadProgressRequirements = useCallback(async (countryIdArg) => {\r\n    const countryId = Number(countryIdArg);\r\n    if (!Number.isFinite(countryId)) {\r\n      setProgressConfig(null);\r\n      return;\r\n    }\r\n    setProgressLoading(true);\r\n    try {\r\n      const data = await api.adminGetProgressRequirements(countryId);\r\n      setProgressConfig(normalizeProgressConfig(data?.config || data));\r\n    } catch (e) {\r\n      toast.error(e.message || \"Failed to load progress requirements\");\r\n      setProgressConfig(normalizeProgressConfig(null));\r\n    } finally {\r\n      setProgressLoading(false);\r\n    }\r\n  }, []);\r\n\r\n  const loadQueue = useCallback(async (filtersArg) => {\n    const f = filtersArg || queueFiltersRef.current || {};\n    setQueueLoading(true);\n    try {\n      const params = {\n        status: f.status,\r\n        academicYear: f.academicYear,\r\n        region: f.region,\r\n        countryId: f.countryId,\r\n      };\r\n      const rows = await api.adminGetScenarioQueue(params);\r\n      setQueueRows(Array.isArray(rows) ? rows : []);\r\n    } catch (e) {\r\n      toast.error(e.message || \"Failed to load approvals queue\");\r\n    } finally {\n      setQueueLoading(false);\n    }\n  }, []);\n\n  const loadBatchQueue = useCallback(async (filtersArg) => {\n    const f = filtersArg || queueFiltersRef.current || {};\n    setBatchQueueLoading(true);\n    try {\n      const params = {\n        status: f.status,\n        academicYear: f.academicYear,\n        region: f.region,\n        countryId: f.countryId,\n      };\n      const rows = await api.adminGetApprovalBatchQueue(params);\n      setBatchQueueRows(Array.isArray(rows) ? rows : []);\n    } catch (e) {\n      toast.error(e.message || \"Failed to load approval batches\");\n    } finally {\n      setBatchQueueLoading(false);\n    }\n  }, []);\n\r\n  const loadRollup = useCallback(async (academicYearArg) => {\r\n    const academicYear = (academicYearArg ?? rollupYear).trim();\r\n    if (!academicYear) {\r\n      toast.error(\"Academic year is required\");\r\n      return;\r\n    }\r\n    setRollupLoading(true);\r\n    try {\r\n      const data = await api.adminGetRollup({ academicYear });\r\n      setRollupData(data);\r\n    } catch (e) {\r\n      toast.error(e.message || \"Failed to load rollup report\");\r\n    } finally {\r\n      setRollupLoading(false);\r\n    }\r\n  }, [rollupYear]);\r\n\r\n  useEffect(() => {\r\n    if (auth.user?.role === \"admin\") load();\r\n  }, [auth.user?.role, load]);\r\n\r\n  useEffect(() => {\n    if (activeTab === \"approvals\" && auth.user?.role === \"admin\") {\n      if (approvalsView === \"batches\") {\n        loadBatchQueue();\n      } else {\n        loadQueue();\n      }\n    }\n  }, [activeTab, auth.user?.role, approvalsView, loadBatchQueue, loadQueue]);\n\r\n  useEffect(() => {\r\n    if (activeTab !== \"countries\") return;\r\n    if (!schoolsCountryId) {\r\n      setCountrySchools([]);\r\n      return;\r\n    }\r\n    loadCountrySchools(schoolsCountryId);\r\n  }, [activeTab, loadCountrySchools, schoolsCountryId]);\r\n\r\n  useEffect(() => {\r\n    if (activeTab !== \"progress\") return;\r\n    if (!progressCountryId) {\r\n      setProgressConfig(null);\r\n      return;\r\n    }\r\n    loadProgressRequirements(progressCountryId);\r\n  }, [activeTab, loadProgressRequirements, progressCountryId]);\r\n\r\n  useEffect(() => {\r\n    setProgressSearch(\"\");\r\n    setExpandedProgressTabs(new Set());\r\n    setExpandedProgressSections(new Set());\r\n  }, [progressCountryId]);\r\n\r\n  useEffect(() => {\r\n    if (!rollupExportOpen) return;\r\n    const handleClick = (event) => {\r\n      const el = rollupExportRef.current;\r\n      if (!el || el.contains(event.target)) return;\r\n      setRollupExportOpen(false);\r\n    };\r\n    const handleKey = (event) => {\r\n      if (event.key === \"Escape\") setRollupExportOpen(false);\r\n    };\r\n    document.addEventListener(\"mousedown\", handleClick);\r\n    document.addEventListener(\"keydown\", handleKey);\r\n    return () => {\r\n      document.removeEventListener(\"mousedown\", handleClick);\r\n      document.removeEventListener(\"keydown\", handleKey);\r\n    };\r\n  }, [rollupExportOpen]);\r\n\r\n  useEffect(() => {\r\n    if (!rollupData?.regions) return;\r\n    const regionSet = new Set();\r\n    const countrySet = new Set();\r\n    rollupData.regions.forEach((region) => {\r\n      regionSet.add(region.region);\r\n      region.countries.forEach((country) => {\r\n        countrySet.add(`${region.region}::${country.id}`);\r\n      });\r\n    });\r\n    setExpandedRegions(regionSet);\r\n    setExpandedCountries(countrySet);\r\n  }, [rollupData]);\r\n\r\n  useEffect(() => {\r\n    if (!assignUserId) {\r\n      setAssignCountryId(\"\");\r\n      return;\r\n    }\r\n    const user = users.find((u) => String(u.id) === String(assignUserId));\r\n    if (!user) {\r\n      setAssignCountryId(\"\");\r\n      return;\r\n    }\r\n    if (user.country_id != null) setAssignCountryId(String(user.country_id));\r\n    else setAssignCountryId(\"\");\r\n  }, [assignUserId, users]);\r\n\r\n  useEffect(() => {\r\n    setSchoolNameDrafts({});\r\n    setSchoolsSearch(\"\");\r\n    setNewSchoolName(\"\");\r\n    setSchoolCreateRows([\"\"]);\r\n  }, [schoolsCountryId]);\r\n\r\n  async function createCountry() {\r\n    const payload = {\r\n      name: countryName.trim(),\r\n      code: countryCode.trim().toUpperCase(),\r\n      region: countryRegion.trim(),\r\n    };\r\n    if (!payload.name || !payload.code || !payload.region) {\r\n      toast.error(\"Name, code, and region are required\");\r\n      return;\r\n    }\r\n    try {\r\n      await api.createCountry(payload);\r\n      setCountryName(\"\");\r\n      setCountryCode(\"\");\r\n      setCountryRegion(\"\");\r\n      await load();\r\n      toast.success(\"Country created\");\r\n    } catch (e) {\r\n      toast.error(e.message || \"Create country failed\");\r\n    }\r\n  }\r\n\r\n  async function createCountrySchool() {\r\n    if (!schoolsCountryId) {\r\n      toast.error(\"Select a country\");\r\n      return;\r\n    }\r\n    const name = newSchoolName.trim();\r\n    if (!name) {\r\n      toast.error(\"School name is required\");\r\n      return;\r\n    }\r\n    setSchoolCreateLoading(true);\r\n    try {\r\n      await api.adminCreateCountrySchool(schoolsCountryId, { name });\r\n      setNewSchoolName(\"\");\r\n      await loadCountrySchools(schoolsCountryId);\r\n      toast.success(\"School created\");\r\n    } catch (e) {\r\n      toast.error(e.message || \"Create school failed\");\r\n    } finally {\r\n      setSchoolCreateLoading(false);\r\n    }\r\n  }\r\n\r\n  function updateSchoolCreateRow(index, value) {\r\n    setSchoolCreateRows((prev) => {\r\n      const next = [...prev];\r\n      next[index] = value;\r\n      return next;\r\n    });\r\n  }\r\n\r\n  function addSchoolCreateRow() {\r\n    setSchoolCreateRows((prev) => [...prev, \"\"]);\r\n  }\r\n\r\n  function removeSchoolCreateRow(index) {\r\n    setSchoolCreateRows((prev) => {\r\n      if (prev.length <= 1) return prev;\r\n      return prev.filter((_, i) => i !== index);\r\n    });\r\n  }\r\n\r\n  async function createCountrySchoolsBulk() {\r\n    if (!schoolsCountryId) {\r\n      toast.error(\"Select a country\");\r\n      return;\r\n    }\r\n    const rawNames = schoolCreateRows.map((name) => String(name || \"\").trim()).filter(Boolean);\r\n    const names = Array.from(new Set(rawNames));\r\n    if (!names.length) {\r\n      toast.error(\"At least one school name is required\");\r\n      return;\r\n    }\r\n    setSchoolBulkCreateLoading(true);\r\n    const errors = [];\r\n    let created = 0;\r\n    try {\r\n      for (const name of names) {\r\n        try {\r\n          await api.adminCreateCountrySchool(schoolsCountryId, { name });\r\n          created += 1;\r\n        } catch (e) {\r\n          errors.push({ name, message: e?.message || \"Create school failed\" });\r\n        }\r\n      }\r\n      if (created > 0) {\r\n        await loadCountrySchools(schoolsCountryId);\r\n      }\r\n      if (errors.length) {\r\n        toast.error(`${errors.length} of ${names.length} schools failed`);\r\n        setSchoolCreateRows(errors.map((err) => err.name));\r\n      } else {\r\n        toast.success(`${created} schools created`);\r\n        setSchoolCreateRows([\"\"]);\r\n      }\r\n    } finally {\r\n      setSchoolBulkCreateLoading(false);\r\n    }\r\n  }\r\n\r\n  async function createUser() {\r\n    const payload = {\r\n      fullName: newUserName.trim() || null,\r\n      email: newUserEmail.trim(),\r\n      password: newUserPassword,\r\n      role: newUserRole,\r\n    };\r\n    if (newUserCountryId) {\r\n      const nextId = Number(newUserCountryId);\r\n      if (!Number.isFinite(nextId)) {\r\n        toast.error(\"Invalid country selection\");\r\n        return;\r\n      }\r\n      payload.countryId = nextId;\r\n    }\r\n    if (!payload.email || !payload.password) {\r\n      toast.error(\"Email and password are required\");\r\n      return;\r\n    }\r\n    if (payload.password.length < 8) {\r\n      toast.error(\"Password must be at least 8 characters\");\r\n      return;\r\n    }\r\n    try {\r\n      await api.createUser(payload);\r\n      setNewUserName(\"\");\r\n      setNewUserEmail(\"\");\r\n      setNewUserPassword(\"\");\r\n      setNewUserRole(\"user\");\r\n      setNewUserCountryId(\"\");\r\n      await load();\r\n      toast.success(\"User created (password reset required on first login)\");\r\n    } catch (e) {\r\n      toast.error(e.message || \"Create user failed\");\r\n    }\r\n  }\r\n\r\n  async function assignCountry() {\r\n    if (!selectedUser) {\r\n      toast.error(\"Select a user\");\r\n      return;\r\n    }\r\n    if (!assignCountryId) {\r\n      toast.error(\"Select a country\");\r\n      return;\r\n    }\r\n    if (userUpdateLoading) return;\r\n    const nextId = Number(assignCountryId);\r\n    if (!Number.isFinite(nextId)) {\r\n      toast.error(\"Invalid country selection\");\r\n      return;\r\n    }\r\n    if (isSameCountry) {\r\n      toast.error(\"Selected country is already assigned to this user\");\r\n      return;\r\n    }\r\n    if (selectedUser.country_id != null) {\r\n      const currentLabel = selectedUser.country_name\r\n        ? `${selectedUser.country_name} (${selectedUser.country_code})`\r\n        : \"Unassigned\";\r\n      const nextLabel = selectedCountry ? `${selectedCountry.name} (${selectedCountry.code})` : `#${nextId}`;\r\n      setConfirmAssign({\r\n        userId: selectedUser.id,\r\n        nextId,\r\n        email: selectedUser.email,\r\n        currentLabel,\r\n        nextLabel,\r\n        hadCountry: true,\r\n      });\r\n      return;\r\n    }\r\n    setUserUpdateLoading(true);\r\n    try {\r\n      await api.assignUserCountry(assignUserId, { countryId: nextId });\r\n      await load();\r\n      toast.success(\"User assigned\");\r\n    } catch (e) {\r\n      toast.error(e.message || \"Assignment failed\");\r\n    } finally {\r\n      setUserUpdateLoading(false);\r\n    }\r\n  }\r\n\r\n  async function confirmAssignCountry(data) {\r\n    if (!data) return;\r\n    if (userUpdateLoading) return;\r\n    setUserUpdateLoading(true);\r\n    try {\r\n      await api.assignUserCountry(data.userId, { countryId: data.nextId });\r\n      await load();\r\n      toast.success(data.hadCountry ? \"User country updated\" : \"User assigned\");\r\n    } catch (e) {\r\n      toast.error(e.message || \"Assignment failed\");\r\n    } finally {\r\n      setUserUpdateLoading(false);\r\n    }\r\n  }\r\n\r\n  async function deleteUser(user) {\r\n    if (!user || !user.id) return;\r\n    const label = user.email || `User #${user.id}`;\r\n    setConfirmDelete({ id: user.id, label });\r\n  }\r\n\r\n  async function confirmDeleteUser(data) {\r\n    if (!data) return;\r\n    try {\r\n      await api.deleteUser(data.id);\r\n      await load();\r\n      toast.success(\"User deleted\");\r\n    } catch (e) {\r\n      toast.error(e.message || \"Delete failed\");\r\n    }\r\n  }\r\n\r\n  // --- Permission editor helpers ---\r\n  /**\r\n   * Toggle selection of a permission key (resource|action) in the UI.\r\n   * When enabling a permission for the first time without a scope, defaults to country scope.\r\n   */\r\n  function togglePermission(key) {\r\n    setPermissionSelections((prev) => {\r\n      const next = { ...prev };\r\n      next[key] = !prev[key];\r\n      return next;\r\n    });\r\n    setPermissionScopes((prev) => {\r\n      // When turning on a permission that doesnt have a scope yet, default to country\r\n      if (!permissionSelections[key] && !prev[key]) {\r\n        return { ...prev, [key]: \"country\" };\r\n      }\r\n      return prev;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Change the scope for a permission key.\r\n   * @param {string} key The permission key (resource|action)\r\n   * @param {string} value The selected scope: \"country\" or \"school:<id>\"\r\n   */\r\n  function changePermissionScope(key, value) {\r\n    setPermissionScopes((prev) => ({ ...prev, [key]: value }));\r\n  }\r\n\r\n  /**\r\n   * Persist the current permission selections for the selected user.\r\n   * Constructs the payload based on selected permissions and scopes and sends\r\n   * it to the backend. Afterwards reloads the users permissions from the\r\n   * server to ensure UI consistency.\r\n   */\r\n  async function saveUserPermissions() {\r\n    if (!selectedUser) {\r\n      toast.error(\"Select a user to edit permissions\");\r\n      return;\r\n    }\r\n    const perms = [];\r\n    const keys = Object.keys(permissionSelections || {});\r\n    keys.forEach((key) => {\r\n      if (!permissionSelections[key]) return;\r\n      const [resource, action] = key.split(\"|\");\r\n      let scopeVal = permissionScopes[key] || \"country\";\r\n      let scope_country_id = null;\r\n      let scope_school_id = null;\r\n      // Determine scope\r\n      if (scopeVal === \"country\") {\r\n        // assign scope_country_id based on user's country_id if available\r\n        if (selectedUser.country_id != null) {\r\n          scope_country_id = Number(selectedUser.country_id);\r\n        }\r\n      } else if (scopeVal.startsWith(\"school:\")) {\r\n        const idStr = scopeVal.split(\":\")[1];\r\n        const sid = Number(idStr);\r\n        if (Number.isFinite(sid)) {\r\n          scope_school_id = sid;\r\n        }\r\n        // set country_id if available\r\n        if (selectedUser.country_id != null) {\r\n          scope_country_id = Number(selectedUser.country_id);\r\n        }\r\n      }\r\n      perms.push({ resource, action, scope_country_id, scope_school_id });\r\n    });\r\n    setPermissionsSaving(true);\r\n    try {\r\n      await api.adminSetUserPermissions(selectedUser.id, { permissions: perms });\r\n      // Reload user permissions to reflect server state\r\n      const updated = await api.adminGetUserPermissions(selectedUser.id);\r\n      // Recompute selections and scopes based on the latest permissions returned\r\n      const sel = {};\r\n      const scopeMap = {};\r\n      (updated || []).forEach((p) => {\r\n        const k = `${p.resource}|${p.action}`;\r\n        sel[k] = true;\r\n        if (p.scope_school_id != null) {\r\n          scopeMap[k] = `school:${p.scope_school_id}`;\r\n        } else {\r\n          scopeMap[k] = \"country\";\r\n        }\r\n      });\r\n      setPermissionSelections(sel);\r\n      setPermissionScopes(scopeMap);\r\n      toast.success(\"Permissions saved\");\r\n    } catch (e) {\r\n      toast.error(e?.message || \"Save permissions failed\");\r\n    } finally {\r\n      setPermissionsSaving(false);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update the role of the currently selected user.  This is triggered\r\n   * when an admin chooses a new role from the role selector.  The\r\n   * function calls the adminUpdateUserRole API and then refreshes\r\n   * the list of users to reflect the change.  Displays success or\r\n   * error messages via toast notifications.\r\n   *\r\n   * @param {string} role The new role to assign to the user\r\n   */\r\n  async function updateSelectedUserRole(role) {\r\n    // Ensure there is a selected user before updating\r\n    if (!selectedUser) return;\r\n    setRoleUpdating(true);\r\n    try {\r\n      await api.adminUpdateUserRole(selectedUser.id, { role });\r\n      // Reload data so the user list reflects the new role\r\n      await load();\r\n      // Maintain the current selection after reload\r\n      setAssignUserId(String(selectedUser.id));\r\n      toast.success(\"Role updated\");\r\n    } catch (e) {\r\n      toast.error(e?.message || \"Failed to update role\");\r\n    } finally {\r\n      setRoleUpdating(false);\r\n    }\r\n  }\r\n\r\n  // --- Principal assignment helpers ---\r\n  /**\r\n   * Handle selection of principal users for a school. Updates the draft state.\r\n   * @param {number} schoolId\r\n   * @param {string[]} valueIds Array of selected userId strings from a multiselect element\r\n   */\r\n  function handlePrincipalSelectionChange(schoolId, valueIds) {\r\n    const ids = valueIds.map((v) => Number(v)).filter((n) => Number.isFinite(n));\r\n    setPrincipalDrafts((prev) => ({ ...prev, [schoolId]: ids }));\r\n  }\r\n\r\n  /**\r\n   * Save principal assignments for a given school. Sends the current draft\r\n   * selection to the backend and updates the local principal list.\r\n   * @param {number} schoolId\r\n   */\r\n  async function savePrincipalAssignments(schoolId) {\r\n    const userIds = principalDrafts[schoolId] || [];\r\n    setPrincipalSaving((prev) => ({ ...prev, [schoolId]: true }));\r\n    try {\r\n      await api.adminSetSchoolPrincipals(schoolId, { userIds });\r\n      // Update local list with selected principal user objects\r\n      const newList = users.filter((u) => u.role === \"principal\" && userIds.includes(u.id));\r\n      setPrincipalLists((prev) => ({ ...prev, [schoolId]: newList }));\r\n      toast.success(\"Principals updated\");\r\n    } catch (e) {\r\n      toast.error(e?.message || \"Failed to update principals\");\r\n    } finally {\r\n      setPrincipalSaving((prev) => ({ ...prev, [schoolId]: false }));\r\n    }\r\n  }\r\n\r\n  function getAuthTokenFromStorage() {\r\n    try {\r\n      const keys = [\"token\", \"auth_token\", \"jwt\", \"access_token\"];\r\n      for (const k of keys) {\r\n        const v = window?.localStorage?.getItem(k);\r\n        if (v) return String(v);\r\n      }\r\n    } catch {\r\n      // ignore\r\n    }\r\n    return \"\";\r\n  }\r\n\r\n  async function adminResetUserPassword(userId) {\r\n    const token = getAuthTokenFromStorage();\r\n    const res = await fetch(`/api/admin/users/${userId}/reset-password`, {\r\n      method: \"POST\",\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n        ...(token ? { Authorization: `Bearer ${token}` } : {}),\r\n      },\r\n      body: JSON.stringify({}),\r\n    });\r\n    let data = {};\r\n    try {\r\n      data = await res.json();\r\n    } catch {\r\n      data = {};\r\n    }\r\n    if (!res.ok) {\r\n      const msg = data?.error || data?.details || `Reset failed (${res.status})`;\r\n      throw new Error(msg);\r\n    }\r\n    return data;\r\n  }\r\n\r\n  async function resetPasswordForUser(user) {\r\n    if (!user?.id) return;\r\n    setConfirmReset({ id: user.id, email: user.email, full_name: user.full_name || null });\r\n  }\r\n\r\n  async function confirmResetPassword(data) {\r\n    if (!data?.id) return;\r\n    if (resetLoadingId) return;\r\n    setResetLoadingId(data.id);\r\n    try {\r\n      const out = await adminResetUserPassword(data.id);\r\n      setResetResult({\r\n        id: data.id,\r\n        email: data.email,\r\n        full_name: data.full_name || null,\r\n        temporary_password: out.temporary_password,\r\n      });\r\n      await load();\r\n      toast.success(\"Temporary password generated\");\r\n    } catch (e) {\r\n      toast.error(e.message || \"Reset failed\");\r\n    } finally {\r\n      setResetLoadingId(null);\r\n    }\r\n  }\r\n\r\n  async function copyText(text) {\r\n    const value = String(text || \"\");\r\n    if (!value) return;\r\n    try {\r\n      await navigator.clipboard.writeText(value);\r\n      toast.success(\"Copied\");\r\n      return;\r\n    } catch {\r\n      // fallback\r\n    }\r\n    try {\r\n      const ta = document.createElement(\"textarea\");\r\n      ta.value = value;\r\n      ta.style.position = \"fixed\";\r\n      ta.style.left = \"-9999px\";\r\n      document.body.appendChild(ta);\r\n      ta.select();\r\n      document.execCommand(\"copy\");\r\n      document.body.removeChild(ta);\r\n      toast.success(\"Copied\");\r\n    } catch {\r\n      toast.error(\"Copy failed\");\r\n    }\r\n  }\r\n\r\n  async function saveSchoolName(school) {\r\n    if (!school?.id) return;\r\n    const draft = schoolNameDrafts[school.id];\r\n    const nextName = String(draft != null ? draft : school.name || \"\").trim();\r\n    if (!nextName) {\r\n      toast.error(\"Name is required\");\r\n      return;\r\n    }\r\n    if (nextName === school.name) return;\r\n\r\n    setSchoolSavingId(school.id);\r\n    try {\r\n      await api.adminUpdateSchool(school.id, { name: nextName });\r\n      await loadCountrySchools(schoolsCountryId);\r\n      setSchoolNameDrafts((prev) => ({ ...prev, [school.id]: nextName }));\r\n      toast.success(\"School updated\");\r\n    } catch (e) {\r\n      toast.error(e.message || \"Update failed\");\r\n    } finally {\r\n      setSchoolSavingId(null);\r\n    }\r\n  }\r\n\r\n  async function toggleSchoolStatus(school) {\r\n    if (!school?.id) return;\r\n    const nextStatus = school.status === \"closed\" ? \"active\" : \"closed\";\r\n    setSchoolSavingId(school.id);\r\n    try {\r\n      await api.adminUpdateSchool(school.id, { status: nextStatus });\r\n      await loadCountrySchools(schoolsCountryId);\r\n      toast.success(nextStatus === \"closed\" ? \"School closed\" : \"School reopened\");\r\n    } catch (e) {\r\n      toast.error(e.message || \"Update failed\");\r\n    } finally {\r\n      setSchoolSavingId(null);\r\n    }\r\n  }\r\n\r\n  const toggleProgressTab = (tabKey) => {\r\n    setExpandedProgressTabs((prev) => {\r\n      const next = new Set(prev);\r\n      if (next.has(tabKey)) next.delete(tabKey);\r\n      else next.add(tabKey);\r\n      return next;\r\n    });\r\n  };\r\n\r\n  const toggleProgressSection = (sectionId) => {\r\n    setExpandedProgressSections((prev) => {\r\n      const next = new Set(prev);\r\n      if (next.has(sectionId)) next.delete(sectionId);\r\n      else next.add(sectionId);\r\n      return next;\r\n    });\r\n  };\r\n\r\n  const updateProgressSection = (sectionId, updater) => {\r\n    setProgressConfig((prev) => {\r\n      const base = normalizeProgressConfig(prev);\r\n      const next = structuredClone(base);\r\n      const section = next.sections?.[sectionId];\r\n      if (!section) return base;\r\n      updater(section);\r\n      return next;\r\n    });\r\n  };\r\n\r\n  const setProgressFieldSelected = (sectionId, fieldId, checked) => {\r\n    updateProgressSection(sectionId, (section) => {\r\n      if (!section.selectedFields) section.selectedFields = {};\r\n      if (checked) delete section.selectedFields[fieldId];\r\n      else section.selectedFields[fieldId] = false;\r\n    });\r\n  };\r\n\r\n  const setProgressSectionEnabled = (sectionId, enabled) => {\r\n    updateProgressSection(sectionId, (section) => {\r\n      section.enabled = !!enabled;\r\n    });\r\n  };\r\n\r\n  const setProgressSectionMode = (sectionId, mode) => {\r\n    updateProgressSection(sectionId, (section) => {\r\n      section.mode = mode;\r\n    });\r\n  };\r\n\r\n  const setProgressSectionMin = (sectionId, value) => {\r\n    const num = Number(value);\r\n    updateProgressSection(sectionId, (section) => {\r\n      section.min = Number.isFinite(num) ? Math.max(1, num) : 1;\r\n    });\r\n  };\r\n\r\n  const selectAllSectionFields = (sectionId, fieldIds) => {\r\n    updateProgressSection(sectionId, (section) => {\r\n      if (!section.selectedFields) section.selectedFields = {};\r\n      fieldIds.forEach((id) => {\r\n        if (section.selectedFields) delete section.selectedFields[id];\r\n      });\r\n    });\r\n  };\r\n\r\n  const unselectAllSectionFields = (sectionId, fieldIds) => {\r\n    updateProgressSection(sectionId, (section) => {\r\n      if (!section.selectedFields) section.selectedFields = {};\r\n      fieldIds.forEach((id) => {\r\n        if (section.selectedFields) section.selectedFields[id] = false;\r\n      });\r\n    });\r\n  };\r\n\r\n  const toggleTargetCountry = (countryId) => {\r\n    const id = Number(countryId);\r\n    if (!Number.isFinite(id)) return;\r\n    setProgressTargetIds((prev) => {\r\n      const next = new Set(prev);\r\n      if (next.has(id)) next.delete(id);\r\n      else next.add(id);\r\n      return next;\r\n    });\r\n  };\r\n\r\n  const selectAllTargets = () => {\r\n    setProgressTargetIds((prev) => {\r\n      const next = new Set(prev);\r\n      filteredCountriesForApply.forEach((country) => {\r\n        const id = Number(country.id);\r\n        if (Number.isFinite(id)) next.add(id);\r\n      });\r\n      return next;\r\n    });\r\n  };\r\n\r\n  const clearTargets = () => {\r\n    setProgressTargetIds(new Set());\r\n  };\r\n\r\n  const applyProgressConfigToSelectedCountries = async () => {\r\n    const ids = Array.from(progressTargetIds)\r\n      .map((id) => Number(id))\r\n      .filter((id) => Number.isFinite(id));\r\n    const uniqueIds = Array.from(new Set(ids));\r\n    if (!uniqueIds.length) {\r\n      toast.error(\"Select at least one country\");\r\n      return;\r\n    }\r\n    if (!progressCountryId) {\r\n      toast.error(\"Select a country to edit rules first\");\r\n      return;\r\n    }\r\n    const ok = window.confirm(\r\n      `Apply this configuration to ${uniqueIds.length} countries? This will overwrite their current rules.`\r\n    );\r\n    if (!ok) return;\r\n\r\n    setProgressBulkSaving(true);\r\n    try {\r\n      const result = await api.adminBulkSaveProgressRequirements(uniqueIds, progressConfigNormalized);\r\n      const updatedCount = Number.isFinite(Number(result?.updatedCount))\r\n        ? Number(result.updatedCount)\r\n        : uniqueIds.length;\r\n      toast.success(`Applied to ${updatedCount} countries`);\r\n      if (uniqueIds.some((id) => String(id) === String(progressCountryId))) {\r\n        await loadProgressRequirements(progressCountryId);\r\n      }\r\n    } catch (e) {\r\n      toast.error(e.message || \"Failed to apply progress requirements\");\r\n    } finally {\r\n      setProgressBulkSaving(false);\r\n    }\r\n  };\r\n\r\n  const saveProgressConfig = async () => {\r\n    if (!progressCountryId) {\r\n      toast.error(\"Select a country\");\r\n      return;\r\n    }\r\n    setProgressSaving(true);\r\n    try {\r\n      const saved = await api.adminSaveProgressRequirements(progressCountryId, progressConfigNormalized);\r\n      setProgressConfig(normalizeProgressConfig(saved?.config || saved));\r\n      toast.success(\"Progress requirements saved\");\r\n    } catch (e) {\r\n      toast.error(e.message || \"Failed to save progress requirements\");\r\n    } finally {\r\n      setProgressSaving(false);\r\n    }\r\n  };\r\n\r\n  const openReviewModal = (row, action) => {\r\n    setReviewModal({ row, action });\r\n    setReviewNote(\"\");\r\n    setReviewIncludedYears({ y1: true, y2: true, y3: true });\r\n    if (action === \"revise\") {\r\n      // Reset revision selection: all modules unchecked by default\r\n      const initial = {};\r\n      REQUIRED_WORK_IDS.forEach((id) => (initial[id] = false));\r\n      setReviewRevisionSelection(initial);\r\n    }\r\n  };\r\n\r\n  const closeReviewModal = () => {\r\n    setReviewModal(null);\r\n    setReviewNote(\"\");\r\n    setReviewIncludedYears({ y1: true, y2: true, y3: true });\r\n    // Reset revision selections on close\r\n    const reset = {};\r\n    REQUIRED_WORK_IDS.forEach((id) => (reset[id] = false));\r\n    setReviewRevisionSelection(reset);\r\n  };\r\n\r\n  const submitReview = async () => {\n    if (!reviewModal?.row?.scenario?.id) return;\n    const action = reviewModal.action;\r\n    const note = reviewNote.trim();\r\n    if (action === \"revise\" && !note) {\r\n      toast.error(\"Note is required for revision requests\");\r\n      return;\r\n    }\r\n    const payload = { action, note: note || null };\r\n    if (action === \"approve\") {\r\n      const includedYears = YEAR_KEYS.filter((key) => reviewIncludedYears[key]);\r\n      if (!includedYears.length) {\r\n        toast.error(\"Select at least one year\");\r\n        return;\r\n      }\r\n      payload.includedYears = includedYears;\r\n    } else if (action === \"revise\") {\r\n      // Collect selected revision work ids.  At least one must be selected.\r\n      const revisionWorkIds = REQUIRED_WORK_IDS.filter((id) => reviewRevisionSelection[id]);\r\n      if (!revisionWorkIds.length) {\r\n        toast.error(\"Select at least one module\");\r\n        return;\r\n      }\r\n      payload.revisionWorkIds = revisionWorkIds;\r\n    }\r\n    setReviewSaving(true);\r\n    try {\r\n      await api.adminReviewScenario(reviewModal.row.scenario.id, payload);\r\n      toast.success(action === \"approve\" ? \"Scenario approved\" : \"Revision requested\");\r\n      closeReviewModal();\r\n      await loadQueue(); // uses latest filters via ref\r\n    } catch (e) {\r\n      toast.error(e.message || \"Review failed\");\r\n    } finally {\r\n      setReviewSaving(false);\r\n    }\n  };\n\n  const openBatchReviewModal = (row, action) => {\n    setBatchReviewModal({ row, action });\n    setBatchReviewNote(\"\");\n    setBatchReviewIncludedYears({ y1: true, y2: true, y3: true });\n    if (action === \"revise\") {\n      const initial = {};\n      REQUIRED_WORK_IDS.forEach((id) => (initial[id] = false));\n      setBatchReviewRevisionSelection(initial);\n    }\n  };\n\n  const closeBatchReviewModal = () => {\n    setBatchReviewModal(null);\n    setBatchReviewNote(\"\");\n    setBatchReviewIncludedYears({ y1: true, y2: true, y3: true });\n    const reset = {};\n    REQUIRED_WORK_IDS.forEach((id) => (reset[id] = false));\n    setBatchReviewRevisionSelection(reset);\n    setBatchDetail(null);\n  };\n\n  useEffect(() => {\n    const batchId = batchReviewModal?.row?.batch_id;\n    if (!batchId) return;\n    setBatchDetailLoading(true);\n    api.adminGetApprovalBatch(batchId)\n      .then((data) => {\n        setBatchDetail(data || null);\n      })\n      .catch((e) => {\n        toast.error(e.message || \"Failed to load batch details\");\n        setBatchDetail(null);\n      })\n      .finally(() => {\n        setBatchDetailLoading(false);\n      });\n  }, [batchReviewModal?.row?.batch_id]);\n\n  const submitBatchReview = async () => {\n    const batchId = batchReviewModal?.row?.batch_id;\n    if (!batchId) return;\n    const action = batchReviewModal.action;\n    const note = batchReviewNote.trim();\n    if (action === \"revise\" && !note) {\n      toast.error(\"Note is required for revision requests\");\n      return;\n    }\n    const payload = { action, note: note || null };\n    if (action === \"approve\") {\n      const includedYears = YEAR_KEYS.filter((key) => batchReviewIncludedYears[key]);\n      if (!includedYears.length) {\n        toast.error(\"Select at least one year\");\n        return;\n      }\n      payload.includedYears = includedYears;\n    } else {\n      const revisionWorkIds = REQUIRED_WORK_IDS.filter((id) => batchReviewRevisionSelection[id]);\n      if (!revisionWorkIds.length) {\n        toast.error(\"Select at least one module\");\n        return;\n      }\n      payload.revisionWorkIds = revisionWorkIds;\n    }\n\n    setBatchReviewSaving(true);\n    try {\n      await api.adminReviewApprovalBatch(batchId, payload);\n      toast.success(action === \"approve\" ? \"Batch approved\" : \"Revision requested\");\n      closeBatchReviewModal();\n      loadBatchQueue(queueFiltersRef.current);\n    } catch (e) {\n      toast.error(e.message || \"Failed to submit batch review\");\n    } finally {\n      setBatchReviewSaving(false);\n    }\n  };\n\r\n  const toggleRegion = (regionKey) => {\r\n    setExpandedRegions((prev) => {\r\n      const next = new Set(prev);\r\n      if (next.has(regionKey)) next.delete(regionKey);\r\n      else next.add(regionKey);\r\n      return next;\r\n    });\r\n  };\r\n\r\n  const toggleCountry = (regionKey, countryId) => {\r\n    const key = `${regionKey}::${countryId}`;\r\n    setExpandedCountries((prev) => {\r\n      const next = new Set(prev);\r\n      if (next.has(key)) next.delete(key);\r\n      else next.add(key);\r\n      return next;\r\n    });\r\n  };\r\n\r\n  const renderQueueKpis = (kpi) => {\r\n    if (!kpi) {\r\n      return <div className=\"kpi-mini kpi-mini-missing\">Missing KPIs</div>;\r\n    }\r\n    const margin = kpi.net_ciro ? kpi.net_result / kpi.net_ciro : null;\r\n    return (\r\n      <div className=\"kpi-mini\">\r\n        <div className=\"kpi-mini-row\">\r\n          <span className=\"kpi-mini-label\">Net ciro</span>\r\n          <span className=\"kpi-mini-value\">{fmt(kpi.net_ciro)}</span>\r\n        </div>\r\n        <div className=\"kpi-mini-row\">\r\n          <span className=\"kpi-mini-label\">Net result</span>\r\n          <span className=\"kpi-mini-value\">{fmt(kpi.net_result)}</span>\r\n        </div>\r\n        <div className=\"kpi-mini-row\">\r\n          <span className=\"kpi-mini-label\">Margin</span>\r\n          <span className=\"kpi-mini-value\">{fmtPct(margin)}</span>\r\n        </div>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  const renderYearCell = (year) => {\r\n    if (!year) return <div className=\"rollup-year-cell is-empty\">-</div>;\r\n    return (\r\n      <div className=\"rollup-year-cell\">\r\n        <div className=\"rollup-metric\">\r\n          <span className=\"rollup-label\">Net ciro</span>\r\n          <span className=\"rollup-value\">{fmt(year.net_ciro)}</span>\r\n        </div>\r\n        <div className=\"rollup-metric\">\r\n          <span className=\"rollup-label\">Net income</span>\r\n          <span className=\"rollup-value\">{fmt(year.net_income)}</span>\r\n        </div>\r\n        <div className=\"rollup-metric\">\r\n          <span className=\"rollup-label\">Expenses</span>\r\n          <span className=\"rollup-value\">{fmt(year.total_expenses)}</span>\r\n        </div>\r\n        <div className=\"rollup-metric\">\r\n          <span className=\"rollup-label\">Net result</span>\r\n          <span className=\"rollup-value\">{fmt(year.net_result)}</span>\r\n        </div>\r\n        <div className=\"rollup-metric\">\r\n          <span className=\"rollup-label\">Margin</span>\r\n          <span className=\"rollup-value\">{fmtPct(year.profitMargin)}</span>\r\n        </div>\r\n        <div className=\"rollup-metric\">\r\n          <span className=\"rollup-label\">Students</span>\r\n          <span className=\"rollup-value\">{fmt(year.students_total)}</span>\r\n        </div>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  const handleRefresh = () => {\n    if (activeTab === \"approvals\") {\n      if (approvalsView === \"batches\") {\n        loadBatchQueue(queueFilters);\n      } else {\n        loadQueue(queueFilters);\n      }\n      return;\n    }\n    if (activeTab === \"progress\") {\r\n      if (progressCountryId) loadProgressRequirements(progressCountryId);\r\n      return;\r\n    }\r\n    if (activeTab === \"reports\") {\r\n      loadRollup(rollupYear);\r\n      return;\r\n    }\r\n    if (activeTab === \"countries\") {\r\n      load();\r\n      if (schoolsCountryId) loadCountrySchools(schoolsCountryId);\r\n      return;\r\n    }\r\n    load();\r\n  };\r\n\r\n  if (!auth.user) {\r\n    return (\r\n      <div className=\"container\">\r\n        <div className=\"card\">Loading...</div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (auth.user.role !== \"admin\") {\r\n    return (\r\n      <div className=\"container\">\r\n        <div className=\"card\">\r\n          <div style={{ fontWeight: 700 }}>Admin only</div>\r\n          <div className=\"small\" style={{ marginTop: 6 }}>\r\n            You do not have permission to view this page.\r\n          </div>\r\n          <div style={{ marginTop: 10 }}>\r\n            <Link to=\"/schools\">Back to Schools</Link>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const rollupExportDisabled = rollupLoading || !rollupData;\r\n  const rollupXlsxReady = false;\r\n  const activeApprovalsLoading = approvalsView === \"batches\" ? batchQueueLoading : queueLoading;\n  const refreshDisabled = loading || activeApprovalsLoading || rollupLoading || progressLoading;\n  const renderRefreshButton = () => (\r\n    <button className=\"btn\" onClick={handleRefresh} disabled={refreshDisabled}>\r\n      Refresh\r\n    </button>\r\n  );\r\n\r\n  return (\r\n    <>\r\n      {outlet?.headerPortalEl ? createPortal(renderRefreshButton(), outlet.headerPortalEl) : null}\r\n      <div className=\"container\">\r\n        {!outlet?.headerPortalEl && (\r\n          <div className=\"row\" style={{ justifyContent: \"space-between\" }}>\r\n            <div>\r\n              <div style={{ fontWeight: 800, fontSize: 20 }}>Admin</div>\r\n              <div className=\"small\">Create users, manage countries, and review scenarios.</div>\r\n            </div>\r\n            {renderRefreshButton()}\r\n          </div>\r\n        )}\r\n\r\n        <ToastContainer position=\"top-right\" autoClose={3500} newestOnTop closeOnClick pauseOnFocusLoss pauseOnHover />\r\n\r\n      {userUpdateLoading ? (\r\n        <div className=\"modal-backdrop\" role=\"status\" aria-live=\"polite\" aria-busy=\"true\">\r\n          <style>{`@keyframes adminSpin{to{transform:rotate(360deg)}}`}</style>\r\n          <div\r\n            className=\"card\"\r\n            style={{\r\n              width: \"min(360px, 92vw)\",\r\n              padding: \"16px\",\r\n              textAlign: \"center\",\r\n            }}\r\n          >\r\n            <div\r\n              aria-hidden\r\n              style={{\r\n                width: 28,\r\n                height: 28,\r\n                margin: \"0 auto\",\r\n                borderRadius: \"50%\",\r\n                border: \"3px solid rgba(0,0,0,.15)\",\r\n                borderTopColor: \"rgba(0,0,0,.75)\",\r\n                animation: \"adminSpin .8s linear infinite\",\r\n              }}\r\n            />\r\n            <div style={{ fontWeight: 700, marginTop: 10 }}>Updating user...</div>\r\n            <div className=\"small muted\" style={{ marginTop: 6 }}>\r\n              Please wait.\r\n            </div>\r\n          </div>\r\n        </div>\r\n      ) : null}\r\n\r\n      {confirmAssign ? (\r\n        <div className=\"modal-backdrop\" role=\"dialog\" aria-modal=\"true\">\r\n          <div className=\"modal\">\r\n            <div style={{ fontWeight: 700, marginBottom: 8 }}>Confirm Change</div>\r\n            <div className=\"small\" style={{ marginBottom: 12 }}>\r\n              {`Change ${confirmAssign.email} from ${confirmAssign.currentLabel} to ${confirmAssign.nextLabel}?`}\r\n            </div>\r\n            <div className=\"row\" style={{ justifyContent: \"flex-end\" }}>\r\n              <button className=\"btn\" onClick={() => setConfirmAssign(null)} disabled={userUpdateLoading}>\r\n                Cancel\r\n              </button>\r\n              <button\r\n                className=\"btn primary\"\r\n                onClick={() => {\r\n                  const data = confirmAssign;\r\n                  setConfirmAssign(null);\r\n                  confirmAssignCountry(data);\r\n                }}\r\n                disabled={userUpdateLoading}\r\n              >\r\n                {userUpdateLoading ? \"Updating...\" : \"Confirm\"}\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      ) : null}\r\n\r\n      {confirmDelete ? (\r\n        <div className=\"modal-backdrop\" role=\"dialog\" aria-modal=\"true\">\r\n          <div className=\"modal\">\r\n            <div style={{ fontWeight: 700, marginBottom: 8 }}>Confirm Delete</div>\r\n            <div className=\"small\" style={{ marginBottom: 12 }}>\r\n              {`Delete ${confirmDelete.label}? This only works if the user has no related records.`}\r\n            </div>\r\n            <div className=\"row\" style={{ justifyContent: \"flex-end\" }}>\r\n              <button className=\"btn\" onClick={() => setConfirmDelete(null)}>\r\n                Cancel\r\n              </button>\r\n              <button\r\n                className=\"btn danger\"\r\n                onClick={() => {\r\n                  const data = confirmDelete;\r\n                  setConfirmDelete(null);\r\n                  confirmDeleteUser(data);\r\n                }}\r\n              >\r\n                Delete\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      ) : null}\r\n\r\n      {resetLoadingId ? (\r\n        <div className=\"modal-backdrop\" role=\"status\" aria-live=\"polite\" aria-busy=\"true\">\r\n          <style>{`@keyframes adminSpin{to{transform:rotate(360deg)}}`}</style>\r\n          <div\r\n            className=\"card\"\r\n            style={{\r\n              width: \"min(360px, 92vw)\",\r\n              padding: \"16px\",\r\n              textAlign: \"center\",\r\n            }}\r\n          >\r\n            <div\r\n              aria-hidden\r\n              style={{\r\n                width: 28,\r\n                height: 28,\r\n                margin: \"0 auto\",\r\n                borderRadius: \"50%\",\r\n                border: \"3px solid rgba(0,0,0,.15)\",\r\n                borderTopColor: \"rgba(0,0,0,.75)\",\r\n                animation: \"adminSpin .8s linear infinite\",\r\n              }}\r\n            />\r\n            <div style={{ fontWeight: 700, marginTop: 10 }}>Resetting password...</div>\r\n            <div className=\"small muted\" style={{ marginTop: 6 }}>\r\n              Please wait.\r\n            </div>\r\n          </div>\r\n        </div>\r\n      ) : null}\r\n\r\n      {confirmReset ? (\r\n        <div className=\"modal-backdrop\" role=\"dialog\" aria-modal=\"true\">\r\n          <div className=\"modal\">\r\n            <div style={{ fontWeight: 700, marginBottom: 8 }}>Reset Password</div>\r\n            <div className=\"small\" style={{ marginBottom: 12 }}>\r\n              {`Generate a new temporary password for ${confirmReset.email}? The user will be forced to change it on next login.`}\r\n            </div>\r\n            <div className=\"row\" style={{ justifyContent: \"flex-end\" }}>\r\n              <button className=\"btn\" onClick={() => setConfirmReset(null)} disabled={Boolean(resetLoadingId)}>\r\n                Cancel\r\n              </button>\r\n              <button\r\n                className=\"btn primary\"\r\n                onClick={() => {\r\n                  const data = confirmReset;\r\n                  setConfirmReset(null);\r\n                  confirmResetPassword(data);\r\n                }}\r\n                disabled={Boolean(resetLoadingId)}\r\n              >\r\n                Confirm\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      ) : null}\r\n\r\n      {resetResult ? (\r\n        <div className=\"modal-backdrop\" role=\"dialog\" aria-modal=\"true\">\r\n          <div className=\"modal\" style={{ maxWidth: 560 }}>\r\n            <div style={{ fontWeight: 700, marginBottom: 8 }}>Temporary Password</div>\r\n            <div className=\"small\" style={{ marginBottom: 10 }}>\r\n              Share this password securely with the user. It will only be shown once here.\r\n            </div>\r\n            <div className=\"card\" style={{ padding: 12, background: \"rgba(0,0,0,.03)\" }}>\r\n              <div className=\"small\" style={{ marginBottom: 6 }}>\r\n                User: <strong>{resetResult.email}</strong>\r\n              </div>\r\n              <div className=\"row\" style={{ alignItems: \"center\", justifyContent: \"space-between\" }}>\r\n                <div style={{ fontFamily: \"ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace\", fontSize: 18 }}>\r\n                  {resetResult.temporary_password}\r\n                </div>\r\n                <button className=\"btn\" onClick={() => copyText(resetResult.temporary_password)}>\r\n                  Copy\r\n                </button>\r\n              </div>\r\n            </div>\r\n            <div className=\"row\" style={{ justifyContent: \"flex-end\", marginTop: 12 }}>\r\n              <button className=\"btn primary\" onClick={() => setResetResult(null)}>\r\n                Done\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      ) : null}\r\n\r\n      {reviewModal ? (\n        <div className=\"modal-backdrop\" role=\"dialog\" aria-modal=\"true\">\n          <div className=\"modal\">\n            <div style={{ fontWeight: 700, marginBottom: 8 }}>\r\n              {reviewModal.action === \"approve\" ? \"Approve Scenario\" : \"Request Revision\"}\r\n            </div>\r\n            <div className=\"small\" style={{ marginBottom: 12 }}>\r\n              {reviewModal.row?.school?.name ? `${reviewModal.row.school.name} - ` : \"\"}\r\n              {reviewModal.row?.scenario?.name || \"Scenario\"}\r\n            </div>\r\n\r\n            {reviewModal.action === \"approve\" ? (\r\n              <div style={{ marginBottom: 10 }}>\r\n                <div className=\"small\" style={{ marginBottom: 6 }}>\r\n                  Included years\r\n                </div>\r\n                <div className=\"row\">\r\n                  {YEAR_KEYS.map((key) => (\r\n                    <label key={key} className=\"small\" style={{ display: \"inline-flex\", gap: 6 }}>\r\n                      <input\r\n                        type=\"checkbox\"\r\n                        checked={reviewIncludedYears[key]}\r\n                        onChange={(e) => setReviewIncludedYears((prev) => ({ ...prev, [key]: e.target.checked }))}\r\n                      />\r\n                      {key.toUpperCase()}\r\n                    </label>\r\n                  ))}\r\n                </div>\r\n              </div>\r\n            ) : null}\r\n\r\n            {reviewModal.action === \"revise\" ? (\r\n              <div style={{ marginBottom: 10 }}>\r\n                <div className=\"small\" style={{ marginBottom: 6 }}>\r\n                  Sadece seilen modller revizeye alacak (editable).\r\n                </div>\r\n                <div className=\"row\" style={{ flexWrap: \"wrap\", gap: 8 }}>\r\n                  {REQUIRED_WORK_IDS.map((id) => (\r\n                    <label\r\n                      key={id}\r\n                      className=\"small\"\r\n                      style={{ display: \"inline-flex\", gap: 6, alignItems: \"center\" }}\r\n                    >\r\n                      <input\r\n                        type=\"checkbox\"\r\n                        checked={Boolean(reviewRevisionSelection[id])}\r\n                        onChange={(e) =>\r\n                          setReviewRevisionSelection((prev) => ({ ...prev, [id]: e.target.checked }))\r\n                        }\r\n                      />\r\n                      {WORK_ID_LABELS[id] || id}\r\n                    </label>\r\n                  ))}\r\n                  <button type=\"button\" className=\"btn sm\" onClick={selectAllRevisionWork}>\r\n                    Tmn se\r\n                  </button>\r\n                  <button type=\"button\" className=\"btn sm\" onClick={clearRevisionWork}>\r\n                    Temizle\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            ) : null}\r\n\r\n            <div style={{ marginBottom: 12 }}>\r\n              <div className=\"small\" style={{ marginBottom: 6 }}>\r\n                Note {reviewModal.action === \"revise\" ? \"(required)\" : \"(optional)\"}\r\n              </div>\r\n              <textarea\r\n                className=\"input\"\r\n                style={{ width: \"100%\", minHeight: 90 }}\r\n                value={reviewNote}\r\n                onChange={(e) => setReviewNote(e.target.value)}\r\n              />\r\n            </div>\r\n\r\n            <div className=\"row\" style={{ justifyContent: \"flex-end\" }}>\r\n              <button className=\"btn\" onClick={closeReviewModal}>\r\n                Cancel\r\n              </button>\r\n              <button className=\"btn primary\" onClick={submitReview} disabled={reviewSaving}>\r\n                {reviewSaving ? \"Saving...\" : reviewModal.action === \"approve\" ? \"Approve\" : \"Request Revision\"}\r\n              </button>\r\n            </div>\r\n          </div>\n        </div>\n      ) : null}\n\n      {batchReviewModal ? (\n        <div className=\"modal-backdrop\" role=\"dialog\" aria-modal=\"true\">\n          <div className=\"modal\" style={{ maxWidth: 960 }}>\n            <div style={{ fontWeight: 700, marginBottom: 8 }}>\n              {batchReviewModal.action === \"approve\" ? \"Approve Batch\" : \"Request Revision\"}\n            </div>\n            <div className=\"small\" style={{ marginBottom: 12 }}>\n              {batchReviewModal.row?.country?.name ? `${batchReviewModal.row.country.name} - ` : \"\"}\n              {batchReviewModal.row?.academic_year || \"Batch\"}\n            </div>\n\n            {batchDetailLoading ? (\n              <div className=\"card\">Loading batch details...</div>\n            ) : batchDetail?.items?.length ? (\n              <div className=\"table-scroll\" style={{ marginBottom: 12 }}>\n                <table className=\"table\">\n                  <thead>\n                    <tr>\n                      <th>Okul</th>\n                      <th>Senaryo</th>\n                      <th>Durum</th>\n                      <th>Progress</th>\n                      <th>Kaynak</th>\n                    </tr>\n                  </thead>\n                  <tbody>\n                    {batchDetail.items.map((item) => (\n                      <tr key={`${item.school_id}-${item.scenario_id}`}>\n                        <td>{item.school_name}</td>\n                        <td>{item.scenario_name}</td>\n                        <td>{item.status}</td>\n                        <td>{Number.isFinite(Number(item.progress_pct)) ? `${Math.round(Number(item.progress_pct))}%` : \"-\"}</td>\n                        <td>{item.is_source ? \"Evet\" : \"Hayir\"}</td>\n                      </tr>\n                    ))}\n                  </tbody>\n                </table>\n              </div>\n            ) : (\n              <div className=\"card\">No items found.</div>\n            )}\n\n            {batchReviewModal.action === \"approve\" ? (\n              <div style={{ marginBottom: 10 }}>\n                <div className=\"small\" style={{ marginBottom: 6 }}>\n                  Included years\n                </div>\n                <div className=\"row\">\n                  {YEAR_KEYS.map((key) => (\n                    <label key={key} className=\"small\" style={{ display: \"inline-flex\", gap: 6 }}>\n                      <input\n                        type=\"checkbox\"\n                        checked={batchReviewIncludedYears[key]}\n                        onChange={(e) => setBatchReviewIncludedYears((prev) => ({ ...prev, [key]: e.target.checked }))}\n                      />\n                      {key.toUpperCase()}\n                    </label>\n                  ))}\n                </div>\n              </div>\n            ) : null}\n\n            {batchReviewModal.action === \"revise\" ? (\n              <div style={{ marginBottom: 10 }}>\n                <div className=\"small\" style={{ marginBottom: 6 }}>\n                  Sadece seilen modller revizeye alacak (editable).\n                </div>\n                <div className=\"row\" style={{ flexWrap: \"wrap\", gap: 8 }}>\n                  {REQUIRED_WORK_IDS.map((id) => (\n                    <label\n                      key={id}\n                      className=\"small\"\n                      style={{ display: \"inline-flex\", gap: 6, alignItems: \"center\" }}\n                    >\n                      <input\n                        type=\"checkbox\"\n                        checked={Boolean(batchReviewRevisionSelection[id])}\n                        onChange={(e) =>\n                          setBatchReviewRevisionSelection((prev) => ({ ...prev, [id]: e.target.checked }))\n                        }\n                      />\n                      {WORK_ID_LABELS[id] || id}\n                    </label>\n                  ))}\n                  <button type=\"button\" className=\"btn sm\" onClick={selectAllBatchRevisionWork}>\n                    Tmn se\n                  </button>\n                  <button type=\"button\" className=\"btn sm\" onClick={clearBatchRevisionWork}>\n                    Temizle\n                  </button>\n                </div>\n              </div>\n            ) : null}\n\n            <div style={{ marginBottom: 12 }}>\n              <div className=\"small\" style={{ marginBottom: 6 }}>\n                Note {batchReviewModal.action === \"revise\" ? \"(required)\" : \"(optional)\"}\n              </div>\n              <textarea\n                className=\"input\"\n                style={{ width: \"100%\", minHeight: 90 }}\n                value={batchReviewNote}\n                onChange={(e) => setBatchReviewNote(e.target.value)}\n              />\n            </div>\n\n            <div className=\"row\" style={{ justifyContent: \"flex-end\" }}>\n              <button className=\"btn\" onClick={closeBatchReviewModal}>\n                Cancel\n              </button>\n              <button className=\"btn primary\" onClick={submitBatchReview} disabled={batchReviewSaving}>\n                {batchReviewSaving\n                  ? \"Saving...\"\n                  : batchReviewModal.action === \"approve\"\n                    ? \"Approve\"\n                    : \"Request Revision\"}\n              </button>\n            </div>\n          </div>\n        </div>\n      ) : null}\n\r\n      {activeTab === \"users\" && (\r\n        <>\r\n          <div\r\n            style={{\r\n              marginTop: 12,\r\n              display: \"grid\",\r\n              gridTemplateColumns: \"repeat(auto-fit, minmax(320px, 1fr))\",\r\n              gap: 12,\r\n            }}\r\n          >\r\n            <div className=\"card\">\r\n              <div style={{ fontWeight: 700, marginBottom: 8 }}>Create User</div>\r\n              <div className=\"row\">\r\n                <input\r\n                  className=\"input\"\r\n                  placeholder=\"Full name\"\r\n                  value={newUserName}\r\n                  onChange={(e) => setNewUserName(e.target.value)}\r\n                />\r\n                <input\r\n                  className=\"input\"\r\n                  placeholder=\"Email\"\r\n                  value={newUserEmail}\r\n                  onChange={(e) => setNewUserEmail(e.target.value)}\r\n                />\r\n                <input\r\n                  className=\"input\"\r\n                  placeholder=\"Temporary password\"\r\n                  type=\"password\"\r\n                  value={newUserPassword}\r\n                  onChange={(e) => setNewUserPassword(e.target.value)}\r\n                />\r\n                <select className=\"input sm\" value={newUserRole} onChange={(e) => setNewUserRole(e.target.value)}>\r\n                  <option value=\"user\">User</option>\r\n                  <option value=\"admin\">Admin</option>\r\n                  <option value=\"principal\">Principal</option>\r\n                  <option value=\"hr\">HR</option>\r\n                  <option value=\"manager\">Manager</option>\r\n                  <option value=\"accountant\">Accountant</option>\r\n                </select>\r\n                <select\r\n                  className=\"input\"\r\n                  value={newUserCountryId}\r\n                  onChange={(e) => setNewUserCountryId(e.target.value)}\r\n                >\r\n                  <option value=\"\">Assign country (optional)</option>\r\n                  {countries.map((c) => (\r\n                    <option key={c.id} value={c.id}>\r\n                      {c.name} ({c.code}){c.region ? ` - ${c.region}` : \"\"}\r\n                    </option>\r\n                  ))}\r\n                </select>\r\n                <button className=\"btn primary\" onClick={createUser} disabled={loading}>\r\n                  <span className=\"row\" style={{ gap: 6, alignItems: \"center\" }}>\r\n                    <FaUserPlus aria-hidden=\"true\" />\r\n                    <span>Create</span>\r\n                  </span>\r\n                </button>\r\n              </div>\r\n              <div className=\"small\" style={{ marginTop: 8 }}>\r\n                New users must reset their password on first login.\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"card\">\r\n              <div style={{ fontWeight: 700, marginBottom: 8 }}>Assign / Edit User Country</div>\r\n              <div className=\"small\" style={{ marginBottom: 6 }}>\r\n                {selectedUser\r\n                  ? `Editing: ${selectedUser.email}${selectedUser.full_name ? ` (${selectedUser.full_name})` : \"\"\r\n                  } #${selectedUser.id}`\r\n                  : \"Select a user to assign or edit.\"}\r\n              </div>\r\n              <div className=\"row\">\r\n                <select className=\"input\" value={assignUserId} onChange={(e) => setAssignUserId(e.target.value)}>\r\n                  <option value=\"\">Select user</option>\r\n                  {users.map((u) => (\r\n                    <option key={u.id} value={u.id}>\r\n                      {u.email} {u.full_name ? `(${u.full_name})` : \"\"} #{u.id}\r\n                    </option>\r\n                  ))}\r\n                </select>\r\n                <select className=\"input\" value={assignCountryId} onChange={(e) => setAssignCountryId(e.target.value)}>\r\n                  <option value=\"\">Select country</option>\r\n                  {countries.map((c) => (\r\n                    <option key={c.id} value={c.id}>\r\n                      {c.name} ({c.code}) - {c.region}\r\n                    </option>\r\n                  ))}\r\n                </select>\r\n                <button\r\n                  className=\"btn primary\"\r\n                  onClick={assignCountry}\r\n                  disabled={loading || userUpdateLoading || !assignUserId || !assignCountryId || isSameCountry}\r\n                >\r\n                  {userUpdateLoading ? \"Updating...\" : actionLabel}\r\n                </button>\r\n              </div>\r\n              <div className=\"small\" style={{ marginTop: 8 }}>\r\n                <div>Current: {currentAssignmentLabel}</div>\r\n                <div>New: {newAssignmentLabel}</div>\r\n                {selectedUser && selectedCountry && selectedUser.country_id != null && !isSameCountry ? (\r\n                  <div style={{ color: \"#b45309\" }}>You are changing this user's assignment.</div>\r\n                ) : null}\r\n                {isSameCountry ? <div style={{ color: \"#6b7280\" }}>Selected country matches current assignment.</div> : null}\r\n                Users must re-login after assignment to refresh their token.\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n            {/* Permissions editor for the selected user */}\r\n            <div className=\"card\">\r\n              <div style={{ fontWeight: 700, marginBottom: 8 }}>Permissions</div>\r\n              {/* Only render the editor when a user is selected */}\r\n              {!selectedUser ? (\r\n                <div className=\"small\">Select a user above to edit permissions.</div>\r\n              ) : permissionsLoading ? (\r\n                <div className=\"small\">Loading permissions...</div>\r\n              ) : (\r\n                <>\r\n                  {/* Role selector for admin to change the user's role */}\r\n                  <div style={{ marginBottom: 8 }}>\r\n                    <label className=\"small\" style={{ marginRight: 8 }}>Role:</label>\r\n                    <select\r\n                      className=\"input sm\"\r\n                      value={selectedUser?.role || \"user\"}\r\n                      onChange={(e) => updateSelectedUserRole(e.target.value)}\r\n                      disabled={roleUpdating}\r\n                    >\r\n                      {roleOptions.map((opt) => (\r\n                        <option key={opt.value} value={opt.value}>{opt.label}</option>\r\n                      ))}\r\n                    </select>\r\n                  </div>\r\n                  {Object.keys(permissionsGrouped).length === 0 ? (\r\n                    <div className=\"small\">No permissions defined.</div>\r\n                  ) : (\r\n                    Object.entries(permissionsGrouped).map(([groupName, perms]) => (\r\n                      <div key={groupName} style={{ marginBottom: 12 }}>\r\n                        <div style={{ fontWeight: 600, marginBottom: 4 }}>{groupName}</div>\r\n                        {perms.map((perm) => {\r\n                          const key = `${perm.resource}|${perm.action}`;\r\n                          const isSelected = Boolean(permissionSelections[key]);\r\n                          const scopeValue = permissionScopes[key] || \"country\";\r\n                          return (\r\n                            <div key={key} className=\"row\" style={{ alignItems: \"center\", marginBottom: 4 }}>\r\n                              <label className=\"small\" style={{ flexGrow: 1, display: \"flex\", alignItems: \"center\", gap: 6 }}>\r\n                                <input\r\n                                  type=\"checkbox\"\r\n                                  checked={isSelected}\r\n                                  onChange={() => togglePermission(key)}\r\n                                />\r\n                                {perm.label}\r\n                              </label>\r\n                              {/* Scope selector */}\r\n                              <select\r\n                                className=\"input sm\"\r\n                                disabled={!isSelected}\r\n                                value={scopeValue}\r\n                                onChange={(e) => changePermissionScope(key, e.target.value)}\r\n                              >\r\n                                <option value=\"country\">Country</option>\r\n                                {userSchools && userSchools.map((s) => (\r\n                                  <option key={s.id} value={`school:${s.id}`}>\r\n                                    {s.name}\r\n                                  </option>\r\n                                ))}\r\n                              </select>\r\n                            </div>\r\n                          );\r\n                        })}\r\n                      </div>\r\n                    ))\r\n                  )}\r\n                  <div className=\"row\" style={{ marginTop: 8 }}>\r\n                    <button className=\"btn primary\" onClick={saveUserPermissions} disabled={permissionsSaving}>\r\n                      {permissionsSaving ? \"Saving...\" : \"Save Permissions\"}\r\n                    </button>\r\n                  </div>\r\n                </>\r\n              )}\r\n            </div>\r\n\r\n          <div className=\"card\" style={{ marginTop: 12 }}>\r\n            <div className=\"row\" style={{ justifyContent: \"space-between\" }}>\r\n              <div style={{ fontWeight: 700 }}>Users</div>\r\n              <label className=\"small\">\r\n                <input type=\"checkbox\" checked={showUnassigned} onChange={(e) => setShowUnassigned(e.target.checked)} />{\" \"}\r\n                Unassigned only\r\n              </label>\r\n            </div>\r\n            <table className=\"table\" style={{ marginTop: 8 }}>\r\n              <thead>\r\n                <tr>\r\n                  <th>ID</th>\r\n                  <th>Name</th>\r\n                  <th>Email</th>\r\n                  <th>Role</th>\r\n                  <th>Reset</th>\r\n                  <th>Country</th>\r\n                  <th>Region</th>\r\n                  <th>Actions</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody>\r\n                {filteredUsers.length === 0 ? (\r\n                  <tr>\r\n                    <td colSpan=\"8\" className=\"small\">\r\n                      No users found.\r\n                    </td>\r\n                  </tr>\r\n                ) : (\r\n                  filteredUsers.map((u) => (\r\n                    <tr key={u.id}>\r\n                      <td className=\"small\">{u.id}</td>\r\n                      <td>{u.full_name || \"-\"}</td>\r\n                      <td>{u.email}</td>\r\n                      <td className=\"small\">{u.role}</td>\r\n                      <td>{u.must_reset_password ? <span className=\"badge\">Yes</span> : <span className=\"small\">No</span>}</td>\r\n                      <td>\r\n                        {u.country_name ? <span>{u.country_name} ({u.country_code})</span> : <span className=\"badge\">Unassigned</span>}\r\n                      </td>\r\n                      <td>{u.region || \"-\"}</td>\r\n                      <td>\r\n                        <div className=\"row\">\r\n                          <button className=\"btn\" onClick={() => setAssignUserId(String(u.id))}>\r\n                            Edit\r\n                          </button>\r\n                          <button\r\n                            className=\"btn\"\r\n                            onClick={() => resetPasswordForUser(u)}\r\n                            disabled={Boolean(resetLoadingId)}\r\n                          >\r\n                            Reset password\r\n                          </button>\r\n                          <button className=\"btn\" onClick={() => deleteUser(u)}>\r\n                            Delete\r\n                          </button>\r\n                        </div>\r\n                      </td>\r\n                    </tr>\r\n                  ))\r\n                )}\r\n              </tbody>\r\n            </table>\r\n            <div className=\"small\" style={{ marginTop: 8 }}>\r\n              Delete is blocked if the user has created or updated records.\r\n            </div>\r\n          </div>\r\n        </>\r\n      )}\r\n\r\n      {activeTab === \"countries\" && (\r\n        <>\r\n          <div className=\"card\" style={{ marginTop: 12 }}>\r\n            <div style={{ fontWeight: 700, marginBottom: 8 }}>Create Country</div>\r\n            <div className=\"row\">\r\n              <input\r\n                className=\"input\"\r\n                placeholder=\"Country name\"\r\n                value={countryName}\r\n                onChange={(e) => setCountryName(e.target.value)}\r\n              />\r\n              <input\r\n                className=\"input sm\"\r\n                placeholder=\"Code\"\r\n                value={countryCode}\r\n                onChange={(e) => setCountryCode(e.target.value.toUpperCase())}\r\n              />\r\n              <input\r\n                className=\"input\"\r\n                placeholder=\"Region\"\r\n                value={countryRegion}\r\n                onChange={(e) => setCountryRegion(e.target.value)}\r\n              />\r\n              <button className=\"btn primary\" onClick={createCountry} disabled={loading}>\r\n                Create\r\n              </button>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"card\" style={{ marginTop: 12 }}>\r\n            <div style={{ fontWeight: 700, marginBottom: 8 }}>Countries</div>\r\n            <table className=\"table\">\r\n              <thead>\r\n                <tr>\r\n                  <th>ID</th>\r\n                  <th>Name</th>\r\n                  <th>Code</th>\r\n                  <th>Region</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody>\r\n                {countries.length === 0 ? (\r\n                  <tr>\r\n                    <td colSpan=\"4\" className=\"small\">\r\n                      No countries yet.\r\n                    </td>\r\n                  </tr>\r\n                ) : (\r\n                  countries.map((c) => (\r\n                    <tr key={c.id}>\r\n                      <td className=\"small\">{c.id}</td>\r\n                      <td>{c.name}</td>\r\n                      <td className=\"small\">{c.code}</td>\r\n                      <td>{c.region}</td>\r\n                    </tr>\r\n                  ))\r\n                )}\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n\r\n          <div className=\"card\" style={{ marginTop: 12 }}>\r\n            <div style={{ fontWeight: 700, marginBottom: 8 }}>Country Schools</div>\r\n            <div className=\"row\" style={{ marginBottom: 10 }}>\r\n              <select\r\n                className=\"input\"\r\n                value={schoolsCountryId}\r\n                onChange={(e) => setSchoolsCountryId(e.target.value)}\r\n              >\r\n                <option value=\"\">Select a country</option>\r\n                {countries.map((c) => (\r\n                  <option key={c.id} value={c.id}>\r\n                    {c.name}\r\n                  </option>\r\n                ))}\r\n              </select>\r\n              <input\r\n                className=\"input\"\r\n                placeholder=\"Search schools\"\r\n                value={schoolsSearch}\r\n                onChange={(e) => setSchoolsSearch(e.target.value)}\r\n                disabled={!schoolsCountryId}\r\n              />\r\n            </div>\r\n\r\n            <div className=\"row\" style={{ marginBottom: 10 }}>\r\n              <input\r\n                className=\"input\"\r\n                placeholder=\"New school name\"\r\n                value={newSchoolName}\r\n                onChange={(e) => setNewSchoolName(e.target.value)}\r\n                disabled={!schoolsCountryId || schoolCreateBusy}\r\n              />\r\n              <button\r\n                className=\"btn primary\"\r\n                onClick={createCountrySchool}\r\n                disabled={!schoolsCountryId || schoolCreateBusy}\r\n              >\r\n                <span className=\"row\" style={{ gap: 6, alignItems: \"center\" }}>\r\n                  <FaSchool aria-hidden=\"true\" />\r\n                  <span>{schoolCreateLoading ? \"Creating...\" : \"Create\"}</span>\r\n                </span>\r\n              </button>\r\n            </div>\r\n\r\n            <div style={{ marginBottom: 12, paddingTop: 8, borderTop: \"1px solid #eef2f7\" }}>\r\n              <div className=\"small\" style={{ fontWeight: 700, marginBottom: 6 }}>\r\n                Bulk add schools\r\n              </div>\r\n              <div style={{ display: \"grid\", gap: 6 }}>\r\n                {schoolCreateRows.map((row, idx) => (\r\n                  <div key={`school-create-row-${idx}`} className=\"row\">\r\n                    <input\r\n                      className=\"input\"\r\n                      placeholder={`School name #${idx + 1}`}\r\n                      value={row}\r\n                      onChange={(e) => updateSchoolCreateRow(idx, e.target.value)}\r\n                      disabled={!schoolsCountryId || schoolCreateBusy}\r\n                    />\r\n                    <button\r\n                      className=\"btn\"\r\n                      type=\"button\"\r\n                      onClick={() => removeSchoolCreateRow(idx)}\r\n                      disabled={!schoolsCountryId || schoolCreateBusy || schoolCreateRows.length <= 1}\r\n                    >\r\n                      Remove\r\n                    </button>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n              <div className=\"row\" style={{ marginTop: 8 }}>\r\n                <button\r\n                  className=\"btn\"\r\n                  type=\"button\"\r\n                  onClick={addSchoolCreateRow}\r\n                  disabled={!schoolsCountryId || schoolCreateBusy}\r\n                >\r\n                  Add row\r\n                </button>\r\n                <button\r\n                  className=\"btn primary\"\r\n                  type=\"button\"\r\n                  onClick={createCountrySchoolsBulk}\r\n                  disabled={!schoolsCountryId || schoolCreateBusy || bulkCreateCount === 0}\r\n                >\r\n                  <span className=\"row\" style={{ gap: 6, alignItems: \"center\" }}>\r\n                    <FaSchool aria-hidden=\"true\" />\r\n                    <span>\r\n                      {schoolBulkCreateLoading ? \"Creating...\" : `Create ${bulkCreateCount || \"\"}`.trim()}\r\n                    </span>\r\n                  </span>\r\n                </button>\r\n              </div>\r\n              <div className=\"small\" style={{ marginTop: 6, color: \"#6b7280\" }}>\r\n                Add one school per row, then create all at once.\r\n              </div>\r\n            </div>\r\n\r\n            {!selectedSchoolsCountry ? (\r\n              <div className=\"small\">Select a country to manage its schools.</div>\r\n            ) : (\r\n              <table className=\"table\">\r\n                <thead>\r\n                  <tr>\r\n                    <th>Name</th>\r\n                    <th>Status</th>\r\n                    <th>Created At</th>\r\n                    <th>Closed At</th>\r\n                    <th>Principals</th>\r\n                    <th>Actions</th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody>\r\n                  {countrySchoolsLoading ? (\r\n                    <tr>\r\n                      <td colSpan=\"6\" className=\"small\">\r\n                        Loading...\r\n                      </td>\r\n                    </tr>\r\n                  ) : filteredCountrySchools.length === 0 ? (\r\n                    <tr>\r\n                      <td colSpan=\"6\" className=\"small\">\r\n                        No schools found.\r\n                      </td>\r\n                    </tr>\r\n                  ) : (\r\n                    filteredCountrySchools.map((school) => {\r\n                      const statusMeta = getSchoolStatusMeta(school.status);\r\n                      const draftName = schoolNameDrafts[school.id] ?? school.name ?? \"\";\r\n                      const isSaving = schoolSavingId === school.id;\r\n\r\n                      return (\r\n                        <tr key={school.id}>\r\n                          <td>{school.name}</td>\r\n                          <td>\r\n                            <span className={`status-badge ${statusMeta.className}`}>\r\n                              {statusMeta.label}\r\n                            </span>\r\n                          </td>\r\n                          <td className=\"small\">{formatDateTime(school.created_at)}</td>\r\n                          <td className=\"small\">{formatDateTime(school.closed_at)}</td>\r\n                          {/* Principals column: show assigned principal names */}\r\n                          <td>\r\n                            {Array.isArray(principalLists[school.id]) && principalLists[school.id].length > 0 ? (\r\n                              <span>{principalLists[school.id].map((u) => u.full_name || u.email).join(\", \")}</span>\r\n                            ) : (\r\n                              <span className=\"small muted\">-</span>\r\n                            )}\r\n                          </td>\r\n                          <td>\r\n                            {/* School name edit and status toggle */}\r\n                            <div className=\"row\">\r\n                              <input\r\n                                className=\"input sm\"\r\n                                value={draftName}\r\n                                onChange={(e) =>\r\n                                  setSchoolNameDrafts((prev) => ({\r\n                                    ...prev,\r\n                                    [school.id]: e.target.value,\r\n                                  }))\r\n                                }\r\n                                disabled={isSaving}\r\n                              />\r\n                              <button\r\n                                className=\"btn primary\"\r\n                                onClick={() => saveSchoolName(school)}\r\n                                disabled={isSaving}\r\n                              >\r\n                                Save\r\n                              </button>\r\n                              <button\r\n                                className=\"btn\"\r\n                                onClick={() => toggleSchoolStatus(school)}\r\n                                disabled={isSaving}\r\n                              >\r\n                                {school.status === \"closed\" ? \"Reopen\" : \"Close\"}\r\n                              </button>\r\n                            </div>\r\n                            {/* Principal assignment editor */}\r\n                            <div className=\"row\" style={{ marginTop: 4 }}>\r\n                              <select\r\n                                multiple\r\n                                className=\"input sm\"\r\n                                value={(principalDrafts[school.id] || []).map(String)}\r\n                                onChange={(e) => {\r\n                                  const opts = Array.from(e.target.selectedOptions || []);\r\n                                  const values = opts.map((o) => o.value);\r\n                                  handlePrincipalSelectionChange(school.id, values);\r\n                                }}\r\n                              >\r\n                                {users\r\n                                  .filter((u) => u.role === \"principal\")\r\n                                  .map((u) => (\r\n                                    <option key={u.id} value={u.id}>\r\n                                      {u.email} {u.full_name ? `(${u.full_name})` : \"\"} #{u.id}\r\n                                    </option>\r\n                                  ))}\r\n                              </select>\r\n                              <button\r\n                                className=\"btn\"\r\n                                onClick={() => savePrincipalAssignments(school.id)}\r\n                                disabled={Boolean(principalSaving[school.id])}\r\n                              >\r\n                                {principalSaving[school.id] ? \"Saving...\" : \"Save\"}\r\n                              </button>\r\n                            </div>\r\n                          </td>\r\n                        </tr>\r\n                      );\r\n                    })\r\n                  )}\r\n                </tbody>\r\n              </table>\r\n            )}\r\n          </div>\r\n        </>\r\n      )}\r\n\r\n      {activeTab === \"progress\" && (\r\n        <div style={{ marginTop: 12 }}>\r\n          <div className=\"card\">\r\n            <div className=\"row\" style={{ justifyContent: \"space-between\", alignItems: \"center\" }}>\r\n              <div>\r\n                <div style={{ fontWeight: 700 }}>Progress Tracking</div>\r\n                <div className=\"small\">Configure per-field requirements by country.</div>\r\n              </div>\r\n              <div className=\"row\">\r\n                <select\r\n                  className=\"input sm\"\r\n                  value={progressCountryId}\r\n                  onChange={(e) => setProgressCountryId(e.target.value)}\r\n                >\r\n                  <option value=\"\">Select country</option>\r\n                  {countries.map((c) => (\r\n                    <option key={c.id} value={c.id}>\r\n                      {c.name}\r\n                    </option>\r\n                  ))}\r\n                </select>\r\n                <input\r\n                  className=\"input sm\"\r\n                  placeholder=\"Search fields\"\r\n                  value={progressSearch}\r\n                  onChange={(e) => setProgressSearch(e.target.value)}\r\n                />\r\n                <button\r\n                  className=\"btn primary\"\r\n                  onClick={saveProgressConfig}\r\n                  disabled={!progressCountryId || progressSaving || progressLoading}\r\n                >\r\n                  {progressSaving ? \"Saving...\" : \"Save\"}\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"card\" style={{ marginTop: 12 }}>\r\n            <div style={{ fontWeight: 700, marginBottom: 8 }}>Apply to multiple countries</div>\r\n            <div className=\"row\" style={{ alignItems: \"center\", flexWrap: \"wrap\", marginBottom: 10 }}>\r\n              <input\r\n                className=\"input sm\"\r\n                placeholder=\"Search countries\"\r\n                value={progressCountryListSearch}\r\n                onChange={(e) => setProgressCountryListSearch(e.target.value)}\r\n              />\r\n              <button\r\n                className=\"btn\"\r\n                onClick={selectAllTargets}\r\n                disabled={filteredCountriesForApply.length === 0 || progressBulkSaving}\r\n              >\r\n                Select all\r\n              </button>\r\n              <button\r\n                className=\"btn\"\r\n                onClick={clearTargets}\r\n                disabled={progressTargetCount === 0 || progressBulkSaving}\r\n              >\r\n                Clear\r\n              </button>\r\n              <button\r\n                className=\"btn primary\"\r\n                onClick={applyProgressConfigToSelectedCountries}\r\n                disabled={progressBulkDisabled}\r\n              >\r\n                {progressBulkSaving ? \"Applying...\" : `Apply to Selected (${progressTargetCount})`}\r\n              </button>\r\n            </div>\r\n\r\n            <div\r\n              style={{\r\n                border: \"1px solid #e5e7eb\",\r\n                borderRadius: 10,\r\n                padding: 10,\r\n                background: \"#fff\",\r\n                maxHeight: 240,\r\n                overflowY: \"auto\",\r\n              }}\r\n            >\r\n              {filteredCountriesForApply.length === 0 ? (\r\n                <div className=\"small\">No countries found.</div>\r\n              ) : (\r\n                filteredCountriesForApply.map((country) => {\r\n                  const id = Number(country.id);\r\n                  const checked = progressTargetIds.has(id);\r\n                  return (\r\n                    <label\r\n                      key={country.id}\r\n                      style={{ display: \"flex\", gap: 8, alignItems: \"center\", padding: \"6px 0\" }}\r\n                    >\r\n                      <input\r\n                        type=\"checkbox\"\r\n                        checked={checked}\r\n                        onChange={() => toggleTargetCountry(id)}\r\n                      />\r\n                      <span>{country.name || \"-\"}</span>\r\n                    </label>\r\n                  );\r\n                })\r\n              )}\r\n            </div>\r\n          </div>\r\n\r\n          {!progressCountryId ? (\r\n            <div className=\"card\" style={{ marginTop: 12 }}>\r\n              <div className=\"small\">Select a country to edit progress rules.</div>\r\n            </div>\r\n          ) : (\r\n            <div className=\"card\" style={{ marginTop: 12 }}>\r\n              {progressLoading ? (\r\n                <div className=\"small\">Loading...</div>\r\n              ) : (\r\n                <div style={{ display: \"grid\", gap: 12 }}>\r\n                  {progressCatalog.tabs.map((tab) => {\r\n                    const tabSections = progressCatalog.sections.filter((s) => s.tabKey === tab.key);\r\n                    const visibleSections = tabSections.filter((section) => {\r\n                      if (!progressSearchValue) return true;\r\n                      const sectionMatch = String(section.label || \"\").toLowerCase().includes(progressSearchValue);\r\n                      const fields = (section.fields || [])\r\n                        .map((id) => progressCatalog.fieldsById[id])\r\n                        .filter(Boolean);\r\n                      const fieldMatch = fields.some((f) => {\r\n                        const label = String(f.label || \"\").toLowerCase();\r\n                        const id = String(f.id || \"\").toLowerCase();\r\n                        return label.includes(progressSearchValue) || id.includes(progressSearchValue);\r\n                      });\r\n                      return sectionMatch || fieldMatch;\r\n                    });\r\n\r\n                    if (!visibleSections.length) return null;\r\n                    const tabExpanded = expandedProgressTabs.has(tab.key) || Boolean(progressSearchValue);\r\n\r\n                    return (\r\n                      <div key={tab.key} style={{ border: \"1px solid #e5e7eb\", borderRadius: 10, padding: 10 }}>\r\n                        <div className=\"row\" style={{ justifyContent: \"space-between\" }}>\r\n                          <div className=\"row\">\r\n                            <button\r\n                              type=\"button\"\r\n                              className=\"btn\"\r\n                              onClick={() => toggleProgressTab(tab.key)}\r\n                            >\r\n                              {tabExpanded ? \"-\" : \"+\"}\r\n                            </button>\r\n                            <div style={{ fontWeight: 700 }}>{tab.label}</div>\r\n                          </div>\r\n                          <div className=\"small\">{tabSections.length} sections</div>\r\n                        </div>\r\n\r\n                        {tabExpanded ? (\r\n                          <div style={{ display: \"grid\", gap: 10, marginTop: 10 }}>\r\n                            {visibleSections.map((section) => {\r\n                              const sectionConfig = progressConfigNormalized.sections?.[section.id] || {};\r\n                              const sectionEnabled = sectionConfig.enabled !== false;\r\n                              const sectionMode = String(sectionConfig.mode || section.modeDefault || \"ALL\").toUpperCase();\r\n                              const sectionMin =\r\n                                Number.isFinite(Number(sectionConfig.min)) && Number(sectionConfig.min) > 0\r\n                                  ? Number(sectionConfig.min)\r\n                                  : section.minDefault || 1;\r\n\r\n                              const allFields = (section.fields || [])\r\n                                .map((id) => progressCatalog.fieldsById[id])\r\n                                .filter(Boolean);\r\n                              const filteredFields = progressSearchValue\r\n                                ? allFields.filter((field) => {\r\n                                  const label = String(field.label || \"\").toLowerCase();\r\n                                  const id = String(field.id || \"\").toLowerCase();\r\n                                  return label.includes(progressSearchValue) || id.includes(progressSearchValue);\r\n                                })\r\n                                : allFields;\r\n\r\n                              if (!filteredFields.length && progressSearchValue) return null;\r\n\r\n                              const sectionExpanded = expandedProgressSections.has(section.id) || Boolean(progressSearchValue);\r\n                              const fieldIdsForBulk = (progressSearchValue ? filteredFields : allFields).map((f) => f.id);\r\n                              const selectedCount = allFields.filter(\r\n                                (field) => sectionConfig.selectedFields?.[field.id] !== false\r\n                              ).length;\r\n                              const totalCount = allFields.length;\r\n                              const showOnlySelected = Boolean(showOnlySelectedBySection[section.id]);\r\n                              const visibleFields = showOnlySelected\r\n                                ? filteredFields.filter((field) => sectionConfig.selectedFields?.[field.id] !== false)\r\n                                : filteredFields;\r\n                              const minValue = sectionMode === \"MIN\" ? sectionMin : null;\r\n                              const minTooHigh = sectionMode === \"MIN\" && minValue > selectedCount;\r\n                              const ruleSummary =\r\n                                sectionMode === \"ALL\"\r\n                                  ? ` Rule: Must complete ALL selected fields (${selectedCount} selected)`\r\n                                  : minTooHigh\r\n                                    ? ` MIN (${minValue}) is greater than selected (${selectedCount}). It will behave like ALL.`\r\n                                    : ` Rule: Must complete AT LEAST ${minValue} of ${selectedCount} selected fields`;\r\n                              const requiredCount = sectionMode === \"MIN\" ? minValue : selectedCount;\r\n\r\n                              return (\r\n                                <div key={section.id} style={{ borderTop: \"1px solid #eef2f7\", paddingTop: 10 }}>\r\n                                  <div className=\"row\" style={{ justifyContent: \"space-between\", alignItems: \"center\" }}>\r\n                                    <div className=\"row\">\r\n                                      <button\r\n                                        type=\"button\"\r\n                                        className=\"btn\"\r\n                                        onClick={() => toggleProgressSection(section.id)}\r\n                                      >\r\n                                        {sectionExpanded ? \"-\" : \"+\"}\r\n                                      </button>\r\n                                      <div style={{ fontWeight: 700 }}>{section.label}</div>\r\n                                      <span className={`status-badge ${sectionEnabled ? \"is-ok\" : \"is-muted\"}`}>\r\n                                        {sectionEnabled ? \"Enabled\" : \"Disabled\"}\r\n                                      </span>\r\n                                      <span className=\"small\">\r\n                                        {selectedCount}/{allFields.length || 0} selected\r\n                                      </span>\r\n                                    </div>\r\n\r\n                                    <div className=\"row\">\r\n                                      <label className=\"small\">\r\n                                        <input\r\n                                          type=\"checkbox\"\r\n                                          checked={showOnlySelected}\r\n                                          onChange={() =>\r\n                                            setShowOnlySelectedBySection((prev) => ({\r\n                                              ...prev,\r\n                                              [section.id]: !prev?.[section.id],\r\n                                            }))\r\n                                          }\r\n                                        />{\" \"}\r\n                                        Show only selected\r\n                                      </label>\r\n                                      <label className=\"small\">\r\n                                        <input\r\n                                          type=\"checkbox\"\r\n                                          checked={sectionEnabled}\r\n                                          onChange={(e) => setProgressSectionEnabled(section.id, e.target.checked)}\r\n                                        />{\" \"}\r\n                                        Enabled\r\n                                      </label>\r\n                                      <select\r\n                                        className=\"input xs\"\r\n                                        value={sectionMode}\r\n                                        onChange={(e) => setProgressSectionMode(section.id, e.target.value)}\r\n                                      >\r\n                                        <option value=\"ALL\">ALL</option>\r\n                                        <option value=\"MIN\">MIN</option>\r\n                                      </select>\r\n                                      {sectionMode === \"MIN\" ? (\r\n                                        <input\r\n                                          className=\"input xs\"\r\n                                          type=\"number\"\r\n                                          min=\"1\"\r\n                                          value={sectionMin}\r\n                                          onChange={(e) => setProgressSectionMin(section.id, e.target.value)}\r\n                                        />\r\n                                      ) : null}\r\n                                      <button\r\n                                        className=\"btn\"\r\n                                        onClick={() => selectAllSectionFields(section.id, fieldIdsForBulk)}\r\n                                        disabled={!fieldIdsForBulk.length}\r\n                                      >\r\n                                        Select all\r\n                                      </button>\r\n                                      <button\r\n                                        className=\"btn\"\r\n                                        onClick={() => unselectAllSectionFields(section.id, fieldIdsForBulk)}\r\n                                        disabled={!fieldIdsForBulk.length}\r\n                                      >\r\n                                        Unselect all\r\n                                      </button>\r\n                                    </div>\r\n                                  </div>\r\n                                  <div className=\"small\" style={{ marginTop: 6 }}>\r\n                                    {ruleSummary}\r\n                                  </div>\r\n                                  <div className=\"small\" style={{ marginTop: 4, color: \"#6b7280\" }}>\r\n                                    Selected: {selectedCount}/{totalCount}  Mode: {sectionMode}  Required: {requiredCount}\r\n                                  </div>\r\n\r\n                                  {sectionExpanded ? (\r\n                                    <div style={{ marginTop: 8 }}>\r\n                                      {!visibleFields.length ? (\r\n                                        <div className=\"small\">No fields available for this section.</div>\r\n                                      ) : (\r\n                                        <div className=\"grid2\" style={{ gap: 8 }}>\r\n                                          {visibleFields.map((field) => {\r\n                                            const checked = sectionConfig.selectedFields?.[field.id] !== false;\r\n                                            const dynamicHint = getDynamicHint(section.id, field);\r\n                                            return (\r\n                                              <label\r\n                                                key={field.id}\r\n                                                className=\"small\"\r\n                                                style={{\r\n                                                  display: \"flex\",\r\n                                                  gap: 8,\r\n                                                  alignItems: \"center\",\r\n                                                  justifyContent: \"space-between\",\r\n                                                  width: \"100%\",\r\n                                                }}\r\n                                              >\r\n                                                <span style={{ display: \"inline-flex\", gap: 8, alignItems: \"center\" }}>\r\n                                                  <input\r\n                                                    type=\"checkbox\"\r\n                                                    checked={checked}\r\n                                                    onChange={(e) =>\r\n                                                      setProgressFieldSelected(section.id, field.id, e.target.checked)\r\n                                                    }\r\n                                                    disabled={!sectionEnabled}\r\n                                                  />\r\n                                                  <span>{field.label || field.id}</span>\r\n                                                </span>\r\n                                                {dynamicHint ? (\r\n                                                  <span\r\n                                                    style={{\r\n                                                      padding: \"2px 8px\",\r\n                                                      borderRadius: 999,\r\n                                                      background: \"#eef2f7\",\r\n                                                      color: \"#374151\",\r\n                                                      fontSize: 11,\r\n                                                      lineHeight: 1.4,\r\n                                                      whiteSpace: \"nowrap\",\r\n                                                    }}\r\n                                                  >\r\n                                                    Dynamic: {dynamicHint}\r\n                                                  </span>\r\n                                                ) : null}\r\n                                              </label>\r\n                                            );\r\n                                          })}\r\n                                        </div>\r\n                                      )}\r\n                                    </div>\r\n                                  ) : null}\r\n                                </div>\r\n                              );\r\n                            })}\r\n                          </div>\r\n                        ) : null}\r\n                      </div>\r\n                    );\r\n                  })}\r\n                </div>\r\n              )}\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n\r\n      {activeTab === \"approvals\" && (\n        <div className=\"card\" style={{ marginTop: 12 }}>\n          <div className=\"row\" style={{ justifyContent: \"space-between\", alignItems: \"center\", gap: 12 }}>\n            <div>\n              <div style={{ fontWeight: 700 }}>alma Listeleri</div>\n              <div className=\"small\">\n                {approvalsView === \"batches\"\n                  ? \"Review country approval batches.\"\n                  : \"Review submitted scenarios and approve for rollups.\"}\n              </div>\n            </div>\n            <div className=\"row\" style={{ gap: 8 }}>\n              <button\n                className={`btn ${approvalsView === \"scenarios\" ? \"primary\" : \"\"}`}\n                onClick={() => setApprovalsView(\"scenarios\")}\n              >\n                Senaryolar\n              </button>\n              <button\n                className={`btn ${approvalsView === \"batches\" ? \"primary\" : \"\"}`}\n                onClick={() => setApprovalsView(\"batches\")}\n              >\n                Ulke Paketleri\n              </button>\n            </div>\n          </div>\n\n          <div className=\"row admin-filter-row\" style={{ marginTop: 10 }}>\n            <select\n              className=\"input sm\"\n              value={queueFilters.status}\n              onChange={(e) => setQueueFilters((prev) => ({ ...prev, status: e.target.value }))}\n            >\n              <option value=\"\">All</option>\n              <option value=\"sent_for_approval\">Sent for approval</option>\n              <option value=\"approved\">Approved</option>\n              <option value=\"revision_requested\">Revision requested</option>\n              <option value=\"draft\">Draft</option>\n            </select>\n            <input\n              className=\"input sm\"\n              placeholder=\"Academic year\"\n              value={queueFilters.academicYear}\n              onChange={(e) => setQueueFilters((prev) => ({ ...prev, academicYear: e.target.value }))}\n            />\n            <select\n              className=\"input sm\"\n              value={queueFilters.region}\n              onChange={(e) => setQueueFilters((prev) => ({ ...prev, region: e.target.value, countryId: \"\" }))}\n            >\n              <option value=\"\">All regions</option>\n              {regionOptions.map((r) => (\n                <option key={r} value={r}>\n                  {r}\n                </option>\n              ))}\n            </select>\n            <select\n              className=\"input sm\"\n              value={queueFilters.countryId}\n              onChange={(e) => setQueueFilters((prev) => ({ ...prev, countryId: e.target.value }))}\n            >\n              <option value=\"\">All countries</option>\n              {queueCountryOptions.map((c) => (\n                <option key={c.id} value={c.id}>\n                  {c.name}\n                </option>\n              ))}\n            </select>\n\n            <button\n              className=\"btn\"\n              onClick={() => (approvalsView === \"batches\" ? loadBatchQueue(queueFilters) : loadQueue(queueFilters))}\n              disabled={approvalsView === \"batches\" ? batchQueueLoading : queueLoading}\n            >\n              Apply\n            </button>\n          </div>\n\n          {approvalsView === \"scenarios\" ? (\n            <table className=\"table admin-approvals-table\" style={{ marginTop: 12 }}>\n              <thead>\n                <tr>\n                  <th aria-sort={ariaSort(\"country_name\")}>\n                    <button\n                      type=\"button\"\n                      onClick={() => toggleQueueSort(\"country_name\")}\n                      style={{\n                        display: \"inline-flex\",\n                        alignItems: \"center\",\n                        gap: 6,\n                        background: \"none\",\n                        border: \"none\",\n                        padding: 0,\n                        cursor: \"pointer\",\n                        font: \"inherit\",\n                      }}\n                      title=\"Sort\"\n                    >\n                      lke <span aria-hidden>{sortIndicator(\"country_name\")}</span>\n                    </button>\n                  </th>\n                  <th aria-sort={ariaSort(\"school_name\")}>\n                    <button\n                      type=\"button\"\n                      onClick={() => toggleQueueSort(\"school_name\")}\n                      style={{\n                        display: \"inline-flex\",\n                        alignItems: \"center\",\n                        gap: 6,\n                        background: \"none\",\n                        border: \"none\",\n                        padding: 0,\n                        cursor: \"pointer\",\n                        font: \"inherit\",\n                      }}\n                      title=\"Sort\"\n                    >\n                      School <span aria-hidden>{sortIndicator(\"school_name\")}</span>\n                    </button>\n                  </th>\n                  <th aria-sort={ariaSort(\"scenario_name\")}>\n                    <button\n                      type=\"button\"\n                      onClick={() => toggleQueueSort(\"scenario_name\")}\n                      style={{\n                        display: \"inline-flex\",\n                        alignItems: \"center\",\n                        gap: 6,\n                        background: \"none\",\n                        border: \"none\",\n                        padding: 0,\n                        cursor: \"pointer\",\n                        font: \"inherit\",\n                      }}\n                      title=\"Sort\"\n                    >\n                      Scenario <span aria-hidden>{sortIndicator(\"scenario_name\")}</span>\n                    </button>\n                  </th>\n                  <th aria-sort={ariaSort(\"academic_year\")}>\n                    <button\n                      type=\"button\"\n                      onClick={() => toggleQueueSort(\"academic_year\")}\n                      style={{\n                        display: \"inline-flex\",\n                        alignItems: \"center\",\n                        gap: 6,\n                        background: \"none\",\n                        border: \"none\",\n                        padding: 0,\n                        cursor: \"pointer\",\n                        font: \"inherit\",\n                      }}\n                      title=\"Sort\"\n                    >\n                      Academic Year <span aria-hidden>{sortIndicator(\"academic_year\")}</span>\n                    </button>\n                  </th>\n                  <th aria-sort={ariaSort(\"submitted_at\")}>\n                    <button\n                      type=\"button\"\n                      onClick={() => toggleQueueSort(\"submitted_at\")}\n                      style={{\n                        display: \"inline-flex\",\n                        alignItems: \"center\",\n                        gap: 6,\n                        background: \"none\",\n                        border: \"none\",\n                        padding: 0,\n                        cursor: \"pointer\",\n                        font: \"inherit\",\n                      }}\n                      title=\"Sort\"\n                    >\n                      Submitted <span aria-hidden>{sortIndicator(\"submitted_at\")}</span>\n                    </button>\n                  </th>\n                  <th aria-sort={ariaSort(\"status\")}>\n                    <button\n                      type=\"button\"\n                      onClick={() => toggleQueueSort(\"status\")}\n                      style={{\n                        display: \"inline-flex\",\n                        alignItems: \"center\",\n                        gap: 6,\n                        background: \"none\",\n                        border: \"none\",\n                        padding: 0,\n                        cursor: \"pointer\",\n                        font: \"inherit\",\n                      }}\n                      title=\"Sort\"\n                    >\n                      Status <span aria-hidden>{sortIndicator(\"status\")}</span>\n                    </button>\n                  </th>\n                  <th>Progress</th>\n                  <th>Y1 KPIs</th>\n                  <th>Y2 KPIs</th>\n                  <th>Y3 KPIs</th>\n                  <th>Actions</th>\n                </tr>\n              </thead>\n              <tbody>\n                {queueLoading ? (\n                  <tr>\n                    <td colSpan=\"11\" className=\"small\">\n                      Loading...\n                    </td>\n                  </tr>\n                ) : sortedQueueRows.length === 0 ? (\n                  <tr>\n                    <td colSpan=\"11\" className=\"small\">\n                      No scenarios found.\n                    </td>\n                  </tr>\n                ) : (\n                  sortedQueueRows.map((row) => {\n                    const statusMeta = getStatusMeta(row.scenario);\n                    const canApprove =\n                      row.scenario?.status === 'sent_for_approval' || row.scenario?.status === 'submitted';\n                    const canRevise = ['sent_for_approval', 'approved', 'submitted'].includes(row.scenario?.status);\n                    const missing = row.missingKpis?.y1 || row.missingKpis?.y2 || row.missingKpis?.y3;\n                    const progressPct = Number.isFinite(Number(row.scenario?.progress_pct))\n                      ? Math.round(Number(row.scenario.progress_pct))\n                      : null;\n                    const progressMissingCount = Number(row.scenario?.progress_missing_count || 0);\n                    const progressMissingPreview = row.scenario?.progress_missing_preview;\n                    const progressTooltipLines =\n                      progressPct == null\n                        ? []\n                        : progressMissingCount > 0\n                          ? [\"Eksik:\", progressMissingPreview || \"Eksik alanlar\"]\n                          : [\"Tum tablar tamamlandi\"];\n\n                    return (\n                      <tr key={row.scenario?.id || `${row.school?.id}-${row.scenario?.name}`}>\n                        <td>\n                          <div style={{ fontWeight: 700 }}>{row.country?.name || \"-\"}</div>\n                          {row.country?.region ? <div className=\"small\">{row.country.region}</div> : null}\n                        </td>\n                        <td>\n                          <div style={{ fontWeight: 700 }}>{row.school?.name || \"-\"}</div>\n                        </td>\n                        <td>\n                          <div>{row.scenario?.name || \"-\"}</div>\n                          {missing ? <span className=\"status-badge is-bad\">Missing KPIs</span> : null}\n                        </td>\n                        <td className=\"small\">{row.scenario?.academic_year || \"-\"}</td>\n                        <td className=\"small\">{formatDateTime(row.scenario?.submitted_at)}</td>\n                        <td>\n                          <span className={`status-badge ${statusMeta.className}`}>{statusMeta.label}</span>\n                        </td>\n                        <td>\n                          {progressPct == null ? (\n                            <span className=\"small\">-</span>\n                          ) : (\n                            <Tooltip lines={progressTooltipLines}>\n                              <span className=\"badge\">{progressPct}%</span>\n                            </Tooltip>\n                          )}\n                        </td>\n                        <td>{renderQueueKpis(row.kpis?.y1)}</td>\n                        <td>{renderQueueKpis(row.kpis?.y2)}</td>\n                        <td>{renderQueueKpis(row.kpis?.y3)}</td>\n                        <td>\n                          <div className=\"row\">\n                            <button\n                              className=\"btn primary\"\n                              onClick={() => openReviewModal(row, \"approve\")}\n                              disabled={!canApprove || reviewSaving}\n                            >\n                              Onayla\n                            </button>\n                            <button\n                              className=\"btn\"\n                              onClick={() => openReviewModal(row, \"revise\")}\n                              disabled={!canRevise || reviewSaving}\n                            >\n                              Revizyon ste\n                            </button>\n                          </div>\n                        </td>\n                      </tr>\n                    );\n                  })\n                )}\n              </tbody>\n            </table>\n          ) : (\n            <table className=\"table admin-approvals-table\" style={{ marginTop: 12 }}>\n              <thead>\n                <tr>\n                  <th>lke</th>\n                  <th>Akademik Yl</th>\n                  <th>Durum</th>\n                  <th>Oluturma</th>\n                  <th>nceleme</th>\n                  <th>Senaryo</th>\n                  <th>Okul</th>\n                  <th>lem</th>\n                </tr>\n              </thead>\n              <tbody>\n                {batchQueueLoading ? (\n                  <tr>\n                    <td colSpan=\"8\" className=\"small\">Loading...</td>\n                  </tr>\n                ) : batchQueueRows.length === 0 ? (\n                  <tr>\n                    <td colSpan=\"8\" className=\"small\">No batches found.</td>\n                  </tr>\n                ) : (\n                  batchQueueRows.map((row) => {\n                    const statusMeta = getBatchStatusMeta(row.status);\n                    const canApprove = row.status === \"sent_for_approval\";\n                    const canRevise = [\"sent_for_approval\", \"approved\"].includes(row.status);\n                    return (\n                      <tr key={row.batch_id}>\n                        <td>\n                          <div style={{ fontWeight: 700 }}>{row.country?.name || \"-\"}</div>\n                          {row.country?.region ? <div className=\"small\">{row.country.region}</div> : null}\n                        </td>\n                        <td className=\"small\">{row.academic_year || \"-\"}</td>\n                        <td>\n                          <span className={`status-badge ${statusMeta.className}`}>{statusMeta.label}</span>\n                        </td>\n                        <td className=\"small\">{formatDateTime(row.created_at)}</td>\n                        <td className=\"small\">{formatDateTime(row.reviewed_at)}</td>\n                        <td className=\"small\">{row.scenario_count}</td>\n                        <td className=\"small\">{row.school_count}</td>\n                        <td>\n                          <div className=\"row\">\n                            <button className=\"btn\" onClick={() => openBatchReviewModal(row, \"approve\")} disabled={!canApprove || batchReviewSaving}>\n                              Onayla\n                            </button>\n                            <button className=\"btn\" onClick={() => openBatchReviewModal(row, \"revise\")} disabled={!canRevise || batchReviewSaving}>\n                              Revizyon ste\n                            </button>\n                          </div>\n                        </td>\n                      </tr>\n                    );\n                  })\n                )}\n              </tbody>\n            </table>\n          )}\n        </div>\n      )}\n\r\n      {activeTab === \"reports\" && (\r\n        <div style={{ marginTop: 12 }}>\r\n          <div className=\"card\">\r\n            <div className=\"row\" style={{ justifyContent: \"space-between\" }}>\r\n              <div>\r\n                <div style={{ fontWeight: 700 }}>Rollup Reports</div>\r\n                <div className=\"small\">Approved scenarios only. Select an academic year.</div>\r\n              </div>\r\n              <div className=\"row\">\r\n                <input\r\n                  className=\"input sm\"\r\n                  placeholder=\"Academic year\"\r\n                  value={rollupYear}\r\n                  onChange={(e) => setRollupYear(e.target.value)}\r\n                />\r\n                <button className=\"btn\" onClick={() => loadRollup(rollupYear)} disabled={rollupLoading}>\r\n                  {rollupLoading ? \"Loading...\" : \"Load\"}\r\n                </button>\r\n\r\n                <div className=\"action-menu\" ref={rollupExportRef}>\r\n                  <button\r\n                    type=\"button\"\r\n                    className=\"btn\"\r\n                    onClick={() => {\r\n                      if (rollupExportDisabled) return;\r\n                      setRollupExportOpen((prev) => !prev);\r\n                    }}\r\n                    disabled={rollupExportDisabled}\r\n                    aria-haspopup=\"menu\"\r\n                    aria-expanded={rollupExportOpen}\r\n                  >\r\n                    Export\r\n                  </button>\r\n                  {rollupExportOpen ? (\r\n                    <div className=\"action-menu-panel\" role=\"menu\">\r\n                      <button\r\n                        type=\"button\"\r\n                        className=\"action-menu-item\"\r\n                        onClick={() => {\r\n                          setRollupExportOpen(false);\r\n                          if (!rollupXlsxReady) return;\r\n                          const url = api.adminExportRollupXlsxUrl(rollupYear.trim());\r\n                          window.location.assign(url);\r\n                        }}\r\n                        disabled={!rollupXlsxReady}\r\n                        title={rollupXlsxReady ? \"Download Excel\" : \"Excel export coming soon\"}\r\n                        role=\"menuitem\"\r\n                      >\r\n                        Excel (.xlsx){rollupXlsxReady ? \"\" : \" (coming soon)\"}\r\n                      </button>\r\n                      <button type=\"button\" className=\"action-menu-item\" disabled role=\"menuitem\">\r\n                        PDF (coming soon)\r\n                      </button>\r\n                    </div>\r\n                  ) : null}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {rollupData ? (\r\n            <>\r\n              <div className=\"card\" style={{ marginTop: 12 }}>\r\n                <div style={{ fontWeight: 700 }}>Consolidated KPIs</div>\r\n                <div className=\"admin-kpi-strip\" style={{ marginTop: 10 }}>\r\n                  {YEAR_KEYS.map((key) => (\r\n                    <div key={key} className=\"admin-kpi-year\">\r\n                      <div className=\"admin-kpi-year-title\">{key.toUpperCase()}</div>\r\n                      <div className=\"admin-kpi-grid\">\r\n                        <div className=\"admin-kpi\">\r\n                          <div className=\"admin-kpi-label\">Net ciro</div>\r\n                          <div className=\"admin-kpi-value\">{fmt(rollupData.totals?.[key]?.net_ciro)}</div>\r\n                        </div>\r\n                        <div className=\"admin-kpi\">\r\n                          <div className=\"admin-kpi-label\">Net income</div>\r\n                          <div className=\"admin-kpi-value\">{fmt(rollupData.totals?.[key]?.net_income)}</div>\r\n                        </div>\r\n                        <div className=\"admin-kpi\">\r\n                          <div className=\"admin-kpi-label\">Expenses</div>\r\n                          <div className=\"admin-kpi-value\">{fmt(rollupData.totals?.[key]?.total_expenses)}</div>\r\n                        </div>\r\n                        <div className=\"admin-kpi\">\r\n                          <div className=\"admin-kpi-label\">Net result</div>\r\n                          <div className=\"admin-kpi-value\">{fmt(rollupData.totals?.[key]?.net_result)}</div>\r\n                        </div>\r\n                        <div className=\"admin-kpi\">\r\n                          <div className=\"admin-kpi-label\">Margin</div>\r\n                          <div className=\"admin-kpi-value\">{fmtPct(rollupData.totals?.[key]?.profitMargin)}</div>\r\n                        </div>\r\n                        <div className=\"admin-kpi\">\r\n                          <div className=\"admin-kpi-label\">Students</div>\r\n                          <div className=\"admin-kpi-value\">{fmt(rollupData.totals?.[key]?.students_total)}</div>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"card\" style={{ marginTop: 12 }}>\r\n                <div style={{ fontWeight: 700 }}>Rollup Tree</div>\r\n                <div className=\"small\" style={{ marginTop: 4 }}>\r\n                  Only approved scenarios are consolidated. Excluded years show as blank.\r\n                </div>\r\n\r\n                <div className=\"rollup-table-wrap\" style={{ marginTop: 10 }}>\r\n                  <table className=\"table rollup-table\">\r\n                    <thead>\r\n                      <tr>\r\n                        <th style={{ minWidth: 220 }}>Unit</th>\r\n                        <th style={{ minWidth: 220 }}>Y1</th>\r\n                        <th style={{ minWidth: 220 }}>Y2</th>\r\n                        <th style={{ minWidth: 220 }}>Y3</th>\r\n                      </tr>\r\n                    </thead>\r\n                    <tbody>\r\n                      <tr className=\"rollup-row rollup-total\">\r\n                        <td className=\"rollup-name\">Totals</td>\r\n                        <td>{renderYearCell(rollupData.totals?.y1)}</td>\r\n                        <td>{renderYearCell(rollupData.totals?.y2)}</td>\r\n                        <td>{renderYearCell(rollupData.totals?.y3)}</td>\r\n                      </tr>\r\n\r\n                      {rollupData.regions?.map((region) => {\r\n                        const regionKey = region.region || \"Unknown\";\r\n                        const regionExpanded = expandedRegions.has(regionKey);\r\n                        return (\r\n                          <React.Fragment key={`region-${regionKey}`}>\r\n                            <tr className=\"rollup-row rollup-region\">\r\n                              <td className=\"rollup-name\">\r\n                                <button\r\n                                  type=\"button\"\r\n                                  className=\"tree-toggle\"\r\n                                  onClick={() => toggleRegion(regionKey)}\r\n                                  aria-label=\"Toggle region\"\r\n                                >\r\n                                  {regionExpanded ? \"-\" : \"+\"}\r\n                                </button>\r\n                                <span className=\"rollup-title\">{region.region || \"Unknown region\"}</span>\r\n                              </td>\r\n                              <td>{renderYearCell(region.years?.y1)}</td>\r\n                              <td>{renderYearCell(region.years?.y2)}</td>\r\n                              <td>{renderYearCell(region.years?.y3)}</td>\r\n                            </tr>\r\n\r\n                            {regionExpanded\r\n                              ? region.countries?.map((country) => {\r\n                                const countryKey = `${regionKey}::${country.id}`;\r\n                                const countryExpanded = expandedCountries.has(countryKey);\r\n                                return (\r\n                                  <React.Fragment key={countryKey}>\r\n                                    <tr className=\"rollup-row rollup-country\">\r\n                                      <td className=\"rollup-name level-1\">\r\n                                        <button\r\n                                          type=\"button\"\r\n                                          className=\"tree-toggle\"\r\n                                          onClick={() => toggleCountry(regionKey, country.id)}\r\n                                          aria-label=\"Toggle country\"\r\n                                        >\r\n                                          {countryExpanded ? \"-\" : \"+\"}\r\n                                        </button>\r\n                                        <span className=\"rollup-title\">{country.name}</span>\r\n                                      </td>\r\n                                      <td>{renderYearCell(country.years?.y1)}</td>\r\n                                      <td>{renderYearCell(country.years?.y2)}</td>\r\n                                      <td>{renderYearCell(country.years?.y3)}</td>\r\n                                    </tr>\r\n\r\n                                    {countryExpanded\r\n                                      ? country.schools?.map((school) => (\r\n                                        <tr key={`school-${school.id}`} className=\"rollup-row rollup-school\">\r\n                                          <td className=\"rollup-name level-2\">\r\n                                            {school.name}\r\n                                            {school.included_years?.length ? (\r\n                                              <span className=\"rollup-sub\">({school.included_years.join(\", \")})</span>\r\n                                            ) : null}\r\n                                          </td>\r\n                                          <td>{renderYearCell(school.years?.y1)}</td>\r\n                                          <td>{renderYearCell(school.years?.y2)}</td>\r\n                                          <td>{renderYearCell(school.years?.y3)}</td>\r\n                                        </tr>\r\n                                      ))\r\n                                      : null}\r\n                                  </React.Fragment>\r\n                                );\r\n                              })\r\n                              : null}\r\n                          </React.Fragment>\r\n                        );\r\n                      })}\r\n                    </tbody>\r\n                  </table>\r\n                </div>\r\n              </div>\r\n\r\n              {rollupData.missingNoApproved?.length ? (\r\n                <div className=\"card admin-alert\" style={{ marginTop: 12 }}>\r\n                  <div className=\"admin-alert-title\">Schools without an approved scenario</div>\r\n                  <ul>\r\n                    {rollupData.missingNoApproved.map((row) => (\r\n                      <li key={`missing-${row.id}`}>\r\n                        {row.name} ({row.country_name})\r\n                      </li>\r\n                    ))}\r\n                  </ul>\r\n                </div>\r\n              ) : null}\r\n\r\n              {rollupData.missingKpis?.length ? (\r\n                <div className=\"card admin-alert\" style={{ marginTop: 12 }}>\r\n                  <div className=\"admin-alert-title\">Approved scenarios missing KPI snapshots</div>\r\n                  <ul>\r\n                    {rollupData.missingKpis.map((row) => (\r\n                      <li key={`missing-kpi-${row.scenario_id}`}>\r\n                        Scenario #{row.scenario_id} (School #{row.school_id}) - missing {row.missingYears.join(\", \")}\r\n                      </li>\r\n                    ))}\r\n                  </ul>\r\n                </div>\r\n              ) : null}\r\n            </>\r\n          ) : (\r\n            <div className=\"card\" style={{ marginTop: 12 }}>\r\n              <div className=\"small\">Select an academic year to view the rollup report.</div>\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n    </div>\r\n    </>\r\n  );\r\n}\r\n"],"names":["YEAR_KEYS","REQUIRED_WORK_IDS","WORK_ID_LABELS","temel_bilgiler","kapasite","DEFAULT_ADMIN_TAB","_ADMIN_TABS$","ADMIN_TABS","key","isValidAdminTab","value","some","tab","getTabFromSearch","search","URLSearchParams","get","fmt","v","n","Number","isFinite","toLocaleString","undefined","maximumFractionDigits","fmtPct","formatDateTime","d","Date","getTime","SAMPLE_DISCOUNTS","normalizeProgressConfig","config","defaults","DEFAULT_PROGRESS_CONFIG","input","sectionsInput","sections","out","version","Object","keys","forEach","id","base","incoming","enabled","mode","min","selectedFields","AdminPage","_auth$user2","_auth$user4","_batchReviewModal$row2","_reviewModal$row2","_reviewModal$row2$sch","_reviewModal$row3","_reviewModal$row3$sce","_batchReviewModal$row4","_batchReviewModal$row5","_batchReviewModal$row6","_batchDetail$items","_rollupData$totals7","_rollupData$totals8","_rollupData$totals9","_rollupData$regions","_rollupData$missingNo","_rollupData$missingKp","forcedTab","arguments","length","auth","useAuth","outlet","useOutletContext","location","useLocation","normalizedForcedTab","activeTab","setActiveTab","useState","fromSearch","stored","localStorage","getItem","_","useEffect","setItem","countries","setCountries","users","setUsers","loading","setLoading","userUpdateLoading","setUserUpdateLoading","confirmAssign","setConfirmAssign","confirmDelete","setConfirmDelete","confirmReset","setConfirmReset","resetResult","setResetResult","resetLoadingId","setResetLoadingId","countryName","setCountryName","countryCode","setCountryCode","countryRegion","setCountryRegion","newUserName","setNewUserName","newUserEmail","setNewUserEmail","newUserPassword","setNewUserPassword","newUserRole","setNewUserRole","newUserCountryId","setNewUserCountryId","assignUserId","setAssignUserId","assignCountryId","setAssignCountryId","showUnassigned","setShowUnassigned","schoolsCountryId","setSchoolsCountryId","countrySchools","setCountrySchools","countrySchoolsLoading","setCountrySchoolsLoading","schoolsSearch","setSchoolsSearch","newSchoolName","setNewSchoolName","schoolCreateLoading","setSchoolCreateLoading","schoolBulkCreateLoading","setSchoolBulkCreateLoading","schoolCreateRows","setSchoolCreateRows","schoolSavingId","setSchoolSavingId","schoolNameDrafts","setSchoolNameDrafts","progressCountryId","setProgressCountryId","progressConfig","setProgressConfig","progressLoading","setProgressLoading","progressSaving","setProgressSaving","progressSearch","setProgressSearch","progressTargetIds","setProgressTargetIds","Set","progressCountryListSearch","setProgressCountryListSearch","progressBulkSaving","setProgressBulkSaving","showOnlySelectedBySection","setShowOnlySelectedBySection","expandedProgressTabs","setExpandedProgressTabs","expandedProgressSections","setExpandedProgressSections","queueRows","setQueueRows","approvalsView","setApprovalsView","batchQueueRows","setBatchQueueRows","batchQueueLoading","setBatchQueueLoading","batchReviewModal","setBatchReviewModal","batchReviewNote","setBatchReviewNote","batchReviewIncludedYears","setBatchReviewIncludedYears","y1","y2","y3","batchReviewRevisionSelection","setBatchReviewRevisionSelection","initial","batchReviewSaving","setBatchReviewSaving","batchDetail","setBatchDetail","batchDetailLoading","setBatchDetailLoading","permissionsCatalog","setPermissionsCatalog","permissionSelections","setPermissionSelections","permissionScopes","setPermissionScopes","permissionsLoading","setPermissionsLoading","permissionsSaving","setPermissionsSaving","userSchools","setUserSchools","roleOptions","useMemo","label","roleUpdating","setRoleUpdating","principalLists","setPrincipalLists","principalDrafts","setPrincipalDrafts","principalSaving","setPrincipalSaving","queueLoading","setQueueLoading","queueFilters","setQueueFilters","status","academicYear","region","countryId","queueSort","setQueueSort","dir","reviewModal","setReviewModal","reviewNote","setReviewNote","reviewIncludedYears","setReviewIncludedYears","reviewRevisionSelection","setReviewRevisionSelection","selectAllRevisionWork","useCallback","next","clearRevisionWork","reviewSaving","setReviewSaving","selectAllBatchRevisionWork","clearBatchRevisionWork","rollupYear","setRollupYear","rollupData","setRollupData","rollupLoading","setRollupLoading","rollupExportOpen","setRollupExportOpen","rollupExportRef","useRef","expandedRegions","setExpandedRegions","expandedCountries","setExpandedCountries","document","title","setHeaderMeta","subtitle","_outlet$clearHeaderMe","clearHeaderMeta","call","queueFiltersRef","current","selectedUser","find","u","String","selectedCountry","c","selectedSchoolsCountry","Array","isArray","school","list","api","adminGetSchoolPrincipals","prev","_objectSpread","ids","map","e","console","error","userId","country_id","Promise","all","adminGetPermissionsCatalog","adminGetUserPermissions","adminListCountrySchools","resolve","then","_ref","catalogData","userPerms","schoolsData","schoolsList","items","sel","scopeMap","p","concat","resource","action","scope_school_id","catch","toast","message","finally","progressCatalogInputs","discounts","name","ratio","progressCatalog","buildProgressCatalog","inputs","norm","progressConfigNormalized","isSameCountry","currentAssignmentLabel","country_name","country_code","newAssignmentLabel","code","actionLabel","filteredUsers","filter","regionOptions","set","add","from","sort","permissionsGrouped","reduce","acc","perm","grp","group","push","queueCountryOptions","toggleQueueSort","cycles","academic_year","school_name","scenario_name","submitted_at","cycle","i","indexOf","sortIndicator","ariaSort","sortedQueueRows","getValue","row","_row$country","_row$school","_row$scenario","_row$scenario2","_row$scenario3","_row$scenario4","country","scenario","raw","trim","nums","match","a","b","toLowerCase","parseAcademicYear","Infinity","dirMul","cmpStr","localeCompare","sensitivity","decorated","idx","val","A","B","av","bv","_av$a","_bv$a","_av$b","_bv$b","progressSearchValue","filteredCountriesForApply","q","includes","progressTargetCount","size","progressBulkDisabled","filteredCountrySchools","s","schoolCreateBusy","bulkCreateCount","count","load","async","countriesRows","userData","listCountries","listUsers","limit","offset","fields","order","loadCountrySchools","countryIdArg","rows","includeClosed","loadProgressRequirements","data","adminGetProgressRequirements","loadQueue","f","filtersArg","params","adminGetScenarioQueue","loadBatchQueue","adminGetApprovalBatchQueue","loadRollup","academicYearArg","adminGetRollup","adminResetUserPassword","token","k","_window","_window$localStorage","window","_unused","getAuthTokenFromStorage","res","fetch","method","headers","Authorization","body","JSON","stringify","json","_unused2","ok","_data","_data2","msg","details","Error","_auth$user","user","role","_auth$user3","handleClick","event","el","contains","target","handleKey","addEventListener","removeEventListener","regions","regionSet","countrySet","updateProgressSection","sectionId","updater","_next$sections","structuredClone","section","openReviewModal","closeReviewModal","reset","openBatchReviewModal","closeBatchReviewModal","_batchReviewModal$row","batchId","batch_id","adminGetApprovalBatch","renderQueueKpis","kpi","_jsx","className","children","margin","net_ciro","net_result","_jsxs","renderYearCell","year","net_income","total_expenses","profitMargin","students_total","handleRefresh","style","fontWeight","marginTop","Link","to","rollupExportDisabled","refreshDisabled","renderRefreshButton","onClick","disabled","_Fragment","headerPortalEl","createPortal","justifyContent","fontSize","ToastContainer","position","autoClose","newestOnTop","closeOnClick","pauseOnFocusLoss","pauseOnHover","width","padding","textAlign","height","borderRadius","border","borderTopColor","animation","marginBottom","email","currentLabel","nextLabel","assignUserCountry","nextId","success","hadCountry","confirmAssignCountry","deleteUser","confirmDeleteUser","Boolean","full_name","temporary_password","confirmResetPassword","maxWidth","background","alignItems","fontFamily","text","navigator","clipboard","writeText","_unused3","ta","createElement","left","appendChild","select","execCommand","removeChild","_unused4","copyText","display","gap","type","checked","onChange","toUpperCase","flexWrap","minHeight","_reviewModal$row","_reviewModal$row$scen","note","payload","includedYears","revisionWorkIds","adminReviewScenario","item","progress_pct","Math","round","is_source","school_id","scenario_id","_batchReviewModal$row3","adminReviewApprovalBatch","gridTemplateColumns","placeholder","fullName","password","createUser","FaUserPlus","color","marginRight","adminUpdateUserRole","updateSelectedUserRole","opt","entries","_ref2","groupName","perms","isSelected","scopeValue","flexGrow","togglePermission","changePermissionScope","split","scopeVal","scope_country_id","startsWith","idStr","sid","adminSetUserPermissions","permissions","updated","colSpan","must_reset_password","resetPasswordForUser","createCountry","adminCreateCountrySchool","FaSchool","paddingTop","borderTop","updateSchoolCreateRow","index","removeSchoolCreateRow","rawNames","names","errors","created","err","_ref3","_schoolNameDrafts$sch","statusMeta","draftName","isSaving","created_at","closed_at","join","draft","nextName","adminUpdateSchool","saveSchoolName","nextStatus","toggleSchoolStatus","multiple","values","selectedOptions","o","schoolId","valueIds","handlePrincipalSelectionChange","userIds","adminSetSchoolPrincipals","newList","savePrincipalAssignments","saved","adminSaveProgressRequirements","selectAllTargets","clearTargets","uniqueIds","confirm","result","adminBulkSaveProgressRequirements","updatedCount","maxHeight","overflowY","has","delete","toggleTargetCountry","tabs","tabSections","tabKey","visibleSections","sectionMatch","fieldMatch","fieldsById","tabExpanded","toggleProgressTab","_progressConfigNormal","sectionConfig","sectionEnabled","sectionMode","modeDefault","sectionMin","minDefault","allFields","filteredFields","field","sectionExpanded","fieldIdsForBulk","selectedCount","_sectionConfig$select","totalCount","showOnlySelected","visibleFields","_sectionConfig$select2","minValue","minTooHigh","ruleSummary","requiredCount","toggleProgressSection","setProgressSectionEnabled","setProgressSectionMode","setProgressSectionMin","num","max","selectAllSectionFields","fieldIds","unselectAllSectionFields","_sectionConfig$select3","dynamicHint","getDynamicHint","setProgressFieldSelected","fieldId","lineHeight","whiteSpace","r","cursor","font","_row$scenario5","_row$scenario6","_row$scenario7","_row$missingKpis","_row$missingKpis2","_row$missingKpis3","_row$scenario8","_row$scenario9","_row$scenario0","_row$scenario1","_row$school2","_row$scenario10","_row$country2","_row$country3","_row$school3","_row$scenario11","_row$scenario12","_row$scenario13","_row$kpis","_row$kpis2","_row$kpis3","scenarioOrStatus","obj","sentAt","sent_at","getStatusMeta","canApprove","canRevise","missing","missingKpis","progressPct","progressMissingCount","progress_missing_count","progressMissingPreview","progress_missing_preview","progressTooltipLines","Tooltip","lines","kpis","_row$country4","_row$country5","getBatchStatusMeta","reviewed_at","scenario_count","school_count","ref","_rollupData$totals","_rollupData$totals$ke","_rollupData$totals2","_rollupData$totals2$k","_rollupData$totals3","_rollupData$totals3$k","_rollupData$totals4","_rollupData$totals4$k","_rollupData$totals5","_rollupData$totals5$k","_rollupData$totals6","_rollupData$totals6$k","totals","minWidth","_region$years","_region$years2","_region$years3","_region$countries","regionKey","regionExpanded","React","toggleRegion","years","_country$years","_country$years2","_country$years3","_country$schools","countryKey","countryExpanded","toggleCountry","schools","_school$included_year","_school$years","_school$years2","_school$years3","included_years","missingNoApproved","missingYears"],"ignoreList":[],"sourceRoot":""}