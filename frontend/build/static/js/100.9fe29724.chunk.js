"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[100],{4405(e,i,l){l.d(i,{A:()=>n});l(5043);var r=l(579);function n(e){let{text:i,lines:l,children:n,className:a=""}=e;const t=function(e,i){return Array.isArray(e)?e.map(e=>String(e)).filter(e=>e.trim().length>0):"string"===typeof i?i.split("\n").map(e=>e.trim()).filter(Boolean):[]}(l,i);return t.length?(0,r.jsxs)("span",{className:"tooltip-wrap ".concat(a).trim(),children:[n,(0,r.jsx)("span",{className:"tooltip-bubble",role:"tooltip",children:t.map((e,i)=>(0,r.jsx)("div",{className:"tooltip-line",children:e},"".concat(i,"-").concat(e)))})]}):n}},6037(e,i,l){l.d(i,{Ds:()=>d,In:()=>m,VJ:()=>u,aW:()=>o,jc:()=>c,oP:()=>p,qV:()=>y});var r=l(2555);const n=["KG","1","2","3","4","5","6","7","8","9","10","11","12"],a=[{key:"okulOncesi",label:"Okul \xd6ncesi",defaultFrom:"KG",defaultTo:"KG"},{key:"ilkokul",label:"\u0130lkokul",defaultFrom:"1",defaultTo:"5"},{key:"ortaokul",label:"Ortaokul",defaultFrom:"6",defaultTo:"9"},{key:"lise",label:"Lise",defaultFrom:"10",defaultTo:"12"}];function t(e){const i=String(e||"").trim().toUpperCase();if("KG"===i)return"KG";if(!/^\d{1,2}$/.test(i))return null;const l=Number(i);return!Number.isFinite(l)||l<1||l>12?null:String(l)}function s(e){const i=t(e);return i?n.indexOf(i):-1}function o(){return a.map(e=>(0,r.A)({},e))}function c(){const e={};return a.forEach(i=>{e[i.key]={enabled:!0,from:i.defaultFrom,to:i.defaultTo}}),e}function d(e){const i=e&&"object"===typeof e?e:{},l={};return a.forEach(e=>{const n=i[e.key]&&"object"===typeof i[e.key]?i[e.key]:{},a=!1!==n.enabled,o=function(e,i,l){var r,n;const a=null!==(r=t(e))&&void 0!==r?r:l.defaultFrom,o=null!==(n=t(i))&&void 0!==n?n:l.defaultTo,c=s(a),d=s(o);return c<0||d<0?{from:l.defaultFrom,to:l.defaultTo}:c<=d?{from:a,to:o}:{from:o,to:a}}(n.from,n.to,e);l[e.key]=(0,r.A)({enabled:a},o)}),l}function u(e,i,l){const r=function(e,i){if(!a.find(e=>e.key===i))return"";const l=d(e)[i];return null!==l&&void 0!==l&&l.enabled?l.from===l.to?l.from:"".concat(l.from,"-").concat(l.to):""}(i,l);return r?"".concat(e," (").concat(r,")"):e}function m(e,i){const l=s(e);if(l<0)return null;const r=d(i);for(const n of a){const e=r[n.key];if(null===e||void 0===e||!e.enabled)continue;const i=s(e.from),a=s(e.to);if(i<=l&&l<=a)return n.key}return null}function y(e,i){const l=Array.isArray(e)?e:[],r={okulOncesi:0,ilkokul:0,ortaokul:0,lise:0,total:0};for(const n of l){const e=Number((null===n||void 0===n?void 0:n.studentsPerBranch)||0);if(!Number.isFinite(e))continue;r.total+=e;const l=m(null===n||void 0===n?void 0:n.grade,i);l&&Object.prototype.hasOwnProperty.call(r,l)&&(r[l]+=e)}return r}function p(){return n.map(e=>e)}},7452(e,i,l){l.d(i,{A:()=>a});l(5043);var r=l(4405),n=l(579);function a(e){let{value:i=0,label:l="",tooltipLines:a}=e;const t=Number(i),s=Number.isFinite(t)?Math.max(0,Math.min(100,t)):0,o=function(e){return e?Array.isArray(e)?e.map(e=>String(e)):"string"===typeof e?e.split("\n"):[]:[]}(a).filter(e=>String(e).trim().length>0),c=(0,n.jsx)("div",{className:"progress-track",children:(0,n.jsx)("div",{className:"progress-bar",role:"progressbar","aria-valuenow":s,"aria-valuemin":0,"aria-valuemax":100,children:(0,n.jsx)("div",{className:"progress-bar-fill",style:{width:"".concat(s,"%")}})})});return(0,n.jsxs)("div",{className:"progress-row",children:[l?(0,n.jsx)("div",{className:"progress-label",children:l}):null,o.length?(0,n.jsx)(r.A,{lines:o,className:"progress-tooltip",children:c}):c,(0,n.jsxs)("div",{className:"progress-value",children:[Math.round(s),"%"]})]})}},8345(e,i,l){l.d(i,{B:()=>n});const r=["okulOncesi","ilkokul","ortaokul","lise"];function n(e){var i;const l=null===e||void 0===e||null===(i=e.temelBilgiler)||void 0===i?void 0:i.kademeler;return!(!l||"object"!==typeof l)&&r.every(e=>{var i;return!1===(null===l||void 0===l||null===(i=l[e])||void 0===i?void 0:i.enabled)})}},9100(e,i,l){l.r(i),l.d(i,{default:()=>H});var r=l(2555),n=l(5043),a=l(5685),t=l(2115),s=l(3204),o=l(7559),c=l(3182),d=l(7452),u=l(579);const m=[{key:"ulkeTemsilciligi",label:"\xdclke Temsilciligi Giderleri"},{key:"genelYonetim",label:"Genel Y\xf6netim Giderleri"},{key:"kira",label:"Isletme Giderleri (Kira)"},{key:"emsalKira",label:"Isletme Giderleri (Emsal Kira)"},{key:"enerjiKantin",label:"Isletme Giderleri (Elektrik, Su, vb.)"},{key:"turkPersonelMaas",label:"Yurt disi T\xdcRK Personel Maas Giderleri"},{key:"turkDestekPersonelMaas",label:"Yurt disi T\xdcRK DESTEK Personel Maas Giderleri"},{key:"yerelPersonelMaas",label:"Yurt disi YEREL Personel Maas Giderleri"},{key:"yerelDestekPersonelMaas",label:"Yurt disi YEREL DESTEK Personel Maas Giderleri"},{key:"internationalPersonelMaas",label:"Yurt disi INTERNATIONAL Personel Maas Giderleri"},{key:"disaridanHizmet",label:"Disaridan Saglanan Mal ve Hizmet Alimlari"},{key:"egitimAracGerec",label:"Egitim Ara\xe7 ve Gere\xe7leri"},{key:"finansalGiderler",label:"Finansal Giderler"},{key:"egitimAmacliHizmet",label:"Egitim Ama\xe7li Hizmet Alimlari"},{key:"temsilAgirlama",label:"Temsil ve Agirlama"},{key:"ulkeIciUlasim",label:"\xdclke I\xe7i Ulasim ve Konaklama"},{key:"ulkeDisiUlasim",label:"\xdclke Disi Ulasim ve Konaklama"},{key:"vergilerResmiIslemler",label:"Vergiler Resmi Islemler"},{key:"vergiler",label:"Vergiler"},{key:"demirbasYatirim",label:"Demirbas ve Yatirimlar"},{key:"rutinBakim",label:"Rutin Bakim ve Onarim"},{key:"pazarlamaOrganizasyon",label:"Pazarlama Organizasyon"},{key:"reklamTanitim",label:"Reklam ve Tanitim"},{key:"tahsilEdilemeyenGelirler",label:"Tahsil Edilemeyen Gelirler"},{key:"yemek",label:"Yemek"},{key:"uniforma",label:"\xdcniforma"},{key:"kitapKirtasiye",label:"Kitap-K\u0131rtasiye"},{key:"ulasimServis",label:"Servis / Ula\u015f\u0131m"},{key:"yurtGiderleri",label:"Yurt Giderleri (Kampus giderleri i\xe7inde g\xf6sterilmeyecek)"},{key:"digerYurt",label:"Di\u011fer (Yaz okulu giderleri vb.)"},{key:"discountsTotal",label:"Burs ve \u0130ndirimler (Toplam)"}],y=m.map(e=>e.key),p=new Map(m.map(e=>[e.key,e])),g=new Map(m.map(e=>[e.key,e.label])),h=[{id:"isletme",label:"\u0130\u015fletme Giderleri",groups:[{label:"\u0130\u015fletme Giderleri",keys:["ulkeTemsilciligi","genelYonetim","temsilAgirlama","ulkeIciUlasim","ulkeDisiUlasim","vergilerResmiIslemler","vergiler","demirbasYatirim","rutinBakim","pazarlamaOrganizasyon","reklamTanitim","tahsilEdilemeyenGelirler"]},{label:"E\u011fitim Maliyetleri",keys:["kira","emsalKira","enerjiKantin","turkPersonelMaas","turkDestekPersonelMaas","yerelPersonelMaas","yerelDestekPersonelMaas","internationalPersonelMaas","disaridanHizmet","egitimAracGerec","finansalGiderler","egitimAmacliHizmet"]}]},{id:"ogrenimDisi",label:"\xd6\u011frenim D\u0131\u015f\u0131 Hizmetler",keys:["yemek","uniforma","kitapKirtasiye","ulasimServis"]},{id:"yurtKonaklama",label:"Yurt / Konaklama",keys:["yurtGiderleri","digerYurt"]},{id:"bursIndirim",label:"Burs ve \u0130ndirimler",keys:["discountsTotal"]}].map(e=>{if(Array.isArray(e.groups)){const i=e.groups.filter(e=>e.keys.length),l=i.flatMap(e=>e.keys);return(0,r.A)((0,r.A)({},e),{},{groups:i,keys:l})}return(0,r.A)((0,r.A)({},e),{},{keys:e.keys})}).filter(e=>e.keys.length),v=function(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return Number.isFinite(Number(e))?Number(e).toLocaleString(void 0,{maximumFractionDigits:i}):"-"};function b(e){var i;let{open:l,onClose:a,sourceScenario:c,sourceSchoolId:d,sourceSchoolName:m}=e;const[b,f]=(0,n.useState)([]),[x,k]=(0,n.useState)(!1),[j,N]=(0,n.useState)(""),[S,C]=(0,n.useState)(new Set),[A,w]=(0,n.useState)("students"),[L,T]=(0,n.useState)("y1"),[O,B]=(0,n.useState)(new Set),[I,_]=(0,n.useState)(null),[z,Y]=(0,n.useState)(!1),[D,F]=(0,n.useState)(!1),[E,K]=(0,n.useState)(!1),[M,U]=(0,n.useState)(new Set),[P,H]=(0,n.useState)(!0),[R,G]=(0,n.useState)(!0),W={fontSize:12,height:30,padding:"4px 8px",lineHeight:"20px",boxSizing:"border-box"},V=(0,n.useMemo)(()=>Array.from(S).sort().join(","),[S]),$=(0,n.useMemo)(()=>Array.from(O).sort().join(","),[O]);(0,n.useEffect)(()=>{l&&(N(""),C(new Set),B(new Set),w("students"),T("y1"),_(null))},[l,null===c||void 0===c?void 0:c.id]),(0,n.useEffect)(()=>{_(null),K(!1),U(new Set),H(!0),G(!0)},[A,L,V,$]),(0,n.useEffect)(()=>{let e=!0;return async function(){if(l&&null!==c&&void 0!==c&&c.academic_year){k(!0);try{const i=await o.FH.expenseSplitTargets(c.academic_year);if(!e)return;const l=(Array.isArray(i)?i:[]).filter(e=>String(e.scenarioId)!==String(null===c||void 0===c?void 0:c.id));f(l)}catch(i){e&&t.oR.error(i.message||"Hedef senaryolar alinamadi")}finally{e&&k(!1)}}}(),()=>{e=!1}},[l,null===c||void 0===c?void 0:c.academic_year,null===c||void 0===c?void 0:c.id]);const Z=(0,n.useMemo)(()=>{const e=j.trim().toLowerCase();return e?b.filter(i=>{const l=String((null===i||void 0===i?void 0:i.schoolName)||"").toLowerCase(),r=String((null===i||void 0===i?void 0:i.scenarioName)||"").toLowerCase();return l.includes(e)||r.includes(e)}):b},[b,j]),q=e=>{C(i=>{const l=new Set(i),r=String(e);return l.has(r)?l.delete(r):l.add(r),l})},X=e=>{B(i=>{const l=new Set(i);return l.has(e)?l.delete(e):l.add(e),l})},J=(e,i)=>{Array.isArray(e)&&e.length&&B(l=>{const r=new Set(l);return e.forEach(e=>{i?r.add(e):r.delete(e)}),r})},Q=(0,n.useMemo)(()=>Array.isArray(null===I||void 0===I?void 0:I.targets)?I.targets:[],[I]),ee=(0,n.useMemo)(()=>Array.isArray(null===I||void 0===I?void 0:I.pools)?I.pools:[],[I]),ie=(0,n.useMemo)(()=>Array.isArray(null===I||void 0===I?void 0:I.allocations)?I.allocations:[],[I]),le=(0,n.useMemo)(()=>Array.isArray(null===I||void 0===I?void 0:I.warnings)?I.warnings:[],[I]),re=m||(null===c||void 0===c?void 0:c.schoolName)||(null===c||void 0===c||null===(i=c.school)||void 0===i?void 0:i.name)||"",ne=(0,n.useMemo)(()=>{const e=new Map;return ie.forEach(i=>{const l=String(i.targetScenarioId),r=e.get(l)||[];r.push({expenseLabel:g.get(i.expenseKey)||i.expenseKey,amount:i.allocatedAmount}),e.set(l,r)}),e},[ie]),ae=y.length,te=O.size,se=ae>0&&te===ae,oe=te>0&&!se,ce=!S.size||!O.size||z||D,de=h.find(e=>"isletme"===e.id)||null,ue=h.filter(e=>"isletme"!==e.id),me=e=>{if(!e)return null;const i=e.keys.length,l=e.keys.reduce((e,i)=>e+(O.has(i)?1:0),0),r=i>0&&l===i,n=l>0&&!r;return(0,u.jsxs)("div",{className:"card",style:{padding:"10px 12px",background:"#f8fafc"},children:[(0,u.jsxs)("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center"},children:[(0,u.jsxs)("label",{className:"row small",style:{gap:6,alignItems:"center",fontWeight:700},children:[(0,u.jsx)("input",{type:"checkbox",checked:r,ref:e=>{e&&(e.indeterminate=n)},onChange:i=>J(e.keys,i.target.checked)}),(0,u.jsx)("span",{children:e.label})]}),(0,u.jsxs)("div",{className:"row",style:{gap:6},children:[(0,u.jsx)("button",{className:"btn",type:"button",style:{padding:"4px 10px"},onClick:()=>J(e.keys,!0),disabled:!i,children:"Sec"}),(0,u.jsx)("button",{className:"btn",type:"button",style:{padding:"4px 10px"},onClick:()=>J(e.keys,!1),disabled:!l,children:"Temizle"})]})]}),(0,u.jsxs)("div",{className:"small muted",style:{marginTop:4},children:["Secili: ",l,"/",i]}),Array.isArray(e.groups)?(0,u.jsx)("div",{style:{marginTop:8},children:e.groups.map(e=>(0,u.jsxs)("div",{style:{marginTop:8},children:[(0,u.jsx)("div",{className:"small",style:{fontWeight:700,marginBottom:6},children:e.label}),(0,u.jsx)("div",{className:"grid2",style:{gap:8},children:e.keys.map(e=>{const i=p.get(e),l=(null===i||void 0===i?void 0:i.label)||e;return(0,u.jsxs)("label",{className:"row",style:{gap:6,alignItems:"center"},children:[(0,u.jsx)("input",{type:"checkbox",checked:O.has(e),onChange:()=>X(e)}),(0,u.jsx)("span",{className:"small",children:l})]},e)})})]},e.label))}):(0,u.jsx)("div",{className:"grid2",style:{gap:8,marginTop:8},children:e.keys.map(e=>{const i=p.get(e),l=(null===i||void 0===i?void 0:i.label)||e;return(0,u.jsxs)("label",{className:"row",style:{gap:6,alignItems:"center"},children:[(0,u.jsx)("input",{type:"checkbox",checked:O.has(e),onChange:()=>X(e)}),(0,u.jsx)("span",{className:"small",children:l})]},e)})})]},e.id)};return l?(0,u.jsx)("div",{className:"modal-backdrop",role:"dialog","aria-modal":"true",onClick:a,children:(0,u.jsxs)("div",{className:"modal",style:{width:"min(980px, 96vw)",maxHeight:"86vh",overflowY:"auto",position:"relative"},onClick:e=>e.stopPropagation(),children:[(0,u.jsx)("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center"},children:(0,u.jsx)("button",{className:"btn",onClick:a,disabled:D||z,style:{position:"absolute",top:10,right:10,background:"#111827",borderColor:"#111827",color:"#fff"},children:"Kapat"})}),c?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("div",{style:{marginTop:2},children:(0,u.jsxs)("div",{className:"row",style:{gap:12,alignItems:"flex-end",flexWrap:"wrap"},children:[(0,u.jsxs)("div",{style:{minWidth:170},children:[(0,u.jsx)("div",{className:"small",style:{fontWeight:700,marginBottom:6},children:"Basis"}),(0,u.jsxs)("select",{className:"input sm",style:W,value:A,onChange:e=>w(e.target.value),children:[(0,u.jsx)("option",{value:"students",children:"Students"}),(0,u.jsx)("option",{value:"revenue",children:"Revenue"})]})]}),(0,u.jsxs)("div",{style:{minWidth:160},children:[(0,u.jsx)("div",{className:"small",style:{fontWeight:700,marginBottom:6},children:"Basis Yil"}),(0,u.jsxs)("select",{className:"input sm",style:W,value:L,onChange:e=>T(e.target.value),children:[(0,u.jsx)("option",{value:"y1",children:"Y1"}),(0,u.jsx)("option",{value:"y2",children:"Y2"}),(0,u.jsx)("option",{value:"y3",children:"Y3"})]})]}),(0,u.jsxs)("div",{style:{flex:"1 1 220px"},children:[(0,u.jsx)("div",{className:"small",style:{fontWeight:700,marginBottom:6},children:"Hedef Ara"}),(0,u.jsx)("input",{className:"input sm",style:W,placeholder:"Okul veya senaryo ara",value:j,onChange:e=>N(e.target.value)})]})]})}),(0,u.jsxs)("div",{style:{marginTop:5},children:[(0,u.jsx)("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center",cursor:"pointer"},onClick:()=>H(e=>!e),children:(0,u.jsxs)("div",{className:"row",style:{gap:6,alignItems:"center"},children:[P?(0,u.jsx)(s.Vr3,{"aria-hidden":"true"}):(0,u.jsx)(s.X6T,{"aria-hidden":"true"}),(0,u.jsx)("div",{className:"small",style:{fontWeight:700},children:"Hedef Senaryolar"})]})}),P?x?(0,u.jsx)("div",{className:"small",children:"Yukleniyor..."}):(0,u.jsx)("div",{className:"table-scroll",style:{maxHeight:260},children:(0,u.jsxs)("table",{className:"table",style:{fontSize:12},children:[(0,u.jsx)("thead",{children:(0,u.jsxs)("tr",{children:[(0,u.jsx)("th",{style:{width:40}}),(0,u.jsx)("th",{style:{fontSize:12,padding:"6px 8px"},children:"Okul"}),(0,u.jsx)("th",{style:{fontSize:12,padding:"6px 8px"},children:"Senaryo"}),(0,u.jsx)("th",{style:{fontSize:12,padding:"6px 8px"},children:"Yil"}),(0,u.jsx)("th",{style:{fontSize:12,padding:"6px 8px"},children:"Para Birimi"})]})}),(0,u.jsx)("tbody",{children:0===Z.length?(0,u.jsx)("tr",{children:(0,u.jsx)("td",{colSpan:"5",className:"small",style:{padding:"6px 8px"},children:"Hedef bulunamadi."})}):Z.map(e=>{const i=String(e.scenarioId),l=S.has(i),n="LOCAL"===String(e.input_currency||"USD")?"".concat(e.input_currency,"/").concat(e.local_currency_code||"LOCAL"):e.input_currency||"USD";return(0,u.jsxs)("tr",{onClick:()=>q(i),style:(0,r.A)({cursor:"pointer"},l?{background:"#eef2ff"}:{}),children:[(0,u.jsx)("td",{style:{padding:"6px 8px"},children:(0,u.jsx)("input",{type:"checkbox",checked:l,onClick:e=>e.stopPropagation(),onChange:()=>q(i)})}),(0,u.jsx)("td",{style:{padding:"6px 8px"},children:e.schoolName}),(0,u.jsx)("td",{style:{padding:"6px 8px"},children:e.scenarioName}),(0,u.jsx)("td",{style:{padding:"6px 8px"},children:e.academic_year}),(0,u.jsx)("td",{style:{padding:"6px 8px"},children:n})]},e.scenarioId)})})]})}):null]}),(0,u.jsxs)("div",{style:{marginTop:16},children:[(0,u.jsxs)("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center",cursor:"pointer"},onClick:()=>G(e=>!e),children:[(0,u.jsxs)("div",{className:"row",style:{gap:6,alignItems:"center"},children:[R?(0,u.jsx)(s.Vr3,{"aria-hidden":"true"}):(0,u.jsx)(s.X6T,{"aria-hidden":"true"}),(0,u.jsx)("div",{className:"small",style:{fontWeight:700},children:"Gider Kalemleri"})]}),(0,u.jsxs)("div",{className:"row",style:{gap:6},children:[(0,u.jsx)("button",{className:"btn",type:"button",style:{padding:"4px 10px"},onClick:e=>{e.stopPropagation(),J(y,!0)},disabled:!ae,children:"Tumunu Sec"}),(0,u.jsx)("button",{className:"btn",type:"button",style:{padding:"4px 10px"},onClick:e=>{e.stopPropagation(),J(y,!1)},disabled:!te,children:"Temizle"})]})]}),R?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("div",{className:"row",style:{gap:10,alignItems:"center",marginTop:8},children:(0,u.jsxs)("label",{className:"row small",style:{gap:6,alignItems:"center"},children:[(0,u.jsx)("input",{type:"checkbox",checked:se,ref:e=>{e&&(e.indeterminate=oe)},onChange:e=>J(y,e.target.checked)}),(0,u.jsxs)("span",{children:["Toplam Secili: ",te,"/",ae]})]})}),(0,u.jsxs)("div",{className:"row",style:{alignItems:"flex-start",gap:12,marginTop:10},children:[(0,u.jsx)("div",{style:{flex:"1 1 0",minWidth:320},children:me(de)}),(0,u.jsx)("div",{style:{flex:"1 1 0",minWidth:320,display:"grid",gap:12},children:ue.map(e=>me(e))})]})]}):null]}),(0,u.jsxs)("div",{className:"row",style:{justifyContent:"flex-end",marginTop:16,gap:8},children:[(0,u.jsx)("button",{className:"btn",onClick:async()=>{if(null===c||void 0===c||!c.id||!d)return;const e={targetScenarioIds:Array.from(S).map(e=>Number(e)),basis:A,basisYearKey:L,expenseKeys:Array.from(O)};H(!1),G(!1),Y(!0);try{const i=await o.FH.previewExpenseSplit(d,c.id,e);_(i||null)}catch(i){t.oR.error(i.message||"\xd6nizleme alinamadi")}finally{Y(!1)}},disabled:ce,children:z?"\xd6nizleme...":"\xd6nizle"}),(0,u.jsx)("button",{className:"btn primary",onClick:async()=>{if(null===c||void 0===c||!c.id||!d)return;const e={targetScenarioIds:Array.from(S).map(e=>Number(e)),basis:A,basisYearKey:L,expenseKeys:Array.from(O)};F(!0);try{await o.FH.applyExpenseSplit(d,c.id,e),t.oR.success("Gider dagitimi kaydedildi."),null===a||void 0===a||a()}catch(i){t.oR.error(i.message||"Dagitim uygulanamadi")}finally{F(!1)}},disabled:D||z||!S.size||!O.size,children:D?"Uygulaniyor...":"Uygula"})]}),le.length>0?(0,u.jsxs)("div",{className:"card",style:{marginTop:12,background:"#fff7ed",borderColor:"#fed7aa"},children:[(0,u.jsx)("div",{style:{fontWeight:700,marginBottom:6},children:"Uyarilar"}),le.map((e,i)=>(0,u.jsxs)("div",{className:"small",children:["\u2022 ",e]},i))]}):null,I?(0,u.jsxs)("div",{style:{marginTop:16},children:[ee.length>0?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center",marginBottom:6,cursor:"pointer"},onClick:()=>K(e=>!e),children:(0,u.jsxs)("div",{className:"row",style:{gap:6,alignItems:"center"},children:[E?(0,u.jsx)(s.Vr3,{"aria-hidden":"true"}):(0,u.jsx)(s.X6T,{"aria-hidden":"true"}),(0,u.jsxs)("div",{className:"small",style:{fontWeight:700},children:["Havuz Tutarlari",re?" (".concat(re,")"):""]})]})}),E?(0,u.jsx)("div",{className:"table-scroll",children:(0,u.jsxs)("table",{className:"table",children:[(0,u.jsx)("thead",{children:(0,u.jsxs)("tr",{children:[(0,u.jsx)("th",{children:"Gider"}),(0,u.jsx)("th",{children:"Havuz Tutari"})]})}),(0,u.jsx)("tbody",{children:ee.map(e=>(0,u.jsxs)("tr",{children:[(0,u.jsx)("td",{children:g.get(e.expenseKey)||e.expenseKey}),(0,u.jsx)("td",{children:v(e.poolAmount)})]},e.expenseKey))})]})}):null]}):null,Q.length>0?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("div",{className:"small",style:{fontWeight:700,margin:"12px 0 6px"},children:"Agirliklar (satira tiklayin)"}),(0,u.jsx)("div",{className:"table-scroll",children:(0,u.jsxs)("table",{className:"table",children:[(0,u.jsx)("thead",{children:(0,u.jsxs)("tr",{children:[(0,u.jsx)("th",{style:{width:28}}),(0,u.jsx)("th",{children:"Okul"}),(0,u.jsx)("th",{children:"Senaryo"}),(0,u.jsx)("th",{children:"Basis"}),(0,u.jsx)("th",{children:"Agirlik"})]})}),(0,u.jsx)("tbody",{children:Q.map(e=>{const i=String(e.targetScenarioId),l=M.has(i),r=ne.get(i)||[];return(0,u.jsxs)(n.Fragment,{children:[(0,u.jsxs)("tr",{onClick:()=>{return i=e.targetScenarioId,void U(e=>{const l=new Set(e),r=String(i);return l.has(r)?l.delete(r):l.add(r),l});var i},style:{cursor:"pointer"},children:[(0,u.jsx)("td",{style:{textAlign:"center"},children:l?(0,u.jsx)(s.Vr3,{"aria-hidden":"true"}):(0,u.jsx)(s.X6T,{"aria-hidden":"true"})}),(0,u.jsx)("td",{children:e.schoolName}),(0,u.jsx)("td",{children:e.scenarioName}),(0,u.jsx)("td",{children:v(e.basisValue)}),(0,u.jsx)("td",{children:(a=e.weight,Number.isFinite(Number(a))?"".concat((100*Number(a)).toFixed(2),"%"):"-")})]}),l?(0,u.jsx)("tr",{children:(0,u.jsx)("td",{colSpan:5,children:r.length?(0,u.jsxs)("table",{className:"table",style:{margin:0},children:[(0,u.jsx)("thead",{children:(0,u.jsxs)("tr",{children:[(0,u.jsx)("th",{children:"Gider"}),(0,u.jsx)("th",{children:"Tutar"})]})}),(0,u.jsx)("tbody",{children:r.map((e,l)=>(0,u.jsxs)("tr",{children:[(0,u.jsx)("td",{children:e.expenseLabel}),(0,u.jsx)("td",{children:v(e.amount)})]},"".concat(i,"-").concat(e.expenseLabel,"-").concat(l)))})]}):(0,u.jsx)("div",{className:"small is-muted",children:"Dagitim bulunamadi."})})}):null]},e.targetScenarioId);var a})})]})})]}):null]}):null]}):(0,u.jsx)("div",{className:"small",style:{marginTop:10},children:"Kaynak senaryo se\xe7ilmedi."})]})}):null}var f=l(6037),x=l(9322),k=l(5534),j=l(8345),N=l(1298);const S=[{key:"temel",label:"Temel Bilgiler",sections:[{id:"temel.core",label:"Kademeler + Program"},{id:"temel.pricing",label:"Enflasyon + Ucret Artis Oranlari + Ucret Hesaplama Ayari"},{id:"temel.schoolInfo",label:"Yetkililer + Okul/Egitim Bilgileri"},{id:"temel.discountsMeta",label:"IK Mevcut + Burs/Indirim Ogrenci Sayilari"},{id:"temel.competitors",label:"Rakip Analizi"},{id:"temel.performance",label:"Performans + Degerlendirme"}]},{key:"kapasite",label:"Kapasite",sections:[{id:"kapasite.all",label:"Kapasite (tumu)"}]},{key:"norm",label:"Norm",sections:[{id:"norm.planned",label:"Planlanan donem bilgileri"},{id:"norm.current",label:"Mevcut donem bilgileri"},{id:"norm.lessonY1",label:"Ders dagilimi (yalnizca Y1)"}]},{key:"hr",label:"IK (HR)",sections:[{id:"hr.ik",label:"IK Plan (tumu)"}]},{key:"gelirler",label:"Gelirler",sections:[{id:"income.gelirler",label:"Gelirler (tumu)"}]},{key:"giderler",label:"Giderler",sections:[{id:"expenses.giderler",label:"Giderler (tumu)"},{id:"expenses.discounts",label:"BURS VE INDIRIMLER / YIL"}]}],C={"temel.core":["page.temel_bilgiler"],"temel.pricing":["section.temel_bilgiler.inflation"],"temel.schoolInfo":["page.temel_bilgiler"],"temel.discountsMeta":["section.temel_bilgiler.ik_mevcut","section.temel_bilgiler.burs_ogr"],"temel.competitors":["section.temel_bilgiler.rakip"],"temel.performance":["section.temel_bilgiler.performans"],"kapasite.all":["section.kapasite.caps"],"norm.planned":["page.norm"],"norm.current":["page.norm"],"norm.lessonY1":["section.norm.ders_dagilimi"],"hr.ik":["section.ik.local_staff"],"income.gelirler":["section.gelirler.unit_fee"],"expenses.giderler":["section.giderler.isletme"],"expenses.discounts":["section.discounts.discounts"]};function A(e){const i=String((null===e||void 0===e?void 0:e.status)||"draft"),l=null!=(null===e||void 0===e?void 0:e.submitted_at),r=null!=(null===e||void 0===e?void 0:e.sent_at);return"sent_for_approval"===i||"submitted"===i||"approved"===i&&r||"in_review"===i&&l}const w="2026",L="2027",T=/^[A-Z0-9]{2,10}$/,O=["USD","EUR","TRY","GBP","JPY","CNY","INR","RUB","AED","SAR","AFN"];function B(e){const i=String(e||"").trim();return/^\d{4}$/.test(i)?Number(i):null}function I(e){const i=String(e||"").trim(),l=i.match(/^(\d{4})$/);if(l){const e=Number(l[1]);return Number.isFinite(e)?String(e+1):""}const r=i.match(/^(\d{4})\s*-\s*(\d{4})$/);if(r){const e=Number(r[1]),i=Number(r[2]);if(Number.isFinite(e)&&Number.isFinite(i))return"".concat(e+1,"-").concat(i+1)}return""}function _(){return S.flatMap(e=>e.sections.map(e=>e.id))}function z(e){const i=(0,r.A)({},e||{}),l=!!i["hr.ik"],n=!!i["expenses.giderler"];if(l!==n){const e=l||n;i["hr.ik"]=e,i["expenses.giderler"]=e}return i}function Y(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"all";const i=_(),l=Object.fromEntries(i.map(e=>[e,!1]));return"all"===e?i.forEach(e=>{l[e]=!0}):"structure"===e?["temel.core","kapasite.all","norm.planned","norm.lessonY1"].forEach(e=>{l[e]=!0}):"financial"===e&&["temel.core","income.gelirler","expenses.discounts","hr.ik","expenses.giderler"].forEach(e=>{l[e]=!0}),z(l)}function D(){const e={};return(0,f.oP)().forEach(i=>{e[i]={}}),e}function F(e){return{teacherWeeklyMaxHours:Number.isFinite(e)&&e>0?e:24,curriculumWeeklyHours:D()}}function E(e,i){var l;const r=Number(i);if(!Number.isFinite(r)||r<=0)return e;const n=e=>{const i=Number(e);return Number.isFinite(i)?Math.round(i*r*100)/100:e};if(null!==e&&void 0!==e&&e.gelirler){var a,t,s,o;const i=e.gelirler,l=e=>{Array.isArray(e)&&e.forEach(e=>{e&&"object"===typeof e&&("unitFee"in e&&(e.unitFee=n(e.unitFee)),"amount"in e&&(e.amount=n(e.amount)))})};l(null===i||void 0===i||null===(a=i.tuition)||void 0===a?void 0:a.rows),l(null===i||void 0===i||null===(t=i.nonEducationFees)||void 0===t?void 0:t.rows),l(null===i||void 0===i||null===(s=i.dormitory)||void 0===s?void 0:s.rows),l(null===i||void 0===i||null===(o=i.otherInstitutionIncome)||void 0===o?void 0:o.rows),null!=(null===i||void 0===i?void 0:i.governmentIncentives)&&(i.governmentIncentives=n(i.governmentIncentives))}null!==e&&void 0!==e&&e.giderler&&"object"===typeof e.giderler&&Object.values(e.giderler).forEach(e=>{e&&"object"===typeof e&&e.items&&"object"===typeof e.items&&Object.keys(e.items).forEach(i=>{e.items[i]=n(e.items[i])})}),null!==e&&void 0!==e&&null!==(l=e.ik)&&void 0!==l&&l.years&&"object"===typeof e.ik.years&&Object.values(e.ik.years).forEach(e=>{e&&"object"===typeof e&&e.unitCosts&&"object"===typeof e.unitCosts&&Object.keys(e.unitCosts).forEach(i=>{e.unitCosts[i]=n(e.unitCosts[i])})}),Array.isArray(null===e||void 0===e?void 0:e.discounts)&&e.discounts.forEach(e=>{e&&"object"===typeof e&&"amount"===String(e.mode||"").toLowerCase()&&(e.value=n(e.value))});const c=null===e||void 0===e?void 0:e.temelBilgiler;var d,u;c&&(null!=(null===c||void 0===c||null===(d=c.inflation)||void 0===d?void 0:d.currentSeasonAvgFee)&&(c.inflation.currentSeasonAvgFee=n(c.inflation.currentSeasonAvgFee)),null!==c&&void 0!==c&&c.rakipAnalizi&&"object"===typeof c.rakipAnalizi&&Object.values(c.rakipAnalizi).forEach(e=>{e&&"object"===typeof e&&["a","b","c"].forEach(i=>{i in e&&(e[i]=n(e[i]))})}),null!==c&&void 0!==c&&null!==(u=c.performans)&&void 0!==u&&u.gerceklesen&&"object"===typeof c.performans.gerceklesen&&Object.keys(c.performans.gerceklesen).forEach(e=>{c.performans.gerceklesen[e]=n(c.performans.gerceklesen[e])}));return e}function K(e){let{size:i=12}=e;return(0,u.jsx)("span",{"aria-hidden":!0,style:{width:i,height:i,borderRadius:"50%",border:"2px solid rgba(0,0,0,0.18)",borderTopColor:"rgba(0,0,0,0.65)",display:"inline-block",animation:"schoolSpin .8s linear infinite"}})}function M(e){var i,l,n;const a=e=>{const i=Number(e);return Number.isFinite(i)?i:0},t=e||{},s=a(t.schoolCapacity),o=t.kapasite&&"object"===typeof t.kapasite?t.kapasite:{},c=o.years&&"object"===typeof o.years?o.years:{},d=a(null!=c.y1?c.y1:s),u=a(null!=c.y2?c.y2:d),m=a(null!=c.y3?c.y3:d),y=a(o.currentStudents),p=o.byKademe&&"object"===typeof o.byKademe?o.byKademe:{};if(!("schoolCapacity"in t||!t.kapasite||"object"!==typeof t.kapasite||!o.years||"object"!==typeof o.years||a(null===o||void 0===o||null===(i=o.years)||void 0===i?void 0:i.y1)!==d||a(null===o||void 0===o||null===(l=o.years)||void 0===l?void 0:l.y2)!==u||a(null===o||void 0===o||null===(n=o.years)||void 0===n?void 0:n.y3)!==m||a(null===o||void 0===o?void 0:o.currentStudents)!==y||!o.byKademe||"object"!==typeof o.byKademe))return t;const g=structuredClone(t);return g.kapasite=(0,r.A)((0,r.A)({},o||{}),{},{currentStudents:y,years:{y1:d,y2:u,y3:m},byKademe:p}),"schoolCapacity"in g&&delete g.schoolCapacity,g}function U(e){const i=e||{},l=i.temelBilgiler&&"object"===typeof i.temelBilgiler?i.temelBilgiler:{},n=structuredClone(i),a=l.inflation&&"object"===typeof l.inflation?l.inflation:{},t=e=>Number.isFinite(Number(e))?Number(e):0;return n.temelBilgiler={inflation:(0,r.A)((0,r.A)({},a),{},{expenseDeviationPct:t(a.expenseDeviationPct),y2023:t(a.y2023),y2024:t(a.y2024),y2025:t(a.y2025),y1:t(a.y1),y2:t(a.y2),y3:t(a.y3),currentSeasonAvgFee:t(a.currentSeasonAvgFee)}),yetkililer:l.yetkililer||{mudur:"",ulkeTemsilcisi:"",raporuHazirlayan:""},okulEgitimBilgileri:l.okulEgitimBilgileri||{egitimBaslamaTarihi:"",zorunluEgitimDonemleri:"",birDersSuresiDakika:0,gunlukDersSaati:0,haftalikDersSaatiToplam:0,sabahciOglenci:"",ogretmenHaftalikDersOrt:0,gecisSinaviBilgisi:"",uygulananProgram:""},kademeler:(0,f.Ds)(l.kademeler),programType:(0,x.wN)(l.programType),okulUcretleriHesaplama:"boolean"!==typeof l.okulUcretleriHesaplama||l.okulUcretleriHesaplama,ucretArtisOranlari:l.ucretArtisOranlari||{okulOncesi:0,ilkokulYerel:0,ilkokulInt:0,ortaokulYerel:0,ortaokulInt:0,liseYerel:0,liseInt:0},ikMevcut:l.ikMevcut||{turkPersonelYoneticiEgitimci:0,turkPersonelTemsilcilik:0,yerelKadroluEgitimci:0,yerelUcretliVakaterEgitimci:0,yerelDestek:0,yerelTemsilcilik:0,international:0},bursIndirimOgrenciSayilari:l.bursIndirimOgrenciSayilari||{magisBasariBursu:0,maarifYetenekBursu:0,ihtiyacBursu:0,okulBasariBursu:0,tamEgitimBursu:0,barinmaBursu:0,turkceBasariBursu:0,uluslararasiYukumlulukIndirimi:0,vakifCalisaniIndirimi:0,kardesIndirimi:0,erkenKayitIndirimi:0,pesinOdemeIndirimi:0,kademeGecisIndirimi:0,temsilIndirimi:0,kurumIndirimi:0,istisnaiIndirim:0,yerelMevzuatIndirimi:0},rakipAnalizi:l.rakipAnalizi||{okulOncesi:{a:0,b:0,c:0},ilkokul:{a:0,b:0,c:0},ortaokul:{a:0,b:0,c:0},lise:{a:0,b:0,c:0}},performans:l.performans||{gerceklesen:{ogrenciSayisi:0,gelirler:0,giderler:0,karZarar:0,bursVeIndirimler:0}},degerlendirme:"string"===typeof l.degerlendirme?l.degerlendirme:""},n}function P(e){const i=e||{},l=(0,f.oP)().map(e=>({grade:e,branchCount:0,studentsPerBranch:0})),r=Array.isArray(i.grades)?i.grades:l,n=i.gradesYears&&"object"===typeof i.gradesYears?i.gradesYears:{},a=Array.isArray(n.y1)?n.y1:r,t=Array.isArray(n.y2)?n.y2:a,s=Array.isArray(n.y3)?n.y3:a,o=e=>{const i=new Map;return(Array.isArray(e)?e:[]).forEach(e=>{const l=(e=>{var i,l,r;return{grade:String(null!==(i=null===e||void 0===e?void 0:e.grade)&&void 0!==i?i:""),branchCount:Number(null!==(l=null===e||void 0===e?void 0:e.branchCount)&&void 0!==l?l:0),studentsPerBranch:Number(null!==(r=null===e||void 0===e?void 0:e.studentsPerBranch)&&void 0!==r?r:0)}})(e);l.grade&&i.set(l.grade,l)}),i};if(!(!i.gradesYears||!Array.isArray(i.grades)||!Array.isArray(n.y1)||!Array.isArray(n.y2)||!Array.isArray(n.y3)||!((e,i)=>{if(!Array.isArray(e)||!Array.isArray(i))return!1;if(e.length!==i.length)return!1;const l=o(e),r=o(i);if(l.size!==r.size)return!1;for(const[n,a]of l.entries()){const e=r.get(n);if(!e)return!1;if(Number(a.branchCount)!==Number(e.branchCount))return!1;if(Number(a.studentsPerBranch)!==Number(e.studentsPerBranch))return!1}return!0})(i.grades,a)))return i;const c=structuredClone(i);return c.gradesYears={y1:structuredClone(a),y2:structuredClone(t),y3:structuredClone(s)},c.grades=structuredClone(c.gradesYears.y1),c}function H(){var e,i,l,m,y,p;const g=(0,a.Zp)(),h=(0,a.KC)(),[v,H]=(0,a.ok)(),R=(0,c.A)(),[G,W]=(0,n.useState)([]),[V,$]=(0,n.useState)([]),[Z,q]=(0,n.useState)(null),[X,J]=(0,n.useState)(null),[Q,ee]=(0,n.useState)(null),[ie,le]=(0,n.useState)(null),[re,ne]=(0,n.useState)(null),[,ae]=(0,n.useState)(null),[te,se]=(0,n.useState)(""),[oe,ce]=(0,n.useState)(!1),[de,ue]=(0,n.useState)(!1),[me,ye]=(0,n.useState)({}),[pe,ge]=(0,n.useState)(!1),[he,ve]=(0,n.useState)({}),[be,fe]=(0,n.useState)(!1),[xe,ke]=(0,n.useState)(""),[je,Ne]=(0,n.useState)("split"),[Se,Ce]=(0,n.useState)(w),[Ae,we]=(0,n.useState)(L),[Le,Te]=(0,n.useState)((0,f.jc)()),[Oe,Be]=(0,n.useState)(!1),[Ie,_e]=(0,n.useState)("USD"),[ze,Ye]=(0,n.useState)(""),[De,Fe]=(0,n.useState)(""),[Ee,Ke]=(0,n.useState)(null),[Me,Ue]=(0,n.useState)(0),[Pe,He]=(0,n.useState)(!1),[Re,Ge]=(0,n.useState)("create"),[We,Ve]=(0,n.useState)(null),[$e,Ze]=(0,n.useState)(!1),[qe,Xe]=(0,n.useState)(!1),[Je,Qe]=(0,n.useState)({key:null,dir:"asc"}),[ei,ii]=(0,n.useState)(null),[li,ri]=(0,n.useState)(null),[ni,ai]=(0,n.useState)(null),[ti,si]=(0,n.useState)(null),[oi,ci]=(0,n.useState)(!1),[di,ui]=(0,n.useState)(!1),[mi,yi]=(0,n.useState)(""),[pi,gi]=(0,n.useState)(null),[hi,vi]=(0,n.useState)(""),[bi,fi]=(0,n.useState)("USD"),[xi,ki]=(0,n.useState)(""),[ji,Ni]=(0,n.useState)(""),[Si,Ci]=(0,n.useState)(""),[Ai,wi]=(0,n.useState)(!1),Li=(0,n.useRef)(null),Ti=(0,n.useRef)(null);(0,n.useEffect)(()=>{if(null!==h&&void 0!==h&&h.setHeaderMeta)return h.setHeaderMeta({title:"Okul & Senaryo Sec",subtitle:"Okul ve senaryoyu secip Uygula'ya basin.",centered:!0}),()=>{var e;null===(e=h.clearHeaderMeta)||void 0===e||e.call(h)}},[h]);const Oi=(0,n.useCallback)(async()=>{se(""),ce(!0);try{const e=await o.FH.listSchools({limit:50,offset:0,fields:"brief",order:"name:asc"});W(Array.isArray(null===e||void 0===e?void 0:e.items)?e.items:[])}catch(e){se(e.message||"Okullar yuklenemedi.")}finally{ce(!1)}},[]);(0,n.useEffect)(()=>{Oi()},[Oi]);const Bi=(0,n.useCallback)(async e=>{if(Array.isArray(e)&&e.length){ge(!0);try{const i=e.map(e=>e.id),l=await o.FH.getSchoolsProgressBulk(i),r=null!==l&&void 0!==l&&l.progressBySchoolId&&"object"===typeof l.progressBySchoolId?l.progressBySchoolId:{};ye(r)}catch(i){const l={};e.forEach(e=>{l[e.id]={state:"error",label:"\u0130lerleme hesaplanamad\u0131"}}),ye(l)}finally{ge(!1)}}else ye({})},[]);(0,n.useEffect)(()=>{if(!G.length)return ye({}),void ge(!1);Bi(G)},[G,Bi]),(0,n.useEffect)(()=>{const e=v.get("schoolId"),i=Number(e||0);e&&Number.isFinite(i)&&G.length&&G.some(e=>String(e.id)===String(i))&&J(e=>String(e)===String(i)?e:($([]),q(null),ve({}),fe(!1),i))},[v,G]);const Ii=(0,n.useCallback)(e=>{const i=String(X)!==String(e);i&&(ee(null),le(null),ne(null),ae(null),$([]),q(null),ve({}),fe(!1)),J(e),i&&H(i=>{const l=new URLSearchParams(i);return l.set("schoolId",String(e)),l})},[X,H]),_i=(0,n.useCallback)(()=>{J(null),ee(null),le(null),ne(null),ae(null),$([]),q(null),ve({}),H(e=>{const i=new URLSearchParams(e);return i.delete("schoolId"),i})},[H]),zi=(0,n.useCallback)(()=>{ee(null),le(null),ne(null),ae(null)},[]);(0,n.useEffect)(()=>{if(!X)return $([]),q(null),ee(null),le(null),ne(null),ae(null),ve({}),fe(!1),void ue(!1);ee(null),le(null),ne(null),ae(null),$([]),q(null),ve({}),fe(!1);let e=!0;return se(""),ue(!0),async function(){try{const i=await o.FH.listScenarios(X,{limit:50,offset:0,fields:"brief",order:"created_at:desc"});if(!e)return;const l=Array.isArray(null===i||void 0===i?void 0:i.items)?i.items:[];$(l),q(X),ee(e=>{if(l.some(i=>String(i.id)===String(e)))return e;const i=(0,k.Rj)(X);return null!=i&&l.some(e=>String(e.id)===String(i))?i:null})}catch(i){if(!e)return;se(i.message||"Senaryolar yuklenemedi."),$([])}finally{e&&ue(!1)}}(),()=>{e=!1}},[X]),(0,n.useEffect)(()=>{if(!X)return ve({}),void fe(!1);if(null!=Z&&String(Z)!==String(X))return ve({}),void fe(!1);if(!V.length)return ve({}),void fe(!1);let e=!0;return fe(!0),async function(){try{const i=await Promise.all(V.map(async e=>{try{var i;const l=await o.FH.getScenarioProgress(X,e.id),r=null===l||void 0===l?void 0:l.progress;if(!r)return{id:e.id,error:!0};const n=Array.isArray(r.missingDetailsLines)?r.missingDetailsLines:[],a=n.length?["Eksik:",...n]:["T\xfcm tablolar tamamland\u0131"];return{id:e.id,pct:null!==(i=r.pct)&&void 0!==i?i:0,tooltipLines:a}}catch(l){return{id:e.id,error:!0}}}));if(!e)return;const l={};i.forEach(e=>{l[e.id]=e}),ve(l)}finally{e&&fe(!1)}}(),()=>{e=!1}},[X,V,Z]),(0,n.useEffect)(()=>{if(!X||!Q)return le(null),ne(null),void ae(null);let e=!0;return se(""),async function(){try{const i=await o.FH.getScenarioInputs(X,Q);if(!e)return;le((null===i||void 0===i?void 0:i.scenario)||null);const l=null===i||void 0===i?void 0:i.inputs,r=l&&"object"===typeof l?P(U(M(l))):l;ne(r);const n=(0,j.B)(r);(0,k.X3)(X,Q,{isHeadquarter:n}),ae(null)}catch(i){if(!e)return;se(i.message||"Senaryo yuklenemedi.")}}(),()=>{e=!1}},[X,Q]);const Yi=(0,n.useCallback)(async()=>{if(!X)return null;try{const e=await o.FH.listScenarios(X,{limit:50,offset:0,fields:"brief",order:"created_at:desc"}),i=Array.isArray(null===e||void 0===e?void 0:e.items)?e.items:[];return $(i),q(X),i}catch(e){return null}},[X]),Di=(0,n.useMemo)(()=>(0,f.aW)(),[]),Fi=(0,n.useMemo)(()=>(0,f.oP)(),[]),Ei=B(Se),Ki=B(Ae),Mi=function(e,i,l){const r=B(i);if(!r)return"";if("full"===e)return String(r);const n=B(l);return n?"".concat(r,"-").concat(n):""}(je,Se,Ae),Ui="full"===je||null!=Ei&&Ki===Ei+1,Pi=(0,n.useMemo)(()=>{if(!Mi)return!1;const e="edit"===Re?Number((null===We||void 0===We?void 0:We.id)||Q||0):null;return V.some(i=>String((null===i||void 0===i?void 0:i.academic_year)||"").trim()===String(Mi).trim()&&(null==e||Number(null===i||void 0===i?void 0:i.id)!==e))},[Mi,V,Re,null===We||void 0===We?void 0:We.id,Q]),Hi=(0,n.useMemo)(()=>(0,f.Ds)(Le),[Le]),Ri=(0,n.useMemo)(()=>Object.values(Hi).some(e=>e&&e.enabled),[Hi]),Gi=Oe||Ri,Wi=String(ze||"").trim().toUpperCase(),Vi="LOCAL"!==Ie||T.test(Wi),$i=Number(De),Zi="LOCAL"!==Ie||Number.isFinite($i)&&$i>0,qi="USD"===Ie||Vi&&Zi,Xi=Boolean(xe.trim())&&Boolean(Mi)&&Ui&&!Pi&&Gi&&qi,Ji=[!0,qi,Boolean(Ee),Boolean(Mi)&&Ui&&!Pi,Gi,Xi],Qi=Boolean(li||ei||ni||qe||$e),el=null!==(e=null!==(i=null!==li&&void 0!==li?li:ei)&&void 0!==i?i:ni)&&void 0!==e?e:null,il=(0,n.useMemo)(()=>V.find(e=>String(e.id)===String(Q))||null,[V,Q]),ll=(0,n.useMemo)(()=>{const e=G.find(e=>String(e.id)===String(X));return(null===e||void 0===e?void 0:e.name)||""},[G,X]),rl=(0,n.useMemo)(()=>{if(!Je.key)return V;const e=V.map((e,i)=>({s:e,idx:i})),i="asc"===Je.dir?1:-1,l=e=>{const i=String(e||"").match(/(\d{4})(?:\s*-\s*(\d{4}))?/),l=i?Number(i[1]):0;return[l||0,(i&&i[2]?Number(i[2]):l)||0]},r=e=>"LOCAL"===String(e.input_currency||"USD").toUpperCase()?String(e.local_currency_code||"LOCAL").toUpperCase():"USD",n=e=>{switch(e){case"in_review":return"\u0130ncelemede";case"sent_for_approval":return"Onaya Gonderildi";case"submitted":return"Gonderildi";case"revision_requested":return"Revizyon Istendi";case"approved":return"Onaylandi";default:return"Taslak"}};return e.sort((e,a)=>{const t=e.s,s=a.s;let o=0;switch(Je.key){case"name":o=String(t.name||"").localeCompare(String(s.name||""),"tr",{sensitivity:"base",numeric:!0});break;case"year":{const[e,i]=l(t.academic_year),[r,n]=l(s.academic_year);o=e-r||i-n;break}case"currency":o=r(t).localeCompare(r(s),"tr",{sensitivity:"base",numeric:!0});break;case"status":o=n(t.status).localeCompare(n(s.status),"tr",{sensitivity:"base",numeric:!0});break;case"date":o=new Date(t.created_at).getTime()-new Date(s.created_at).getTime();break;default:o=0}return 0===o&&(o=e.idx-a.idx),o*i}),e.map(e=>e.s)},[V,Je]),nl=e=>{Qe(i=>i.key===e?{key:e,dir:"asc"===i.dir?"desc":"asc"}:{key:e,dir:"asc"})},al=e=>Je.key!==e?"none":"asc"===Je.dir?"ascending":"descending",tl=e=>Je.key!==e?(0,u.jsx)("span",{className:"sort-icon is-idle",children:(0,u.jsx)(s.MjW,{"aria-hidden":"true"})}):(0,u.jsx)("span",{className:"sort-icon",children:"asc"===Je.dir?(0,u.jsx)(s.XhJ,{"aria-hidden":"true"}):(0,u.jsx)(s.GOR,{"aria-hidden":"true"})}),sl=(0,n.useMemo)(()=>_(),[]),ol=pi?sl.reduce((e,i)=>e+(pi[i]?1:0),0):0,cl=!(null===pi||void 0===pi||!pi["hr.ik"])===!(null===pi||void 0===pi||!pi["expenses.giderler"]),dl=String((null===ie||void 0===ie?void 0:ie.input_currency)||"USD").toUpperCase(),ul="LOCAL"===(null===ie||void 0===ie?void 0:ie.input_currency)?ie.local_currency_code||"LOCAL":"USD",ml="LOCAL"===(null===ie||void 0===ie?void 0:ie.input_currency),yl=Number((null===re||void 0===re||null===(l=re.temelBilgiler)||void 0===l||null===(m=l.performans)||void 0===m?void 0:m.prevYearRealizedFxUsdToLocal)||0),pl=ml&&!(Number.isFinite(yl)&&yl>0),gl=(0,n.useMemo)(()=>{var e,i;return{countryId:null!==(e=null===(i=R.user)||void 0===i?void 0:i.country_id)&&void 0!==e?e:null,schoolId:null!=X?Number(X):null}},[null===(y=R.user)||void 0===y?void 0:y.country_id,X]),hl=String((null===(p=R.user)||void 0===p?void 0:p.role)||""),vl=(0,N.$3)(R.user,"scenario.create","write",gl),bl=(0,N.$3)(R.user,"scenario.plan_edit","write",gl),fl=(0,N.$3)(R.user,"scenario.copy","write",gl),xl=(0,N.$3)(R.user,"scenario.expense_split","write",gl),kl=(0,N.$3)(R.user,"scenario.submit","write",gl),jl="manager"===hl||"accountant"===hl||(0,N.$3)(R.user,"scenario.forward","write",gl),Nl=(0,N.$3)(R.user,"scenario.delete","write",gl),Sl=Boolean(il)&&A(il),Cl=Boolean(il)&&!Sl&&bl,Al=Boolean(il)&&!Sl&&Nl,wl=Boolean(il)&&("draft"===il.status||"revision_requested"===il.status),Ll=Boolean(il)&&"approved"===il.status&&!il.sent_at,Tl=wl&&kl,Ol=Ll&&jl,Bl=Boolean(il)&&re&&fl,Il=il&&String(li)===String(il.id),_l=il&&String(ei)===String(il.id),zl=il&&String(ni)===String(il.id),Yl=e=>{_e(e),"LOCAL"!==e&&(Ye(""),Fe(""))},Dl=e=>{if(Ne(e),"split"===e){const e=B(Se);null!=e&&we(String(e+1))}},Fl=e=>{if(Ce(e),"split"===je){const i=B(e);null!=i&&we(String(i+1))}};async function El(e){if(!bl)return;if(!X)return;se("");const i=V.find(i=>String(i.id)===String(e));if(i&&A(i))se("Senaryo onayda veya onaylandi, duzenlenemez.");else{ee(e),Ge("edit"),Ve(null),He(!0),Ze(!0),Ue(0);try{var l,r;const i=await o.FH.getScenarioInputs(X,e),n=null===i||void 0===i?void 0:i.scenario;if(!n)throw new Error("Senaryo bulunamadi.");Ve(n),ke(n.name||"");const a=function(e){const i=String(e||"").trim(),l=i.match(/(\d{4})\s*-\s*(\d{4})/);if(l){const e=Number(l[1]),i=Number(l[2]);if(Number.isFinite(e)&&Number.isFinite(i))return{startYear:e,endYear:i}}const r=i.match(/^(\d{4})$/);if(r){const e=Number(r[1]);if(Number.isFinite(e))return{startYear:e,endYear:e}}return{startYear:null,endYear:null}}(n.academic_year);a.startYear&&a.endYear&&a.endYear!==a.startYear?(Ne("split"),Ce(String(a.startYear)),we(String(a.endYear))):a.startYear?(Ne("full"),Ce(String(a.startYear)),we(String(a.startYear+1))):(Ne("split"),Ce(w),we(L));const t=null===i||void 0===i||null===(l=i.inputs)||void 0===l||null===(r=l.temelBilgiler)||void 0===r?void 0:r.kademeler,s=t?(0,f.Ds)(t):(0,f.jc)(),c=Object.values(s).some(e=>e&&e.enabled);Te(s),Be(!c),Ti.current=c?structuredClone(s):null;const d=n.input_currency||"USD";_e(d),Ye(n.local_currency_code||""),Fe(null!=n.fx_usd_to_local?String(n.fx_usd_to_local):""),Ke(n.program_type||x.Rw.LOCAL)}catch(n){se(n.message||"Senaryo yuklenemedi."),He(!1)}finally{Ze(!1)}}}const Kl=(e,i)=>{Te(l=>{const n=(0,f.Ds)(l),a=(0,r.A)((0,r.A)({},n),{},{[e]:(0,r.A)((0,r.A)({},n[e]),i)});return(0,f.Ds)(a)})},Ml=e=>{const i=String(null!==e&&void 0!==e?e:"").trim();if(!i)return NaN;const l=i.replace(",",".").match(/-?\d+(?:\.\d+)?/);if(!l)return NaN;const r=Number.parseFloat(l[0]);return Number.isFinite(r)?r:NaN},Ul=e=>{gi(Y(e)),vi("")},Pl=(e,i)=>{Qi||gi(l=>{const n=l||Y("all"),a=(0,r.A)({},n);var t;return"hr.ik"===e||"expenses.giderler"===e?(a["hr.ik"]=i,a["expenses.giderler"]=i,t="IK ve Giderler birlikte ".concat(i?"secildi":"kaldirildi","."),Li.current&&clearTimeout(Li.current),vi(t),Li.current=setTimeout(()=>{vi("")},2e3)):a[e]=i,z(a)})},Hl=(e,i)=>{if(Qi)return;const l=S.find(i=>i.key===e);l&&gi(e=>{const n=e||Y("all"),a=(0,r.A)({},n);return l.sections.forEach(e=>{a[e.id]=i}),z(a)})};function Rl(){ci(!1),yi("")}function Gl(e){const i=Array.isArray(e)?e:[];let l=0;for(const n of i){var r;const e=Number(null!==(r=null===n||void 0===n?void 0:n.studentsPerBranch)&&void 0!==r?r:0);Number.isFinite(e)&&(l+=e)}return l}function Wl(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"blocking-toast";t.oR.warn(e,{toastId:i,position:"bottom-right",autoClose:!1,closeOnClick:!1,draggable:!0,icon:"!",style:{background:"rgba(15, 23, 42, 0.96)",color:"#f8fafc",border:"1px solid rgba(251, 191, 36, 0.35)",boxShadow:"0 18px 40px rgba(0,0,0,.28)",borderRadius:14}})}function Vl(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Islem";if(!re)return!0;if((0,j.B)(re))return!0;const i=function(e){const i=e&&"object"===typeof e?e:{},l=i.gradesYears&&"object"===typeof i.gradesYears?i.gradesYears:{};return{y1:Gl(Array.isArray(l.y1)?l.y1:i.grades),y2:Gl(l.y2),y3:Gl(l.y3)}}(re),l=[];if(i.y2>0||l.push("Y2"),i.y3>0||l.push("Y3"),!l.length)return!0;const r="".concat(e," yapilamaz: Norm > Planlanan Donem Bilgileri bolumunde ")+"".concat(l.join(" ve ")," toplam ogrenci 0 gorunuyor. Lutfen Y2/Y3 ogrenci sayilarini girin.");return se(""),Wl(r,"norm-y2y3-missing"),!1}function $l(){if(!re)return!0;if(!ml)return!0;if(!pl)return!0;const e="".concat(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Islem"," yapilamaz: Temel Bilgiler > Performans alanindaki ")+'"Onceki Donem Ortalama Kur (Gerceklesen)" girilmelidir.';return se(""),Wl(e,"prev-realized-fx-missing"),!1}async function Zl(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!X||!Q)return!1;if(!$l("Hesaplama"))return!1;if(!e.skipPlanValidation&&!Vl("Hesaplama"))return!1;wi(!0),se("");let i=!1;try{const e=await o.FH.calculateScenario(X,Q);ae(e.results),i=!0}catch(l){se(l.message||"Calculation failed")}finally{wi(!1)}return i}const ql=null!=ti?V.find(e=>String(e.id)===String(ti)):null,Xl=null!==ql&&void 0!==ql&&ql.name?'"'.concat(ql.name,'"'):"Senaryo",Jl=null!=ti&&String(ti)===String(Q)&&V.length<=1?"".concat(Xl," son senaryo. Silerseniz senaryo secimi temizlenir."):"".concat(Xl," silinecek. Devam edilsin mi?");return(0,u.jsxs)("div",{className:"container select-page",children:[(0,u.jsx)(t.N9,{position:"bottom-right",autoClose:3500,newestOnTop:!0,closeOnClick:!0,pauseOnFocusLoss:!0,pauseOnHover:!0,hideProgressBar:!0,theme:"dark"}),(0,u.jsx)("style",{children:"@keyframes schoolSpin{to{transform:rotate(360deg)}}"}),te?(0,u.jsx)("div",{className:"card",style:{marginTop:10,background:"#fff1f2",borderColor:"#fecaca"},children:te}):null,ti?(0,u.jsx)("div",{className:"modal-backdrop",role:"dialog","aria-modal":"true",children:(0,u.jsxs)("div",{className:"modal",children:[(0,u.jsx)("div",{style:{fontWeight:700,marginBottom:8},children:"Senaryo Sil"}),(0,u.jsx)("div",{className:"small",children:Jl}),(0,u.jsxs)("div",{className:"row",style:{justifyContent:"flex-end",marginTop:12},children:[(0,u.jsx)("button",{className:"btn",onClick:()=>si(null),disabled:Qi,children:"Iptal"}),(0,u.jsx)("button",{className:"btn danger",onClick:async function(){if(!ti)return;const e=ti;si(null),await async function(e){if(!Nl)return;if(!X||!e)return;if(Qi)return;const i=V.find(i=>String(i.id)===String(e));if(!i)return;if(A(i))return void se("Senaryo onayda veya onaylandi, silinemez.");se(""),ai(e);try{await o.FH.deleteScenario(X,e);const i=await Yi();Array.isArray(i)&&(i.length?i.some(e=>String(e.id)===String(Q))||ee(i[0].id):(ee(null),ne(null),ae(null))),t.oR.success("Senaryo silindi.")}catch(l){se(l.message||"Senaryo silinemedi.")}finally{ai(null)}}(e)},disabled:Qi,children:"Sil"})]})]})}):null,oi?(0,u.jsx)("div",{className:"modal-backdrop",role:"dialog","aria-modal":"true",children:(0,u.jsxs)("div",{className:"modal",style:{width:"min(980px, 96vw)",maxHeight:"86vh",overflowY:"auto"},children:[(0,u.jsxs)("div",{className:"row",style:{justifyContent:"space-between"},children:[(0,u.jsx)("div",{style:{fontWeight:700},children:"Senaryo Kopyalama"}),(0,u.jsx)("button",{className:"btn",onClick:Rl,disabled:Qi,children:"Kapat"})]}),(0,u.jsx)("div",{className:"small",style:{marginTop:6},children:"Yeni senaryo icin para birimini secin."}),mi?(0,u.jsx)("div",{className:"card",style:{marginTop:10,background:"#fff1f2",borderColor:"#fecaca"},children:mi}):null,(0,u.jsxs)("div",{style:{marginTop:12},children:[(0,u.jsx)("div",{className:"small",style:{fontWeight:700,marginBottom:6},children:"Para Birimi"}),(0,u.jsxs)("div",{className:"row",style:{gap:12,alignItems:"center"},children:[(0,u.jsxs)("label",{className:"row",style:{gap:6,alignItems:"center"},children:[(0,u.jsx)("input",{type:"radio",name:"copy-currency",checked:"USD"===bi,onChange:()=>{fi("USD"),yi("")}}),(0,u.jsx)("span",{children:"USD"})]}),(0,u.jsxs)("label",{className:"row",style:{gap:6,alignItems:"center"},children:[(0,u.jsx)("input",{type:"radio",name:"copy-currency",checked:"LOCAL"===bi,onChange:()=>{fi("LOCAL"),yi("")}}),(0,u.jsx)("span",{children:"LOCAL"})]})]})]}),"USD"===dl&&"LOCAL"===bi?(0,u.jsxs)("div",{style:{marginTop:12},children:[(0,u.jsxs)("div",{className:"row",style:{gap:8,alignItems:"center"},children:[(0,u.jsx)("div",{className:"small",style:{fontWeight:700},children:"Local currency code"}),(0,u.jsx)("input",{className:"input sm",list:"local-currency-codes-copy",placeholder:"TRY",value:xi,onChange:e=>ki(e.target.value.toUpperCase().replace(/[^A-Z0-9]/g,"").slice(0,10))}),(0,u.jsx)("datalist",{id:"local-currency-codes-copy",children:O.map(e=>(0,u.jsx)("option",{value:e},e))})]}),(0,u.jsxs)("div",{className:"row",style:{gap:8,alignItems:"center",marginTop:10},children:[(0,u.jsx)("span",{children:"1 USD ="}),(0,u.jsx)("input",{className:"input sm",type:"number",step:"0.000001",value:ji,onChange:e=>Ni(e.target.value)}),(0,u.jsx)("span",{children:xi||"LOCAL"})]}),(0,u.jsx)("div",{className:"small muted",style:{marginTop:6},children:"Planlanan kur (senaryo ayarlari icin)."}),(0,u.jsxs)("div",{className:"row",style:{gap:8,alignItems:"center",marginTop:10},children:[(0,u.jsx)("span",{children:"Kopyalama kuru:"}),(0,u.jsx)("input",{className:"input sm",type:"number",step:"0.000001",value:Si,onChange:e=>Ci(e.target.value)}),(0,u.jsx)("span",{children:xi||"LOCAL"})]}),(0,u.jsx)("div",{className:"small muted",style:{marginTop:6},children:"Kopyalama kuruna gore tum rakamlar cevrilir."})]}):null,"LOCAL"===dl&&"USD"===bi?(0,u.jsxs)("div",{style:{marginTop:12},children:[(0,u.jsxs)("div",{className:"row",style:{gap:8,alignItems:"center"},children:[(0,u.jsx)("span",{children:"1 USD ="}),(0,u.jsx)("input",{className:"input sm",type:"number",step:"0.000001",value:Si,onChange:e=>Ci(e.target.value)}),(0,u.jsx)("span",{children:ul})]}),(0,u.jsx)("div",{className:"small muted",style:{marginTop:6},children:"Kopyalama kuru (LOCAL -> USD)."})]}):null,hi?(0,u.jsx)("div",{className:"small",style:{marginTop:10,color:"#0369a1"},children:hi}):null,(0,u.jsxs)("div",{style:{marginTop:16},children:[(0,u.jsxs)("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center"},children:[(0,u.jsx)("div",{style:{fontWeight:700},children:"Kopyalanacak Bolumler"}),(0,u.jsxs)("div",{className:"row",style:{gap:6,alignItems:"center"},children:[(0,u.jsxs)("div",{className:"small muted",children:["Secili: ",ol]}),(0,u.jsx)("button",{type:"button",className:"btn",onClick:()=>Ul("all"),disabled:Qi,children:"Tumu"}),(0,u.jsx)("button",{type:"button",className:"btn",onClick:()=>Ul("structure"),disabled:Qi,children:"Yapisi"}),(0,u.jsx)("button",{type:"button",className:"btn",onClick:()=>Ul("financial"),disabled:Qi,children:"Finans"})]})]}),(0,u.jsx)("div",{style:{marginTop:10,display:"grid",gap:12,gridTemplateColumns:"repeat(auto-fit, minmax(240px, 1fr))"},children:S.map(e=>(0,u.jsxs)("div",{className:"card",style:{padding:12},children:[(0,u.jsxs)("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center"},children:[(0,u.jsx)("div",{style:{fontWeight:700},children:e.label}),(0,u.jsxs)("div",{className:"row",style:{gap:4},children:[(0,u.jsx)("button",{type:"button",className:"btn",style:{padding:"2px 6px",fontSize:12},onClick:()=>Hl(e.key,!0),disabled:Qi,children:"Tumu"}),(0,u.jsx)("button",{type:"button",className:"btn",style:{padding:"2px 6px",fontSize:12},onClick:()=>Hl(e.key,!1),disabled:Qi,children:"Temizle"})]})]}),(0,u.jsx)("div",{style:{marginTop:8,display:"flex",flexDirection:"column",gap:6},children:e.sections.map(e=>(0,u.jsxs)("label",{className:"row",style:{gap:6,alignItems:"center"},children:[(0,u.jsx)("input",{type:"checkbox",checked:!(null===pi||void 0===pi||!pi[e.id]),onChange:i=>Pl(e.id,i.target.checked),disabled:Qi}),(0,u.jsx)("span",{className:"small",children:e.label})]},e.id))})]},e.key))})]}),(0,u.jsxs)("div",{className:"row",style:{justifyContent:"flex-end",marginTop:14},children:[(0,u.jsx)("button",{className:"btn",onClick:Rl,disabled:Qi,children:"Iptal"}),(0,u.jsx)("button",{className:"btn primary",onClick:async function(){if(!pi)return;if(li)return;const e=z(pi),i=String(bi||dl).toUpperCase();let l=null,r=null,n=null;if("USD"===dl&&"LOCAL"===i){const e=String(xi||"").toUpperCase().replace(/[^A-Z0-9]/g,"").slice(0,10);if(!T.test(e))return void yi("Local para birimi kodu gecersiz.");const i=Ml(ji);if(!Number.isFinite(i)||i<=0)return void yi("Gecerli bir kur girilmelidir.");const a=Ml(Si);if(!Number.isFinite(a)||a<=0)return void yi("Gecerli bir kopyalama kuru girilmelidir.");l=e,r=i,n=a}if("LOCAL"===dl&&"USD"===i){const e=Ml(Si);if(!Number.isFinite(e)||e<=0)return void yi("Gecerli bir kopyalama kuru girilmelidir.");n=e}Rl(),await async function(){var e,i,l;let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!fl)return;if(!Q||!ie||!re)return;if(li)return;if(!ie.academic_year)return void se("Akademik yil bulunamadi.");se("");const n=z((null===r||void 0===r?void 0:r.selection)||Y("all"));if(!!n["hr.ik"]!==!!n["expenses.giderler"])return void t.oR.warn("IK ve Giderler birlikte secilmelidir.");const a=String((null===r||void 0===r?void 0:r.targetCurrency)||dl).toUpperCase();let s=null!==(e=null===r||void 0===r?void 0:r.localCurrencyCode)&&void 0!==e?e:null,c=null!==(i=null===r||void 0===r?void 0:r.plannedFxUsdToLocal)&&void 0!==i?i:null,d=null!==(l=null===r||void 0===r?void 0:r.copyFxUsdToLocal)&&void 0!==l?l:null,u=Ml(c),m=Ml(d);if("LOCAL"===dl&&"LOCAL"===a){var y,p,g;s=null!==(y=null!==(p=s)&&void 0!==p?p:ie.local_currency_code)&&void 0!==y?y:"",c=null!==(g=c)&&void 0!==g?g:ie.fx_usd_to_local,u=Ml(c)}if("LOCAL"===dl&&"USD"===a){var h;if(d=null!==(h=d)&&void 0!==h?h:ie.fx_usd_to_local,m=Ml(d),!Number.isFinite(m)||m<=0)return void t.oR.warn("Gecerli bir kopyalama kuru girilmelidir.")}if("USD"===dl&&"LOCAL"===a){if(!s||!T.test(s))return void t.oR.warn("Local para birimi kodu gecersiz.");if(!Number.isFinite(u)||u<=0)return void t.oR.warn("Gecerli bir kur girilmelidir.");if(!Number.isFinite(m)||m<=0)return void t.oR.warn("Gecerli bir kopyalama kuru girilmelidir.")}ri(Q);try{var v;const e=ie.name||"Senaryo",i="".concat(e," (Kopya)");let l=I(ie.academic_year);if(!l)throw new Error("Akademik yil formati gecersiz.");let r=0;const c=e=>V.some(i=>String((null===i||void 0===i?void 0:i.academic_year)||"").trim()===String(e).trim());for(;c(l);)if(l=I(l),r+=1,!l||r>20)throw new Error("Uygun yeni akademik yil bulunamadi.");const d=!!n["temel.core"],y=(0,f.Ds)(d&&(null===re||void 0===re||null===(v=re.temelBilgiler)||void 0===v?void 0:v.kademeler)||(0,f.jc)()),p=d&&(null===ie||void 0===ie?void 0:ie.program_type)||x.Rw.LOCAL,g="LOCAL"===a&&Number.isFinite(u)&&u>0?u:null,h=await o.FH.createScenario(X,{name:i,academicYear:l,kademeConfig:y,inputCurrency:a,localCurrencyCode:"LOCAL"===a?s||"":null,fxUsdToLocal:g,programType:p});let N=function(e,i){var l;const r=i||{},n=e=>!!r[e],a=structuredClone(e||{}),t=()=>(0,f.oP)().map(e=>({grade:e,branchCount:0,studentsPerBranch:0})),s=null!==e&&void 0!==e&&e.gradesYears&&"object"===typeof e.gradesYears?e.gradesYears:{},o=Array.isArray(null===e||void 0===e?void 0:e.grades)?e.grades:null,c=Array.isArray(null===s||void 0===s?void 0:s.y1)?s.y1:Array.isArray(o)?o:t(),d=n("norm.planned"),u=n("norm.lessonY1"),m=Array.isArray(null===s||void 0===s?void 0:s.y2)?s.y2:u?c:t(),y=Array.isArray(null===s||void 0===s?void 0:s.y3)?s.y3:u?c:t();if(a.temelBilgiler=a.temelBilgiler||{},n("temel.core")||(delete a.temelBilgiler.kademeler,delete a.temelBilgiler.programType),n("temel.pricing")||(delete a.temelBilgiler.inflation,delete a.temelBilgiler.ucretArtisOranlari,delete a.temelBilgiler.okulUcretleriHesaplama),n("temel.schoolInfo")||(delete a.temelBilgiler.yetkililer,delete a.temelBilgiler.okulEgitimBilgileri),n("temel.discountsMeta")||(delete a.temelBilgiler.ikMevcut,delete a.temelBilgiler.bursIndirimOgrenciSayilari),n("temel.competitors")||delete a.temelBilgiler.rakipAnalizi,n("temel.performance")||(delete a.temelBilgiler.performans,delete a.temelBilgiler.degerlendirme),null!==(l=a.temelBilgiler)&&void 0!==l&&l.performans&&"object"===typeof a.temelBilgiler.performans&&delete a.temelBilgiler.performans.gerceklesen,n("kapasite.all")||(delete a.kapasite,delete a.schoolCapacity),n("norm.current")||delete a.gradesCurrent,d||u){const e=u?structuredClone(c):structuredClone(t()),i=d?structuredClone(m):structuredClone(t()),l=d?structuredClone(y):structuredClone(t());a.gradesYears={y1:e,y2:i,y3:l},u?a.grades=structuredClone(e):delete a.grades}else delete a.gradesYears,delete a.grades;return n("hr.ik")||delete a.ik,n("income.gelirler")||delete a.gelirler,n("expenses.giderler")||delete a.giderler,n("expenses.discounts")||delete a.discounts,a}(re,n);n["hr.ik"]&&n["expenses.giderler"]&&(N=function(e){var i,l,r;const n=e||{},a=n.ik||{},t=null!==a&&void 0!==a&&null!==(i=a.years)&&void 0!==i&&i.y1?a.years.y1:a,s=(null===t||void 0===t?void 0:t.unitCosts)||{},o=(null===t||void 0===t?void 0:t.headcountsByLevel)||{},c=["turk_mudur","turk_mdyard","turk_egitimci","turk_temsil","yerel_yonetici_egitimci","yerel_destek","yerel_ulke_temsil_destek","int_yonetici_egitimci"],d=["okulOncesi","ilkokulYerel","ilkokulInt","ortaokulYerel","ortaokulInt","liseYerel","liseInt"],u={};for(const b of c){let e=0;for(const i of d){var m;e+=Number((null===o||void 0===o||null===(m=o[i])||void 0===m?void 0:m[b])||0)}u[b]=Number((null===s||void 0===s?void 0:s[b])||0)*e}const y={turkPersonelMaas:(u.turk_mudur||0)+(u.turk_mdyard||0)+(u.turk_egitimci||0),turkDestekPersonelMaas:u.turk_temsil||0,yerelPersonelMaas:u.yerel_yonetici_egitimci||0,yerelDestekPersonelMaas:(u.yerel_destek||0)+(u.yerel_ulke_temsil_destek||0),internationalPersonelMaas:u.int_yonetici_egitimci||0},p=(null===n||void 0===n||null===(l=n.giderler)||void 0===l||null===(r=l.isletme)||void 0===r?void 0:r.items)||{},g=Object.keys(y);let h=!1;for(const b of g){const e=Number((null===p||void 0===p?void 0:p[b])||0),i=Number((null===y||void 0===y?void 0:y[b])||0);if(Math.abs(e-i)>1e-6){h=!0;break}}if(!h)return n;const v=structuredClone(n);v.giderler=v.giderler||{},v.giderler.isletme=v.giderler.isletme||{},v.giderler.isletme.items=v.giderler.isletme.items||{};for(const b of g)v.giderler.isletme.items[b]=Number(y[b]||0);return v}(N)),N=U(N),N=M(N),N=P(N),"USD"===dl&&"LOCAL"===a&&(N=E(N,m),N.temelBilgiler=N.temelBilgiler||{},N.temelBilgiler.performans=N.temelBilgiler.performans||{},N.temelBilgiler.performans.prevYearRealizedFxUsdToLocal=Number(m)),"LOCAL"===dl&&"USD"===a&&(N=function(e,i){const l=Number(i);return!Number.isFinite(l)||l<=0?e:E(e,1/l)}(N,m),N.temelBilgiler=N.temelBilgiler||{},N.temelBilgiler.performans=N.temelBilgiler.performans||{},N.temelBilgiler.performans.prevYearRealizedFxUsdToLocal=Number(m));const S=function(e){const i=new Set;return e&&"object"===typeof e?(Object.entries(e).forEach(e=>{let[l,r]=e;if(!r)return;const n=C[l];Array.isArray(n)&&n.forEach(e=>i.add(e))}),Array.from(i)):[]}(n);if(await o.FH.saveScenarioInputs(X,h.id,N,S),n["norm.lessonY1"])try{const e=await o.FH.getNormConfig(X,Q);if(e){var b,k,j;const i=null!==e&&void 0!==e&&e.years&&"object"===typeof e.years?e.years:{},l=Number(null!==(b=null!==(k=null===i||void 0===i||null===(j=i.y1)||void 0===j?void 0:j.teacherWeeklyMaxHours)&&void 0!==k?k:null===e||void 0===e?void 0:e.teacherWeeklyMaxHours)&&void 0!==b?b:24),r={years:{y1:null!==i&&void 0!==i&&i.y1?structuredClone(i.y1):{teacherWeeklyMaxHours:Number.isFinite(l)&&l>0?l:24,curriculumWeeklyHours:null!==e&&void 0!==e&&e.curriculumWeeklyHours&&"object"===typeof e.curriculumWeeklyHours?structuredClone(e.curriculumWeeklyHours):D()},y2:F(l),y3:F(l)}};await o.FH.saveNormConfig(X,h.id,r)}}catch(te){console.warn("[copyScenario] norm copy skipped",te)}await Yi(),ee(h.id),t.oR.success("Senaryo kopyalandi.")}catch(N){se(N.message||"Scenario copy failed")}finally{ri(null)}}({targetCurrency:i,localCurrencyCode:l,plannedFxUsdToLocal:r,copyFxUsdToLocal:n,selection:e})},disabled:Qi||li||!pi||!cl,children:li?(0,u.jsxs)("span",{style:{display:"inline-flex",gap:6,alignItems:"center"},children:[(0,u.jsx)(K,{}),(0,u.jsx)("span",{children:"Kopyalaniyor..."})]}):"Tamam"})]})]})}):null,di?(0,u.jsx)(b,{open:di,onClose:()=>ui(!1),sourceScenario:il,sourceSchoolId:X,sourceSchoolName:ll}):null,Pe?(0,u.jsx)("div",{className:"modal-backdrop",role:"dialog","aria-modal":"true",children:(0,u.jsxs)("div",{className:"modal scenario-wizard-modal",children:[(0,u.jsxs)("div",{className:"scenario-wizard-header",children:[(0,u.jsxs)("div",{className:"row",style:{justifyContent:"space-between"},children:[(0,u.jsx)("div",{style:{fontWeight:700},children:"edit"===Re?"Senaryo Kurulumunu Duzenle":"Yeni Senaryo Kurulumu"}),(0,u.jsx)("button",{className:"btn",onClick:function(){se(""),He(!1),Ze(!1),Xe(!1),Ue(0)},disabled:qe||$e,children:"Kapat"})]}),(0,u.jsx)("div",{className:"small",style:{marginTop:6},children:"edit"===Re?"Senaryo ayarlarini guncelleyip kaydedebilirsiniz.":"Adim adim kurulum tamamlayin."})]}),(0,u.jsxs)("div",{className:"scenario-wizard-body",children:[te?(0,u.jsx)("div",{className:"card",style:{marginTop:10,background:"#fff1f2",borderColor:"#fecaca"},children:te}):null,$e?(0,u.jsx)("div",{className:"card",style:{marginTop:12},children:"Yukleniyor..."}):(0,u.jsxs)("div",{style:{marginTop:12},children:[(0,u.jsxs)("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center"},children:[(0,u.jsx)("div",{style:{fontWeight:700},children:"Kurulum Adimi"}),(0,u.jsx)("div",{className:"small",children:"Adim ".concat(Me+1," / ").concat(6,": ").concat(["Donem Turu","Para Birimi","Program Turu","Yil","Kademeler","Senaryo Adi"][Me])})]}),0===Me&&(0,u.jsxs)("div",{style:{marginTop:10},children:[(0,u.jsx)("div",{className:"small",style:{fontWeight:700,marginBottom:6},children:"Donem Turu"}),(0,u.jsxs)("div",{className:"row",style:{gap:12,alignItems:"center"},children:[(0,u.jsxs)("label",{className:"row",style:{gap:6,alignItems:"center"},children:[(0,u.jsx)("input",{type:"radio",name:"scenario-period",checked:"full"===je,onChange:()=>Dl("full")}),(0,u.jsx)("span",{children:"Tam Yil (tek yil)"})]}),(0,u.jsxs)("label",{className:"row",style:{gap:6,alignItems:"center"},children:[(0,u.jsx)("input",{type:"radio",name:"scenario-period",checked:"split"===je,onChange:()=>Dl("split")}),(0,u.jsx)("span",{children:"Yil ortasinda baslar, sonraki yil biter"})]})]})]}),1===Me&&(0,u.jsxs)("div",{style:{marginTop:10},children:[(0,u.jsx)("div",{className:"small",style:{fontWeight:700,marginBottom:6},children:"Para Birimi"}),(0,u.jsxs)("div",{className:"row",style:{gap:12,alignItems:"center"},children:[(0,u.jsxs)("label",{className:"row",style:{gap:6,alignItems:"center"},children:[(0,u.jsx)("input",{type:"radio",name:"scenario-currency",checked:"USD"===Ie,onChange:()=>Yl("USD"),disabled:"edit"===Re}),(0,u.jsx)("span",{children:"USD"})]}),(0,u.jsxs)("label",{className:"row",style:{gap:6,alignItems:"center"},children:[(0,u.jsx)("input",{type:"radio",name:"scenario-currency",checked:"LOCAL"===Ie,onChange:()=>Yl("LOCAL"),disabled:"edit"===Re}),(0,u.jsx)("span",{children:"Local currency"})]})]}),"LOCAL"===Ie&&(0,u.jsxs)("div",{style:{marginTop:10},children:[(0,u.jsxs)("div",{className:"row",style:{gap:8,alignItems:"center"},children:[(0,u.jsx)("div",{className:"small",style:{fontWeight:700},children:"Local currency code"}),(0,u.jsx)("input",{className:"input sm",list:"local-currency-codes",placeholder:"TRY",value:ze,onChange:e=>Ye(e.target.value.toUpperCase().replace(/[^A-Z0-9]/g,"").slice(0,10))}),(0,u.jsx)("datalist",{id:"local-currency-codes",children:O.map(e=>(0,u.jsx)("option",{value:e},e))})]}),Vi?null:(0,u.jsx)("div",{className:"small",style:{color:"#b91c1c",marginTop:6},children:"Code 2-10 chars, A-Z0-9."}),(0,u.jsxs)("div",{className:"row",style:{gap:8,alignItems:"center",marginTop:10},children:[(0,u.jsx)("span",{children:"1 USD ="}),(0,u.jsx)("input",{className:"input sm",type:"number",step:"0.000001",value:De,onChange:e=>Fe(e.target.value)}),(0,u.jsx)("span",{children:Wi||"LOCAL"})]}),Zi?null:(0,u.jsx)("div",{className:"small",style:{color:"#b91c1c",marginTop:6},children:"FX rate must be > 0."}),(0,u.jsx)("div",{className:"small muted",style:{marginTop:6},children:"Kur formati: 1 USD = X LOCAL"})]})]}),2===Me&&(0,u.jsxs)("div",{style:{marginTop:10},children:[(0,u.jsx)("div",{className:"small",style:{fontWeight:700,marginBottom:6},children:"Program Turu"}),(0,u.jsx)("div",{className:"row",style:{gap:12},children:[{key:x.Rw.LOCAL,label:"Yerel",hint:"Yerel kademeleri planlayin"},{key:x.Rw.INTERNATIONAL,label:"International",hint:"Uluslararasi kademeleri planlayin"}].map(e=>(0,u.jsxs)("button",{type:"button",className:"btn ".concat(Ee===e.key?"primary":"ghost"),"aria-pressed":Ee===e.key,onClick:()=>Ke(e.key),children:[(0,u.jsx)("div",{style:{fontWeight:700},children:e.label}),(0,u.jsx)("div",{className:"small",style:{opacity:.75},children:e.hint})]},e.key))})]}),3===Me&&(0,u.jsxs)("div",{style:{marginTop:10},children:[(0,u.jsx)("div",{className:"small",style:{fontWeight:700,marginBottom:6},children:"Yil"}),"full"===je?(0,u.jsx)("input",{className:"input sm num-spin",type:"number",step:"1",placeholder:w,value:Se,onChange:e=>Fl(e.target.value)}):(0,u.jsxs)("div",{className:"row",style:{gap:8,alignItems:"center"},children:[(0,u.jsx)("input",{className:"input sm num-spin",type:"number",step:"1",placeholder:w,value:Se,onChange:e=>Fl(e.target.value)}),(0,u.jsx)("span",{className:"muted",children:"-"}),(0,u.jsx)("input",{className:"input sm num-spin",type:"number",step:"1",placeholder:L,value:Ae,readOnly:!0})]}),(0,u.jsxs)("div",{className:"small muted",style:{marginTop:6},children:["Akademik yil: ",Mi||"-","split"===je&&Mi&&!Ui?(0,u.jsx)("span",{style:{color:"#b91c1c",marginLeft:8},children:"Bitis yili, baslangic yilindan 1 fazla olmali."}):null,Mi&&Pi?(0,u.jsx)("span",{style:{color:"#b91c1c",marginLeft:8},children:"Bu yil turu icin zaten bir senaryo var."}):null]})]}),4===Me&&(0,u.jsxs)("div",{style:{marginTop:10},children:[(0,u.jsx)("div",{className:"small",style:{fontWeight:700,marginBottom:6},children:"Kademeler"}),(0,u.jsxs)("label",{className:"row small",style:{gap:8,alignItems:"center",marginBottom:8},children:[(0,u.jsx)("input",{type:"checkbox",checked:Oe,onChange:e=>(e=>{const i=Boolean(e);Be(i),Te(e=>{const l=(0,f.Ds)(e);if(i)return Ti.current=structuredClone(l),Object.fromEntries(Object.entries(l).map(e=>{let[i,l]=e;return[i,(0,r.A)((0,r.A)({},l),{},{enabled:!1})]}));const n=Ti.current;return Ti.current=null,n?(0,f.Ds)(n):(0,f.jc)()})})(e.target.checked)}),(0,u.jsx)("span",{children:"Kademe yok (Merkez / Headquarter)"})]}),Oe?(0,u.jsx)("div",{className:"small muted",style:{marginBottom:8},children:"Bu senaryo icin kademe secmeye gerek yok. Kademe-bagimli alanlar ilerleme hesabina dahil edilmez."}):null,(0,u.jsxs)("table",{className:"table",children:[(0,u.jsx)("thead",{children:(0,u.jsxs)("tr",{children:[(0,u.jsx)("th",{children:"Kademe"}),(0,u.jsx)("th",{style:{width:120},children:"Aktif"}),(0,u.jsx)("th",{style:{width:160},children:"Baslangic"}),(0,u.jsx)("th",{style:{width:160},children:"Bitis"})]})}),(0,u.jsx)("tbody",{children:Di.map(e=>{const i=Hi[e.key];return(0,u.jsxs)("tr",{children:[(0,u.jsx)("td",{style:{fontWeight:700},children:e.label}),(0,u.jsx)("td",{children:(0,u.jsx)("input",{type:"checkbox",checked:!(null===i||void 0===i||!i.enabled),disabled:Oe,onChange:i=>Kl(e.key,{enabled:i.target.checked})})}),(0,u.jsx)("td",{children:(0,u.jsx)("select",{className:"input sm",value:(null===i||void 0===i?void 0:i.from)||"",onChange:i=>Kl(e.key,{from:i.target.value}),disabled:Oe||!(null!==i&&void 0!==i&&i.enabled),children:Fi.map(e=>(0,u.jsx)("option",{value:e,children:e},e))})}),(0,u.jsx)("td",{children:(0,u.jsx)("select",{className:"input sm",value:(null===i||void 0===i?void 0:i.to)||"",onChange:i=>Kl(e.key,{to:i.target.value}),disabled:Oe||!(null!==i&&void 0!==i&&i.enabled),children:Fi.map(e=>(0,u.jsx)("option",{value:e,children:e},e))})})]},e.key)})})]}),Oe||Ri?null:(0,u.jsx)("div",{className:"small",style:{color:"#b91c1c"},children:"En az bir kademe secmelisiniz."})]}),5===Me&&(0,u.jsxs)("div",{style:{marginTop:10},children:[(0,u.jsx)("div",{className:"small",style:{fontWeight:700,marginBottom:6},children:"Senaryo Adi"}),(0,u.jsx)("div",{className:"row",children:(0,u.jsx)("input",{className:"input",placeholder:"Senaryo adi",value:xe,onChange:e=>ke(e.target.value)})}),xe.trim()?null:(0,u.jsx)("div",{className:"small",style:{color:"#b91c1c",marginTop:6},children:"Senaryo adi zorunludur."})]})]})]}),$e?null:(0,u.jsxs)("div",{className:"scenario-wizard-footer",children:[(0,u.jsx)("button",{className:"btn",onClick:function(){se(""),Ue(e=>Math.max(0,e-1))},disabled:0===Me||qe,children:"Geri"}),(0,u.jsx)("button",{className:"btn primary",onClick:function(){if(se(""),qe)return;const e=function(e){if(1===e&&"LOCAL"===Ie){if(!Vi)return"Local currency code zorunludur.";if(!Zi)return"Kur degeri zorunlu ve 0'dan buyuk olmali."}if(2===e&&!Ee)return"Program Turu secilmelidir.";if(3===e){if(!Mi)return"Lutfen gecerli bir akademik yil girin.";if(!Ui)return"Bitis yili, baslangic yilindan 1 fazla olmali.";if(Pi)return"Bu yil turu icin zaten bir senaryo var. Lutfen baska bir yil secin."}return 4!==e||Gi?5!==e||xe.trim()?"":"Senaryo adi zorunludur.":"En az bir kademe secmelisiniz."}(Me);e?se(e):Me<5?Ue(e=>Math.min(e+1,5)):async function(){if("edit"===Re)return void await async function(){if(!X||null===We||void 0===We||!We.id)return;const e=xe.trim();if(!e)return;if(!Mi)return void se("Lutfen gecerli bir akademik yil girin.");if(!Ui)return void se("Bitis yili, baslangic yilindan 1 fazla olmali.");if(Pi)return void se("Bu yil turu icin zaten bir senaryo var. Lutfen baska bir yil secin.");if(!Gi)return void se("En az bir kademe secmelisiniz.");if("LOCAL"===(null===We||void 0===We?void 0:We.input_currency)){if(!Vi)return void se("Local currency code zorunludur.");if(!Zi)return void se("Kur degeri zorunlu ve 0'dan buyuk olmali.")}se(""),Xe(!0);try{const i=Ee||x.Rw.LOCAL,l=(0,f.Ds)(Le),n=Oe?Object.fromEntries(Object.entries(l).map(e=>{let[i,l]=e;return[i,(0,r.A)((0,r.A)({},l),{},{enabled:!1})]})):l;await o.FH.updateScenario(X,We.id,{name:e,academicYear:Mi,kademeConfig:n,programType:i,localCurrencyCode:"LOCAL"===(null===We||void 0===We?void 0:We.input_currency)?Wi:void 0,fxUsdToLocal:"LOCAL"===(null===We||void 0===We?void 0:We.input_currency)?De:void 0}),await Yi(),ee(We.id),le(l=>l&&l.id===We.id?(0,r.A)((0,r.A)({},l),{},{name:e,academic_year:Mi,program_type:i},"LOCAL"===(null===We||void 0===We?void 0:We.input_currency)?{local_currency_code:Wi,fx_usd_to_local:$i}:{}):l),ne(e=>{if(!e||"object"!==typeof e)return e;const l=structuredClone(e);return l.temelBilgiler=l.temelBilgiler||{},l.temelBilgiler.kademeler=n,l.temelBilgiler.programType=i,l}),He(!1),Ue(0)}catch(i){se(i.message||"Senaryo guncellenemedi.")}finally{Xe(!1)}}();await async function(){if(!X)return;const e=xe.trim();if(!e)return;if(!Mi)return void se("Lutfen gecerli bir akademik yil girin.");if(!Ui)return void se("Bitis yili, baslangic yilindan 1 fazla olmali.");if(Pi)return void se("Bu yil turu icin zaten bir senaryo var. Lutfen baska bir yil secin.");if(!Gi)return void se("En az bir kademe secmelisiniz.");if("LOCAL"===Ie){if(!Vi)return void se("Local currency code zorunludur.");if(!Zi)return void se("Kur degeri zorunlu ve 0'dan buyuk olmali.")}se(""),Xe(!0);try{const i=Ee||x.Rw.LOCAL,l=(0,f.Ds)(Le),n=Oe?Object.fromEntries(Object.entries(l).map(e=>{let[i,l]=e;return[i,(0,r.A)((0,r.A)({},l),{},{enabled:!1})]})):l,a=await o.FH.createScenario(X,{name:e,academicYear:Mi,kademeConfig:n,inputCurrency:Ie,localCurrencyCode:"LOCAL"===Ie?Wi:null,fxUsdToLocal:"LOCAL"===Ie?De:null,programType:i});await Yi(),ee(a.id),He(!1),Ue(0)}catch(i){se(i.message||"Senaryo olusturulamadi.")}finally{Xe(!1)}}()}()},disabled:qe||!Ji[Me],children:qe?(0,u.jsxs)("span",{style:{display:"inline-flex",gap:6,alignItems:"center"},children:[(0,u.jsx)(K,{}),(0,u.jsx)("span",{children:"edit"===Re?"Kaydediliyor...":"Olusturuluyor..."})]}):Me<5?"Ileri":"edit"===Re?"Kaydet":"Bitir"})]})]})}):null,(0,u.jsxs)("div",{className:"row select-page-tables",style:{gap:12,alignItems:"stretch",flexWrap:"wrap"},children:[(0,u.jsxs)("div",{className:"card select-table-card",style:{flex:"1 1 320px",minWidth:280},children:[(0,u.jsx)("div",{style:{fontWeight:700,marginBottom:8},children:"Okullar"}),oe?(0,u.jsx)("div",{className:"small",children:"Yukleniyor..."}):(0,u.jsx)("div",{className:"select-table-body",children:(0,u.jsxs)("table",{className:"table select-school-table",children:[(0,u.jsxs)("colgroup",{children:[(0,u.jsx)("col",{style:{width:32}}),(0,u.jsx)("col",{}),(0,u.jsx)("col",{style:{width:180}})]}),(0,u.jsx)("thead",{children:(0,u.jsxs)("tr",{children:[(0,u.jsx)("th",{}),(0,u.jsx)("th",{children:"Okul"}),(0,u.jsx)("th",{children:"\u0130lerleme"})]})}),(0,u.jsx)("tbody",{children:0===G.length?(0,u.jsx)("tr",{children:(0,u.jsx)("td",{colSpan:"3",className:"small",children:"Okul bulunamadi."})}):G.map(e=>{const i=String(X)===String(e.id),l=me[e.id];return(0,u.jsxs)("tr",{className:i?"scenario-row is-selected":"scenario-row",style:{cursor:i?"default":"pointer"},onClick:()=>{i||Ii(e.id)},children:[(0,u.jsx)("td",{onClick:e=>{e.stopPropagation()},children:(0,u.jsx)("input",{type:"checkbox",className:"select-checkbox",checked:i,"aria-label":"".concat(e.name," okulunu se\xe7"),onChange:l=>{l.stopPropagation(),i?_i():Ii(e.id)}})}),(0,u.jsx)("td",{onClick:l=>{l.stopPropagation(),i||Ii(e.id)},style:{cursor:"pointer"},children:(0,u.jsx)("b",{children:e.name})}),(0,u.jsx)("td",{style:{minWidth:180},children:l?"active"===l.state?(0,u.jsx)(d.A,{value:l.pct,tooltipLines:l.tooltipLines}):(0,u.jsx)("div",{className:"small",children:l.label||"-"}):(0,u.jsx)("div",{className:"small",children:pe?"Hesaplan\u0131yor...":"-"})})]},e.id)})})]})})]}),(0,u.jsxs)("div",{className:"card select-table-card",style:{flex:"2 1 420px",minWidth:320},children:[(0,u.jsx)("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center",gap:12},children:(0,u.jsx)("div",{style:{fontWeight:700},children:"Senaryolar"})}),X?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsxs)("div",{className:"scenario-toolbar",style:{marginTop:10},children:[vl?(0,u.jsx)("button",{type:"button",className:"btn primary",onClick:function(){vl&&(X?(se(""),ke(""),Ne("split"),Ce(w),we(L),Te((0,f.jc)()),Be(!1),Ti.current=null,_e("USD"),Ye(""),Fe(""),Ke(null),Ue(0),Ge("create"),Ve(null),He(!0)):se("Once okul secin."))},disabled:!X||Qi,title:"Yeni Senaryo",children:(0,u.jsxs)("span",{className:"btn-inner",children:[(0,u.jsx)(s.OiG,{"aria-hidden":"true"}),(0,u.jsx)("span",{children:"Yeni Senaryo"})]})}):null,bl?(0,u.jsx)("button",{type:"button",className:"btn",onClick:()=>{il&&El(il.id)},disabled:!Cl||Qi,title:"Planlamayi Duzenle",children:(0,u.jsxs)("span",{className:"btn-inner",children:[(0,u.jsx)(s.uO9,{"aria-hidden":"true"}),(0,u.jsx)("span",{children:"Planlamayi Duzenle"})]})}):null,fl?(0,u.jsx)("button",{type:"button",className:"btn",onClick:function(){fl&&Q&&ie&&re&&(li||(se(""),yi(""),gi(Y("all")),vi(""),fi("LOCAL"===dl?"LOCAL":"USD"),ki(""),Ni(""),Ci(""),ci(!0)))},disabled:!Bl||Ai||Qi,title:"Kopyala",children:(0,u.jsxs)("span",{className:"btn-inner",children:[Il?(0,u.jsx)(K,{}):(0,u.jsx)(s.paH,{"aria-hidden":"true"}),(0,u.jsx)("span",{children:"Kopyala"})]})}):null,xl?(0,u.jsx)("button",{type:"button",className:"btn",onClick:()=>ui(!0),disabled:!il||Qi,title:"Gider Payla\u015ft\u0131r",children:(0,u.jsxs)("span",{className:"btn-inner",children:[(0,u.jsx)(s.CbL,{"aria-hidden":"true"}),(0,u.jsx)("span",{children:"Gider Payla\u015ft\u0131r"})]})}):null,jl&&Ll?(0,u.jsx)("button",{type:"button",className:"btn primary",onClick:()=>{il&&async function(e){if(!jl)return;if(!X||!e||e!==Q)return;if("approved"!==String((null===ie||void 0===ie?void 0:ie.status)||"draft")||null!==ie&&void 0!==ie&&ie.sent_at)se("Senaryo merkeze iletilemez.");else if($l("Merkeze iletme")&&Vl("Merkeze iletme")&&!ei){se(""),ii(e);try{if(!await Zl({keepTab:!0}))return;const i=await o.FH.sendForApproval(X,e);t.oR.success("Merkeze iletildi"),null!==i&&void 0!==i&&i.scenario&&le(e=>(0,r.A)((0,r.A)({},e||{}),i.scenario)),await Yi()}catch(i){se(i.message||"Gonderme basarisiz")}finally{ii(null)}}}(il.id)},disabled:!Ol||Ai||Qi,title:"Merkeze ilet",children:(0,u.jsxs)("span",{className:"btn-inner",children:[_l?(0,u.jsx)(K,{}):(0,u.jsx)(s.Cer,{style:{marginRight:4}}),(0,u.jsx)("span",{children:"Merkeze ilet"})]})}):null,kl&&wl?(0,u.jsx)("button",{type:"button",className:"btn primary",onClick:()=>{il&&async function(e){if(!kl)return;if(!X||!e||e!==Q)return;const i=String((null===ie||void 0===ie?void 0:ie.status)||"draft");if(["draft","revision_requested"].includes(i)){if($l("Onaya gonderme")&&Vl("Onaya gonderme")&&!ei){se(""),ii(e);try{if(!await Zl({keepTab:!0}))return;const i=await o.FH.submitScenario(X,e);t.oR.success("Senaryo onaya gonderildi."),null!==i&&void 0!==i&&i.scenario&&le(e=>(0,r.A)((0,r.A)({},e||{}),i.scenario)),await Yi()}catch(l){se(l.message||"Submit failed")}finally{ii(null)}}}else se("Senaryo onayda veya onaylandi, gonderilemez.")}(il.id)},disabled:!Tl||Ai||Qi,title:"Onaya Gonder",children:(0,u.jsxs)("span",{className:"btn-inner",children:[_l?(0,u.jsx)(K,{}):(0,u.jsx)(s.A7C,{style:{marginRight:4}}),(0,u.jsx)("span",{children:"Onaya Gonder"})]})}):null,Nl?(0,u.jsx)("button",{type:"button",className:"btn danger",onClick:()=>{var e;il&&(e=il.id,Nl&&e&&!Qi&&si(e))},disabled:!Al||Ai||Qi,title:"Sil",children:(0,u.jsxs)("span",{className:"btn-inner",children:[zl?(0,u.jsx)(K,{}):(0,u.jsx)(s.qbC,{style:{marginRight:4}}),(0,u.jsx)("span",{children:"Sil"})]})}):null]}),(0,u.jsx)("div",{className:"select-table-body select-table-body-gap",children:(0,u.jsxs)("table",{className:"table scenario-table",children:[(0,u.jsx)("thead",{children:(0,u.jsxs)("tr",{children:[(0,u.jsx)("th",{}),(0,u.jsx)("th",{"aria-sort":al("name"),children:(0,u.jsxs)("button",{type:"button",className:"sort-th",onClick:()=>nl("name"),"aria-label":"Sirala: Ad",children:[(0,u.jsx)("span",{children:"Ad"}),tl("name")]})}),(0,u.jsx)("th",{"aria-sort":al("year"),children:(0,u.jsxs)("button",{type:"button",className:"sort-th",onClick:()=>nl("year"),"aria-label":"Sirala: Yil",children:[(0,u.jsx)("span",{children:"Yil"}),tl("year")]})}),(0,u.jsx)("th",{"aria-sort":al("currency"),children:(0,u.jsxs)("button",{type:"button",className:"sort-th",onClick:()=>nl("currency"),"aria-label":"Sirala: Para Birimi",children:[(0,u.jsx)("span",{children:"Para Birimi"}),tl("currency")]})}),(0,u.jsx)("th",{"aria-sort":al("status"),children:(0,u.jsxs)("button",{type:"button",className:"sort-th",onClick:()=>nl("status"),"aria-label":"Sirala: Durum",children:[(0,u.jsx)("span",{children:"Durum"}),tl("status")]})}),(0,u.jsx)("th",{children:"\u0130lerleme"}),(0,u.jsx)("th",{"aria-sort":al("date"),children:(0,u.jsxs)("button",{type:"button",className:"sort-th",onClick:()=>nl("date"),"aria-label":"Sirala: Tarih",children:[(0,u.jsx)("span",{children:"Tarih"}),tl("date")]})})]})}),(0,u.jsx)("tbody",{children:de?(0,u.jsx)("tr",{children:(0,u.jsx)("td",{colSpan:"7",className:"small",children:"Yukleniyor..."})}):0===rl.length?(0,u.jsx)("tr",{children:(0,u.jsx)("td",{colSpan:"7",className:"small",children:"Gosterilecek senaryo yok."})}):rl.map(e=>{const i=function(e){const i=e&&"object"===typeof e?e:{status:e},l=i.status,r=i.sent_at;switch(l){case"revision_requested":return{label:"Revize istendi",cls:"is-revision",help:"Revize istendi: senaryoda d\xfczeltme gerekiyor."};case"sent_for_approval":case"submitted":return{label:"Merkeze iletildi",cls:"is-submitted",help:"Merkeze iletildi: admin onay\u0131 bekleniyor."};case"approved":return r?{label:"Onayland\u0131",cls:"is-approved",help:"Onayland\u0131: admin taraf\u0131ndan onayland\u0131."}:{label:"Kontrol edildi",cls:"is-approved",help:"Kontrol edildi: y\xf6netici taraf\u0131ndan kontrol edildi."};case"in_review":return{label:"\u0130ncelemede",cls:"is-submitted",help:"\u0130ncelemede: y\xf6netici incelemesinde."};case"draft":return{label:"Taslak",cls:"is-draft",help:"Taslak: senaryo \xfczerinde \xe7al\u0131\u015f\u0131l\u0131yor."};default:return{label:l||"-",cls:"is-unknown",help:""}}}(e),l=String(Q)===String(e.id),r=String(e.id)===String(el),n=Qi&&el&&!r,a=Qi,t="LOCAL"===e.input_currency?"".concat(e.local_currency_code||"LOCAL"," (LOCAL)"):"USD";return(0,u.jsxs)("tr",{className:l?"scenario-row is-selected":"scenario-row",style:{opacity:n?.5:1,pointerEvents:n?"none":"auto",cursor:l||a||n?"default":"pointer"},onClick:()=>{l||a||n||ee(e.id)},children:[(0,u.jsx)("td",{children:(0,u.jsx)("input",{type:"checkbox",className:"select-checkbox",checked:l,disabled:a||n,"aria-label":"".concat(e.name," senaryosunu se\xe7"),onChange:i=>{i.stopPropagation(),a||n||(l?zi():ee(e.id))}})}),(0,u.jsx)("td",{children:(0,u.jsx)("b",{className:"scenario-name",title:e.name,children:e.name})}),(0,u.jsx)("td",{children:e.academic_year}),(0,u.jsx)("td",{children:t}),(0,u.jsx)("td",{children:(0,u.jsx)("span",{className:"status-badge ".concat(i.cls),title:i.help,children:i.label})}),(0,u.jsx)("td",{style:{minWidth:160},children:he[e.id]&&!he[e.id].error?(0,u.jsx)(d.A,{value:he[e.id].pct,tooltipLines:he[e.id].tooltipLines}):(0,u.jsx)("span",{className:"small",children:be?"Hesaplan\u0131yor...":"-"})}),(0,u.jsx)("td",{className:"small",children:new Date(e.created_at).toLocaleString()})]},e.id)})})]})})]}):(0,u.jsx)("div",{className:"small muted",style:{marginTop:10},children:"Once okul secin."}),(0,u.jsx)("div",{className:"row select-table-footer",style:{justifyContent:"flex-end"},children:(0,u.jsx)("button",{className:"btn primary",onClick:()=>{if(!X||!Q)return;(0,k.sE)(X,Q),(0,k.f)(X);const e=(0,k.Mf)()||"temel-bilgiler";g("/schools/".concat(X,"/").concat(e),{replace:!0})},disabled:!X||!Q,children:"Uygula"})})]})]})]})}},9322(e,i,l){l.d(i,{Rw:()=>r,Z4:()=>o,ZG:()=>t,pb:()=>s,wN:()=>a});const r={LOCAL:"local",INTERNATIONAL:"international"},n=new Set(Object.values(r));function a(e){const i=String(e||"").trim().toLowerCase();return n.has(i)?i:r.LOCAL}function t(){var e,i,l;let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const s=null!==(e=null!==(i=null===n||void 0===n||null===(l=n.temelBilgiler)||void 0===l?void 0:l.programType)&&void 0!==i?i:null===n||void 0===n?void 0:n.programType)&&void 0!==e?e:null===n||void 0===n?void 0:n.program_type;if(s)return a(s);const o=(null===t||void 0===t?void 0:t.program_type)||(null===t||void 0===t?void 0:t.programType);return o?a(o):r.LOCAL}function s(e){const i=a(arguments.length>1&&void 0!==arguments[1]?arguments[1]:r.LOCAL);return!e||("okulOncesi"===e||(e.endsWith("Yerel")?i===r.LOCAL:!e.endsWith("Int")||i===r.INTERNATIONAL))}function o(e){const i=a(arguments.length>1&&void 0!==arguments[1]?arguments[1]:r.LOCAL);if("okulOncesi"===e)return"okulOncesi";const l=i===r.INTERNATIONAL?"Int":"Yerel";return"".concat(e).concat(l)}}}]);
//# sourceMappingURL=100.9fe29724.chunk.js.map