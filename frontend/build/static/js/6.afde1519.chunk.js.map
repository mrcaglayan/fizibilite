{"version":3,"file":"static/js/6.afde1519.chunk.js","mappings":"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","sources":["pages/ManagerReviewQueuePage.jsx"],"sourcesContent":["// frontend/src/pages/ManagerReviewQueuePage.jsx\r\n\r\nimport React, { useEffect, useState, useMemo, useCallback, useId, useRef } from 'react';\r\nimport { AnimatePresence, motion } from 'motion/react';\r\nimport { useNavigate, useOutletContext } from 'react-router-dom';\r\nimport { ToastContainer, toast } from 'react-toastify';\r\nimport { FaCheck, FaCheckCircle, FaExclamationTriangle, FaPaperPlane, FaSearch, FaStar, FaThLarge } from 'react-icons/fa';\r\nimport { api } from '../api';\r\nimport { useAuth } from '../auth/AuthContext';\r\nimport { writeGlobalLastRouteSegment, writeLastVisitedPath, writeSelectedScenarioId } from '../utils/schoolNavStorage';\r\n\r\n/**\r\n * ManagerReviewQueuePage\r\n *\r\n * Displays a list of scenarios for manager review.  Managers,\r\n * accountants, admins, or users granted the manage_permissions permission can\r\n * access this page.  The page lists each scenario's required modules and\r\n * allows the reviewer to approve or request revision for submitted modules.\r\n * The list refreshes automatically after each action.\n */\r\n\r\n// Define the stable required work item identifiers and their friendly labels.\r\nconst REQUIRED_WORK_IDS = [\r\n  'temel_bilgiler',\r\n  'kapasite',\r\n  'norm.ders_dagilimi',\r\n  'ik.local_staff',\r\n  'gelirler.unit_fee',\r\n  'giderler.isletme',\r\n];\r\n\r\nconst WORK_ID_LABELS = {\r\n  'temel_bilgiler': 'Temel Bilgiler',\r\n  'kapasite': 'Kapasite',\r\n  'norm.ders_dagilimi': 'Norm',\r\n  'ik.local_staff': 'İK',\r\n  'gelirler.unit_fee': 'Gelirler',\r\n  'giderler.isletme': 'Giderler',\r\n};\r\n\r\nconst WORK_ID_TO_ROUTE = {\r\n  'temel_bilgiler': 'temel-bilgiler',\r\n  'kapasite': 'kapasite',\r\n  'norm.ders_dagilimi': 'norm',\r\n  'ik.local_staff': 'ik',\r\n  'gelirler.unit_fee': 'gelirler',\r\n  'giderler.isletme': 'giderler',\r\n};\r\n\r\nfunction getRequiredTotal(entry) {\r\n  const total = Number(entry?.totalRequired);\r\n  if (Number.isFinite(total) && total > 0) return total;\r\n  if (Array.isArray(entry?.requiredItems)) return entry.requiredItems.length;\r\n  return REQUIRED_WORK_IDS.length;\r\n}\r\n\r\nconst FILTER_TABS = [\r\n  { key: 'all', label: 'Tümü' },\r\n  { key: 'ready', label: 'Merkeze İletilmeye Hazır' },\r\n  { key: 'in_review', label: 'İncelemede' },\r\n  { key: 'revision', label: 'Revize İstendi' },\r\n  { key: 'approved', label: 'Kontrol Edildi' },\r\n  { key: 'sent', label: 'Merkeze İletildi' },\r\n  { key: 'approved_final', label: 'Onaylandı' },\r\n];\r\n\r\nconst FILTER_TAB_ICONS = {\r\n  all: FaThLarge,\r\n  ready: FaCheckCircle,\r\n  in_review: FaSearch,\r\n  revision: FaExclamationTriangle,\r\n  approved: FaCheck,\r\n  sent: FaPaperPlane,\r\n  approved_final: FaStar,\r\n};\r\n\r\n\r\n// Map scenario status and sent_at to visual badge metadata.  A scenario\r\n// that is approved but has not yet been forwarded to administrators\r\n// (sent_at is null) is considered manager-approved (“Kontrol edildi”).\r\nfunction getScenarioStatusMeta(scenario) {\r\n  const status = scenario?.status;\r\n  const sentAt = scenario?.sent_at;\r\n  switch (status) {\r\n    case 'revision_requested':\r\n      return { label: 'Revize İstendi', className: 'is-bad' };\r\n    case 'sent_for_approval':\r\n      return { label: 'Merkeze iletildi', className: 'is-warn' };\r\n    case 'approved':\r\n      if (sentAt) {\r\n        return { label: 'Onaylandı', className: 'is-ok' };\r\n      }\r\n      return { label: 'Kontrol edildi', className: 'is-ok' };\r\n    case 'in_review':\r\n      return { label: 'İncelemede', className: 'is-warn' };\r\n    case 'submitted':\r\n      return { label: 'Onayda', className: 'is-warn' };\r\n    default:\r\n      return { label: 'Taslak', className: 'is-muted' };\r\n  }\r\n}\r\n\r\n// Map work item states to badge metadata.\r\nfunction getWorkItemStateMeta(state) {\r\n  switch (state) {\r\n    case 'approved':\r\n      // Manager approval of a work item is tracked as \"Kontrol edildi\"\r\n      return { label: 'Kontrol edildi', className: 'is-ok' };\r\n    case 'needs_revision':\r\n      return { label: 'Revize İstendi', className: 'is-bad' };\r\n    case 'submitted':\r\n      return { label: 'İncelemede', className: 'is-warn' };\r\n    case 'in_progress':\r\n      return { label: 'Hazırlanıyor', className: 'is-warn' };\r\n    default:\r\n      return { label: 'Başlanmadı', className: 'is-muted' };\r\n  }\r\n}\r\n\r\nexport default function ManagerReviewQueuePage() {\r\n  const auth = useAuth();\r\n  const outlet = useOutletContext();\r\n  const navigate = useNavigate();\r\n  const [queueData, setQueueData] = useState([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [activeFilter, setActiveFilter] = useState('all');\r\n  const [activeCard, setActiveCard] = useState(null);\r\n  const [modalLayoutShared, setModalLayoutShared] = useState(true);\r\n  const activeScenarioIdRef = useRef(null);\r\n  const pendingQueueRef = useRef(null);\r\n  const isModalOpenRef = useRef(false);\r\n  const motionId = useId();\r\n  const tabsId = useId();\r\n\r\n  const closeModal = useCallback(() => {\r\n    isModalOpenRef.current = false;\r\n    setModalLayoutShared(true);\r\n    requestAnimationFrame(() => setActiveCard(null));\r\n  }, []);\r\n\r\n  const openModalWithCard = useCallback((cardPayload) => {\r\n    isModalOpenRef.current = true;\r\n    setModalLayoutShared(true);\r\n    activeScenarioIdRef.current = cardPayload?.scenario?.id ?? null;\r\n    setActiveCard(cardPayload);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    function onKeyDown(event) {\r\n      if (event.key === 'Escape') {\r\n        closeModal();\r\n      }\r\n    }\r\n\r\n    if (activeCard && typeof activeCard === 'object') {\r\n      document.body.style.overflow = 'hidden';\r\n    } else {\r\n      document.body.style.overflow = 'auto';\r\n    }\r\n\r\n    window.addEventListener('keydown', onKeyDown);\r\n    return () => window.removeEventListener('keydown', onKeyDown);\r\n  }, [activeCard, closeModal]);\r\n\r\n  useEffect(() => {\r\n    if (!activeCard) return;\r\n    const id = window.setTimeout(() => setModalLayoutShared(false), 220);\r\n    return () => window.clearTimeout(id);\r\n  }, [activeCard]);\r\n\r\n\r\n  // Determine whether the current user is allowed to view the review queue.\r\n  const canView = useMemo(() => {\r\n    const role = auth.user?.role;\r\n    if (role === 'admin' || role === 'manager' || role === 'accountant') return true;\r\n    const perms = auth.user?.permissions;\r\n    if (!Array.isArray(perms)) return false;\r\n    return perms.some(\r\n      (p) =>\r\n        p.resource === 'page.manage_permissions' &&\r\n        (p.action === 'read' || p.action === 'write')\r\n    );\r\n  }, [auth.user]);\r\n\r\n  // Configure the top bar header on mount.  Align text to center per spec.\r\n  useEffect(() => {\r\n    outlet?.setHeaderMeta?.({\r\n      title: 'Review Queue',\r\n      subtitle: 'Modül onay kuyruğu',\r\n      centered: true,\r\n    });\r\n    return () => {\r\n      outlet?.clearHeaderMeta?.();\r\n    };\r\n  }, [outlet]);\r\n\r\n  // Load the queue.  Fetch schools, then scenarios for each school, then work items.\r\n  const loadQueue = useCallback(async (options = {}) => {\r\n    if (!canView) return;\r\n    setLoading(true);\r\n    try {\r\n      const results = await api.managerGetReviewQueue();\r\n      const normalized = Array.isArray(results) ? results : [];\r\n      const activeScenarioId =\r\n        options?.activeScenarioId ?? activeScenarioIdRef.current;\r\n      const deferUpdate =\r\n        typeof options?.deferUpdate === 'boolean'\r\n          ? options.deferUpdate\r\n          : isModalOpenRef.current || activeScenarioId != null;\r\n      if (!deferUpdate) {\r\n        setQueueData(normalized);\r\n      } else {\r\n        pendingQueueRef.current = normalized;\r\n      }\r\n\r\n      if (activeScenarioId != null) {\r\n        const match = normalized.find(\r\n          (entry) => String(entry?.scenario?.id) === String(activeScenarioId)\r\n        );\r\n        if (match) {\r\n          setActiveCard({\r\n            school: match.school,\r\n            scenario: match.scenario,\r\n            requiredItems: match.requiredItems,\r\n            approvedCount: match.approvedCount,\r\n            totalRequired: getRequiredTotal(match),\r\n          });\r\n        }\r\n      }\r\n    } catch (err) {\r\n      console.error(err);\r\n      toast.error(err?.message || 'Failed to load review queue');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [canView]);\r\n\r\n  useEffect(() => {\r\n    activeScenarioIdRef.current = activeCard?.scenario?.id ?? null;\r\n    isModalOpenRef.current = Boolean(activeCard);\r\n    if (!activeCard && pendingQueueRef.current) {\r\n      setQueueData(pendingQueueRef.current);\r\n      pendingQueueRef.current = null;\r\n    }\r\n  }, [activeCard]);\r\n\r\n  useEffect(() => {\r\n    loadQueue();\r\n  }, [loadQueue]);\r\n\r\n  const matchFilter = useCallback((entry, filterKey) => {\r\n    if (!entry) return false;\r\n    const scenario = entry.scenario || {};\r\n    const status = scenario.status;\r\n    const sentAt = scenario.sent_at;\r\n    const approvedCount = Number(entry.approvedCount || 0);\r\n    const totalRequired = getRequiredTotal(entry);\r\n    const allApproved = approvedCount === totalRequired;\r\n    const isManagerApproved = status === 'approved' && !sentAt;\r\n    const isFinalApproved = status === 'approved' && !!sentAt;\r\n    switch (filterKey) {\r\n      case 'ready':\r\n        return isManagerApproved && allApproved;\r\n      case 'in_review':\r\n        return status === 'in_review' || status === 'submitted';\r\n      case 'revision':\r\n        return status === 'revision_requested';\r\n      case 'approved':\r\n        return isManagerApproved;\r\n      case 'sent':\r\n        return status === 'sent_for_approval';\r\n      case 'approved_final':\r\n        return isFinalApproved;\r\n      case 'all':\r\n      default:\r\n        return true;\r\n    }\r\n  }, []);\r\n\r\n  const filterCounts = useMemo(() => {\r\n    const base = Object.fromEntries(FILTER_TABS.map((t) => [t.key, 0]));\r\n    base.all = Array.isArray(queueData) ? queueData.length : 0;\r\n    if (!Array.isArray(queueData)) return base;\r\n    queueData.forEach((entry) => {\r\n      FILTER_TABS.forEach((tab) => {\r\n        if (tab.key === 'all') return;\r\n        if (matchFilter(entry, tab.key)) base[tab.key] += 1;\r\n      });\r\n    });\r\n    return base;\r\n  }, [queueData, matchFilter]);\r\n\r\n  const filteredRows = useMemo(() => {\r\n    if (!Array.isArray(queueData)) return [];\r\n    if (activeFilter === 'all') return queueData;\r\n    return queueData.filter((entry) => matchFilter(entry, activeFilter));\r\n  }, [queueData, activeFilter, matchFilter]);\r\n\r\n  const activeTabIndex = Math.max(\r\n    0,\r\n    FILTER_TABS.findIndex((tab) => tab.key === activeFilter)\r\n  );\r\n\r\n  const handleNavigateToModule = useCallback(\r\n    (schoolId, scenarioId, workId) => {\r\n      const segment = WORK_ID_TO_ROUTE[workId];\r\n      if (!segment) return;\r\n      writeSelectedScenarioId(schoolId, scenarioId);\r\n      writeLastVisitedPath(schoolId, scenarioId, segment);\r\n      writeGlobalLastRouteSegment(segment);\r\n      navigate(`/schools/${schoolId}/${segment}`);\r\n    },\r\n    [navigate]\r\n  );\r\n\r\n  const handleTabKeyDown = useCallback((event, tabKey) => {\r\n    if (event.key === 'Enter' || event.key === ' ') {\r\n      event.preventDefault();\r\n      setActiveFilter(tabKey);\r\n    }\r\n  }, []);\r\n\r\n  const applyWorkItemState = (items, workId, nextState, comment) => {\r\n    const updatedItems = Array.isArray(items)\r\n      ? items.map((entry) => {\r\n          if (entry.workId !== workId) return entry;\r\n          return {\r\n            ...entry,\r\n            item: {\r\n              ...entry.item,\r\n              state: nextState,\r\n              manager_comment: comment ? comment : entry.item?.manager_comment,\r\n            },\r\n          };\r\n        })\r\n      : items;\r\n    const approvedCount = Array.isArray(updatedItems)\r\n      ? updatedItems.filter((entry) => entry?.item?.state === 'approved').length\r\n      : 0;\r\n    return { updatedItems, approvedCount };\r\n  };\r\n\r\n  const updateQueueEntry = useCallback((scenarioId, updater) => {\r\n    setQueueData((prev) =>\r\n      prev.map((entry) => {\r\n        if (!entry?.scenario) return entry;\r\n        if (String(entry.scenario.id) !== String(scenarioId)) return entry;\r\n        return updater(entry);\r\n      })\r\n    );\r\n  }, []);\r\n\r\n  // Handlers for approving or revising a work item\r\n  const handleApprove = async (schoolId, scenarioId, workId) => {\r\n    try {\r\n      await api.reviewWorkItem(schoolId, scenarioId, workId, { action: 'approve' });\r\n      toast.success('Onaylandı');\r\n      const isActiveScenario = String(activeCard?.scenario?.id) === String(scenarioId);\r\n      if (isActiveScenario) {\r\n        setActiveCard((prev) => {\r\n          if (!prev) return prev;\r\n          const { updatedItems, approvedCount } = applyWorkItemState(\r\n            prev.requiredItems,\r\n            workId,\r\n            'approved'\r\n          );\r\n          return {\r\n            ...prev,\r\n            requiredItems: updatedItems,\r\n            approvedCount,\r\n          };\r\n        });\r\n        updateQueueEntry(scenarioId, (entry) => {\r\n          const { updatedItems, approvedCount } = applyWorkItemState(\r\n            entry.requiredItems,\r\n            workId,\r\n            'approved'\r\n          );\r\n          return {\r\n            ...entry,\r\n            requiredItems: updatedItems,\r\n            approvedCount,\r\n          };\r\n        });\r\n      } else {\r\n        loadQueue({ deferUpdate: false });\r\n      }\r\n    } catch (e) {\r\n      console.error(e);\r\n      toast.error(e?.message || 'Failed to approve work item');\r\n    }\r\n  };\r\n\r\n  const handleRevise = async (schoolId, scenarioId, workId) => {\r\n    // Prompt the reviewer for a comment.  Use the browser prompt for simplicity.\r\n    const comment = window.prompt('Revizyon notu (opsiyonel):');\r\n    if (comment === undefined) return;\r\n    try {\r\n      await api.reviewWorkItem(schoolId, scenarioId, workId, {\r\n        action: 'revise',\r\n        comment: comment && comment.trim() ? comment.trim() : undefined,\r\n      });\r\n      toast.success('Revizyon istendi');\r\n      const isActiveScenario = String(activeCard?.scenario?.id) === String(scenarioId);\r\n      if (isActiveScenario) {\r\n        const trimmedComment = comment && comment.trim() ? comment.trim() : '';\r\n        setActiveCard((prev) => {\r\n          if (!prev) return prev;\r\n          const { updatedItems, approvedCount } = applyWorkItemState(\r\n            prev.requiredItems,\r\n            workId,\r\n            'needs_revision',\r\n            trimmedComment\r\n          );\r\n          return {\r\n            ...prev,\r\n            requiredItems: updatedItems,\r\n            approvedCount,\r\n          };\r\n        });\r\n        updateQueueEntry(scenarioId, (entry) => {\r\n          const { updatedItems, approvedCount } = applyWorkItemState(\r\n            entry.requiredItems,\r\n            workId,\r\n            'needs_revision',\r\n            trimmedComment\r\n          );\r\n          return {\r\n            ...entry,\r\n            requiredItems: updatedItems,\r\n            approvedCount,\r\n          };\r\n        });\r\n      } else {\r\n        loadQueue({ deferUpdate: false });\r\n      }\r\n    } catch (e) {\r\n      console.error(e);\r\n      toast.error(e?.message || 'Failed to request revision');\r\n    }\r\n  };\r\n\r\n  if (!canView) {\n    return (\r\n      <div className=\"container\">\r\n        <div className=\"card\">\r\n          <div style={{ fontWeight: 700 }}>Access Denied</div>\r\n          <div className=\"small\" style={{ marginTop: 6 }}>\r\n            You do not have permission to view the review queue.\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const activeScenario = activeCard?.scenario;\r\n  const activeSchool = activeCard?.school;\r\n  const activeStatusMeta = activeScenario ? getScenarioStatusMeta(activeScenario) : null;\r\n  const activeTotalRequired = activeCard ? getRequiredTotal(activeCard) : REQUIRED_WORK_IDS.length;\r\n  return (\n    <div className=\"container\">\r\n      <ToastContainer position=\"bottom-right\" autoClose={3500} newestOnTop closeOnClick pauseOnFocusLoss pauseOnHover hideProgressBar theme=\"dark\" />\r\n      <AnimatePresence>\r\n        {activeCard && typeof activeCard === 'object' ? (\r\n          <motion.div\r\n            key=\"rq-overlay\"\r\n            initial={{ opacity: 0 }}\r\n            animate={{ opacity: 1 }}\r\n            exit={{ opacity: 0 }}\r\n            className=\"rq-overlay\"\r\n            onClick={closeModal}\r\n          />\r\n        ) : null}\r\n      </AnimatePresence>\r\n\r\n      <AnimatePresence>\r\n        {activeCard && typeof activeCard === 'object' ? (\r\n          <div\r\n            className=\"rq-modal-wrap\"\r\n            role=\"dialog\"\r\n            aria-modal=\"true\"\r\n            aria-label=\"Scenario details\"\r\n            onClick={(event) => {\r\n              if (event.target === event.currentTarget) closeModal();\r\n            }}\r\n          >\r\n            <motion.button\r\n              key={`rq-close-${activeScenario?.id}-${motionId}`}\r\n              initial={{ opacity: 0 }}\r\n              animate={{ opacity: 1 }}\r\n              exit={{ opacity: 0, transition: { duration: 0.05 } }}\r\n              className=\"rq-close-btn\"\r\n              type=\"button\"\r\n              onClick={closeModal}\r\n              aria-label=\"Close\"\r\n            >\r\n              <CloseIcon />\r\n            </motion.button>\r\n\r\n            <motion.div\r\n              layoutId={\r\n                modalLayoutShared\r\n                  ? `rq-card-${activeScenario?.id}-${motionId}`\r\n                  : `rq-modal-${activeScenario?.id}-${motionId}`\r\n              }\r\n              className=\"card rq-modal\"\r\n              onClick={(event) => event.stopPropagation()}\r\n            >\r\n              <div className=\"rq-modal-head\">\r\n                <motion.div\r\n                  layoutId={\r\n                    modalLayoutShared\r\n                      ? `rq-thumb-${activeScenario?.id}-${motionId}`\r\n                      : `rq-modal-thumb-${activeScenario?.id}-${motionId}`\r\n                  }\r\n                  className=\"rq-thumb rq-thumb--lg\"\r\n                >\r\n                  {getScenarioInitials(activeScenario)}\r\n                </motion.div>\r\n\r\n                <div className=\"rq-modal-head-text\">\r\n                  <motion.div\r\n                    layoutId={\r\n                      modalLayoutShared\r\n                        ? `rq-title-${activeScenario?.id}-${motionId}`\r\n                        : `rq-modal-title-${activeScenario?.id}-${motionId}`\r\n                    }\r\n                    className=\"rq-title rq-title--lg\"\r\n                  >\r\n                    {activeScenario?.name} ({activeScenario?.academic_year})\r\n                  </motion.div>\r\n                  <div className=\"rq-subtitle\">{activeSchool?.name}</div>\r\n                </div>\r\n\r\n                <div className=\"rq-modal-top-actions\">\r\n                  {activeStatusMeta ? (\r\n                    <span className={`status-badge ${activeStatusMeta.className}`}>{activeStatusMeta.label}</span>\r\n                  ) : null}\r\n                  {activeCard ? (\r\n                    <span className=\"small is-muted\">\r\n                      {activeCard.approvedCount}/{activeTotalRequired} onaylandı\r\n                    </span>\r\n                  ) : null}\r\n\r\n                </div>\n              </div>\n\r\n              <div className=\"rq-modal-body\">\r\n                <div className=\"small is-muted\" style={{ marginBottom: 10 }}>\r\n                  Modülleri inceleyin. &ldquo;Gönderildi&rdquo; durumundaki modüller için <b>Onayla</b> veya{' '}\r\n                  <b>Revizyon İste</b> kullanın.\r\n                </div>\r\n\r\n                <div className=\"review-queue-card-inner\">\r\n                  <table className=\"table\">\r\n                    <thead>\r\n                      <tr>\r\n                        <th>Modül</th>\r\n                        <th>Durum</th>\r\n                        <th>Gönderildi</th>\r\n                        <th>Yorum</th>\r\n                        <th />\r\n                      </tr>\r\n                    </thead>\r\n                    <tbody>\r\n                      {activeCard?.requiredItems?.map(({ workId, item }) => {\r\n                        const state = item?.state || 'not_started';\r\n                        const meta = getWorkItemStateMeta(state);\r\n                        const submittedAt = item?.submitted_at ? new Date(item.submitted_at).toLocaleString() : '-';\r\n                        const comment = item?.manager_comment || '-';\r\n                        const canApprove = state === 'submitted';\r\n                        const canRevise = state === 'submitted';\r\n                        const canNavigate = Boolean(WORK_ID_TO_ROUTE[workId]);\r\n\r\n                        return (\r\n                          <tr key={workId} className={state === 'submitted' ? 'highlight-row' : ''}>\r\n                            <td>\r\n                              {canNavigate ? (\r\n                                <button\r\n                                  type=\"button\"\r\n                                  className=\"review-queue-module-link\"\r\n                                  onClick={() => {\r\n                                    closeModal();\r\n                                    handleNavigateToModule(activeSchool.id, activeScenario.id, workId);\r\n                                  }}\r\n                                  title=\"Modüle git\"\r\n                                >\r\n                                  {WORK_ID_LABELS[workId] || workId}\r\n                                </button>\r\n                              ) : (\r\n                                WORK_ID_LABELS[workId] || workId\r\n                              )}\r\n                            </td>\r\n                            <td>\r\n                              <span className={`status-badge ${meta.className}`}>{meta.label}</span>\r\n                            </td>\r\n                            <td className=\"small\">{submittedAt}</td>\r\n                            <td className=\"small\" style={{ maxWidth: 260, whiteSpace: 'pre-wrap' }}>\r\n                              {comment}\r\n                            </td>\r\n                            <td>\r\n                              {canApprove ? (\r\n                                <button\r\n                                  className=\"btn sm primary\"\r\n                                  type=\"button\"\r\n                                  onClick={() => handleApprove(activeSchool.id, activeScenario.id, workId)}\r\n                                >\r\n                                  Onayla\r\n                                </button>\r\n                              ) : null}\r\n                              {canRevise ? (\r\n                                <button\r\n                                  className=\"btn sm danger\"\r\n                                  type=\"button\"\r\n                                  onClick={() => handleRevise(activeSchool.id, activeScenario.id, workId)}\r\n                                >\r\n                                  Revizyon İste\r\n                                </button>\r\n                              ) : null}\r\n                            </td>\r\n                          </tr>\r\n                        );\r\n                      })}\r\n                    </tbody>\r\n                  </table>\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"rq-modal-footer\">\r\n                <button className=\"btn\" type=\"button\" onClick={closeModal}>\r\n                  Kapat\r\n                </button>\r\n              </div>\r\n            </motion.div>\r\n          </div>\r\n        ) : null}\r\n      </AnimatePresence>\r\n\r\n      <section\r\n        className=\"review-queue-tabs\"\r\n        style={{\r\n          '--rq-tab-count': FILTER_TABS.length,\r\n          '--rq-active-index': activeTabIndex,\r\n        }}\r\n      >\r\n        {FILTER_TABS.map((tab) => {\r\n          const inputId = `${tabsId}-${tab.key}`;\r\n          return (\r\n            <input\r\n              key={inputId}\r\n              id={inputId}\r\n              type=\"radio\"\r\n              name={`review-queue-filter-${tabsId}`}\r\n              className=\"rq-tab-input\"\r\n              checked={activeFilter === tab.key}\r\n              onChange={() => setActiveFilter(tab.key)}\r\n            />\r\n          );\r\n        })}\r\n\r\n        <nav className=\"rq-tab-nav\" role=\"tablist\" aria-label=\"Senaryo filtresi\">\r\n          {FILTER_TABS.map((tab) => {\r\n            const inputId = `${tabsId}-${tab.key}`;\r\n            const isActive = activeFilter === tab.key;\r\n            const Icon = FILTER_TAB_ICONS[tab.key];\r\n            return (\r\n              <label\r\n                key={tab.key}\r\n                htmlFor={inputId}\r\n                role=\"tab\"\r\n                aria-selected={isActive}\r\n                tabIndex={0}\r\n                className={`review-queue-tab ${isActive ? 'is-active' : ''}`}\r\n                onKeyDown={(event) => handleTabKeyDown(event, tab.key)}\r\n              >\r\n                <span className=\"rq-tab-icon\">{Icon ? <Icon aria-hidden=\"true\" /> : null}</span>\r\n                <span className=\"rq-tab-text\">{tab.label}</span>\r\n                <span className=\"review-queue-count\">{filterCounts[tab.key] ?? 0}</span>\r\n              </label>\r\n            );\r\n          })}\r\n        </nav>\r\n      </section>\r\n\r\n      {loading ? (\r\n        <div className=\"card\">Loading...</div>\r\n      ) : filteredRows.length === 0 ? (\r\n        <div className=\"card\">\r\n          <div>No scenarios to review</div>\r\n        </div>\r\n      ) : (\r\n        <div className=\"review-queue-cards\">\r\n          {filteredRows.map((entry) => {\r\n            const { school, scenario, requiredItems, approvedCount } = entry;\r\n            const statusMeta = getScenarioStatusMeta(scenario);\r\n            const totalRequired = getRequiredTotal(entry);\r\n            const cardPayload = { school, scenario, requiredItems, approvedCount, totalRequired };\n\r\n            return (\r\n              <motion.div\r\n                key={scenario.id}\r\n                layoutId={`rq-card-${scenario.id}-${motionId}`}\r\n                className=\"card rq-card-compact\"\r\n                onClick={() => openModalWithCard(cardPayload)}\r\n              >\r\n                <div className=\"rq-compact-row\">\r\n                  <div className=\"rq-compact-left\">\r\n                    <motion.div\r\n                      layoutId={`rq-thumb-${scenario.id}-${motionId}`}\r\n                      className=\"rq-thumb\"\r\n                    >\r\n                      {getScenarioInitials(scenario)}\r\n                    </motion.div>\r\n\r\n                    <div>\r\n                      <div className=\"rq-kicker\">{school?.name}</div>\r\n                      <motion.div\r\n                        layoutId={`rq-title-${scenario.id}-${motionId}`}\r\n                        className=\"rq-title\"\r\n                      >\r\n                        {scenario.name} ({scenario.academic_year})\r\n                      </motion.div>\r\n\r\n                      <div className=\"rq-subtitle\">\r\n                        <span className={`status-badge ${statusMeta.className}`}>{statusMeta.label}</span>\r\n                        <span className=\"small is-muted\" style={{ marginLeft: 8 }}>\r\n                          {approvedCount}/{totalRequired} onaylandı\r\n                        </span>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n\r\n                  <div className=\"rq-actions\">\r\n                    <button\r\n                      type=\"button\"\r\n                      className=\"rq-open-pill\"\r\n                      onClick={(e) => {\r\n                        e.stopPropagation();\r\n                        openModalWithCard(cardPayload);\r\n                      }}\r\n                    >\r\n                      İncele\r\n                    </button>\r\n\r\n                  </div>\n                </div>\n              </motion.div>\n            );\n          })}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction CloseIcon() {\r\n  return (\r\n    <motion.svg\r\n      initial={{ opacity: 0 }}\r\n      animate={{ opacity: 1 }}\r\n      exit={{ opacity: 0, transition: { duration: 0.05 } }}\r\n      xmlns=\"http://www.w3.org/2000/svg\"\r\n      width=\"24\"\r\n      height=\"24\"\r\n      viewBox=\"0 0 24 24\"\r\n      fill=\"none\"\r\n      stroke=\"currentColor\"\r\n      strokeWidth=\"2\"\r\n      strokeLinecap=\"round\"\r\n      strokeLinejoin=\"round\"\r\n      className=\"rq-close-icon\"\r\n    >\r\n      <path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\" />\r\n      <path d=\"M18 6l-12 12\" />\r\n      <path d=\"M6 6l12 12\" />\r\n    </motion.svg>\r\n  );\r\n}\r\n\r\nfunction getScenarioInitials(scenario) {\r\n  const name = String(scenario?.name || '').trim();\r\n  if (!name) return 'S';\r\n  const parts = name.split(/\\s+/).filter(Boolean);\r\n  const a = parts[0]?.[0] || 'S';\r\n  const b = parts[1]?.[0] || '';\r\n  return (a + b).toUpperCase();\r\n}\r\n"],"names":["REQUIRED_WORK_IDS","WORK_ID_LABELS","WORK_ID_TO_ROUTE","getRequiredTotal","entry","total","Number","totalRequired","isFinite","Array","isArray","requiredItems","length","FILTER_TABS","key","label","FILTER_TAB_ICONS","all","FaThLarge","ready","FaCheckCircle","in_review","FaSearch","revision","FaExclamationTriangle","approved","FaCheck","sent","FaPaperPlane","approved_final","FaStar","getScenarioStatusMeta","scenario","status","sentAt","sent_at","className","ManagerReviewQueuePage","_activeCard$requiredI","auth","useAuth","outlet","useOutletContext","navigate","useNavigate","queueData","setQueueData","useState","loading","setLoading","activeFilter","setActiveFilter","activeCard","setActiveCard","modalLayoutShared","setModalLayoutShared","activeScenarioIdRef","useRef","pendingQueueRef","isModalOpenRef","motionId","useId","tabsId","closeModal","useCallback","current","requestAnimationFrame","openModalWithCard","cardPayload","_cardPayload$scenario","_cardPayload$scenario2","id","useEffect","onKeyDown","event","document","body","style","overflow","window","addEventListener","removeEventListener","setTimeout","clearTimeout","canView","useMemo","_auth$user","_auth$user2","role","user","perms","permissions","some","p","resource","action","_outlet$setHeaderMeta","setHeaderMeta","call","title","subtitle","centered","_outlet$clearHeaderMe","clearHeaderMeta","loadQueue","async","options","arguments","undefined","_options$activeScenar","results","api","managerGetReviewQueue","normalized","activeScenarioId","deferUpdate","match","find","_entry$scenario","String","school","approvedCount","err","console","error","toast","message","_activeCard$scenario$","_activeCard$scenario","Boolean","matchFilter","filterKey","allApproved","isManagerApproved","isFinalApproved","filterCounts","base","Object","fromEntries","map","t","forEach","tab","filteredRows","filter","activeTabIndex","Math","max","findIndex","handleNavigateToModule","schoolId","scenarioId","workId","segment","writeSelectedScenarioId","writeLastVisitedPath","writeGlobalLastRouteSegment","concat","handleTabKeyDown","tabKey","preventDefault","applyWorkItemState","items","nextState","comment","updatedItems","_entry$item","_objectSpread","item","state","manager_comment","_entry$item2","updateQueueEntry","updater","prev","_jsx","children","_jsxs","fontWeight","marginTop","activeScenario","activeSchool","activeStatusMeta","activeTotalRequired","ToastContainer","position","autoClose","newestOnTop","closeOnClick","pauseOnFocusLoss","pauseOnHover","hideProgressBar","theme","AnimatePresence","motion","div","initial","opacity","animate","exit","onClick","target","currentTarget","button","transition","duration","type","CloseIcon","layoutId","stopPropagation","getScenarioInitials","name","academic_year","marginBottom","_ref","meta","getWorkItemStateMeta","submittedAt","submitted_at","Date","toLocaleString","canApprove","canRevise","canNavigate","maxWidth","whiteSpace","_activeCard$scenario2","reviewWorkItem","success","e","handleApprove","prompt","_activeCard$scenario3","trim","trimmedComment","handleRevise","inputId","checked","onChange","_filterCounts$tab$key","isActive","Icon","htmlFor","tabIndex","statusMeta","marginLeft","svg","xmlns","width","height","viewBox","fill","stroke","strokeWidth","strokeLinecap","strokeLinejoin","d","_parts$","_parts$2","parts","split","toUpperCase"],"ignoreList":[],"sourceRoot":""}