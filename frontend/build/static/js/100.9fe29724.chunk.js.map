{"version":3,"file":"static/js/100.9fe29724.chunk.js","mappings":"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","sources":["components/ui/Tooltip.jsx","utils/kademe.js","components/ui/ProgressBar.jsx","utils/scenarioProfile.js","components/ExpenseSplitModal.jsx","pages/SelectPage.jsx","utils/programType.js"],"sourcesContent":["import React from \"react\";\r\n\r\nfunction normalizeLines(lines, text) {\r\n  if (Array.isArray(lines)) {\r\n    return lines.map((line) => String(line)).filter((line) => line.trim().length > 0);\r\n  }\r\n  if (typeof text === \"string\") {\r\n    return text\r\n      .split(\"\\n\")\r\n      .map((line) => line.trim())\r\n      .filter(Boolean);\r\n  }\r\n  return [];\r\n}\r\n\r\nexport default function Tooltip({ text, lines, children, className = \"\" }) {\r\n  const resolved = normalizeLines(lines, text);\r\n  if (!resolved.length) return children;\r\n\r\n  return (\r\n    <span className={`tooltip-wrap ${className}`.trim()}>\r\n      {children}\r\n      <span className=\"tooltip-bubble\" role=\"tooltip\">\r\n        {resolved.map((line, idx) => (\r\n          <div key={`${idx}-${line}`} className=\"tooltip-line\">\r\n            {line}\r\n          </div>\r\n        ))}\r\n      </span>\r\n    </span>\r\n  );\r\n}\r\n","const GRADES = [\"KG\", \"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\", \"9\", \"10\", \"11\", \"12\"];\r\n\r\nconst KADEME_DEFS = [\r\n  { key: \"okulOncesi\", label: \"Okul ncesi\", defaultFrom: \"KG\", defaultTo: \"KG\" },\r\n  { key: \"ilkokul\", label: \"lkokul\", defaultFrom: \"1\", defaultTo: \"5\" },\r\n  { key: \"ortaokul\", label: \"Ortaokul\", defaultFrom: \"6\", defaultTo: \"9\" },\r\n  { key: \"lise\", label: \"Lise\", defaultFrom: \"10\", defaultTo: \"12\" },\r\n];\r\n\r\nfunction normalizeGrade(value) {\r\n  const v = String(value || \"\").trim().toUpperCase();\r\n  if (v === \"KG\") return \"KG\";\r\n  if (!/^\\d{1,2}$/.test(v)) return null;\r\n  const n = Number(v);\r\n  if (!Number.isFinite(n) || n < 1 || n > 12) return null;\r\n  return String(n);\r\n}\r\n\r\nfunction gradeIndex(value) {\r\n  const g = normalizeGrade(value);\r\n  if (!g) return -1;\r\n  return GRADES.indexOf(g);\r\n}\r\n\r\nfunction normalizeRange(fromValue, toValue, def) {\r\n  const from = normalizeGrade(fromValue) ?? def.defaultFrom;\r\n  const to = normalizeGrade(toValue) ?? def.defaultTo;\r\n  const fromIdx = gradeIndex(from);\r\n  const toIdx = gradeIndex(to);\r\n  if (fromIdx < 0 || toIdx < 0) return { from: def.defaultFrom, to: def.defaultTo };\r\n  if (fromIdx <= toIdx) return { from, to };\r\n  return { from: to, to: from };\r\n}\r\n\r\nexport function getKademeDefinitions() {\r\n  return KADEME_DEFS.map((d) => ({ ...d }));\r\n}\r\n\r\nexport function getDefaultKademeConfig() {\r\n  const out = {};\r\n  KADEME_DEFS.forEach((d) => {\r\n    out[d.key] = { enabled: true, from: d.defaultFrom, to: d.defaultTo };\r\n  });\r\n  return out;\r\n}\r\n\r\nexport function normalizeKademeConfig(config) {\r\n  const cfg = config && typeof config === \"object\" ? config : {};\r\n  const out = {};\r\n  KADEME_DEFS.forEach((d) => {\r\n    const row = cfg[d.key] && typeof cfg[d.key] === \"object\" ? cfg[d.key] : {};\r\n    const enabled = row.enabled !== false;\r\n    const range = normalizeRange(row.from, row.to, d);\r\n    out[d.key] = { enabled, ...range };\r\n  });\r\n  return out;\r\n}\r\n\r\nexport function getKademeRangeLabel(config, key) {\r\n  const def = KADEME_DEFS.find((d) => d.key === key);\r\n  if (!def) return \"\";\r\n  const cfg = normalizeKademeConfig(config)[key];\r\n  if (!cfg?.enabled) return \"\";\r\n  return cfg.from === cfg.to ? cfg.from : `${cfg.from}-${cfg.to}`;\r\n}\r\n\r\nexport function formatKademeLabel(label, config, key) {\r\n  const range = getKademeRangeLabel(config, key);\r\n  if (!range) return label;\r\n  return `${label} (${range})`;\r\n}\r\n\r\nexport function getKademeForGrade(grade, config) {\r\n  const idx = gradeIndex(grade);\r\n  if (idx < 0) return null;\r\n  const cfg = normalizeKademeConfig(config);\r\n  for (const def of KADEME_DEFS) {\r\n    const row = cfg[def.key];\r\n    if (!row?.enabled) continue;\r\n    const fromIdx = gradeIndex(row.from);\r\n    const toIdx = gradeIndex(row.to);\r\n    if (fromIdx <= idx && idx <= toIdx) return def.key;\r\n  }\r\n  return null;\r\n}\r\n\r\nexport function summarizeGradesByKademe(grades, config) {\r\n  const rows = Array.isArray(grades) ? grades : [];\r\n  const out = { okulOncesi: 0, ilkokul: 0, ortaokul: 0, lise: 0, total: 0 };\r\n\r\n  for (const r of rows) {\r\n    // studentsPerBranch now represents TOTAL students for the grade (not per-branch).\r\n    const students = Number(r?.studentsPerBranch || 0);\r\n    if (!Number.isFinite(students)) continue;\r\n    out.total += students;\r\n    const key = getKademeForGrade(r?.grade, config);\r\n    if (key && Object.prototype.hasOwnProperty.call(out, key)) out[key] += students;\r\n  }\r\n\r\n  return out;\r\n}\r\n\r\nexport function getGradeOptions() {\r\n  return GRADES.map((g) => g);\r\n}\r\n","import React from \"react\";\r\nimport Tooltip from \"./Tooltip\";\r\n\r\nfunction normalizeLines(lines) {\r\n  if (!lines) return [];\r\n  if (Array.isArray(lines)) return lines.map((line) => String(line));\r\n  if (typeof lines === \"string\") return lines.split(\"\\n\");\r\n  return [];\r\n}\r\n\r\nexport default function ProgressBar({ value = 0, label = \"\", tooltipLines }) {\r\n  const numeric = Number(value);\r\n  const pct = Number.isFinite(numeric) ? Math.max(0, Math.min(100, numeric)) : 0;\r\n  const lines = normalizeLines(tooltipLines).filter((line) => String(line).trim().length > 0);\r\n\r\n  const track = (\r\n    <div className=\"progress-track\">\r\n      <div className=\"progress-bar\" role=\"progressbar\" aria-valuenow={pct} aria-valuemin={0} aria-valuemax={100}>\r\n        <div className=\"progress-bar-fill\" style={{ width: `${pct}%` }} />\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  return (\r\n    <div className=\"progress-row\">\r\n      {label ? <div className=\"progress-label\">{label}</div> : null}\r\n      {lines.length ? (\r\n        <Tooltip lines={lines} className=\"progress-tooltip\">\r\n          {track}\r\n        </Tooltip>\r\n      ) : (\r\n        track\r\n      )}\r\n      <div className=\"progress-value\">{Math.round(pct)}%</div>\r\n    </div>\r\n  );\r\n}\r\n","const KADEME_BASE_KEYS = [\"okulOncesi\", \"ilkokul\", \"ortaokul\", \"lise\"];\n\nexport function isHeadquarterScenario(inputs) {\n  const kademeler = inputs?.temelBilgiler?.kademeler;\n  if (!kademeler || typeof kademeler !== \"object\") return false;\n  return KADEME_BASE_KEYS.every((key) => kademeler?.[key]?.enabled === false);\n}\n","// frontend/src/components/ExpenseSplitModal.jsx\r\n\r\nimport React, { useEffect, useMemo, useState } from \"react\";\r\nimport { FaChevronDown, FaChevronRight } from \"react-icons/fa\";\r\nimport { toast } from \"react-toastify\";\r\nimport { api } from \"../api\";\r\n\r\nconst OPERATING_ITEMS = [\r\n  { key: \"ulkeTemsilciligi\", label: \"lke Temsilciligi Giderleri\" },\r\n  { key: \"genelYonetim\", label: \"Genel Ynetim Giderleri\" },\r\n  { key: \"kira\", label: \"Isletme Giderleri (Kira)\" },\r\n  { key: \"emsalKira\", label: \"Isletme Giderleri (Emsal Kira)\" },\r\n  { key: \"enerjiKantin\", label: \"Isletme Giderleri (Elektrik, Su, vb.)\" },\r\n  { key: \"turkPersonelMaas\", label: \"Yurt disi TRK Personel Maas Giderleri\" },\r\n  { key: \"turkDestekPersonelMaas\", label: \"Yurt disi TRK DESTEK Personel Maas Giderleri\" },\r\n  { key: \"yerelPersonelMaas\", label: \"Yurt disi YEREL Personel Maas Giderleri\" },\r\n  { key: \"yerelDestekPersonelMaas\", label: \"Yurt disi YEREL DESTEK Personel Maas Giderleri\" },\r\n  { key: \"internationalPersonelMaas\", label: \"Yurt disi INTERNATIONAL Personel Maas Giderleri\" },\r\n  { key: \"disaridanHizmet\", label: \"Disaridan Saglanan Mal ve Hizmet Alimlari\" },\r\n  { key: \"egitimAracGerec\", label: \"Egitim Ara ve Gereleri\" },\r\n  { key: \"finansalGiderler\", label: \"Finansal Giderler\" },\r\n  { key: \"egitimAmacliHizmet\", label: \"Egitim Amali Hizmet Alimlari\" },\r\n  { key: \"temsilAgirlama\", label: \"Temsil ve Agirlama\" },\r\n  { key: \"ulkeIciUlasim\", label: \"lke Ii Ulasim ve Konaklama\" },\r\n  { key: \"ulkeDisiUlasim\", label: \"lke Disi Ulasim ve Konaklama\" },\r\n  { key: \"vergilerResmiIslemler\", label: \"Vergiler Resmi Islemler\" },\r\n  { key: \"vergiler\", label: \"Vergiler\" },\r\n  { key: \"demirbasYatirim\", label: \"Demirbas ve Yatirimlar\" },\r\n  { key: \"rutinBakim\", label: \"Rutin Bakim ve Onarim\" },\r\n  { key: \"pazarlamaOrganizasyon\", label: \"Pazarlama Organizasyon\" },\r\n  { key: \"reklamTanitim\", label: \"Reklam ve Tanitim\" },\r\n  { key: \"tahsilEdilemeyenGelirler\", label: \"Tahsil Edilemeyen Gelirler\" },\r\n];\r\n\r\nconst SERVICE_ITEMS = [\r\n  { key: \"yemek\", label: \"Yemek\" },\r\n  { key: \"uniforma\", label: \"niforma\" },\r\n  { key: \"kitapKirtasiye\", label: \"Kitap-Krtasiye\" },\r\n  { key: \"ulasimServis\", label: \"Servis / Ulam\" },\r\n];\r\n\r\nconst DORM_ITEMS = [\r\n  { key: \"yurtGiderleri\", label: \"Yurt Giderleri (Kampus giderleri iinde gsterilmeyecek)\" },\r\n  { key: \"digerYurt\", label: \"Dier (Yaz okulu giderleri vb.)\" },\r\n];\r\n\r\nconst DISCOUNT_ITEMS = [\r\n  { key: \"discountsTotal\", label: \"Burs ve ndirimler (Toplam)\" },\r\n];\r\n\r\nconst EXPENSE_ITEMS = [...OPERATING_ITEMS, ...SERVICE_ITEMS, ...DORM_ITEMS, ...DISCOUNT_ITEMS];\r\nconst EXPENSE_KEYS = EXPENSE_ITEMS.map((it) => it.key);\r\nconst EXPENSE_ITEM_MAP = new Map(EXPENSE_ITEMS.map((it) => [it.key, it]));\r\nconst EXPENSE_LABELS = new Map(EXPENSE_ITEMS.map((it) => [it.key, it.label]));\r\n\r\nconst EXPENSE_SECTIONS = [\r\n  {\r\n    id: \"isletme\",\r\n    label: \"letme Giderleri\",\r\n    groups: [\r\n      {\r\n        label: \"letme Giderleri\",\r\n        keys: [\r\n          \"ulkeTemsilciligi\",\r\n          \"genelYonetim\",\r\n          \"temsilAgirlama\",\r\n          \"ulkeIciUlasim\",\r\n          \"ulkeDisiUlasim\",\r\n          \"vergilerResmiIslemler\",\r\n          \"vergiler\",\r\n          \"demirbasYatirim\",\r\n          \"rutinBakim\",\r\n          \"pazarlamaOrganizasyon\",\r\n          \"reklamTanitim\",\r\n          \"tahsilEdilemeyenGelirler\",\r\n        ],\r\n      },\r\n      {\r\n        label: \"Eitim Maliyetleri\",\r\n        keys: [\r\n          \"kira\",\r\n          \"emsalKira\",\r\n          \"enerjiKantin\",\r\n          \"turkPersonelMaas\",\r\n          \"turkDestekPersonelMaas\",\r\n          \"yerelPersonelMaas\",\r\n          \"yerelDestekPersonelMaas\",\r\n          \"internationalPersonelMaas\",\r\n          \"disaridanHizmet\",\r\n          \"egitimAracGerec\",\r\n          \"finansalGiderler\",\r\n          \"egitimAmacliHizmet\",\r\n        ],\r\n      },\r\n    ],\r\n  },\r\n  {\r\n    id: \"ogrenimDisi\",\r\n    label: \"renim D Hizmetler\",\r\n    keys: [\"yemek\", \"uniforma\", \"kitapKirtasiye\", \"ulasimServis\"],\r\n  },\r\n  {\r\n    id: \"yurtKonaklama\",\r\n    label: \"Yurt / Konaklama\",\r\n    keys: [\"yurtGiderleri\", \"digerYurt\"],\r\n  },\r\n  {\r\n    id: \"bursIndirim\",\r\n    label: \"Burs ve ndirimler\",\r\n    keys: [\"discountsTotal\"],\r\n  },\r\n].map((section) => {\r\n  if (Array.isArray(section.groups)) {\r\n    const groups = section.groups.filter((group) => group.keys.length);\r\n    const keys = groups.flatMap((group) => group.keys);\r\n    return { ...section, groups, keys };\r\n  }\r\n  return {\r\n    ...section,\r\n    keys: section.keys,\r\n  };\r\n}).filter((section) => section.keys.length);\r\n\r\nconst fmtNum = (v, fractionDigits = 2) =>\r\n  Number.isFinite(Number(v))\r\n    ? Number(v).toLocaleString(undefined, { maximumFractionDigits: fractionDigits })\r\n    : \"-\";\r\n\r\nconst fmtPct = (v) =>\r\n  Number.isFinite(Number(v)) ? `${(Number(v) * 100).toFixed(2)}%` : \"-\";\r\n\r\nexport default function ExpenseSplitModal({\r\n  open,\r\n  onClose,\r\n  sourceScenario,\r\n  sourceSchoolId,\r\n  sourceSchoolName,\r\n}) {\r\n  const [targets, setTargets] = useState([]);\r\n  const [loadingTargets, setLoadingTargets] = useState(false);\r\n  const [targetSearch, setTargetSearch] = useState(\"\");\r\n  const [selectedTargets, setSelectedTargets] = useState(new Set());\r\n  const [basis, setBasis] = useState(\"students\");\r\n  const [basisYearKey, setBasisYearKey] = useState(\"y1\");\r\n  const [selectedExpenseKeys, setSelectedExpenseKeys] = useState(new Set());\r\n  const [preview, setPreview] = useState(null);\r\n  const [previewLoading, setPreviewLoading] = useState(false);\r\n  const [applyLoading, setApplyLoading] = useState(false);\r\n  const [showPools, setShowPools] = useState(false);\r\n  const [expandedTargets, setExpandedTargets] = useState(new Set());\r\n  const [showTargets, setShowTargets] = useState(true);\r\n  const [showExpenses, setShowExpenses] = useState(true);\r\n  const compactControlStyle = {\r\n    fontSize: 12,\r\n    height: 30,\r\n    padding: \"4px 8px\",\r\n    lineHeight: \"20px\",\r\n    boxSizing: \"border-box\",\r\n  };\r\n\r\n  const selectedTargetsKey = useMemo(\r\n    () => Array.from(selectedTargets).sort().join(\",\"),\r\n    [selectedTargets]\r\n  );\r\n  const selectedExpenseKeyStr = useMemo(\r\n    () => Array.from(selectedExpenseKeys).sort().join(\",\"),\r\n    [selectedExpenseKeys]\r\n  );\r\n\r\n  useEffect(() => {\r\n    if (!open) return;\r\n    setTargetSearch(\"\");\r\n    setSelectedTargets(new Set());\r\n    setSelectedExpenseKeys(new Set());\r\n    setBasis(\"students\");\r\n    setBasisYearKey(\"y1\");\r\n    setPreview(null);\r\n  }, [open, sourceScenario?.id]);\r\n\r\n  useEffect(() => {\r\n    setPreview(null);\r\n    setShowPools(false);\r\n    setExpandedTargets(new Set());\r\n    setShowTargets(true);\r\n    setShowExpenses(true);\r\n  }, [basis, basisYearKey, selectedTargetsKey, selectedExpenseKeyStr]);\r\n\r\n  useEffect(() => {\r\n    let active = true;\r\n    async function loadTargets() {\r\n      if (!open || !sourceScenario?.academic_year) return;\r\n      setLoadingTargets(true);\r\n      try {\r\n        const data = await api.expenseSplitTargets(sourceScenario.academic_year);\r\n        if (!active) return;\r\n        const list = Array.isArray(data) ? data : [];\r\n        const filtered = list.filter(\r\n          (row) => String(row.scenarioId) !== String(sourceScenario?.id)\r\n        );\r\n        setTargets(filtered);\r\n      } catch (e) {\r\n        if (active) {\r\n          toast.error(e.message || \"Hedef senaryolar alinamadi\");\r\n        }\r\n      } finally {\r\n        if (active) setLoadingTargets(false);\r\n      }\r\n    }\r\n    loadTargets();\r\n    return () => {\r\n      active = false;\r\n    };\r\n  }, [open, sourceScenario?.academic_year, sourceScenario?.id]);\r\n\r\n  const filteredTargets = useMemo(() => {\r\n    const term = targetSearch.trim().toLowerCase();\r\n    if (!term) return targets;\r\n    return targets.filter((row) => {\r\n      const schoolName = String(row?.schoolName || \"\").toLowerCase();\r\n      const scenarioName = String(row?.scenarioName || \"\").toLowerCase();\r\n      return schoolName.includes(term) || scenarioName.includes(term);\r\n    });\r\n  }, [targets, targetSearch]);\r\n\r\n  const toggleTarget = (id) => {\r\n    setSelectedTargets((prev) => {\r\n      const next = new Set(prev);\r\n      const key = String(id);\r\n      if (next.has(key)) next.delete(key);\r\n      else next.add(key);\r\n      return next;\r\n    });\r\n  };\r\n\r\n  const toggleExpenseKey = (key) => {\r\n    setSelectedExpenseKeys((prev) => {\r\n      const next = new Set(prev);\r\n      if (next.has(key)) next.delete(key);\r\n      else next.add(key);\r\n      return next;\r\n    });\r\n  };\r\n\r\n  const setExpenseKeys = (keys, checked) => {\r\n    if (!Array.isArray(keys) || !keys.length) return;\r\n    setSelectedExpenseKeys((prev) => {\r\n      const next = new Set(prev);\r\n      keys.forEach((key) => {\r\n        if (checked) next.add(key);\r\n        else next.delete(key);\r\n      });\r\n      return next;\r\n    });\r\n  };\r\n\r\n  const handlePreview = async () => {\r\n    if (!sourceScenario?.id || !sourceSchoolId) return;\r\n    const payload = {\r\n      targetScenarioIds: Array.from(selectedTargets).map((id) => Number(id)),\r\n      basis,\r\n      basisYearKey,\r\n      expenseKeys: Array.from(selectedExpenseKeys),\r\n    };\r\n    setShowTargets(false);\r\n    setShowExpenses(false);\r\n    setPreviewLoading(true);\r\n    try {\r\n      const data = await api.previewExpenseSplit(sourceSchoolId, sourceScenario.id, payload);\r\n      setPreview(data || null);\r\n    } catch (e) {\r\n      toast.error(e.message || \"nizleme alinamadi\");\r\n    } finally {\r\n      setPreviewLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleApply = async () => {\r\n    if (!sourceScenario?.id || !sourceSchoolId) return;\r\n    const payload = {\r\n      targetScenarioIds: Array.from(selectedTargets).map((id) => Number(id)),\r\n      basis,\r\n      basisYearKey,\r\n      expenseKeys: Array.from(selectedExpenseKeys),\r\n    };\r\n    setApplyLoading(true);\r\n    try {\r\n      await api.applyExpenseSplit(sourceSchoolId, sourceScenario.id, payload);\r\n      toast.success(\"Gider dagitimi kaydedildi.\");\r\n      onClose?.();\r\n    } catch (e) {\r\n      toast.error(e.message || \"Dagitim uygulanamadi\");\r\n    } finally {\r\n      setApplyLoading(false);\r\n    }\r\n  };\r\n\r\n  const previewTargets = useMemo(\r\n    () => (Array.isArray(preview?.targets) ? preview.targets : []),\r\n    [preview]\r\n  );\r\n  const previewPools = useMemo(\r\n    () => (Array.isArray(preview?.pools) ? preview.pools : []),\r\n    [preview]\r\n  );\r\n  const previewAllocations = useMemo(\r\n    () => (Array.isArray(preview?.allocations) ? preview.allocations : []),\r\n    [preview]\r\n  );\r\n  const previewWarnings = useMemo(\r\n    () => (Array.isArray(preview?.warnings) ? preview.warnings : []),\r\n    [preview]\r\n  );\r\n\r\n  const sourceLabel =\r\n    sourceSchoolName ||\r\n    sourceScenario?.schoolName ||\r\n    sourceScenario?.school?.name ||\r\n    \"\";\r\n\r\n  const allocationsByTarget = useMemo(() => {\r\n    const map = new Map();\r\n    previewAllocations.forEach((row) => {\r\n      const key = String(row.targetScenarioId);\r\n      const list = map.get(key) || [];\r\n      list.push({\r\n        expenseLabel: EXPENSE_LABELS.get(row.expenseKey) || row.expenseKey,\r\n        amount: row.allocatedAmount,\r\n      });\r\n      map.set(key, list);\r\n    });\r\n    return map;\r\n  }, [previewAllocations]);\r\n\r\n  const totalExpenseCount = EXPENSE_KEYS.length;\r\n  const selectedExpenseCount = selectedExpenseKeys.size;\r\n  const allExpensesSelected = totalExpenseCount > 0 && selectedExpenseCount === totalExpenseCount;\r\n  const someExpensesSelected = selectedExpenseCount > 0 && !allExpensesSelected;\r\n\r\n  const previewDisabled =\r\n    !selectedTargets.size || !selectedExpenseKeys.size || previewLoading || applyLoading;\r\n\r\n  const isletmeSection = EXPENSE_SECTIONS.find((s) => s.id === \"isletme\") || null;\r\n  const otherSections = EXPENSE_SECTIONS.filter((s) => s.id !== \"isletme\");\r\n\r\n  const renderSectionCard = (section) => {\r\n    if (!section) return null;\r\n    const total = section.keys.length;\r\n    const selected = section.keys.reduce(\r\n      (sum, key) => sum + (selectedExpenseKeys.has(key) ? 1 : 0),\r\n      0\r\n    );\r\n    const allSelected = total > 0 && selected === total;\r\n    const someSelected = selected > 0 && !allSelected;\r\n\r\n    return (\r\n      <div\r\n        key={section.id}\r\n        className=\"card\"\r\n        style={{ padding: \"10px 12px\", background: \"#f8fafc\" }}\r\n      >\r\n        <div className=\"row\" style={{ justifyContent: \"space-between\", alignItems: \"center\" }}>\r\n          <label className=\"row small\" style={{ gap: 6, alignItems: \"center\", fontWeight: 700 }}>\r\n            <input\r\n              type=\"checkbox\"\r\n              checked={allSelected}\r\n              ref={(el) => {\r\n                if (el) el.indeterminate = someSelected;\r\n              }}\r\n              onChange={(e) => setExpenseKeys(section.keys, e.target.checked)}\r\n            />\r\n            <span>{section.label}</span>\r\n          </label>\r\n          <div className=\"row\" style={{ gap: 6 }}>\r\n            <button\r\n              className=\"btn\"\r\n              type=\"button\"\r\n              style={{ padding: \"4px 10px\" }}\r\n              onClick={() => setExpenseKeys(section.keys, true)}\r\n              disabled={!total}\r\n            >\r\n              Sec\r\n            </button>\r\n            <button\r\n              className=\"btn\"\r\n              type=\"button\"\r\n              style={{ padding: \"4px 10px\" }}\r\n              onClick={() => setExpenseKeys(section.keys, false)}\r\n              disabled={!selected}\r\n            >\r\n              Temizle\r\n            </button>\r\n          </div>\r\n        </div>\r\n        <div className=\"small muted\" style={{ marginTop: 4 }}>\r\n          Secili: {selected}/{total}\r\n        </div>\r\n        {Array.isArray(section.groups) ? (\r\n          <div style={{ marginTop: 8 }}>\r\n            {section.groups.map((group) => (\r\n              <div key={group.label} style={{ marginTop: 8 }}>\r\n                <div className=\"small\" style={{ fontWeight: 700, marginBottom: 6 }}>\r\n                  {group.label}\r\n                </div>\r\n                <div className=\"grid2\" style={{ gap: 8 }}>\r\n                  {group.keys.map((key) => {\r\n                    const item = EXPENSE_ITEM_MAP.get(key);\r\n                    const label = item?.label || key;\r\n                    return (\r\n                      <label key={key} className=\"row\" style={{ gap: 6, alignItems: \"center\" }}>\r\n                        <input\r\n                          type=\"checkbox\"\r\n                          checked={selectedExpenseKeys.has(key)}\r\n                          onChange={() => toggleExpenseKey(key)}\r\n                        />\r\n                        <span className=\"small\">{label}</span>\r\n                      </label>\r\n                    );\r\n                  })}\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        ) : (\r\n          <div className=\"grid2\" style={{ gap: 8, marginTop: 8 }}>\r\n            {section.keys.map((key) => {\r\n              const item = EXPENSE_ITEM_MAP.get(key);\r\n              const label = item?.label || key;\r\n              return (\r\n                <label key={key} className=\"row\" style={{ gap: 6, alignItems: \"center\" }}>\r\n                  <input\r\n                    type=\"checkbox\"\r\n                    checked={selectedExpenseKeys.has(key)}\r\n                    onChange={() => toggleExpenseKey(key)}\r\n                  />\r\n                  <span className=\"small\">{label}</span>\r\n                </label>\r\n              );\r\n            })}\r\n          </div>\r\n        )}\r\n      </div>\r\n    );\r\n  };\r\n\r\n  const toggleTargetAllocations = (scenarioId) => {\r\n    setExpandedTargets((prev) => {\r\n      const next = new Set(prev);\r\n      const key = String(scenarioId);\r\n      if (next.has(key)) next.delete(key);\r\n      else next.add(key);\r\n      return next;\r\n    });\r\n  };\r\n\r\n  if (!open) return null;\r\n\r\n  return (\r\n    <div className=\"modal-backdrop\" role=\"dialog\" aria-modal=\"true\" onClick={onClose}>\r\n      <div\r\n        className=\"modal\"\r\n        style={{ width: \"min(980px, 96vw)\", maxHeight: \"86vh\", overflowY: \"auto\", position: \"relative\" }}\r\n        onClick={(e) => e.stopPropagation()}\r\n      >\r\n        <div className=\"row\" style={{ justifyContent: \"space-between\", alignItems: \"center\" }}>\r\n          <button\r\n            className=\"btn\"\r\n            onClick={onClose}\r\n            disabled={applyLoading || previewLoading}\r\n            style={{\r\n              position: \"absolute\",\r\n              top: 10,\r\n              right: 10,\r\n              background: \"#111827\",\r\n              borderColor: \"#111827\",\r\n              color: \"#fff\",\r\n            }}\r\n          >\r\n            Kapat\r\n          </button>\r\n        </div>\r\n\r\n        {!sourceScenario ? (\r\n          <div className=\"small\" style={{ marginTop: 10 }}>\r\n            Kaynak senaryo seilmedi.\r\n          </div>\r\n        ) : (\r\n          <>\r\n            <div style={{ marginTop: 2 }}>\r\n              <div className=\"row\" style={{ gap: 12, alignItems: \"flex-end\", flexWrap: \"wrap\" }}>\r\n                <div style={{ minWidth: 170 }}>\r\n                  <div className=\"small\" style={{ fontWeight: 700, marginBottom: 6 }}>Basis</div>\r\n                  <select className=\"input sm\" style={compactControlStyle} value={basis} onChange={(e) => setBasis(e.target.value)}>\r\n                    <option value=\"students\">Students</option>\r\n                    <option value=\"revenue\">Revenue</option>\r\n                  </select>\r\n                </div>\r\n                <div style={{ minWidth: 160 }}>\r\n                  <div className=\"small\" style={{ fontWeight: 700, marginBottom: 6 }}>Basis Yil</div>\r\n                  <select className=\"input sm\" style={compactControlStyle} value={basisYearKey} onChange={(e) => setBasisYearKey(e.target.value)}>\r\n                    <option value=\"y1\">Y1</option>\r\n                    <option value=\"y2\">Y2</option>\r\n                    <option value=\"y3\">Y3</option>\r\n                  </select>\r\n                </div>\r\n                <div style={{ flex: \"1 1 220px\" }}>\r\n                  <div className=\"small\" style={{ fontWeight: 700, marginBottom: 6 }}>Hedef Ara</div>\r\n                  <input\r\n                    className=\"input sm\"\r\n                    style={compactControlStyle}\r\n                    placeholder=\"Okul veya senaryo ara\"\r\n                    value={targetSearch}\r\n                    onChange={(e) => setTargetSearch(e.target.value)}\r\n                  />\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            <div style={{ marginTop: 5 }}>\r\n              <div\r\n                className=\"row\"\r\n                style={{ justifyContent: \"space-between\", alignItems: \"center\", cursor: \"pointer\" }}\r\n                onClick={() => setShowTargets((prev) => !prev)}\r\n              >\r\n                <div className=\"row\" style={{ gap: 6, alignItems: \"center\" }}>\r\n                  {showTargets ? <FaChevronDown aria-hidden=\"true\" /> : <FaChevronRight aria-hidden=\"true\" />}\r\n                  <div className=\"small\" style={{ fontWeight: 700 }}>Hedef Senaryolar</div>\r\n                </div>\r\n              </div>\r\n              {showTargets ? (\r\n                loadingTargets ? (\r\n                  <div className=\"small\">Yukleniyor...</div>\n                ) : (\r\n                  <div className=\"table-scroll\" style={{ maxHeight: 260 }}>\r\n                    <table className=\"table\" style={{ fontSize: 12 }}>\r\n                      <thead>\r\n                        <tr>\r\n                          <th style={{ width: 40 }}></th>\r\n                          <th style={{ fontSize: 12, padding: \"6px 8px\" }}>Okul</th>\r\n                          <th style={{ fontSize: 12, padding: \"6px 8px\" }}>Senaryo</th>\r\n                          <th style={{ fontSize: 12, padding: \"6px 8px\" }}>Yil</th>\r\n                          <th style={{ fontSize: 12, padding: \"6px 8px\" }}>Para Birimi</th>\r\n                        </tr>\r\n                      </thead>\r\n                      <tbody>\r\n                        {filteredTargets.length === 0 ? (\r\n                          <tr>\r\n                            <td colSpan=\"5\" className=\"small\" style={{ padding: \"6px 8px\" }}>Hedef bulunamadi.</td>\r\n                          </tr>\r\n                        ) : (\r\n                          filteredTargets.map((row) => {\r\n                            const id = String(row.scenarioId);\r\n                            const checked = selectedTargets.has(id);\r\n                            const currencyLabel =\r\n                              String(row.input_currency || \"USD\") === \"LOCAL\"\r\n                                ? `${row.input_currency}/${row.local_currency_code || \"LOCAL\"}`\r\n                                : row.input_currency || \"USD\";\r\n                            return (\r\n                              <tr\n                                key={row.scenarioId}\n                                onClick={() => toggleTarget(id)}\n                                style={{\n                                  cursor: \"pointer\",\n                                  ...(checked ? { background: \"#eef2ff\" } : {}),\n                                }}\n                              >\n                                <td style={{ padding: \"6px 8px\" }}>\r\n                                  <input\r\n                                    type=\"checkbox\"\r\n                                    checked={checked}\r\n                                    onClick={(e) => e.stopPropagation()}\r\n                                    onChange={() => toggleTarget(id)}\r\n                                  />\r\n                                </td>\r\n                                <td style={{ padding: \"6px 8px\" }}>{row.schoolName}</td>\r\n                                <td style={{ padding: \"6px 8px\" }}>{row.scenarioName}</td>\r\n                                <td style={{ padding: \"6px 8px\" }}>{row.academic_year}</td>\r\n                                <td style={{ padding: \"6px 8px\" }}>{currencyLabel}</td>\r\n                              </tr>\r\n                            );\r\n                          })\r\n                        )}\r\n                      </tbody>\r\n                    </table>\r\n                  </div>\r\n                )\r\n              ) : null}\r\n            </div>\r\n\n            <div style={{ marginTop: 16 }}>\n              <div\r\n                className=\"row\"\r\n                style={{ justifyContent: \"space-between\", alignItems: \"center\", cursor: \"pointer\" }}\r\n                onClick={() => setShowExpenses((prev) => !prev)}\r\n              >\r\n                <div className=\"row\" style={{ gap: 6, alignItems: \"center\" }}>\r\n                  {showExpenses ? <FaChevronDown aria-hidden=\"true\" /> : <FaChevronRight aria-hidden=\"true\" />}\r\n                  <div className=\"small\" style={{ fontWeight: 700 }}>Gider Kalemleri</div>\r\n                </div>\r\n                <div className=\"row\" style={{ gap: 6 }}>\r\n                  <button\r\n                    className=\"btn\"\r\n                    type=\"button\"\r\n                    style={{ padding: \"4px 10px\" }}\r\n                    onClick={(e) => {\r\n                      e.stopPropagation();\r\n                      setExpenseKeys(EXPENSE_KEYS, true);\r\n                    }}\r\n                    disabled={!totalExpenseCount}\r\n                  >\r\n                    Tumunu Sec\r\n                  </button>\r\n                  <button\r\n                    className=\"btn\"\r\n                    type=\"button\"\r\n                    style={{ padding: \"4px 10px\" }}\r\n                    onClick={(e) => {\r\n                      e.stopPropagation();\r\n                      setExpenseKeys(EXPENSE_KEYS, false);\r\n                    }}\r\n                    disabled={!selectedExpenseCount}\r\n                  >\r\n                    Temizle\r\n                  </button>\r\n                </div>\r\n              </div>\r\n              {showExpenses ? (\r\n                <>\r\n                  <div className=\"row\" style={{ gap: 10, alignItems: \"center\", marginTop: 8 }}>\r\n                    <label className=\"row small\" style={{ gap: 6, alignItems: \"center\" }}>\r\n                      <input\r\n                        type=\"checkbox\"\r\n                        checked={allExpensesSelected}\r\n                        ref={(el) => {\r\n                          if (el) el.indeterminate = someExpensesSelected;\r\n                        }}\r\n                        onChange={(e) => setExpenseKeys(EXPENSE_KEYS, e.target.checked)}\r\n                      />\r\n                      <span>Toplam Secili: {selectedExpenseCount}/{totalExpenseCount}</span>\r\n                    </label>\r\n                  </div>\r\n\r\n                  <div className=\"row\" style={{ alignItems: \"flex-start\", gap: 12, marginTop: 10 }}>\r\n                    <div style={{ flex: \"1 1 0\", minWidth: 320 }}>\r\n                      {renderSectionCard(isletmeSection)}\r\n                    </div>\r\n                    <div style={{ flex: \"1 1 0\", minWidth: 320, display: \"grid\", gap: 12 }}>\r\n                      {otherSections.map((section) => renderSectionCard(section))}\r\n                    </div>\r\n                  </div>\r\n                </>\r\n              ) : null}\r\n            </div>\r\n\n            <div className=\"row\" style={{ justifyContent: \"flex-end\", marginTop: 16, gap: 8 }}>\n              <button className=\"btn\" onClick={handlePreview} disabled={previewDisabled}>\r\n                {previewLoading ? \"nizleme...\" : \"nizle\"}\r\n              </button>\r\n              <button\r\n                className=\"btn primary\"\r\n                onClick={handleApply}\r\n                disabled={\r\n                  applyLoading ||\r\n                  previewLoading ||\r\n                  !selectedTargets.size ||\r\n                  !selectedExpenseKeys.size\r\n                }\r\n              >\r\n                {applyLoading ? \"Uygulaniyor...\" : \"Uygula\"}\r\n              </button>\r\n            </div>\r\n\r\n            {previewWarnings.length > 0 ? (\r\n              <div className=\"card\" style={{ marginTop: 12, background: \"#fff7ed\", borderColor: \"#fed7aa\" }}>\r\n                <div style={{ fontWeight: 700, marginBottom: 6 }}>Uyarilar</div>\r\n                {previewWarnings.map((w, idx) => (\r\n                  <div key={idx} className=\"small\"> {w}</div>\r\n                ))}\r\n              </div>\r\n            ) : null}\r\n\r\n            {preview ? (\r\n              <div style={{ marginTop: 16 }}>\r\n                {previewPools.length > 0 ? (\r\n                  <>\r\n                    <div\r\n                      className=\"row\"\r\n                      style={{\r\n                        justifyContent: \"space-between\",\r\n                        alignItems: \"center\",\r\n                        marginBottom: 6,\r\n                        cursor: \"pointer\",\r\n                      }}\r\n                      onClick={() => setShowPools((prev) => !prev)}\r\n                    >\r\n                      <div className=\"row\" style={{ gap: 6, alignItems: \"center\" }}>\r\n                        {showPools ? <FaChevronDown aria-hidden=\"true\" /> : <FaChevronRight aria-hidden=\"true\" />}\r\n                        <div className=\"small\" style={{ fontWeight: 700 }}>\r\n                          Havuz Tutarlari{sourceLabel ? ` (${sourceLabel})` : \"\"}\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                    {showPools ? (\r\n                      <div className=\"table-scroll\">\r\n                        <table className=\"table\">\r\n                          <thead>\r\n                            <tr>\r\n                              <th>Gider</th>\r\n                              <th>Havuz Tutari</th>\r\n                            </tr>\r\n                          </thead>\r\n                          <tbody>\r\n                            {previewPools.map((p) => (\r\n                              <tr key={p.expenseKey}>\r\n                                <td>{EXPENSE_LABELS.get(p.expenseKey) || p.expenseKey}</td>\r\n                                <td>{fmtNum(p.poolAmount)}</td>\r\n                              </tr>\r\n                            ))}\r\n                          </tbody>\r\n                        </table>\r\n                      </div>\r\n                    ) : null}\r\n                  </>\r\n                ) : null}\r\n\r\n                {previewTargets.length > 0 ? (\r\n                  <>\r\n                    <div className=\"small\" style={{ fontWeight: 700, margin: \"12px 0 6px\" }}>\r\n                      Agirliklar (satira tiklayin)\r\n                    </div>\r\n                    <div className=\"table-scroll\">\r\n                      <table className=\"table\">\r\n                        <thead>\r\n                          <tr>\r\n                            <th style={{ width: 28 }} />\r\n                            <th>Okul</th>\r\n                            <th>Senaryo</th>\r\n                            <th>Basis</th>\r\n                            <th>Agirlik</th>\r\n                          </tr>\r\n                        </thead>\r\n                        <tbody>\r\n                          {previewTargets.map((t) => {\r\n                            const targetKey = String(t.targetScenarioId);\r\n                            const isExpanded = expandedTargets.has(targetKey);\r\n                            const allocRows = allocationsByTarget.get(targetKey) || [];\r\n                            return (\r\n                              <React.Fragment key={t.targetScenarioId}>\r\n                                <tr\r\n                                  onClick={() => toggleTargetAllocations(t.targetScenarioId)}\r\n                                  style={{ cursor: \"pointer\" }}\r\n                                >\r\n                                  <td style={{ textAlign: \"center\" }}>\r\n                                    {isExpanded ? (\r\n                                      <FaChevronDown aria-hidden=\"true\" />\r\n                                    ) : (\r\n                                      <FaChevronRight aria-hidden=\"true\" />\r\n                                    )}\r\n                                  </td>\r\n                                  <td>{t.schoolName}</td>\r\n                                  <td>{t.scenarioName}</td>\r\n                                  <td>{fmtNum(t.basisValue)}</td>\r\n                                  <td>{fmtPct(t.weight)}</td>\r\n                                </tr>\r\n                                {isExpanded ? (\r\n                                  <tr>\r\n                                    <td colSpan={5}>\r\n                                      {allocRows.length ? (\r\n                                        <table className=\"table\" style={{ margin: 0 }}>\r\n                                          <thead>\r\n                                            <tr>\r\n                                              <th>Gider</th>\r\n                                              <th>Tutar</th>\r\n                                            </tr>\r\n                                          </thead>\r\n                                          <tbody>\r\n                                            {allocRows.map((row, idx) => (\r\n                                              <tr key={`${targetKey}-${row.expenseLabel}-${idx}`}>\r\n                                                <td>{row.expenseLabel}</td>\r\n                                                <td>{fmtNum(row.amount)}</td>\r\n                                              </tr>\r\n                                            ))}\r\n                                          </tbody>\r\n                                        </table>\r\n                                      ) : (\r\n                                        <div className=\"small is-muted\">Dagitim bulunamadi.</div>\r\n                                      )}\r\n                                    </td>\r\n                                  </tr>\r\n                                ) : null}\r\n                              </React.Fragment>\r\n                            );\r\n                          })}\r\n                        </tbody>\r\n                      </table>\r\n                    </div>\r\n                  </>\r\n                ) : null}\r\n              </div>\r\n            ) : null}\r\n          </>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","\r\nimport React, { useCallback, useEffect, useMemo, useRef, useState } from \"react\";\r\nimport { useNavigate, useOutletContext, useSearchParams } from \"react-router-dom\";\r\nimport { ToastContainer, toast } from \"react-toastify\";\r\n// Import additional icons for better visual cues on the action buttons.\r\n// FaCheckCircle represents approval actions and FaTrash represents deletion actions.\r\nimport {\r\n  FaBalanceScale,\r\n  FaCheckCircle,\r\n  FaCopy,\r\n  FaEdit,\r\n  FaPaperPlane,\r\n  FaPlus,\r\n  FaSort,\r\n  FaSortDown,\r\n  FaSortUp,\r\n  FaTrash,\r\n} from \"react-icons/fa\";\r\nimport { api } from \"../api\";\r\nimport { useAuth } from \"../auth/AuthContext\";\r\nimport ProgressBar from \"../components/ui/ProgressBar\";\r\nimport ExpenseSplitModal from \"../components/ExpenseSplitModal\";\r\nimport {\r\n  getDefaultKademeConfig,\r\n  getKademeDefinitions,\r\n  getGradeOptions,\r\n  normalizeKademeConfig,\r\n} from \"../utils/kademe\";\r\nimport { PROGRAM_TYPES, normalizeProgramType } from \"../utils/programType\";\r\nimport {\n  readSelectedScenarioId,\n  writeSelectedScenarioId,\n  readGlobalLastRouteSegment,\n  writeLastActiveSchoolId,\n  writeScenarioFlags,\n} from \"../utils/schoolNavStorage\";\nimport { isHeadquarterScenario } from \"../utils/scenarioProfile\";\nimport { can } from \"../utils/permissions\";\r\n\r\nconst COPY_SELECT_TABS = [\r\n  {\r\n    key: \"temel\",\r\n    label: \"Temel Bilgiler\",\r\n    sections: [\r\n      { id: \"temel.core\", label: \"Kademeler + Program\" },\r\n      { id: \"temel.pricing\", label: \"Enflasyon + Ucret Artis Oranlari + Ucret Hesaplama Ayari\" },\r\n      { id: \"temel.schoolInfo\", label: \"Yetkililer + Okul/Egitim Bilgileri\" },\r\n      { id: \"temel.discountsMeta\", label: \"IK Mevcut + Burs/Indirim Ogrenci Sayilari\" },\r\n      { id: \"temel.competitors\", label: \"Rakip Analizi\" },\r\n      { id: \"temel.performance\", label: \"Performans + Degerlendirme\" },\r\n    ],\r\n  },\r\n  {\r\n    key: \"kapasite\",\r\n    label: \"Kapasite\",\r\n    sections: [{ id: \"kapasite.all\", label: \"Kapasite (tumu)\" }],\r\n  },\r\n  {\r\n    key: \"norm\",\r\n    label: \"Norm\",\r\n    sections: [\r\n      { id: \"norm.planned\", label: \"Planlanan donem bilgileri\" },\r\n      { id: \"norm.current\", label: \"Mevcut donem bilgileri\" },\r\n      { id: \"norm.lessonY1\", label: \"Ders dagilimi (yalnizca Y1)\" },\r\n    ],\r\n  },\r\n  {\r\n    key: \"hr\",\r\n    label: \"IK (HR)\",\r\n    sections: [{ id: \"hr.ik\", label: \"IK Plan (tumu)\" }],\r\n  },\r\n  {\r\n    key: \"gelirler\",\r\n    label: \"Gelirler\",\r\n    sections: [{ id: \"income.gelirler\", label: \"Gelirler (tumu)\" }],\r\n  },\r\n  {\r\n    key: \"giderler\",\r\n    label: \"Giderler\",\r\n    sections: [\r\n      { id: \"expenses.giderler\", label: \"Giderler (tumu)\" },\r\n      { id: \"expenses.discounts\", label: \"BURS VE INDIRIMLER / YIL\" },\r\n    ],\r\n  },\r\n];\r\n\r\n// Mapping from copy selection section IDs to permission resources.  When a\r\n// scenario is copied, we must specify which permission resources are\r\n// modified so the backend can authorize writes.  Each entry maps a\r\n// selection key to an array of resource strings.  Pagelevel resources\r\n// (e.g. 'page.temel_bilgiler') grant write access to the entire module,\r\n// while sectionlevel resources (e.g. 'section.temel_bilgiler.inflation')\r\n// grant write access only to that portion.  Adjust this mapping if new\r\n// copy sections are introduced.\r\nconst COPY_SECTION_RESOURCES = {\r\n  // Temel Bilgiler: core data (kademeler & program type) require pagelevel permission\r\n  'temel.core': ['page.temel_bilgiler'],\r\n  // Temel Bilgiler: pricing (inflation, fee increases, fee calculation)\r\n  'temel.pricing': ['section.temel_bilgiler.inflation'],\r\n  // Temel Bilgiler: school info and administrators\r\n  'temel.schoolInfo': ['page.temel_bilgiler'],\r\n  // Temel Bilgiler: IK mevcut + burs/indirim counts\r\n  'temel.discountsMeta': ['section.temel_bilgiler.ik_mevcut', 'section.temel_bilgiler.burs_ogr'],\r\n  // Temel Bilgiler: competitors\r\n  'temel.competitors': ['section.temel_bilgiler.rakip'],\r\n  // Temel Bilgiler: performance and evaluation\r\n  'temel.performance': ['section.temel_bilgiler.performans'],\r\n  // Kapasite: all capacity values\r\n  'kapasite.all': ['section.kapasite.caps'],\r\n  // Norm: planned semesters (y2,y3) rely on the norm page\r\n  'norm.planned': ['page.norm'],\r\n  // Norm: current semester values (gradesCurrent) rely on the norm page\r\n  'norm.current': ['page.norm'],\r\n  // Norm: lesson distribution (Y1) maps to the ders_dagilimi section\r\n  'norm.lessonY1': ['section.norm.ders_dagilimi'],\r\n  // HR (IK): all HR data.  Use pagelevel resource since there is only one section defined.\r\n  'hr.ik': ['section.ik.local_staff'],\r\n  // Gelirler: income.  Use pagelevel resource (covers all income categories)\r\n  // For the Gelirler module, use the unit_fee section instead of the page\r\n  // resource.  This allows users who only have sectionlevel write access\r\n  // (e.g. unit_fee) to copy incomes without requiring page.gelirler\r\n  // permission.  See SchoolPage.pathToResources for section mapping logic.\r\n  'income.gelirler': ['section.gelirler.unit_fee'],\r\n  // Giderler: expenses.  The isletme section covers operating expenses\r\n  'expenses.giderler': ['section.giderler.isletme'],\r\n  // Discounts: burs/indirim values (yearlevel discounts)\r\n  'expenses.discounts': ['section.discounts.discounts'],\r\n};\r\n\r\n/**\r\n * Build a list of modified permission resources based on the user's copy\r\n * selection.  For each selected section key whose value is truthy in\r\n * `selection`, this function looks up the corresponding resource(s) in\r\n * COPY_SECTION_RESOURCES and collects them into a unique list.  Unknown\r\n * section keys are ignored.\r\n *\r\n * @param {Object} selection Mapping of section keys to boolean (selected)\r\n * @returns {string[]} List of unique permission resource keys\r\n */\r\nfunction buildModifiedResourcesFromCopySelection(selection) {\r\n  const out = new Set();\r\n  if (!selection || typeof selection !== 'object') return [];\r\n  Object.entries(selection).forEach(([key, value]) => {\r\n    if (!value) return;\r\n    const resources = COPY_SECTION_RESOURCES[key];\r\n    if (Array.isArray(resources)) {\r\n      resources.forEach((r) => out.add(r));\r\n    }\r\n  });\r\n  return Array.from(out);\r\n}\r\n\r\nfunction isScenarioLocked(scenario) {\r\n  const status = String(scenario?.status || \"draft\");\r\n  const submittedAt = scenario?.submitted_at != null;\r\n  const sentAt = scenario?.sent_at != null;\r\n  return (\r\n    status === \"sent_for_approval\" ||\r\n    status === \"submitted\" ||\r\n    (status === \"approved\" && sentAt) ||\r\n    (status === \"in_review\" && submittedAt)\r\n  );\r\n}\r\n\r\nconst DEFAULT_START_YEAR = \"2026\";\r\nconst DEFAULT_END_YEAR = \"2027\";\r\nconst CURRENCY_CODE_REGEX = /^[A-Z0-9]{2,10}$/;\r\nconst LOCAL_CURRENCY_OPTIONS = [\"USD\", \"EUR\", \"TRY\", \"GBP\", \"JPY\", \"CNY\", \"INR\", \"RUB\", \"AED\", \"SAR\", \"AFN\"];\r\n\r\nfunction normalizeYearInput(value) {\r\n  const s = String(value || \"\").trim();\r\n  if (!/^\\d{4}$/.test(s)) return null;\r\n  return Number(s);\r\n}\r\n\r\nfunction formatAcademicYear(periodType, startYearValue, endYearValue) {\r\n  const start = normalizeYearInput(startYearValue);\r\n  if (!start) return \"\";\r\n  if (periodType === \"full\") return String(start);\r\n  const end = normalizeYearInput(endYearValue);\r\n  if (!end) return \"\";\r\n  return `${start}-${end}`;\r\n}\r\n\r\nfunction parseAcademicYear(academicYear) {\r\n  const s = String(academicYear || \"\").trim();\r\n  const range = s.match(/(\\d{4})\\s*-\\s*(\\d{4})/);\r\n  if (range) {\r\n    const startYear = Number(range[1]);\r\n    const endYear = Number(range[2]);\r\n    if (Number.isFinite(startYear) && Number.isFinite(endYear)) {\r\n      return { startYear, endYear };\r\n    }\r\n  }\r\n  const single = s.match(/^(\\d{4})$/);\r\n  if (single) {\r\n    const startYear = Number(single[1]);\r\n    if (Number.isFinite(startYear)) return { startYear, endYear: startYear };\r\n  }\r\n  return { startYear: null, endYear: null };\r\n}\r\n\r\nfunction incrementAcademicYearString(academicYear) {\r\n  const raw = String(academicYear || \"\").trim();\r\n  const single = raw.match(/^(\\d{4})$/);\r\n  if (single) {\r\n    const start = Number(single[1]);\r\n    return Number.isFinite(start) ? String(start + 1) : \"\";\r\n  }\r\n  const range = raw.match(/^(\\d{4})\\s*-\\s*(\\d{4})$/);\r\n  if (range) {\r\n    const start = Number(range[1]);\r\n    const end = Number(range[2]);\r\n    if (Number.isFinite(start) && Number.isFinite(end)) return `${start + 1}-${end + 1}`;\r\n  }\r\n  return \"\";\r\n}\r\n\r\nfunction getAllCopySectionIds() {\r\n  return COPY_SELECT_TABS.flatMap((tab) => tab.sections.map((section) => section.id));\r\n}\r\n\r\nfunction enforceIkGiderlerPair(selection) {\r\n  const next = { ...(selection || {}) };\r\n  const ikSelected = !!next[\"hr.ik\"];\r\n  const giderlerSelected = !!next[\"expenses.giderler\"];\r\n  if (ikSelected !== giderlerSelected) {\r\n    const nextValue = ikSelected || giderlerSelected;\r\n    next[\"hr.ik\"] = nextValue;\r\n    next[\"expenses.giderler\"] = nextValue;\r\n  }\r\n  return next;\r\n}\r\n\r\nfunction buildDefaultCopySelection(presetKey = \"all\") {\r\n  const sectionIds = getAllCopySectionIds();\r\n  const selection = Object.fromEntries(sectionIds.map((id) => [id, false]));\r\n  if (presetKey === \"all\") {\r\n    sectionIds.forEach((id) => {\r\n      selection[id] = true;\r\n    });\r\n  } else if (presetKey === \"structure\") {\r\n    [\"temel.core\", \"kapasite.all\", \"norm.planned\", \"norm.lessonY1\"].forEach((id) => {\r\n      selection[id] = true;\r\n    });\r\n  } else if (presetKey === \"financial\") {\r\n    [\"temel.core\", \"income.gelirler\", \"expenses.discounts\", \"hr.ik\", \"expenses.giderler\"].forEach((id) => {\r\n      selection[id] = true;\r\n    });\r\n  }\r\n  return enforceIkGiderlerPair(selection);\r\n}\r\n\r\nfunction filterInputsForCopyBySelection(srcInputs, selection) {\r\n  const sel = selection || {};\r\n  const keep = (id) => !!sel[id];\r\n  const next = structuredClone(srcInputs || {});\r\n  const buildDefaultGrades = () =>\r\n    getGradeOptions().map((g) => ({ grade: g, branchCount: 0, studentsPerBranch: 0 }));\r\n  const srcGradesYears =\r\n    srcInputs?.gradesYears && typeof srcInputs.gradesYears === \"object\" ? srcInputs.gradesYears : {};\r\n  const srcGrades = Array.isArray(srcInputs?.grades) ? srcInputs.grades : null;\r\n  const y1Source = Array.isArray(srcGradesYears?.y1)\r\n    ? srcGradesYears.y1\r\n    : Array.isArray(srcGrades)\r\n      ? srcGrades\r\n      : buildDefaultGrades();\r\n  const keepPlanned = keep(\"norm.planned\");\r\n  const keepLessonY1 = keep(\"norm.lessonY1\");\r\n  const y2Source = Array.isArray(srcGradesYears?.y2)\r\n    ? srcGradesYears.y2\r\n    : keepLessonY1\r\n      ? y1Source\r\n      : buildDefaultGrades();\r\n  const y3Source = Array.isArray(srcGradesYears?.y3)\r\n    ? srcGradesYears.y3\r\n    : keepLessonY1\r\n      ? y1Source\r\n      : buildDefaultGrades();\r\n  next.temelBilgiler = next.temelBilgiler || {};\r\n\r\n  if (!keep(\"temel.core\")) {\r\n    delete next.temelBilgiler.kademeler;\r\n    delete next.temelBilgiler.programType;\r\n  }\r\n\r\n  if (!keep(\"temel.pricing\")) {\r\n    delete next.temelBilgiler.inflation;\r\n    delete next.temelBilgiler.ucretArtisOranlari;\r\n    delete next.temelBilgiler.okulUcretleriHesaplama;\r\n  }\r\n\r\n  if (!keep(\"temel.schoolInfo\")) {\r\n    delete next.temelBilgiler.yetkililer;\r\n    delete next.temelBilgiler.okulEgitimBilgileri;\r\n  }\r\n\r\n  if (!keep(\"temel.discountsMeta\")) {\r\n    delete next.temelBilgiler.ikMevcut;\r\n    delete next.temelBilgiler.bursIndirimOgrenciSayilari;\r\n  }\r\n\r\n  if (!keep(\"temel.competitors\")) {\r\n    delete next.temelBilgiler.rakipAnalizi;\r\n  }\r\n\r\n  if (!keep(\"temel.performance\")) {\r\n    delete next.temelBilgiler.performans;\r\n    delete next.temelBilgiler.degerlendirme;\r\n  }\r\n  if (next.temelBilgiler?.performans && typeof next.temelBilgiler.performans === \"object\") {\r\n    delete next.temelBilgiler.performans.gerceklesen;\r\n  }\r\n\r\n  if (!keep(\"kapasite.all\")) {\r\n    delete next.kapasite;\r\n    delete next.schoolCapacity;\r\n  }\r\n\r\n  if (!keep(\"norm.current\")) {\r\n    delete next.gradesCurrent;\r\n  }\r\n\r\n  if (!keepPlanned && !keepLessonY1) {\r\n    delete next.gradesYears;\r\n    delete next.grades;\r\n  } else {\r\n    const y1 = keepLessonY1 ? structuredClone(y1Source) : structuredClone(buildDefaultGrades());\r\n    const y2 = keepPlanned ? structuredClone(y2Source) : structuredClone(buildDefaultGrades());\r\n    const y3 = keepPlanned ? structuredClone(y3Source) : structuredClone(buildDefaultGrades());\r\n    next.gradesYears = { y1, y2, y3 };\r\n    if (keepLessonY1) {\r\n      next.grades = structuredClone(y1);\r\n    } else {\r\n      delete next.grades;\r\n    }\r\n  }\r\n\r\n  if (!keep(\"hr.ik\")) {\r\n    delete next.ik;\r\n  }\r\n\r\n  if (!keep(\"income.gelirler\")) {\r\n    delete next.gelirler;\r\n  }\r\n\r\n  if (!keep(\"expenses.giderler\")) {\r\n    delete next.giderler;\r\n  }\r\n\r\n  if (!keep(\"expenses.discounts\")) {\r\n    delete next.discounts;\r\n  }\r\n\r\n  return next;\r\n}\r\n\r\nfunction buildEmptyNormCurriculum() {\r\n  const empty = {};\r\n  getGradeOptions().forEach((g) => {\r\n    empty[g] = {};\r\n  });\r\n  return empty;\r\n}\r\n\r\nfunction buildEmptyNormYear(maxHours) {\r\n  return {\r\n    teacherWeeklyMaxHours: Number.isFinite(maxHours) && maxHours > 0 ? maxHours : 24,\r\n    curriculumWeeklyHours: buildEmptyNormCurriculum(),\r\n  };\r\n}\r\n\r\nfunction convertInputsUsdToLocalForCopy(inputs, fx) {\r\n  const rate = Number(fx);\r\n  if (!Number.isFinite(rate) || rate <= 0) return inputs;\r\n\r\n  const mulMoney = (v) => {\r\n    const n = Number(v);\r\n    if (!Number.isFinite(n)) return v;\r\n    return Math.round(n * rate * 100) / 100;\r\n  };\r\n\r\n  if (inputs?.gelirler) {\r\n    const g = inputs.gelirler;\r\n\r\n    const convertRows = (rows) => {\r\n      if (!Array.isArray(rows)) return;\r\n      rows.forEach((r) => {\r\n        if (!r || typeof r !== \"object\") return;\r\n        if (\"unitFee\" in r) r.unitFee = mulMoney(r.unitFee);\r\n        if (\"amount\" in r) r.amount = mulMoney(r.amount);\r\n      });\r\n    };\r\n\r\n    convertRows(g?.tuition?.rows);\r\n    convertRows(g?.nonEducationFees?.rows);\r\n    convertRows(g?.dormitory?.rows);\r\n    convertRows(g?.otherInstitutionIncome?.rows);\r\n\r\n    if (g?.governmentIncentives != null) {\r\n      g.governmentIncentives = mulMoney(g.governmentIncentives);\r\n    }\r\n  }\r\n\r\n  if (inputs?.giderler && typeof inputs.giderler === \"object\") {\r\n    Object.values(inputs.giderler).forEach((grp) => {\r\n      if (!grp || typeof grp !== \"object\") return;\r\n      if (!grp.items || typeof grp.items !== \"object\") return;\r\n      Object.keys(grp.items).forEach((k) => {\r\n        grp.items[k] = mulMoney(grp.items[k]);\r\n      });\r\n    });\r\n  }\r\n\r\n  if (inputs?.ik?.years && typeof inputs.ik.years === \"object\") {\r\n    Object.values(inputs.ik.years).forEach((yearObj) => {\r\n      if (!yearObj || typeof yearObj !== \"object\") return;\r\n      if (!yearObj.unitCosts || typeof yearObj.unitCosts !== \"object\") return;\r\n      Object.keys(yearObj.unitCosts).forEach((k) => {\r\n        yearObj.unitCosts[k] = mulMoney(yearObj.unitCosts[k]);\r\n      });\r\n    });\r\n  }\r\n\r\n  if (Array.isArray(inputs?.discounts)) {\r\n    inputs.discounts.forEach((d) => {\r\n      if (!d || typeof d !== \"object\") return;\r\n      if (String(d.mode || \"\").toLowerCase() === \"amount\") {\r\n        d.value = mulMoney(d.value);\r\n      }\r\n    });\r\n  }\r\n\r\n  const tb = inputs?.temelBilgiler;\r\n  if (tb) {\r\n    if (tb?.inflation?.currentSeasonAvgFee != null) {\r\n      tb.inflation.currentSeasonAvgFee = mulMoney(tb.inflation.currentSeasonAvgFee);\r\n    }\r\n\r\n    if (tb?.rakipAnalizi && typeof tb.rakipAnalizi === \"object\") {\r\n      Object.values(tb.rakipAnalizi).forEach((obj) => {\r\n        if (!obj || typeof obj !== \"object\") return;\r\n        [\"a\", \"b\", \"c\"].forEach((k) => {\r\n          if (k in obj) obj[k] = mulMoney(obj[k]);\r\n        });\r\n      });\r\n    }\r\n\r\n    if (tb?.performans?.gerceklesen && typeof tb.performans.gerceklesen === \"object\") {\r\n      Object.keys(tb.performans.gerceklesen).forEach((k) => {\r\n        tb.performans.gerceklesen[k] = mulMoney(tb.performans.gerceklesen[k]);\r\n      });\r\n    }\r\n  }\r\n\r\n  return inputs;\r\n}\r\n\r\nfunction convertInputsLocalToUsdForCopy(inputs, fx) {\r\n  const rate = Number(fx);\r\n  if (!Number.isFinite(rate) || rate <= 0) return inputs;\r\n  return convertInputsUsdToLocalForCopy(inputs, 1 / rate);\r\n}\r\n\r\nfunction InlineSpinner({ size = 12 }) {\r\n  return (\r\n    <span\r\n      aria-hidden\r\n      style={{\r\n        width: size,\r\n        height: size,\r\n        borderRadius: \"50%\",\r\n        border: \"2px solid rgba(0,0,0,0.18)\",\r\n        borderTopColor: \"rgba(0,0,0,0.65)\",\r\n        display: \"inline-block\",\r\n        animation: \"schoolSpin .8s linear infinite\",\r\n      }}\r\n    />\r\n  );\r\n}\r\n\r\nfunction applyIkSalariesToGiderler(inInputs) {\r\n  const src = inInputs || {};\r\n  const ik = src.ik || {};\r\n  const yearIK = ik?.years?.y1 ? ik.years.y1 : ik;\r\n\r\n  const unitCosts = yearIK?.unitCosts || {};\r\n  const headcountsByLevel = yearIK?.headcountsByLevel || {};\r\n\r\n  const roles = [\r\n    \"turk_mudur\",\r\n    \"turk_mdyard\",\r\n    \"turk_egitimci\",\r\n    \"turk_temsil\",\r\n    \"yerel_yonetici_egitimci\",\r\n    \"yerel_destek\",\r\n    \"yerel_ulke_temsil_destek\",\r\n    \"int_yonetici_egitimci\",\r\n  ];\r\n\r\n  const levels = [\r\n    \"okulOncesi\",\r\n    \"ilkokulYerel\",\r\n    \"ilkokulInt\",\r\n    \"ortaokulYerel\",\r\n    \"ortaokulInt\",\r\n    \"liseYerel\",\r\n    \"liseInt\",\r\n  ];\r\n\r\n  const roleAnnual = {};\r\n  for (const r of roles) {\r\n    let count = 0;\r\n    for (const lvl of levels) count += Number(headcountsByLevel?.[lvl]?.[r] || 0);\r\n    roleAnnual[r] = Number(unitCosts?.[r] || 0) * count;\r\n  }\r\n\r\n  const patch = {\r\n    turkPersonelMaas:\r\n      (roleAnnual.turk_mudur || 0) +\r\n      (roleAnnual.turk_mdyard || 0) +\r\n      (roleAnnual.turk_egitimci || 0),\r\n    turkDestekPersonelMaas: roleAnnual.turk_temsil || 0,\r\n    yerelPersonelMaas: roleAnnual.yerel_yonetici_egitimci || 0,\r\n    yerelDestekPersonelMaas:\r\n      (roleAnnual.yerel_destek || 0) + (roleAnnual.yerel_ulke_temsil_destek || 0),\r\n    internationalPersonelMaas: roleAnnual.int_yonetici_egitimci || 0,\r\n  };\r\n\r\n  const prevItems = src?.giderler?.isletme?.items || {};\r\n  const keys = Object.keys(patch);\r\n\r\n  let changed = false;\r\n  for (const k of keys) {\r\n    const a = Number(prevItems?.[k] || 0);\r\n    const b = Number(patch?.[k] || 0);\r\n    if (Math.abs(a - b) > 1e-6) {\r\n      changed = true;\r\n      break;\r\n    }\r\n  }\r\n  if (!changed) return src;\r\n\r\n  const next = structuredClone(src);\r\n  next.giderler = next.giderler || {};\r\n  next.giderler.isletme = next.giderler.isletme || {};\r\n  next.giderler.isletme.items = next.giderler.isletme.items || {};\r\n  for (const k of keys) next.giderler.isletme.items[k] = Number(patch[k] || 0);\r\n  return next;\r\n}\r\n\r\nfunction normalizeCapacityInputs(src) {\r\n  const safeNum = (v) => {\r\n    const n = Number(v);\r\n    return Number.isFinite(n) ? n : 0;\r\n  };\r\n\r\n  const s = src || {};\r\n  const legacy = safeNum(s.schoolCapacity);\r\n\r\n  const cap = s.kapasite && typeof s.kapasite === \"object\" ? s.kapasite : {};\r\n  const years = cap.years && typeof cap.years === \"object\" ? cap.years : {};\r\n\r\n  const y1 = safeNum(years.y1 != null ? years.y1 : legacy);\r\n  const y2 = safeNum(years.y2 != null ? years.y2 : y1);\r\n  const y3 = safeNum(years.y3 != null ? years.y3 : y1);\r\n\r\n  const currentStudents = safeNum(cap.currentStudents);\r\n  const byKademe = cap.byKademe && typeof cap.byKademe === \"object\" ? cap.byKademe : {};\r\n\r\n  const needsPatch =\r\n    \"schoolCapacity\" in s ||\r\n    !s.kapasite ||\r\n    typeof s.kapasite !== \"object\" ||\r\n    !cap.years ||\r\n    typeof cap.years !== \"object\" ||\r\n    safeNum(cap?.years?.y1) !== y1 ||\r\n    safeNum(cap?.years?.y2) !== y2 ||\r\n    safeNum(cap?.years?.y3) !== y3 ||\r\n    safeNum(cap?.currentStudents) !== currentStudents ||\r\n    !cap.byKademe ||\r\n    typeof cap.byKademe !== \"object\";\r\n\r\n  if (!needsPatch) return s;\r\n\r\n  const next = structuredClone(s);\r\n  next.kapasite = {\r\n    ...(cap || {}),\r\n    currentStudents,\r\n    years: { y1, y2, y3 },\r\n    byKademe,\r\n  };\r\n  if (\"schoolCapacity\" in next) delete next.schoolCapacity;\r\n  return next;\r\n}\r\n\r\nfunction normalizeTemelBilgilerInputs(src) {\r\n  const s = src || {};\r\n  const t = s.temelBilgiler && typeof s.temelBilgiler === \"object\" ? s.temelBilgiler : {};\r\n  const next = structuredClone(s);\r\n\r\n  const inf = t.inflation && typeof t.inflation === \"object\" ? t.inflation : {};\r\n  const toFinite = (v) => (Number.isFinite(Number(v)) ? Number(v) : 0);\r\n  next.temelBilgiler = {\r\n    inflation: {\r\n      ...inf,\r\n      expenseDeviationPct: toFinite(inf.expenseDeviationPct),\r\n      y2023: toFinite(inf.y2023),\r\n      y2024: toFinite(inf.y2024),\r\n      y2025: toFinite(inf.y2025),\r\n      y1: toFinite(inf.y1),\r\n      y2: toFinite(inf.y2),\r\n      y3: toFinite(inf.y3),\r\n      currentSeasonAvgFee: toFinite(inf.currentSeasonAvgFee),\r\n    },\r\n    yetkililer: t.yetkililer || { mudur: \"\", ulkeTemsilcisi: \"\", raporuHazirlayan: \"\" },\r\n    okulEgitimBilgileri: t.okulEgitimBilgileri || {\r\n      egitimBaslamaTarihi: \"\",\r\n      zorunluEgitimDonemleri: \"\",\r\n      birDersSuresiDakika: 0,\r\n      gunlukDersSaati: 0,\r\n      haftalikDersSaatiToplam: 0,\r\n      sabahciOglenci: \"\",\r\n      ogretmenHaftalikDersOrt: 0,\r\n      gecisSinaviBilgisi: \"\",\r\n      uygulananProgram: \"\",\r\n    },\r\n    kademeler: normalizeKademeConfig(t.kademeler),\r\n    programType: normalizeProgramType(t.programType),\r\n    okulUcretleriHesaplama: typeof t.okulUcretleriHesaplama === \"boolean\" ? t.okulUcretleriHesaplama : true,\r\n    ucretArtisOranlari: t.ucretArtisOranlari || {\r\n      okulOncesi: 0,\r\n      ilkokulYerel: 0,\r\n      ilkokulInt: 0,\r\n      ortaokulYerel: 0,\r\n      ortaokulInt: 0,\r\n      liseYerel: 0,\r\n      liseInt: 0,\r\n    },\r\n    ikMevcut: t.ikMevcut || {\r\n      turkPersonelYoneticiEgitimci: 0,\r\n      turkPersonelTemsilcilik: 0,\r\n      yerelKadroluEgitimci: 0,\r\n      yerelUcretliVakaterEgitimci: 0,\r\n      yerelDestek: 0,\r\n      yerelTemsilcilik: 0,\r\n      international: 0,\r\n    },\r\n    bursIndirimOgrenciSayilari: t.bursIndirimOgrenciSayilari || {\r\n      magisBasariBursu: 0,\r\n      maarifYetenekBursu: 0,\r\n      ihtiyacBursu: 0,\r\n      okulBasariBursu: 0,\r\n      tamEgitimBursu: 0,\r\n      barinmaBursu: 0,\r\n      turkceBasariBursu: 0,\r\n      uluslararasiYukumlulukIndirimi: 0,\r\n      vakifCalisaniIndirimi: 0,\r\n      kardesIndirimi: 0,\r\n      erkenKayitIndirimi: 0,\r\n      pesinOdemeIndirimi: 0,\r\n      kademeGecisIndirimi: 0,\r\n      temsilIndirimi: 0,\r\n      kurumIndirimi: 0,\r\n      istisnaiIndirim: 0,\r\n      yerelMevzuatIndirimi: 0,\r\n    },\r\n    rakipAnalizi: t.rakipAnalizi || {\r\n      okulOncesi: { a: 0, b: 0, c: 0 },\r\n      ilkokul: { a: 0, b: 0, c: 0 },\r\n      ortaokul: { a: 0, b: 0, c: 0 },\r\n      lise: { a: 0, b: 0, c: 0 },\r\n    },\r\n    performans: t.performans || {\r\n      gerceklesen: { ogrenciSayisi: 0, gelirler: 0, giderler: 0, karZarar: 0, bursVeIndirimler: 0 },\r\n    },\r\n    degerlendirme: typeof t.degerlendirme === \"string\" ? t.degerlendirme : \"\",\r\n  };\r\n\r\n  return next;\r\n}\r\n\r\nfunction normalizeGradesInputs(src) {\r\n  const s = src || {};\r\n  const defaultGrades = getGradeOptions().map((g) => ({ grade: g, branchCount: 0, studentsPerBranch: 0 }));\r\n  const baseGrades = Array.isArray(s.grades) ? s.grades : defaultGrades;\r\n  const years = s.gradesYears && typeof s.gradesYears === \"object\" ? s.gradesYears : {};\r\n\r\n  const y1 = Array.isArray(years.y1) ? years.y1 : baseGrades;\r\n  const y2 = Array.isArray(years.y2) ? years.y2 : y1;\r\n  const y3 = Array.isArray(years.y3) ? years.y3 : y1;\r\n\r\n  const normalizeRow = (row) => ({\r\n    grade: String(row?.grade ?? \"\"),\r\n    branchCount: Number(row?.branchCount ?? 0),\r\n    studentsPerBranch: Number(row?.studentsPerBranch ?? 0),\r\n  });\r\n\r\n  const toMap = (list) => {\r\n    const m = new Map();\r\n    (Array.isArray(list) ? list : []).forEach((row) => {\r\n      const r = normalizeRow(row);\r\n      if (!r.grade) return;\r\n      m.set(r.grade, r);\r\n    });\r\n    return m;\r\n  };\r\n\r\n  const areGradesEqual = (a, b) => {\r\n    if (!Array.isArray(a) || !Array.isArray(b)) return false;\r\n    if (a.length !== b.length) return false;\r\n    const ma = toMap(a);\r\n    const mb = toMap(b);\r\n    if (ma.size !== mb.size) return false;\r\n    for (const [grade, ra] of ma.entries()) {\r\n      const rb = mb.get(grade);\r\n      if (!rb) return false;\r\n      if (Number(ra.branchCount) !== Number(rb.branchCount)) return false;\r\n      if (Number(ra.studentsPerBranch) !== Number(rb.studentsPerBranch)) return false;\r\n    }\r\n    return true;\r\n  };\r\n\r\n  const needsPatch =\r\n    !s.gradesYears ||\r\n    !Array.isArray(s.grades) ||\r\n    !Array.isArray(years.y1) ||\r\n    !Array.isArray(years.y2) ||\r\n    !Array.isArray(years.y3) ||\r\n    !areGradesEqual(s.grades, y1);\r\n\r\n  if (!needsPatch) return s;\r\n\r\n  const next = structuredClone(s);\r\n  next.gradesYears = {\r\n    y1: structuredClone(y1),\r\n    y2: structuredClone(y2),\r\n    y3: structuredClone(y3),\r\n  };\r\n  next.grades = structuredClone(next.gradesYears.y1);\r\n  return next;\r\n}\r\n\r\nfunction getScenarioStatusMeta(scenarioOrStatus) {\r\n  const obj = scenarioOrStatus && typeof scenarioOrStatus === 'object' ? scenarioOrStatus : { status: scenarioOrStatus };\r\n  const status = obj.status;\r\n  const sentAt = obj.sent_at;\r\n  switch (status) {\r\n    case 'revision_requested':\r\n      return { label: 'Revize istendi', cls: 'is-revision', help: 'Revize istendi: senaryoda dzeltme gerekiyor.' };\r\n    case 'sent_for_approval':\r\n      return { label: 'Merkeze iletildi', cls: 'is-submitted', help: 'Merkeze iletildi: admin onay bekleniyor.' };\r\n    case 'submitted':\r\n      // Legacy status; treat similarly to sent_for_approval\r\n      return { label: 'Merkeze iletildi', cls: 'is-submitted', help: 'Merkeze iletildi: admin onay bekleniyor.' };\r\n    case 'approved':\r\n      if (sentAt) {\r\n        return { label: 'Onayland', cls: 'is-approved', help: 'Onayland: admin tarafndan onayland.' };\r\n      }\r\n      return { label: 'Kontrol edildi', cls: 'is-approved', help: 'Kontrol edildi: ynetici tarafndan kontrol edildi.' };\r\n    case 'in_review':\r\n      return { label: 'ncelemede', cls: 'is-submitted', help: 'ncelemede: ynetici incelemesinde.' };\r\n    case 'draft':\r\n      return { label: 'Taslak', cls: 'is-draft', help: 'Taslak: senaryo zerinde allyor.' };\r\n    default:\r\n      return { label: status || '-', cls: 'is-unknown', help: '' };\r\n  }\r\n}\r\n\r\nexport default function SelectPage() {\r\n  const navigate = useNavigate();\r\n  const outlet = useOutletContext();\r\n  const [searchParams, setSearchParams] = useSearchParams();\r\n  const auth = useAuth();\r\n\r\n  const [schools, setSchools] = useState([]);\r\n  const [scenarios, setScenarios] = useState([]);\r\n  const [scenariosSchoolId, setScenariosSchoolId] = useState(null);\r\n  const [selectedSchoolId, setSelectedSchoolId] = useState(null);\r\n  const [selectedScenarioIdLocal, setSelectedScenarioIdLocal] = useState(null);\r\n  const [selectedScenario, setSelectedScenario] = useState(null);\r\n  const [inputs, setInputs] = useState(null);\r\n  const [, setReport] = useState(null);\r\n  const [err, setErr] = useState(\"\");\r\n  const [loadingSchools, setLoadingSchools] = useState(false);\r\n  const [loadingScenarios, setLoadingScenarios] = useState(false);\r\n  const [schoolProgress, setSchoolProgress] = useState({});\r\n  const [schoolProgressLoading, setSchoolProgressLoading] = useState(false);\r\n  const [scenarioProgressMap, setScenarioProgressMap] = useState({});\r\n  const [scenarioProgressLoading, setScenarioProgressLoading] = useState(false);\r\n\r\n  const [newScenarioName, setNewScenarioName] = useState(\"\");\r\n  const [newScenarioPeriod, setNewScenarioPeriod] = useState(\"split\");\r\n  const [newScenarioStartYear, setNewScenarioStartYear] = useState(DEFAULT_START_YEAR);\r\n  const [newScenarioEndYear, setNewScenarioEndYear] = useState(DEFAULT_END_YEAR);\r\n  const [newScenarioKademeler, setNewScenarioKademeler] = useState(getDefaultKademeConfig());\r\n  // Some branches (e.g. Headquarter / Merkez) may not have any academic \"kademe\".\r\n  // We support this by allowing an explicit \"no kademe\" toggle in the wizard.\r\n  const [newScenarioNoKademe, setNewScenarioNoKademe] = useState(false);\r\n  const [newScenarioInputCurrency, setNewScenarioInputCurrency] = useState(\"USD\");\r\n  const [newScenarioLocalCurrencyCode, setNewScenarioLocalCurrencyCode] = useState(\"\");\r\n  const [newScenarioFxUsdToLocal, setNewScenarioFxUsdToLocal] = useState(\"\");\r\n  const [newScenarioProgramType, setNewScenarioProgramType] = useState(null);\r\n  const [newScenarioStep, setNewScenarioStep] = useState(0);\r\n  const [scenarioWizardOpen, setScenarioWizardOpen] = useState(false);\r\n  const [scenarioWizardMode, setScenarioWizardMode] = useState(\"create\");\r\n  const [scenarioWizardScenario, setScenarioWizardScenario] = useState(null);\r\n  const [scenarioWizardLoading, setScenarioWizardLoading] = useState(false);\r\n  const [scenarioWizardSaving, setScenarioWizardSaving] = useState(false);\r\n\r\n  const [scenarioSort, setScenarioSort] = useState({ key: null, dir: \"asc\" });\r\n  const [submittingScenarioId, setSubmittingScenarioId] = useState(null);\r\n  const [copyingScenarioId, setCopyingScenarioId] = useState(null);\r\n  const [deletingScenarioId, setDeletingScenarioId] = useState(null);\r\n  const [deleteConfirmScenarioId, setDeleteConfirmScenarioId] = useState(null);\r\n  const [copyModalOpen, setCopyModalOpen] = useState(false);\r\n  const [expenseSplitOpen, setExpenseSplitOpen] = useState(false);\r\n  const [copyModalError, setCopyModalError] = useState(\"\");\r\n  const [copySelection, setCopySelection] = useState(null);\r\n  const [copySelectionMsg, setCopySelectionMsg] = useState(\"\");\r\n  const [copyTargetCurrency, setCopyTargetCurrency] = useState(\"USD\");\r\n  const [copyLocalCurrencyCode, setCopyLocalCurrencyCode] = useState(\"\");\r\n  const [copyPlannedFxUsdToLocal, setCopyPlannedFxUsdToLocal] = useState(\"\");\r\n  const [copyFxUsdToLocal, setCopyFxUsdToLocal] = useState(\"\");\r\n  const [calculating, setCalculating] = useState(false);\r\n\r\n  const copySelectionMsgTimerRef = useRef(null);\r\n  const kademeBeforeNoKademeRef = useRef(null);\r\n\r\n  useEffect(() => {\r\n    if (!outlet?.setHeaderMeta) return;\r\n    outlet.setHeaderMeta({\r\n      title: \"Okul & Senaryo Sec\",\r\n      subtitle: \"Okul ve senaryoyu secip Uygula'ya basin.\",\r\n      centered: true,\r\n    });\r\n    return () => {\r\n      outlet.clearHeaderMeta?.();\r\n    };\r\n  }, [outlet]);\r\n\r\n  const loadSchools = useCallback(async () => {\r\n    setErr(\"\");\r\n    setLoadingSchools(true);\r\n    try {\r\n      const data = await api.listSchools({\r\n        limit: 50,\r\n        offset: 0,\r\n        fields: \"brief\",\r\n        order: \"name:asc\",\r\n      });\r\n      setSchools(Array.isArray(data?.items) ? data.items : []);\r\n    } catch (e) {\r\n      setErr(e.message || \"Okullar yuklenemedi.\");\r\n    } finally {\r\n      setLoadingSchools(false);\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    loadSchools();\r\n  }, [loadSchools]);\r\n\r\n  const loadSchoolProgress = useCallback(async (rows) => {\r\n    if (!Array.isArray(rows) || !rows.length) {\r\n      setSchoolProgress({});\r\n      return;\r\n    }\r\n    setSchoolProgressLoading(true);\r\n    try {\r\n      const ids = rows.map((s) => s.id);\r\n      const data = await api.getSchoolsProgressBulk(ids);\r\n      const map = data?.progressBySchoolId && typeof data.progressBySchoolId === \"object\"\r\n        ? data.progressBySchoolId\r\n        : {};\r\n      setSchoolProgress(map);\r\n    } catch (_) {\r\n      const fallback = {};\r\n      rows.forEach((s) => {\r\n        fallback[s.id] = { state: \"error\", label: \"lerleme hesaplanamad\" };\r\n      });\r\n      setSchoolProgress(fallback);\r\n    } finally {\r\n      setSchoolProgressLoading(false);\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (!schools.length) {\r\n      setSchoolProgress({});\r\n      setSchoolProgressLoading(false);\r\n      return;\r\n    }\r\n    loadSchoolProgress(schools);\r\n  }, [schools, loadSchoolProgress]);\r\n\r\n  useEffect(() => {\r\n    const raw = searchParams.get(\"schoolId\");\r\n    const paramId = Number(raw || 0);\r\n    if (!raw || !Number.isFinite(paramId)) return;\r\n    if (!schools.length) return;\r\n    if (!schools.some((s) => String(s.id) === String(paramId))) return;\r\n    setSelectedSchoolId((prev) => {\r\n      if (String(prev) === String(paramId)) return prev;\r\n      setScenarios([]);\r\n      setScenariosSchoolId(null);\r\n      setScenarioProgressMap({});\r\n      setScenarioProgressLoading(false);\r\n      return paramId;\r\n    });\r\n  }, [searchParams, schools]);\r\n\r\n  const handleSelectSchool = useCallback(\r\n    (schoolId) => {\r\n      const isDifferent = String(selectedSchoolId) !== String(schoolId);\r\n      if (isDifferent) {\r\n        setSelectedScenarioIdLocal(null);\r\n        setSelectedScenario(null);\r\n        setInputs(null);\r\n        setReport(null);\r\n        setScenarios([]);\r\n        setScenariosSchoolId(null);\r\n        setScenarioProgressMap({});\r\n        setScenarioProgressLoading(false);\r\n      }\r\n      setSelectedSchoolId(schoolId);\r\n      if (isDifferent) {\r\n        setSearchParams((prev) => {\r\n          const next = new URLSearchParams(prev);\r\n          next.set(\"schoolId\", String(schoolId));\r\n          return next;\r\n        });\r\n      }\r\n    },\r\n    [selectedSchoolId, setSearchParams]\r\n  );\r\n\r\n  const clearSchoolSelection = useCallback(() => {\r\n    setSelectedSchoolId(null);\r\n    setSelectedScenarioIdLocal(null);\r\n    setSelectedScenario(null);\r\n    setInputs(null);\r\n    setReport(null);\r\n    setScenarios([]);\r\n    setScenariosSchoolId(null);\r\n    setScenarioProgressMap({});\r\n    setSearchParams((prev) => {\r\n      const next = new URLSearchParams(prev);\r\n      next.delete(\"schoolId\");\r\n      return next;\r\n    });\r\n  }, [setSearchParams]);\r\n\r\n  const clearScenarioSelection = useCallback(() => {\r\n    setSelectedScenarioIdLocal(null);\r\n    setSelectedScenario(null);\r\n    setInputs(null);\r\n    setReport(null);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (!selectedSchoolId) {\r\n      setScenarios([]);\r\n      setScenariosSchoolId(null);\r\n      setSelectedScenarioIdLocal(null);\r\n      setSelectedScenario(null);\r\n      setInputs(null);\r\n      setReport(null);\r\n      setScenarioProgressMap({});\r\n      setScenarioProgressLoading(false);\r\n      setLoadingScenarios(false);\r\n      return;\r\n    }\r\n\r\n    setSelectedScenarioIdLocal(null);\r\n    setSelectedScenario(null);\r\n    setInputs(null);\r\n    setReport(null);\r\n    setScenarios([]);\r\n    setScenariosSchoolId(null);\r\n    setScenarioProgressMap({});\r\n    setScenarioProgressLoading(false);\r\n\r\n    let active = true;\r\n    setErr(\"\");\r\n    setLoadingScenarios(true);\r\n    async function loadScenarios() {\r\n      try {\r\n        const sc = await api.listScenarios(selectedSchoolId, {\r\n          limit: 50,\r\n          offset: 0,\r\n          fields: \"brief\",\r\n          order: \"created_at:desc\",\r\n        });\r\n        if (!active) return;\r\n        const rows = Array.isArray(sc?.items) ? sc.items : [];\r\n        setScenarios(rows);\r\n        setScenariosSchoolId(selectedSchoolId);\r\n        setSelectedScenarioIdLocal((prev) => {\r\n          const exists = rows.some((s) => String(s.id) === String(prev));\r\n          if (exists) return prev;\r\n          const stored = readSelectedScenarioId(selectedSchoolId);\r\n          if (stored != null && rows.some((s) => String(s.id) === String(stored))) return stored;\r\n          return null;\r\n        });\r\n      } catch (e) {\r\n        if (!active) return;\r\n        setErr(e.message || \"Senaryolar yuklenemedi.\");\r\n        setScenarios([]);\r\n      } finally {\r\n        if (active) setLoadingScenarios(false);\r\n      }\r\n    }\r\n\r\n    loadScenarios();\r\n    return () => {\r\n      active = false;\r\n    };\r\n  }, [selectedSchoolId]);\r\n\r\n  useEffect(() => {\r\n    if (!selectedSchoolId) {\r\n      setScenarioProgressMap({});\r\n      setScenarioProgressLoading(false);\r\n      return;\r\n    }\r\n    if (scenariosSchoolId != null && String(scenariosSchoolId) !== String(selectedSchoolId)) {\r\n      setScenarioProgressMap({});\r\n      setScenarioProgressLoading(false);\r\n      return;\r\n    }\r\n    if (!scenarios.length) {\r\n      setScenarioProgressMap({});\r\n      setScenarioProgressLoading(false);\r\n      return;\r\n    }\r\n    let active = true;\r\n    setScenarioProgressLoading(true);\r\n    async function loadScenarioProgress() {\r\n      try {\r\n        const results = await Promise.all(\r\n          scenarios.map(async (scenario) => {\r\n            try {\r\n              const data = await api.getScenarioProgress(selectedSchoolId, scenario.id);\r\n              const progress = data?.progress;\r\n              if (!progress) return { id: scenario.id, error: true };\r\n              const missingLines = Array.isArray(progress.missingDetailsLines)\r\n                ? progress.missingDetailsLines\r\n                : [];\r\n              const tooltipLines = missingLines.length\r\n                ? [\"Eksik:\", ...missingLines]\r\n                : [\"Tm tablolar tamamland\"];\r\n              return { id: scenario.id, pct: progress.pct ?? 0, tooltipLines };\r\n            } catch (_) {\r\n              return { id: scenario.id, error: true };\r\n            }\r\n          })\r\n        );\r\n        if (!active) return;\r\n        const map = {};\r\n        results.forEach((row) => {\r\n          map[row.id] = row;\r\n        });\r\n        setScenarioProgressMap(map);\r\n      } finally {\r\n        if (active) setScenarioProgressLoading(false);\r\n      }\r\n    }\r\n    loadScenarioProgress();\r\n    return () => {\r\n      active = false;\r\n    };\r\n  }, [selectedSchoolId, scenarios, scenariosSchoolId]);\r\n\r\n  useEffect(() => {\r\n    if (!selectedSchoolId || !selectedScenarioIdLocal) {\r\n      setSelectedScenario(null);\r\n      setInputs(null);\r\n      setReport(null);\r\n      return;\r\n    }\r\n\r\n    let active = true;\r\n    setErr(\"\");\r\n    async function loadScenario() {\r\n      try {\r\n        const data = await api.getScenarioInputs(selectedSchoolId, selectedScenarioIdLocal);\r\n        if (!active) return;\r\n        setSelectedScenario(data?.scenario || null);\r\n        const raw = data?.inputs;\r\n        const normalized =\n          raw && typeof raw === \"object\"\n            ? normalizeGradesInputs(normalizeTemelBilgilerInputs(normalizeCapacityInputs(raw)))\n            : raw;\n        setInputs(normalized);\n        const isHQ = isHeadquarterScenario(normalized);\n        writeScenarioFlags(selectedSchoolId, selectedScenarioIdLocal, { isHeadquarter: isHQ });\n        setReport(null);\n      } catch (e) {\r\n        if (!active) return;\r\n        setErr(e.message || \"Senaryo yuklenemedi.\");\r\n      }\r\n    }\r\n\r\n    loadScenario();\r\n    return () => {\r\n      active = false;\r\n    };\r\n  }, [selectedSchoolId, selectedScenarioIdLocal]);\r\n\r\n  const refreshScenarios = useCallback(async () => {\r\n    if (!selectedSchoolId) return null;\r\n    try {\r\n      const sc = await api.listScenarios(selectedSchoolId, {\r\n        limit: 50,\r\n        offset: 0,\r\n        fields: \"brief\",\r\n        order: \"created_at:desc\",\r\n      });\r\n      const rows = Array.isArray(sc?.items) ? sc.items : [];\r\n      setScenarios(rows);\r\n      setScenariosSchoolId(selectedSchoolId);\r\n      return rows;\r\n    } catch (_) {\r\n      return null;\r\n    }\r\n  }, [selectedSchoolId]);\r\n\r\n  const kademeDefs = useMemo(() => getKademeDefinitions(), []);\r\n  const gradeOptions = useMemo(() => getGradeOptions(), []);\r\n\r\n  const draftStartYear = normalizeYearInput(newScenarioStartYear);\r\n  const draftEndYear = normalizeYearInput(newScenarioEndYear);\r\n  const draftAcademicYear = formatAcademicYear(newScenarioPeriod, newScenarioStartYear, newScenarioEndYear);\r\n  const draftRangeOk = newScenarioPeriod === \"full\" || (draftStartYear != null && draftEndYear === draftStartYear + 1);\r\n  const yearConflict = useMemo(() => {\r\n    if (!draftAcademicYear) return false;\r\n    const excludeId =\r\n      scenarioWizardMode === \"edit\"\r\n        ? Number(scenarioWizardScenario?.id || selectedScenarioIdLocal || 0)\r\n        : null;\r\n    return scenarios.some(\r\n      (s) =>\r\n        String(s?.academic_year || \"\").trim() === String(draftAcademicYear).trim() &&\r\n        (excludeId == null || Number(s?.id) !== excludeId)\r\n    );\r\n  }, [draftAcademicYear, scenarios, scenarioWizardMode, scenarioWizardScenario?.id, selectedScenarioIdLocal]);\r\n\r\n  const draftKademeConfig = useMemo(() => normalizeKademeConfig(newScenarioKademeler), [newScenarioKademeler]);\r\n  const hasEnabledKademe = useMemo(\r\n    () => Object.values(draftKademeConfig).some((row) => row && row.enabled),\r\n    [draftKademeConfig]\r\n  );\r\n  const kademeStepOk = newScenarioNoKademe || hasEnabledKademe;\r\n  const normalizedLocalCode = String(newScenarioLocalCurrencyCode || \"\").trim().toUpperCase();\r\n  const localCodeOk = newScenarioInputCurrency !== \"LOCAL\" || CURRENCY_CODE_REGEX.test(normalizedLocalCode);\r\n  const fxValue = Number(newScenarioFxUsdToLocal);\r\n  const fxOk = newScenarioInputCurrency !== \"LOCAL\" || (Number.isFinite(fxValue) && fxValue > 0);\r\n  const currencyStepOk = newScenarioInputCurrency === \"USD\" || (localCodeOk && fxOk);\r\n  const draftReady =\r\n    Boolean(newScenarioName.trim()) &&\r\n    Boolean(draftAcademicYear) &&\r\n    draftRangeOk &&\r\n    !yearConflict &&\r\n    kademeStepOk &&\r\n    currencyStepOk;\r\n  const scenarioStepTotal = 6;\r\n  const scenarioStepLabels = [\r\n    \"Donem Turu\",\r\n    \"Para Birimi\",\r\n    \"Program Turu\",\r\n    \"Yil\",\r\n    \"Kademeler\",\r\n    \"Senaryo Adi\",\r\n  ];\r\n  const scenarioStepOk = [\r\n    true,\r\n    currencyStepOk,\r\n    Boolean(newScenarioProgramType),\r\n    Boolean(draftAcademicYear) && draftRangeOk && !yearConflict,\r\n    kademeStepOk,\r\n    draftReady,\r\n  ];\r\n\r\n  const scenarioOpsBusy = Boolean(\r\n    copyingScenarioId ||\r\n    submittingScenarioId ||\r\n    deletingScenarioId ||\r\n    scenarioWizardSaving ||\r\n    scenarioWizardLoading\r\n  );\r\n  const busyRowId = copyingScenarioId ?? submittingScenarioId ?? deletingScenarioId ?? null;\r\n  const selectedRowScenario = useMemo(\n    () => scenarios.find((s) => String(s.id) === String(selectedScenarioIdLocal)) || null,\n    [scenarios, selectedScenarioIdLocal]\n  );\n  const selectedSchoolName = useMemo(() => {\n    const match = schools.find((s) => String(s.id) === String(selectedSchoolId));\n    return match?.name || \"\";\n  }, [schools, selectedSchoolId]);\n  const sortedScenarios = useMemo(() => {\r\n    if (!scenarioSort.key) return scenarios;\r\n    const indexed = scenarios.map((s, idx) => ({ s, idx }));\r\n    const dirMul = scenarioSort.dir === \"asc\" ? 1 : -1;\r\n\r\n    const getYearParts = (ay) => {\r\n      const m = String(ay || \"\").match(/(\\d{4})(?:\\s*-\\s*(\\d{4}))?/);\r\n      const a = m ? Number(m[1]) : 0;\r\n      const b = m && m[2] ? Number(m[2]) : a;\r\n      return [a || 0, b || 0];\r\n    };\r\n\r\n    const getCurrencyCode = (s) =>\r\n      String(s.input_currency || \"USD\").toUpperCase() === \"LOCAL\"\r\n        ? String(s.local_currency_code || \"LOCAL\").toUpperCase()\r\n        : \"USD\";\r\n\r\n    const getStatusLabel = (status) => {\r\n      switch (status) {\r\n        case 'in_review':\r\n          return 'ncelemede';\r\n        case 'sent_for_approval':\r\n          return 'Onaya Gonderildi';\r\n        case 'submitted':\r\n          return 'Gonderildi';\r\n        case \"revision_requested\":\r\n          return \"Revizyon Istendi\";\r\n        case \"approved\":\r\n          return \"Onaylandi\";\r\n        default:\r\n          return \"Taslak\";\r\n      }\r\n    };\r\n\r\n    indexed.sort((a, b) => {\r\n      const A = a.s;\r\n      const B = b.s;\r\n      let res = 0;\r\n\r\n      switch (scenarioSort.key) {\r\n        case \"name\":\r\n          res = String(A.name || \"\").localeCompare(String(B.name || \"\"), \"tr\", {\r\n            sensitivity: \"base\",\r\n            numeric: true,\r\n          });\r\n          break;\r\n        case \"year\": {\r\n          const [a1, a2] = getYearParts(A.academic_year);\r\n          const [b1, b2] = getYearParts(B.academic_year);\r\n          res = a1 - b1 || a2 - b2;\r\n          break;\r\n        }\r\n        case \"currency\":\r\n          res = getCurrencyCode(A).localeCompare(getCurrencyCode(B), \"tr\", {\r\n            sensitivity: \"base\",\r\n            numeric: true,\r\n          });\r\n          break;\r\n        case \"status\":\r\n          res = getStatusLabel(A.status).localeCompare(getStatusLabel(B.status), \"tr\", {\r\n            sensitivity: \"base\",\r\n            numeric: true,\r\n          });\r\n          break;\r\n        case \"date\":\r\n          res = new Date(A.created_at).getTime() - new Date(B.created_at).getTime();\r\n          break;\r\n        default:\r\n          res = 0;\r\n      }\r\n\r\n      if (res === 0) res = a.idx - b.idx;\r\n      return res * dirMul;\r\n    });\r\n\r\n    return indexed.map((item) => item.s);\r\n  }, [scenarios, scenarioSort]);\r\n  const toggleScenarioSort = (key) => {\r\n    setScenarioSort((prev) =>\r\n      prev.key === key ? { key, dir: prev.dir === \"asc\" ? \"desc\" : \"asc\" } : { key, dir: \"asc\" }\r\n    );\r\n  };\r\n  const getSortAria = (key) => {\r\n    if (scenarioSort.key !== key) return \"none\";\r\n    return scenarioSort.dir === \"asc\" ? \"ascending\" : \"descending\";\r\n  };\r\n  const sortIcon = (key) => {\r\n    if (scenarioSort.key !== key) {\r\n      return (\r\n        <span className=\"sort-icon is-idle\">\r\n          <FaSort aria-hidden=\"true\" />\r\n        </span>\r\n      );\r\n    }\r\n    return (\r\n      <span className=\"sort-icon\">\r\n        {scenarioSort.dir === \"asc\" ? <FaSortUp aria-hidden=\"true\" /> : <FaSortDown aria-hidden=\"true\" />}\r\n      </span>\r\n    );\r\n  };\r\n\r\n  const copySectionIds = useMemo(() => getAllCopySectionIds(), []);\r\n  const selectedCopyCount = copySelection\r\n    ? copySectionIds.reduce((sum, id) => sum + (copySelection[id] ? 1 : 0), 0)\r\n    : 0;\r\n  const selIk = !!copySelection?.[\"hr.ik\"];\r\n  const selGiderler = !!copySelection?.[\"expenses.giderler\"];\r\n  const isIkGiderlerValid = selIk === selGiderler;\r\n  const sourceCurrency = String(selectedScenario?.input_currency || \"USD\").toUpperCase();\r\n  const inputCurrencyCode =\r\n    selectedScenario?.input_currency === \"LOCAL\"\r\n      ? selectedScenario.local_currency_code || \"LOCAL\"\r\n      : \"USD\";\r\n  const isLocalScenario = selectedScenario?.input_currency === \"LOCAL\";\r\n  const prevRealFxValue = Number(inputs?.temelBilgiler?.performans?.prevYearRealizedFxUsdToLocal || 0);\r\n  const prevRealFxMissing = isLocalScenario && !(Number.isFinite(prevRealFxValue) && prevRealFxValue > 0);\r\n\r\n  const permissionScope = useMemo(\r\n    () => ({\r\n      countryId: auth.user?.country_id ?? null,\r\n      schoolId: selectedSchoolId != null ? Number(selectedSchoolId) : null,\r\n    }),\r\n    [auth.user?.country_id, selectedSchoolId]\r\n  );\r\n  const role = String(auth.user?.role || \"\");\r\n  const canCreateScenario = can(auth.user, \"scenario.create\", \"write\", permissionScope);\r\n  const canEditScenarioPlan = can(auth.user, \"scenario.plan_edit\", \"write\", permissionScope);\r\n  const canCopyScenario = can(auth.user, \"scenario.copy\", \"write\", permissionScope);\r\n  const canExpenseSplit = can(auth.user, \"scenario.expense_split\", \"write\", permissionScope);\r\n  const canSubmitScenario = can(auth.user, \"scenario.submit\", \"write\", permissionScope);\r\n  const canForwardScenario =\r\n    role === \"manager\" || role === \"accountant\" || can(auth.user, \"scenario.forward\", \"write\", permissionScope);\r\n  const canDeleteScenario = can(auth.user, \"scenario.delete\", \"write\", permissionScope);\r\n\r\n  // Lock editing when the scenario has been forwarded to admins (sent_for_approval)\r\n  // or when it has been adminapproved.  Managerapproved scenarios (status\r\n  // 'approved' with sent_at null) remain editable until they are sent\r\n  // onward via the manager workflow.\r\n  const toolbarLocked = Boolean(selectedRowScenario) && isScenarioLocked(selectedRowScenario);\r\n  const canEditToolbar = Boolean(selectedRowScenario) && !toolbarLocked && canEditScenarioPlan;\r\n  const canDeleteToolbar = Boolean(selectedRowScenario) && !toolbarLocked && canDeleteScenario;\r\n  const isSubmitStage =\r\n    Boolean(selectedRowScenario) &&\r\n    (selectedRowScenario.status === \"draft\" || selectedRowScenario.status === \"revision_requested\");\r\n  const isForwardStage =\r\n    Boolean(selectedRowScenario) && selectedRowScenario.status === \"approved\" && !selectedRowScenario.sent_at;\r\n  const canSubmitToolbar = isSubmitStage && canSubmitScenario;\r\n  const canForwardToolbar = isForwardStage && canForwardScenario;\r\n  const canCopyToolbar = Boolean(selectedRowScenario) && inputs && canCopyScenario;\r\n  const toolbarIsCopying =\r\n    selectedRowScenario && String(copyingScenarioId) === String(selectedRowScenario.id);\r\n  const toolbarIsSubmitting =\r\n    selectedRowScenario && String(submittingScenarioId) === String(selectedRowScenario.id);\r\n  const toolbarIsDeleting =\r\n    selectedRowScenario && String(deletingScenarioId) === String(selectedRowScenario.id);\r\n\r\n  const handleScenarioCurrencyChange = (next) => {\r\n    setNewScenarioInputCurrency(next);\r\n    if (next !== \"LOCAL\") {\r\n      setNewScenarioLocalCurrencyCode(\"\");\r\n      setNewScenarioFxUsdToLocal(\"\");\r\n    }\r\n  };\r\n  const handleScenarioPeriodChange = (nextPeriod) => {\r\n    setNewScenarioPeriod(nextPeriod);\r\n    if (nextPeriod === \"split\") {\r\n      const start = normalizeYearInput(newScenarioStartYear);\r\n      if (start != null) setNewScenarioEndYear(String(start + 1));\r\n    }\r\n  };\r\n  const handleScenarioStartYearChange = (value) => {\r\n    setNewScenarioStartYear(value);\r\n    if (newScenarioPeriod === \"split\") {\r\n      const start = normalizeYearInput(value);\r\n      if (start != null) setNewScenarioEndYear(String(start + 1));\r\n    }\r\n  };\r\n\r\n  function getScenarioStepError(step) {\r\n    if (step === 1) {\r\n      if (newScenarioInputCurrency === \"LOCAL\") {\r\n        if (!localCodeOk) return \"Local currency code zorunludur.\";\r\n        if (!fxOk) return \"Kur degeri zorunlu ve 0'dan buyuk olmali.\";\r\n      }\r\n    }\r\n    if (step === 2) {\r\n      if (!newScenarioProgramType) return \"Program Turu secilmelidir.\";\r\n    }\r\n    if (step === 3) {\r\n      if (!draftAcademicYear) return \"Lutfen gecerli bir akademik yil girin.\";\r\n      if (!draftRangeOk) return \"Bitis yili, baslangic yilindan 1 fazla olmali.\";\r\n      if (yearConflict) return \"Bu yil turu icin zaten bir senaryo var. Lutfen baska bir yil secin.\";\r\n    }\r\n    if (step === 4 && !kademeStepOk) return \"En az bir kademe secmelisiniz.\";\r\n    if (step === 5 && !newScenarioName.trim()) return \"Senaryo adi zorunludur.\";\r\n    return \"\";\r\n  }\r\n\r\n  function goScenarioNext() {\r\n    setErr(\"\");\r\n    if (scenarioWizardSaving) return;\r\n    const msg = getScenarioStepError(newScenarioStep);\r\n    if (msg) {\r\n      setErr(msg);\r\n      return;\r\n    }\r\n    if (newScenarioStep < scenarioStepTotal - 1) {\r\n      setNewScenarioStep((prev) => Math.min(prev + 1, scenarioStepTotal - 1));\r\n      return;\r\n    }\r\n    submitScenarioWizard();\r\n  }\r\n\r\n  function goScenarioBack() {\r\n    setErr(\"\");\r\n    setNewScenarioStep((prev) => Math.max(0, prev - 1));\r\n  }\r\n\r\n  function resetScenarioWizard() {\r\n    setNewScenarioName(\"\");\r\n    setNewScenarioPeriod(\"split\");\r\n    setNewScenarioStartYear(DEFAULT_START_YEAR);\r\n    setNewScenarioEndYear(DEFAULT_END_YEAR);\r\n    setNewScenarioKademeler(getDefaultKademeConfig());\r\n    setNewScenarioNoKademe(false);\r\n    kademeBeforeNoKademeRef.current = null;\r\n    setNewScenarioInputCurrency(\"USD\");\r\n    setNewScenarioLocalCurrencyCode(\"\");\r\n    setNewScenarioFxUsdToLocal(\"\");\r\n    setNewScenarioProgramType(null);\r\n    setNewScenarioStep(0);\r\n  }\r\n\r\n  function closeScenarioWizard() {\r\n    setErr(\"\");\r\n    setScenarioWizardOpen(false);\r\n    setScenarioWizardLoading(false);\r\n    setScenarioWizardSaving(false);\r\n    setNewScenarioStep(0);\r\n  }\r\n\r\n  function openScenarioWizardCreate() {\r\n    if (!canCreateScenario) return;\r\n    if (!selectedSchoolId) {\r\n      setErr(\"Once okul secin.\");\r\n      return;\r\n    }\r\n    setErr(\"\");\r\n    resetScenarioWizard();\r\n    setScenarioWizardMode(\"create\");\r\n    setScenarioWizardScenario(null);\r\n    setScenarioWizardOpen(true);\r\n  }\r\n\r\n  async function openScenarioWizardEdit(scenarioId) {\r\n    if (!canEditScenarioPlan) return;\r\n    if (!selectedSchoolId) return;\r\n    setErr(\"\");\r\n    const targetScenario = scenarios.find((s) => String(s.id) === String(scenarioId));\r\n    if (targetScenario && isScenarioLocked(targetScenario)) {\r\n      setErr(\"Senaryo onayda veya onaylandi, duzenlenemez.\");\r\n      return;\r\n    }\r\n    setSelectedScenarioIdLocal(scenarioId);\r\n    setScenarioWizardMode(\"edit\");\r\n    setScenarioWizardScenario(null);\r\n    setScenarioWizardOpen(true);\r\n    setScenarioWizardLoading(true);\r\n    setNewScenarioStep(0);\r\n    try {\r\n      const data = await api.getScenarioInputs(selectedSchoolId, scenarioId);\r\n      const scenario = data?.scenario;\r\n      if (!scenario) throw new Error(\"Senaryo bulunamadi.\");\r\n      setScenarioWizardScenario(scenario);\r\n      setNewScenarioName(scenario.name || \"\");\r\n      const years = parseAcademicYear(scenario.academic_year);\r\n      if (years.startYear && years.endYear && years.endYear !== years.startYear) {\r\n        setNewScenarioPeriod(\"split\");\r\n        setNewScenarioStartYear(String(years.startYear));\r\n        setNewScenarioEndYear(String(years.endYear));\r\n      } else if (years.startYear) {\r\n        setNewScenarioPeriod(\"full\");\r\n        setNewScenarioStartYear(String(years.startYear));\r\n        setNewScenarioEndYear(String(years.startYear + 1));\r\n      } else {\r\n        setNewScenarioPeriod(\"split\");\r\n        setNewScenarioStartYear(DEFAULT_START_YEAR);\r\n        setNewScenarioEndYear(DEFAULT_END_YEAR);\r\n      }\r\n      const existingKademe = data?.inputs?.temelBilgiler?.kademeler;\r\n      const normalizedKademe = existingKademe\r\n        ? normalizeKademeConfig(existingKademe)\r\n        : getDefaultKademeConfig();\r\n      const hasAnyEnabled = Object.values(normalizedKademe).some((row) => row && row.enabled);\r\n      setNewScenarioKademeler(normalizedKademe);\r\n      setNewScenarioNoKademe(!hasAnyEnabled);\r\n      kademeBeforeNoKademeRef.current = hasAnyEnabled ? structuredClone(normalizedKademe) : null;\r\n      const scenarioCurrency = scenario.input_currency || \"USD\";\r\n      setNewScenarioInputCurrency(scenarioCurrency);\r\n      setNewScenarioLocalCurrencyCode(scenario.local_currency_code || \"\");\r\n      setNewScenarioFxUsdToLocal(\r\n        scenario.fx_usd_to_local != null ? String(scenario.fx_usd_to_local) : \"\"\r\n      );\r\n      setNewScenarioProgramType(scenario.program_type || PROGRAM_TYPES.LOCAL);\r\n    } catch (e) {\r\n      setErr(e.message || \"Senaryo yuklenemedi.\");\r\n      setScenarioWizardOpen(false);\r\n    } finally {\r\n      setScenarioWizardLoading(false);\r\n    }\r\n  }\r\n\r\n  async function submitScenarioWizard() {\r\n    if (scenarioWizardMode === \"edit\") {\r\n      await updateScenario();\r\n      return;\r\n    }\r\n    await createScenario();\r\n  }\r\n\r\n  async function createScenario() {\r\n    if (!selectedSchoolId) return;\r\n    const name = newScenarioName.trim();\r\n    if (!name) return;\r\n    if (!draftAcademicYear) {\r\n      setErr(\"Lutfen gecerli bir akademik yil girin.\");\r\n      return;\r\n    }\r\n    if (!draftRangeOk) {\r\n      setErr(\"Bitis yili, baslangic yilindan 1 fazla olmali.\");\r\n      return;\r\n    }\r\n    if (yearConflict) {\r\n      setErr(\"Bu yil turu icin zaten bir senaryo var. Lutfen baska bir yil secin.\");\r\n      return;\r\n    }\r\n    if (!kademeStepOk) {\r\n      setErr(\"En az bir kademe secmelisiniz.\");\r\n      return;\r\n    }\r\n    if (newScenarioInputCurrency === \"LOCAL\") {\r\n      if (!localCodeOk) {\r\n        setErr(\"Local currency code zorunludur.\");\r\n        return;\r\n      }\r\n      if (!fxOk) {\r\n        setErr(\"Kur degeri zorunlu ve 0'dan buyuk olmali.\");\r\n        return;\r\n      }\r\n    }\r\n    setErr(\"\");\r\n    setScenarioWizardSaving(true);\r\n    try {\r\n      const scenarioProgramType = newScenarioProgramType || PROGRAM_TYPES.LOCAL;\r\n      const baseKademe = normalizeKademeConfig(newScenarioKademeler);\r\n      const kademeConfig = newScenarioNoKademe\r\n        ? Object.fromEntries(Object.entries(baseKademe).map(([k, v]) => [k, { ...v, enabled: false }]))\r\n        : baseKademe;\r\n      const created = await api.createScenario(selectedSchoolId, {\r\n        name,\r\n        academicYear: draftAcademicYear,\r\n        kademeConfig,\r\n        inputCurrency: newScenarioInputCurrency,\r\n        localCurrencyCode: newScenarioInputCurrency === \"LOCAL\" ? normalizedLocalCode : null,\r\n        fxUsdToLocal: newScenarioInputCurrency === \"LOCAL\" ? newScenarioFxUsdToLocal : null,\r\n        programType: scenarioProgramType,\r\n      });\r\n      await refreshScenarios();\r\n      setSelectedScenarioIdLocal(created.id);\r\n      setScenarioWizardOpen(false);\r\n      setNewScenarioStep(0);\r\n    } catch (e) {\r\n      setErr(e.message || \"Senaryo olusturulamadi.\");\r\n    } finally {\r\n      setScenarioWizardSaving(false);\r\n    }\r\n  }\r\n\r\n  async function updateScenario() {\r\n    if (!selectedSchoolId || !scenarioWizardScenario?.id) return;\r\n    const name = newScenarioName.trim();\r\n    if (!name) return;\r\n    if (!draftAcademicYear) {\r\n      setErr(\"Lutfen gecerli bir akademik yil girin.\");\r\n      return;\r\n    }\r\n    if (!draftRangeOk) {\r\n      setErr(\"Bitis yili, baslangic yilindan 1 fazla olmali.\");\r\n      return;\r\n    }\r\n    if (yearConflict) {\r\n      setErr(\"Bu yil turu icin zaten bir senaryo var. Lutfen baska bir yil secin.\");\r\n      return;\r\n    }\r\n    if (!kademeStepOk) {\r\n      setErr(\"En az bir kademe secmelisiniz.\");\r\n      return;\r\n    }\r\n    if (scenarioWizardScenario?.input_currency === \"LOCAL\") {\r\n      if (!localCodeOk) {\r\n        setErr(\"Local currency code zorunludur.\");\r\n        return;\r\n      }\r\n      if (!fxOk) {\r\n        setErr(\"Kur degeri zorunlu ve 0'dan buyuk olmali.\");\r\n        return;\r\n      }\r\n    }\r\n    setErr(\"\");\r\n    setScenarioWizardSaving(true);\r\n    try {\r\n      const scenarioProgramType = newScenarioProgramType || PROGRAM_TYPES.LOCAL;\r\n      const baseKademe = normalizeKademeConfig(newScenarioKademeler);\r\n      const kademeConfig = newScenarioNoKademe\r\n        ? Object.fromEntries(Object.entries(baseKademe).map(([k, v]) => [k, { ...v, enabled: false }]))\r\n        : baseKademe;\r\n      await api.updateScenario(selectedSchoolId, scenarioWizardScenario.id, {\r\n        name,\r\n        academicYear: draftAcademicYear,\r\n        kademeConfig,\r\n        programType: scenarioProgramType,\r\n        localCurrencyCode:\r\n          scenarioWizardScenario?.input_currency === \"LOCAL\" ? normalizedLocalCode : undefined,\r\n        fxUsdToLocal:\r\n          scenarioWizardScenario?.input_currency === \"LOCAL\" ? newScenarioFxUsdToLocal : undefined,\r\n      });\r\n      await refreshScenarios();\r\n      setSelectedScenarioIdLocal(scenarioWizardScenario.id);\r\n      setSelectedScenario((prev) =>\r\n        prev && prev.id === scenarioWizardScenario.id\r\n          ? {\r\n            ...prev,\r\n            name,\r\n            academic_year: draftAcademicYear,\r\n            program_type: scenarioProgramType,\r\n            ...(scenarioWizardScenario?.input_currency === \"LOCAL\"\r\n              ? { local_currency_code: normalizedLocalCode, fx_usd_to_local: fxValue }\r\n              : {}),\r\n          }\r\n          : prev\r\n      );\r\n      setInputs((prev) => {\r\n        if (!prev || typeof prev !== \"object\") return prev;\r\n        const next = structuredClone(prev);\r\n        next.temelBilgiler = next.temelBilgiler || {};\r\n        next.temelBilgiler.kademeler = kademeConfig;\r\n        next.temelBilgiler.programType = scenarioProgramType;\r\n        return next;\r\n      });\r\n      setScenarioWizardOpen(false);\r\n      setNewScenarioStep(0);\r\n    } catch (e) {\r\n      setErr(e.message || \"Senaryo guncellenemedi.\");\r\n    } finally {\r\n      setScenarioWizardSaving(false);\r\n    }\r\n  }\r\n\r\n  const updateNewKademe = (key, patch) => {\r\n    setNewScenarioKademeler((prev) => {\r\n      const base = normalizeKademeConfig(prev);\r\n      const next = { ...base, [key]: { ...base[key], ...patch } };\r\n      return normalizeKademeConfig(next);\r\n    });\r\n  };\r\n\r\n  const setNoKademeMode = (enabled) => {\r\n    const nextEnabled = Boolean(enabled);\r\n    setNewScenarioNoKademe(nextEnabled);\r\n    setNewScenarioKademeler((prev) => {\r\n      const base = normalizeKademeConfig(prev);\r\n      if (nextEnabled) {\r\n        kademeBeforeNoKademeRef.current = structuredClone(base);\r\n        return Object.fromEntries(Object.entries(base).map(([k, v]) => [k, { ...v, enabled: false }]));\r\n      }\r\n      const restored = kademeBeforeNoKademeRef.current;\r\n      kademeBeforeNoKademeRef.current = null;\r\n      return restored ? normalizeKademeConfig(restored) : getDefaultKademeConfig();\r\n    });\r\n  };\r\n\r\n  const parseFxInput = (value) => {\r\n    const raw = String(value ?? \"\").trim();\r\n    if (!raw) return NaN;\r\n    const normalized = raw.replace(\",\", \".\");\r\n    const match = normalized.match(/-?\\d+(?:\\.\\d+)?/);\r\n    if (!match) return NaN;\r\n    const num = Number.parseFloat(match[0]);\r\n    return Number.isFinite(num) ? num : NaN;\r\n  };\r\n\r\n  const showCopySelectionMsg = (message) => {\r\n    if (copySelectionMsgTimerRef.current) {\r\n      clearTimeout(copySelectionMsgTimerRef.current);\r\n    }\r\n    setCopySelectionMsg(message);\r\n    copySelectionMsgTimerRef.current = setTimeout(() => {\r\n      setCopySelectionMsg(\"\");\r\n    }, 2000);\r\n  };\r\n\r\n  const applyPresetSelection = (presetKey) => {\r\n    setCopySelection(buildDefaultCopySelection(presetKey));\r\n    setCopySelectionMsg(\"\");\r\n  };\r\n\r\n  const toggleCopySelection = (id, value) => {\r\n    if (scenarioOpsBusy) return;\r\n    setCopySelection((prev) => {\r\n      const base = prev || buildDefaultCopySelection(\"all\");\r\n      const next = { ...base };\r\n      if (id === \"hr.ik\" || id === \"expenses.giderler\") {\r\n        next[\"hr.ik\"] = value;\r\n        next[\"expenses.giderler\"] = value;\r\n        showCopySelectionMsg(`IK ve Giderler birlikte ${value ? \"secildi\" : \"kaldirildi\"}.`);\r\n      } else {\r\n        next[id] = value;\r\n      }\r\n      return enforceIkGiderlerPair(next);\r\n    });\r\n  };\r\n\r\n  const setCopyTabSelectionAll = (tabKey, value) => {\r\n    if (scenarioOpsBusy) return;\r\n    const tab = COPY_SELECT_TABS.find((entry) => entry.key === tabKey);\r\n    if (!tab) return;\r\n    setCopySelection((prev) => {\r\n      const base = prev || buildDefaultCopySelection(\"all\");\r\n      const next = { ...base };\r\n      tab.sections.forEach((section) => {\r\n        next[section.id] = value;\r\n      });\r\n      return enforceIkGiderlerPair(next);\r\n    });\r\n  };\r\n\r\n  function openCopyScenarioModal() {\r\n    if (!canCopyScenario) return;\r\n    if (!selectedScenarioIdLocal || !selectedScenario || !inputs) return;\r\n    if (copyingScenarioId) return;\r\n    setErr(\"\");\r\n    setCopyModalError(\"\");\r\n    setCopySelection(buildDefaultCopySelection(\"all\"));\r\n    setCopySelectionMsg(\"\");\r\n    setCopyTargetCurrency(sourceCurrency === \"LOCAL\" ? \"LOCAL\" : \"USD\");\r\n    setCopyLocalCurrencyCode(\"\");\r\n    setCopyPlannedFxUsdToLocal(\"\");\r\n    setCopyFxUsdToLocal(\"\");\r\n    setCopyModalOpen(true);\r\n  }\r\n\r\n  function closeCopyScenarioModal() {\r\n    setCopyModalOpen(false);\r\n    setCopyModalError(\"\");\r\n  }\r\n\r\n  async function confirmCopyScenarioModal() {\r\n    if (!copySelection) return;\r\n    if (copyingScenarioId) return;\r\n    const selection = enforceIkGiderlerPair(copySelection);\r\n\r\n    const targetCurrency = String(copyTargetCurrency || sourceCurrency).toUpperCase();\r\n    let localCurrencyCodeValue = null;\r\n    let plannedFxUsdToLocalValue = null;\r\n    let copyFxUsdToLocalValue = null;\r\n\r\n    if (sourceCurrency === \"USD\" && targetCurrency === \"LOCAL\") {\r\n      const normalizedLocalCode = String(copyLocalCurrencyCode || \"\")\r\n        .toUpperCase()\r\n        .replace(/[^A-Z0-9]/g, \"\")\r\n        .slice(0, 10);\r\n      if (!CURRENCY_CODE_REGEX.test(normalizedLocalCode)) {\r\n        setCopyModalError(\"Local para birimi kodu gecersiz.\");\r\n        return;\r\n      }\r\n      const plannedFxNumber = parseFxInput(copyPlannedFxUsdToLocal);\r\n      if (!Number.isFinite(plannedFxNumber) || plannedFxNumber <= 0) {\r\n        setCopyModalError(\"Gecerli bir kur girilmelidir.\");\r\n        return;\r\n      }\r\n      const copyFxNumber = parseFxInput(copyFxUsdToLocal);\r\n      if (!Number.isFinite(copyFxNumber) || copyFxNumber <= 0) {\r\n        setCopyModalError(\"Gecerli bir kopyalama kuru girilmelidir.\");\r\n        return;\r\n      }\r\n      localCurrencyCodeValue = normalizedLocalCode;\r\n      plannedFxUsdToLocalValue = plannedFxNumber;\r\n      copyFxUsdToLocalValue = copyFxNumber;\r\n    }\r\n\r\n    if (sourceCurrency === \"LOCAL\" && targetCurrency === \"USD\") {\r\n      const copyFxNumber = parseFxInput(copyFxUsdToLocal);\r\n      if (!Number.isFinite(copyFxNumber) || copyFxNumber <= 0) {\r\n        setCopyModalError(\"Gecerli bir kopyalama kuru girilmelidir.\");\r\n        return;\r\n      }\r\n      copyFxUsdToLocalValue = copyFxNumber;\r\n    }\r\n\r\n    closeCopyScenarioModal();\r\n    await copySelectedScenario({\r\n      targetCurrency,\r\n      localCurrencyCode: localCurrencyCodeValue,\r\n      plannedFxUsdToLocal: plannedFxUsdToLocalValue,\r\n      copyFxUsdToLocal: copyFxUsdToLocalValue,\r\n      selection,\r\n    });\r\n  }\r\n\r\n  async function copySelectedScenario(copyOptions = {}) {\r\n    if (!canCopyScenario) return;\r\n    if (!selectedScenarioIdLocal || !selectedScenario || !inputs) return;\r\n    if (copyingScenarioId) return;\r\n    if (!selectedScenario.academic_year) {\r\n      setErr(\"Akademik yil bulunamadi.\");\r\n      return;\r\n    }\r\n\r\n    setErr(\"\");\r\n    const selection = enforceIkGiderlerPair(copyOptions?.selection || buildDefaultCopySelection(\"all\"));\r\n    if (!!selection[\"hr.ik\"] !== !!selection[\"expenses.giderler\"]) {\r\n      toast.warn(\"IK ve Giderler birlikte secilmelidir.\");\r\n      return;\r\n    }\r\n    const targetCurrency = String(copyOptions?.targetCurrency || sourceCurrency).toUpperCase();\r\n    let localCurrencyCode = copyOptions?.localCurrencyCode ?? null;\r\n    let plannedFxUsdToLocal = copyOptions?.plannedFxUsdToLocal ?? null;\r\n    let copyFxUsdToLocal = copyOptions?.copyFxUsdToLocal ?? null;\r\n    let plannedFxParsed = parseFxInput(plannedFxUsdToLocal);\r\n    let copyFxParsed = parseFxInput(copyFxUsdToLocal);\r\n\r\n    if (sourceCurrency === \"LOCAL\" && targetCurrency === \"LOCAL\") {\r\n      localCurrencyCode = localCurrencyCode ?? selectedScenario.local_currency_code ?? \"\";\r\n      plannedFxUsdToLocal = plannedFxUsdToLocal ?? selectedScenario.fx_usd_to_local;\r\n      plannedFxParsed = parseFxInput(plannedFxUsdToLocal);\r\n    }\r\n\r\n    if (sourceCurrency === \"LOCAL\" && targetCurrency === \"USD\") {\r\n      copyFxUsdToLocal = copyFxUsdToLocal ?? selectedScenario.fx_usd_to_local;\r\n      copyFxParsed = parseFxInput(copyFxUsdToLocal);\r\n      if (!Number.isFinite(copyFxParsed) || copyFxParsed <= 0) {\r\n        toast.warn(\"Gecerli bir kopyalama kuru girilmelidir.\");\r\n        return;\r\n      }\r\n    }\r\n\r\n    if (sourceCurrency === \"USD\" && targetCurrency === \"LOCAL\") {\r\n      if (!localCurrencyCode || !CURRENCY_CODE_REGEX.test(localCurrencyCode)) {\r\n        toast.warn(\"Local para birimi kodu gecersiz.\");\r\n        return;\r\n      }\r\n      if (!Number.isFinite(plannedFxParsed) || plannedFxParsed <= 0) {\r\n        toast.warn(\"Gecerli bir kur girilmelidir.\");\r\n        return;\r\n      }\r\n      if (!Number.isFinite(copyFxParsed) || copyFxParsed <= 0) {\r\n        toast.warn(\"Gecerli bir kopyalama kuru girilmelidir.\");\r\n        return;\r\n      }\r\n    }\r\n\r\n    setCopyingScenarioId(selectedScenarioIdLocal);\r\n    try {\r\n      const baseName = selectedScenario.name || \"Senaryo\";\r\n      const copyName = `${baseName} (Kopya)`;\r\n      let candidateYear = incrementAcademicYearString(selectedScenario.academic_year);\r\n      if (!candidateYear) {\r\n        throw new Error(\"Akademik yil formati gecersiz.\");\r\n      }\r\n      let guard = 0;\r\n      const hasAcademicYear = (yearStr) =>\r\n        scenarios.some((s) => String(s?.academic_year || \"\").trim() === String(yearStr).trim());\r\n\r\n      while (hasAcademicYear(candidateYear)) {\r\n        candidateYear = incrementAcademicYearString(candidateYear);\r\n        guard += 1;\r\n        if (!candidateYear || guard > 20) {\r\n          throw new Error(\"Uygun yeni akademik yil bulunamadi.\");\r\n        }\r\n      }\r\n\r\n      const shouldCopyCore = !!selection[\"temel.core\"];\r\n      const kademeConfig = normalizeKademeConfig(\r\n        shouldCopyCore ? inputs?.temelBilgiler?.kademeler || getDefaultKademeConfig() : getDefaultKademeConfig()\r\n      );\r\n      const programType = shouldCopyCore\r\n        ? selectedScenario?.program_type || PROGRAM_TYPES.LOCAL\r\n        : PROGRAM_TYPES.LOCAL;\r\n      const fxForCreate =\r\n        targetCurrency === \"LOCAL\" && Number.isFinite(plannedFxParsed) && plannedFxParsed > 0\r\n          ? plannedFxParsed\r\n          : null;\r\n      const created = await api.createScenario(selectedSchoolId, {\r\n        name: copyName,\r\n        academicYear: candidateYear,\r\n        kademeConfig,\r\n        inputCurrency: targetCurrency,\r\n        localCurrencyCode: targetCurrency === \"LOCAL\" ? localCurrencyCode || \"\" : null,\r\n        fxUsdToLocal: fxForCreate,\r\n        programType,\r\n      });\r\n\r\n      let clonedInputs = filterInputsForCopyBySelection(inputs, selection);\r\n      if (selection[\"hr.ik\"] && selection[\"expenses.giderler\"]) {\r\n        clonedInputs = applyIkSalariesToGiderler(clonedInputs);\r\n      }\r\n      clonedInputs = normalizeTemelBilgilerInputs(clonedInputs);\r\n      clonedInputs = normalizeCapacityInputs(clonedInputs);\r\n      clonedInputs = normalizeGradesInputs(clonedInputs);\r\n\r\n      if (sourceCurrency === \"USD\" && targetCurrency === \"LOCAL\") {\r\n        clonedInputs = convertInputsUsdToLocalForCopy(clonedInputs, copyFxParsed);\r\n        clonedInputs.temelBilgiler = clonedInputs.temelBilgiler || {};\r\n        clonedInputs.temelBilgiler.performans = clonedInputs.temelBilgiler.performans || {};\r\n        clonedInputs.temelBilgiler.performans.prevYearRealizedFxUsdToLocal = Number(copyFxParsed);\r\n      }\r\n\r\n      if (sourceCurrency === \"LOCAL\" && targetCurrency === \"USD\") {\r\n        clonedInputs = convertInputsLocalToUsdForCopy(clonedInputs, copyFxParsed);\r\n        clonedInputs.temelBilgiler = clonedInputs.temelBilgiler || {};\r\n        clonedInputs.temelBilgiler.performans = clonedInputs.temelBilgiler.performans || {};\r\n        clonedInputs.temelBilgiler.performans.prevYearRealizedFxUsdToLocal = Number(copyFxParsed);\r\n      }\r\n\r\n      // Determine which permission resources are modified based on the user's selection.  The\r\n      // backend requires a list of modifiedResources for nonadmin users to enforce\r\n      // granular write permissions.  Without this list, principals and managers\r\n      // would be blocked from copying scenarios.  See COPY_SECTION_RESOURCES\r\n      // mapping above for how selection keys map to permission resources.\r\n      const modifiedResources = buildModifiedResourcesFromCopySelection(selection);\r\n      await api.saveScenarioInputs(selectedSchoolId, created.id, clonedInputs, modifiedResources);\r\n\r\n      if (selection[\"norm.lessonY1\"]) {\r\n        try {\r\n          const sourceNorm = await api.getNormConfig(selectedSchoolId, selectedScenarioIdLocal);\r\n          if (sourceNorm) {\r\n            const sourceYears = sourceNorm?.years && typeof sourceNorm.years === \"object\" ? sourceNorm.years : {};\r\n            const baseHours = Number(\r\n              sourceYears?.y1?.teacherWeeklyMaxHours ??\r\n                sourceNorm?.teacherWeeklyMaxHours ??\r\n                24\r\n            );\r\n            const y1 = sourceYears?.y1\r\n              ? structuredClone(sourceYears.y1)\r\n              : {\r\n                teacherWeeklyMaxHours: Number.isFinite(baseHours) && baseHours > 0 ? baseHours : 24,\r\n                curriculumWeeklyHours:\r\n                  sourceNorm?.curriculumWeeklyHours && typeof sourceNorm.curriculumWeeklyHours === \"object\"\r\n                    ? structuredClone(sourceNorm.curriculumWeeklyHours)\r\n                    : buildEmptyNormCurriculum(),\r\n              };\r\n            const payload = {\r\n              years: {\r\n                y1,\r\n                y2: buildEmptyNormYear(baseHours),\r\n                y3: buildEmptyNormYear(baseHours),\r\n              },\r\n            };\r\n            await api.saveNormConfig(selectedSchoolId, created.id, payload);\r\n          }\r\n        } catch (err) {\r\n          console.warn(\"[copyScenario] norm copy skipped\", err);\r\n        }\r\n      }\r\n\r\n      await refreshScenarios();\r\n      setSelectedScenarioIdLocal(created.id);\r\n      toast.success(\"Senaryo kopyalandi.\");\r\n    } catch (e) {\r\n      setErr(e.message || \"Scenario copy failed\");\r\n    } finally {\r\n      setCopyingScenarioId(null);\r\n    }\r\n  }\r\n\r\n  function openDeleteScenarioModal(scenarioId) {\r\n    if (!canDeleteScenario) return;\r\n    if (!scenarioId || scenarioOpsBusy) return;\r\n    setDeleteConfirmScenarioId(scenarioId);\r\n  }\r\n\r\n  async function confirmDeleteScenario() {\r\n    if (!deleteConfirmScenarioId) return;\r\n    const scenarioId = deleteConfirmScenarioId;\r\n    setDeleteConfirmScenarioId(null);\r\n    await deleteScenario(scenarioId);\r\n  }\r\n\r\n  async function deleteScenario(scenarioId) {\r\n    if (!canDeleteScenario) return;\r\n    if (!selectedSchoolId || !scenarioId) return;\r\n    if (scenarioOpsBusy) return;\r\n    const target = scenarios.find((s) => String(s.id) === String(scenarioId));\r\n    if (!target) return;\r\n    if (isScenarioLocked(target)) {\r\n      setErr(\"Senaryo onayda veya onaylandi, silinemez.\");\r\n      return;\r\n    }\r\n\r\n    setErr(\"\");\r\n    setDeletingScenarioId(scenarioId);\r\n    try {\r\n      await api.deleteScenario(selectedSchoolId, scenarioId);\r\n      const sc = await refreshScenarios();\r\n      if (Array.isArray(sc)) {\r\n        if (!sc.length) {\r\n          setSelectedScenarioIdLocal(null);\r\n          setInputs(null);\r\n          setReport(null);\r\n        } else if (!sc.some((s) => String(s.id) === String(selectedScenarioIdLocal))) {\r\n          setSelectedScenarioIdLocal(sc[0].id);\r\n        }\r\n      }\r\n      toast.success(\"Senaryo silindi.\");\r\n    } catch (e) {\r\n      setErr(e.message || \"Senaryo silinemedi.\");\r\n    } finally {\r\n      setDeletingScenarioId(null);\r\n    }\r\n  }\r\n\r\n  function sumPlannedStudents(grades) {\r\n    const list = Array.isArray(grades) ? grades : [];\r\n    let sum = 0;\r\n    for (const row of list) {\r\n      const n = Number(row?.studentsPerBranch ?? 0);\r\n      if (Number.isFinite(n)) sum += n;\r\n    }\r\n    return sum;\r\n  }\r\n\r\n  function getPlannedStudentTotalsByYear(srcInputs) {\r\n    const s = srcInputs && typeof srcInputs === \"object\" ? srcInputs : {};\r\n    const years = s.gradesYears && typeof s.gradesYears === \"object\" ? s.gradesYears : {};\r\n    return {\r\n      y1: sumPlannedStudents(Array.isArray(years.y1) ? years.y1 : s.grades),\r\n      y2: sumPlannedStudents(years.y2),\r\n      y3: sumPlannedStudents(years.y3),\r\n    };\r\n  }\r\n\r\n  function showBlockingToast(message, toastId = \"blocking-toast\") {\r\n    toast.warn(message, {\r\n      toastId,\r\n      position: \"bottom-right\",\r\n      autoClose: false,\r\n      closeOnClick: false,\r\n      draggable: true,\r\n      icon: \"!\",\r\n      style: {\r\n        background: \"rgba(15, 23, 42, 0.96)\",\r\n        color: \"#f8fafc\",\r\n        border: \"1px solid rgba(251, 191, 36, 0.35)\",\r\n        boxShadow: \"0 18px 40px rgba(0,0,0,.28)\",\r\n        borderRadius: 14,\r\n      },\r\n    });\r\n  }\r\n\r\n  function ensurePlanningStudentsForY2Y3(actionLabel = \"Islem\") {\n    if (!inputs) return true;\n    if (isHeadquarterScenario(inputs)) return true;\n\r\n    const totals = getPlannedStudentTotalsByYear(inputs);\r\n    const missing = [];\r\n    if (!(totals.y2 > 0)) missing.push(\"Y2\");\r\n    if (!(totals.y3 > 0)) missing.push(\"Y3\");\r\n    if (!missing.length) return true;\r\n\r\n    const msg =\r\n      `${actionLabel} yapilamaz: Norm > Planlanan Donem Bilgileri bolumunde ` +\r\n      `${missing.join(\" ve \")} toplam ogrenci 0 gorunuyor. Lutfen Y2/Y3 ogrenci sayilarini girin.`;\r\n\r\n    setErr(\"\");\r\n    showBlockingToast(msg, \"norm-y2y3-missing\");\r\n    return false;\r\n  }\r\n\r\n  function ensurePrevRealFxForLocal(actionLabel = \"Islem\") {\r\n    if (!inputs) return true;\r\n    if (!isLocalScenario) return true;\r\n    if (!prevRealFxMissing) return true;\r\n\r\n    const msg =\r\n      `${actionLabel} yapilamaz: Temel Bilgiler > Performans alanindaki ` +\r\n      `\"Onceki Donem Ortalama Kur (Gerceklesen)\" girilmelidir.`;\r\n\r\n    setErr(\"\");\r\n    showBlockingToast(msg, \"prev-realized-fx-missing\");\r\n    return false;\r\n  }\r\n\r\n  async function calculate(options = {}) {\r\n    if (!selectedSchoolId || !selectedScenarioIdLocal) return false;\r\n    if (!ensurePrevRealFxForLocal(\"Hesaplama\")) return false;\r\n    if (!options.skipPlanValidation && !ensurePlanningStudentsForY2Y3(\"Hesaplama\")) return false;\r\n    setCalculating(true);\r\n    setErr(\"\");\r\n    let ok = false;\r\n    try {\r\n      const data = await api.calculateScenario(selectedSchoolId, selectedScenarioIdLocal);\r\n      setReport(data.results);\r\n      ok = true;\r\n    } catch (e) {\r\n      setErr(e.message || \"Calculation failed\");\r\n    } finally {\r\n      setCalculating(false);\r\n    }\r\n    return ok;\r\n  }\r\n\r\n  async function submitScenarioForApproval(scenarioId) {\r\n    if (!canSubmitScenario) return;\r\n    if (!selectedSchoolId || !scenarioId || scenarioId !== selectedScenarioIdLocal) return;\r\n    const status = String(selectedScenario?.status || \"draft\");\r\n    if (![\"draft\", \"revision_requested\"].includes(status)) {\r\n      setErr(\"Senaryo onayda veya onaylandi, gonderilemez.\");\r\n      return;\r\n    }\r\n    if (!ensurePrevRealFxForLocal(\"Onaya gonderme\")) return;\r\n    if (!ensurePlanningStudentsForY2Y3(\"Onaya gonderme\")) return;\r\n    if (submittingScenarioId) return;\r\n\r\n    setErr(\"\");\r\n    setSubmittingScenarioId(scenarioId);\r\n    try {\r\n      const calcOk = await calculate({ keepTab: true });\r\n      if (!calcOk) return;\r\n      const data = await api.submitScenario(selectedSchoolId, scenarioId);\r\n      toast.success(\"Senaryo onaya gonderildi.\");\r\n      if (data?.scenario) {\r\n        setSelectedScenario((prev) => ({ ...(prev || {}), ...data.scenario }));\r\n      }\r\n      await refreshScenarios();\r\n    } catch (e) {\r\n      setErr(e.message || \"Submit failed\");\r\n    } finally {\r\n      setSubmittingScenarioId(null);\r\n    }\r\n  }\r\n\r\n  async function sendScenarioForApproval(scenarioId) {\r\n    if (!canForwardScenario) return;\r\n    if (!selectedSchoolId || !scenarioId || scenarioId !== selectedScenarioIdLocal) return;\r\n    const status = String(selectedScenario?.status || \"draft\");\r\n    if (status !== \"approved\" || selectedScenario?.sent_at) {\r\n      setErr(\"Senaryo merkeze iletilemez.\");\r\n      return;\r\n    }\r\n    if (!ensurePrevRealFxForLocal(\"Merkeze iletme\")) return;\r\n    if (!ensurePlanningStudentsForY2Y3(\"Merkeze iletme\")) return;\r\n    if (submittingScenarioId) return;\r\n\r\n    setErr(\"\");\r\n    setSubmittingScenarioId(scenarioId);\r\n    try {\r\n      const calcOk = await calculate({ keepTab: true });\r\n      if (!calcOk) return;\r\n      const data = await api.sendForApproval(selectedSchoolId, scenarioId);\r\n      toast.success(\"Merkeze iletildi\");\r\n      if (data?.scenario) {\r\n        setSelectedScenario((prev) => ({ ...(prev || {}), ...data.scenario }));\r\n      }\r\n      await refreshScenarios();\r\n    } catch (e) {\r\n      setErr(e.message || \"Gonderme basarisiz\");\r\n    } finally {\r\n      setSubmittingScenarioId(null);\r\n    }\r\n  }\r\n\r\n  const deleteConfirmScenario =\r\n    deleteConfirmScenarioId != null\r\n      ? scenarios.find((s) => String(s.id) === String(deleteConfirmScenarioId))\r\n      : null;\r\n  const deleteConfirmLabel = deleteConfirmScenario?.name\r\n    ? `\"${deleteConfirmScenario.name}\"`\r\n    : \"Senaryo\";\r\n  const deleteConfirmMessage =\r\n    deleteConfirmScenarioId != null &&\r\n      String(deleteConfirmScenarioId) === String(selectedScenarioIdLocal) &&\r\n      scenarios.length <= 1\r\n      ? `${deleteConfirmLabel} son senaryo. Silerseniz senaryo secimi temizlenir.`\r\n      : `${deleteConfirmLabel} silinecek. Devam edilsin mi?`;\r\n\r\n  const handleApply = () => {\r\n    if (!selectedSchoolId || !selectedScenarioIdLocal) return;\r\n    // Persist the selected scenario. Regardless of which scenario the user\r\n    // chooses, navigate to the globally last viewed sidebar page. This ensures\r\n    // that when switching schools or scenarios the user lands on the same\r\n    // section (e.g. Gelirler). If no global route has been recorded, default\r\n    // to the \"temel-bilgiler\" page.\r\n    // Persist the selected scenario for the chosen school.  Also write\r\n    // the last active school ID so that the sidebar can immediately\r\n    // render navigation items without requiring a page refresh.  Without\r\n    // this call, users have reported that the nav menu only appears\r\n    // after refreshing the page.  See issue reported by testers.\r\n    writeSelectedScenarioId(selectedSchoolId, selectedScenarioIdLocal);\r\n    writeLastActiveSchoolId(selectedSchoolId);\r\n    const seg = readGlobalLastRouteSegment() || \"temel-bilgiler\";\r\n    navigate(`/schools/${selectedSchoolId}/${seg}`, { replace: true });\r\n  };\r\n\r\n  return (\r\n    <div className=\"container select-page\">\r\n      <ToastContainer position=\"bottom-right\" autoClose={3500} newestOnTop closeOnClick pauseOnFocusLoss pauseOnHover hideProgressBar theme=\"dark\" />\r\n      <style>{`@keyframes schoolSpin{to{transform:rotate(360deg)}}`}</style>\r\n\r\n      {err ? (\r\n        <div className=\"card\" style={{ marginTop: 10, background: \"#fff1f2\", borderColor: \"#fecaca\" }}>\r\n          {err}\r\n        </div>\r\n      ) : null}\r\n\r\n      {deleteConfirmScenarioId ? (\r\n        <div className=\"modal-backdrop\" role=\"dialog\" aria-modal=\"true\">\r\n          <div className=\"modal\">\r\n            <div style={{ fontWeight: 700, marginBottom: 8 }}>Senaryo Sil</div>\r\n            <div className=\"small\">{deleteConfirmMessage}</div>\r\n            <div className=\"row\" style={{ justifyContent: \"flex-end\", marginTop: 12 }}>\r\n              <button className=\"btn\" onClick={() => setDeleteConfirmScenarioId(null)} disabled={scenarioOpsBusy}>\r\n                Iptal\r\n              </button>\r\n              <button className=\"btn danger\" onClick={confirmDeleteScenario} disabled={scenarioOpsBusy}>\r\n                Sil\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      ) : null}\r\n\r\n      {copyModalOpen ? (\r\n        <div className=\"modal-backdrop\" role=\"dialog\" aria-modal=\"true\">\r\n          <div\r\n            className=\"modal\"\r\n            style={{\r\n              width: \"min(980px, 96vw)\",\r\n              maxHeight: \"86vh\",\r\n              overflowY: \"auto\",\r\n            }}\r\n          >\r\n            <div className=\"row\" style={{ justifyContent: \"space-between\" }}>\r\n              <div style={{ fontWeight: 700 }}>Senaryo Kopyalama</div>\r\n              <button className=\"btn\" onClick={closeCopyScenarioModal} disabled={scenarioOpsBusy}>\r\n                Kapat\r\n              </button>\r\n            </div>\r\n            <div className=\"small\" style={{ marginTop: 6 }}>\r\n              Yeni senaryo icin para birimini secin.\r\n            </div>\r\n\r\n            {copyModalError ? (\r\n              <div className=\"card\" style={{ marginTop: 10, background: \"#fff1f2\", borderColor: \"#fecaca\" }}>\r\n                {copyModalError}\r\n              </div>\r\n            ) : null}\r\n\r\n            <div style={{ marginTop: 12 }}>\r\n              <div className=\"small\" style={{ fontWeight: 700, marginBottom: 6 }}>Para Birimi</div>\r\n              <div className=\"row\" style={{ gap: 12, alignItems: \"center\" }}>\r\n                <label className=\"row\" style={{ gap: 6, alignItems: \"center\" }}>\r\n                  <input\r\n                    type=\"radio\"\r\n                    name=\"copy-currency\"\r\n                    checked={copyTargetCurrency === \"USD\"}\r\n                    onChange={() => {\r\n                      setCopyTargetCurrency(\"USD\");\r\n                      setCopyModalError(\"\");\r\n                    }}\r\n                  />\r\n                  <span>USD</span>\r\n                </label>\r\n                <label className=\"row\" style={{ gap: 6, alignItems: \"center\" }}>\r\n                  <input\r\n                    type=\"radio\"\r\n                    name=\"copy-currency\"\r\n                    checked={copyTargetCurrency === \"LOCAL\"}\r\n                    onChange={() => {\r\n                      setCopyTargetCurrency(\"LOCAL\");\r\n                      setCopyModalError(\"\");\r\n                    }}\r\n                  />\r\n                  <span>LOCAL</span>\r\n                </label>\r\n              </div>\r\n            </div>\r\n\r\n            {sourceCurrency === \"USD\" && copyTargetCurrency === \"LOCAL\" ? (\r\n              <div style={{ marginTop: 12 }}>\r\n                <div className=\"row\" style={{ gap: 8, alignItems: \"center\" }}>\r\n                  <div className=\"small\" style={{ fontWeight: 700 }}>Local currency code</div>\r\n                  <input\r\n                    className=\"input sm\"\r\n                    list=\"local-currency-codes-copy\"\r\n                    placeholder=\"TRY\"\r\n                    value={copyLocalCurrencyCode}\r\n                    onChange={(e) =>\r\n                      setCopyLocalCurrencyCode(\r\n                        e.target.value.toUpperCase().replace(/[^A-Z0-9]/g, \"\").slice(0, 10)\r\n                      )\r\n                    }\r\n                  />\r\n                  <datalist id=\"local-currency-codes-copy\">\r\n                    {LOCAL_CURRENCY_OPTIONS.map((code) => (\r\n                      <option key={code} value={code} />\r\n                    ))}\r\n                  </datalist>\r\n                </div>\r\n\r\n                <div className=\"row\" style={{ gap: 8, alignItems: \"center\", marginTop: 10 }}>\r\n                  <span>1 USD =</span>\r\n                  <input\r\n                    className=\"input sm\"\r\n                    type=\"number\"\r\n                    step=\"0.000001\"\r\n                    value={copyPlannedFxUsdToLocal}\r\n                    onChange={(e) => setCopyPlannedFxUsdToLocal(e.target.value)}\r\n                  />\r\n                  <span>{copyLocalCurrencyCode || \"LOCAL\"}</span>\r\n                </div>\r\n                <div className=\"small muted\" style={{ marginTop: 6 }}>\r\n                  Planlanan kur (senaryo ayarlari icin).\r\n                </div>\r\n\r\n                <div className=\"row\" style={{ gap: 8, alignItems: \"center\", marginTop: 10 }}>\r\n                  <span>Kopyalama kuru:</span>\r\n                  <input\r\n                    className=\"input sm\"\r\n                    type=\"number\"\r\n                    step=\"0.000001\"\r\n                    value={copyFxUsdToLocal}\r\n                    onChange={(e) => setCopyFxUsdToLocal(e.target.value)}\r\n                  />\r\n                  <span>{copyLocalCurrencyCode || \"LOCAL\"}</span>\r\n                </div>\r\n                <div className=\"small muted\" style={{ marginTop: 6 }}>\r\n                  Kopyalama kuruna gore tum rakamlar cevrilir.\r\n                </div>\r\n              </div>\r\n            ) : null}\r\n\r\n            {sourceCurrency === \"LOCAL\" && copyTargetCurrency === \"USD\" ? (\r\n              <div style={{ marginTop: 12 }}>\r\n                <div className=\"row\" style={{ gap: 8, alignItems: \"center\" }}>\r\n                  <span>1 USD =</span>\r\n                  <input\r\n                    className=\"input sm\"\r\n                    type=\"number\"\r\n                    step=\"0.000001\"\r\n                    value={copyFxUsdToLocal}\r\n                    onChange={(e) => setCopyFxUsdToLocal(e.target.value)}\r\n                  />\r\n                  <span>{inputCurrencyCode}</span>\r\n                </div>\r\n                <div className=\"small muted\" style={{ marginTop: 6 }}>\r\n                  Kopyalama kuru (LOCAL -&gt; USD).\r\n                </div>\r\n              </div>\r\n            ) : null}\r\n\r\n            {copySelectionMsg ? (\r\n              <div className=\"small\" style={{ marginTop: 10, color: \"#0369a1\" }}>\r\n                {copySelectionMsg}\r\n              </div>\r\n            ) : null}\r\n\r\n            <div style={{ marginTop: 16 }}>\r\n              <div className=\"row\" style={{ justifyContent: \"space-between\", alignItems: \"center\" }}>\r\n                <div style={{ fontWeight: 700 }}>Kopyalanacak Bolumler</div>\r\n                <div className=\"row\" style={{ gap: 6, alignItems: \"center\" }}>\r\n                  <div className=\"small muted\">Secili: {selectedCopyCount}</div>\r\n                  <button\r\n                    type=\"button\"\r\n                    className=\"btn\"\r\n                    onClick={() => applyPresetSelection(\"all\")}\r\n                    disabled={scenarioOpsBusy}\r\n                  >\r\n                    Tumu\r\n                  </button>\r\n                  <button\r\n                    type=\"button\"\r\n                    className=\"btn\"\r\n                    onClick={() => applyPresetSelection(\"structure\")}\r\n                    disabled={scenarioOpsBusy}\r\n                  >\r\n                    Yapisi\r\n                  </button>\r\n                  <button\r\n                    type=\"button\"\r\n                    className=\"btn\"\r\n                    onClick={() => applyPresetSelection(\"financial\")}\r\n                    disabled={scenarioOpsBusy}\r\n                  >\r\n                    Finans\r\n                  </button>\r\n                </div>\r\n              </div>\r\n\r\n              <div style={{ marginTop: 10, display: \"grid\", gap: 12, gridTemplateColumns: \"repeat(auto-fit, minmax(240px, 1fr))\" }}>\r\n                {COPY_SELECT_TABS.map((tab) => (\r\n                  <div key={tab.key} className=\"card\" style={{ padding: 12 }}>\r\n                    <div className=\"row\" style={{ justifyContent: \"space-between\", alignItems: \"center\" }}>\r\n                      <div style={{ fontWeight: 700 }}>{tab.label}</div>\r\n                      <div className=\"row\" style={{ gap: 4 }}>\r\n                        <button\r\n                          type=\"button\"\r\n                          className=\"btn\"\r\n                          style={{ padding: \"2px 6px\", fontSize: 12 }}\r\n                          onClick={() => setCopyTabSelectionAll(tab.key, true)}\r\n                          disabled={scenarioOpsBusy}\r\n                        >\r\n                          Tumu\r\n                        </button>\r\n                        <button\r\n                          type=\"button\"\r\n                          className=\"btn\"\r\n                          style={{ padding: \"2px 6px\", fontSize: 12 }}\r\n                          onClick={() => setCopyTabSelectionAll(tab.key, false)}\r\n                          disabled={scenarioOpsBusy}\r\n                        >\r\n                          Temizle\r\n                        </button>\r\n                      </div>\r\n                    </div>\r\n                    <div style={{ marginTop: 8, display: \"flex\", flexDirection: \"column\", gap: 6 }}>\r\n                      {tab.sections.map((section) => (\r\n                        <label key={section.id} className=\"row\" style={{ gap: 6, alignItems: \"center\" }}>\r\n                          <input\r\n                            type=\"checkbox\"\r\n                            checked={!!copySelection?.[section.id]}\r\n                            onChange={(e) => toggleCopySelection(section.id, e.target.checked)}\r\n                            disabled={scenarioOpsBusy}\r\n                          />\r\n                          <span className=\"small\">{section.label}</span>\r\n                        </label>\r\n                      ))}\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"row\" style={{ justifyContent: \"flex-end\", marginTop: 14 }}>\r\n              <button className=\"btn\" onClick={closeCopyScenarioModal} disabled={scenarioOpsBusy}>\r\n                Iptal\r\n              </button>\r\n              <button\r\n                className=\"btn primary\"\r\n                onClick={confirmCopyScenarioModal}\r\n                disabled={scenarioOpsBusy || copyingScenarioId || !copySelection || !isIkGiderlerValid}\r\n              >\r\n                {copyingScenarioId ? (\r\n                  <span style={{ display: \"inline-flex\", gap: 6, alignItems: \"center\" }}>\r\n                    <InlineSpinner />\r\n                    <span>Kopyalaniyor...</span>\r\n                  </span>\r\n                ) : (\r\n                  \"Tamam\"\r\n                )}\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      ) : null}\r\n\r\n      {expenseSplitOpen ? (\n        <ExpenseSplitModal\n          open={expenseSplitOpen}\n          onClose={() => setExpenseSplitOpen(false)}\n          sourceScenario={selectedRowScenario}\n          sourceSchoolId={selectedSchoolId}\n          sourceSchoolName={selectedSchoolName}\n        />\n      ) : null}\n\r\n      {scenarioWizardOpen ? (\r\n        <div className=\"modal-backdrop\" role=\"dialog\" aria-modal=\"true\">\r\n          <div className=\"modal scenario-wizard-modal\">\r\n            <div className=\"scenario-wizard-header\">\r\n              <div className=\"row\" style={{ justifyContent: \"space-between\" }}>\r\n                <div style={{ fontWeight: 700 }}>\r\n                  {scenarioWizardMode === \"edit\" ? \"Senaryo Kurulumunu Duzenle\" : \"Yeni Senaryo Kurulumu\"}\r\n                </div>\r\n                <button\r\n                  className=\"btn\"\r\n                  onClick={closeScenarioWizard}\r\n                  disabled={scenarioWizardSaving || scenarioWizardLoading}\r\n                >\r\n                  Kapat\r\n                </button>\r\n              </div>\r\n              <div className=\"small\" style={{ marginTop: 6 }}>\r\n                {scenarioWizardMode === \"edit\"\r\n                  ? \"Senaryo ayarlarini guncelleyip kaydedebilirsiniz.\"\r\n                  : \"Adim adim kurulum tamamlayin.\"}\r\n              </div>\r\n            </div>\r\n            <div className=\"scenario-wizard-body\">\r\n              {err ? (\r\n                <div className=\"card\" style={{ marginTop: 10, background: \"#fff1f2\", borderColor: \"#fecaca\" }}>\r\n                  {err}\r\n                </div>\r\n              ) : null}\r\n\r\n              {scenarioWizardLoading ? (\r\n                <div className=\"card\" style={{ marginTop: 12 }}>Yukleniyor...</div>\r\n              ) : (\r\n                <div style={{ marginTop: 12 }}>\r\n                  <div className=\"row\" style={{ justifyContent: \"space-between\", alignItems: \"center\" }}>\r\n                    <div style={{ fontWeight: 700 }}>Kurulum Adimi</div>\r\n                    <div className=\"small\">{`Adim ${newScenarioStep + 1} / ${scenarioStepTotal}: ${scenarioStepLabels[newScenarioStep]}`}</div>\r\n                  </div>\r\n\r\n                  {newScenarioStep === 0 && (\r\n                    <div style={{ marginTop: 10 }}>\r\n                      <div className=\"small\" style={{ fontWeight: 700, marginBottom: 6 }}>Donem Turu</div>\r\n                      <div className=\"row\" style={{ gap: 12, alignItems: \"center\" }}>\r\n                        <label className=\"row\" style={{ gap: 6, alignItems: \"center\" }}>\r\n                          <input\r\n                            type=\"radio\"\r\n                            name=\"scenario-period\"\r\n                            checked={newScenarioPeriod === \"full\"}\r\n                            onChange={() => handleScenarioPeriodChange(\"full\")}\r\n                          />\r\n                          <span>Tam Yil (tek yil)</span>\r\n                        </label>\r\n                        <label className=\"row\" style={{ gap: 6, alignItems: \"center\" }}>\r\n                          <input\r\n                            type=\"radio\"\r\n                            name=\"scenario-period\"\r\n                            checked={newScenarioPeriod === \"split\"}\r\n                            onChange={() => handleScenarioPeriodChange(\"split\")}\r\n                          />\r\n                          <span>Yil ortasinda baslar, sonraki yil biter</span>\r\n                        </label>\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n\r\n                  {newScenarioStep === 1 && (\r\n                    <div style={{ marginTop: 10 }}>\r\n                      <div className=\"small\" style={{ fontWeight: 700, marginBottom: 6 }}>Para Birimi</div>\r\n                      <div className=\"row\" style={{ gap: 12, alignItems: \"center\" }}>\r\n                        <label className=\"row\" style={{ gap: 6, alignItems: \"center\" }}>\r\n                          <input\r\n                            type=\"radio\"\r\n                            name=\"scenario-currency\"\r\n                            checked={newScenarioInputCurrency === \"USD\"}\r\n                            onChange={() => handleScenarioCurrencyChange(\"USD\")}\r\n                            disabled={scenarioWizardMode === \"edit\"}\r\n                          />\r\n                          <span>USD</span>\r\n                        </label>\r\n                        <label className=\"row\" style={{ gap: 6, alignItems: \"center\" }}>\r\n                          <input\r\n                            type=\"radio\"\r\n                            name=\"scenario-currency\"\r\n                            checked={newScenarioInputCurrency === \"LOCAL\"}\r\n                            onChange={() => handleScenarioCurrencyChange(\"LOCAL\")}\r\n                            disabled={scenarioWizardMode === \"edit\"}\r\n                          />\r\n                          <span>Local currency</span>\r\n                        </label>\r\n                      </div>\r\n\r\n                      {newScenarioInputCurrency === \"LOCAL\" && (\r\n                        <div style={{ marginTop: 10 }}>\r\n                          <div className=\"row\" style={{ gap: 8, alignItems: \"center\" }}>\r\n                            <div className=\"small\" style={{ fontWeight: 700 }}>Local currency code</div>\r\n                            <input\r\n                              className=\"input sm\"\r\n                              list=\"local-currency-codes\"\r\n                              placeholder=\"TRY\"\r\n                              value={newScenarioLocalCurrencyCode}\r\n                              onChange={(e) =>\r\n                                setNewScenarioLocalCurrencyCode(\r\n                                  e.target.value.toUpperCase().replace(/[^A-Z0-9]/g, \"\").slice(0, 10)\r\n                                )\r\n                              }\r\n                            />\r\n                            <datalist id=\"local-currency-codes\">\r\n                              {LOCAL_CURRENCY_OPTIONS.map((code) => (\r\n                                <option key={code} value={code} />\r\n                              ))}\r\n                            </datalist>\r\n                          </div>\r\n                          {!localCodeOk ? (\r\n                            <div className=\"small\" style={{ color: \"#b91c1c\", marginTop: 6 }}>\r\n                              Code 2-10 chars, A-Z0-9.\r\n                            </div>\r\n                          ) : null}\r\n\r\n                          <div className=\"row\" style={{ gap: 8, alignItems: \"center\", marginTop: 10 }}>\r\n                            <span>1 USD =</span>\r\n                            <input\r\n                              className=\"input sm\"\r\n                              type=\"number\"\r\n                              step=\"0.000001\"\r\n                              value={newScenarioFxUsdToLocal}\r\n                              onChange={(e) => setNewScenarioFxUsdToLocal(e.target.value)}\r\n                            />\r\n                            <span>{normalizedLocalCode || \"LOCAL\"}</span>\r\n                          </div>\r\n                          {!fxOk ? (\r\n                            <div className=\"small\" style={{ color: \"#b91c1c\", marginTop: 6 }}>\r\n                              FX rate must be &gt; 0.\r\n                            </div>\r\n                          ) : null}\r\n                          <div className=\"small muted\" style={{ marginTop: 6 }}>\r\n                            Kur formati: 1 USD = X LOCAL\r\n                          </div>\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  )}\r\n                  {newScenarioStep === 2 && (\r\n                    <div style={{ marginTop: 10 }}>\r\n                      <div className=\"small\" style={{ fontWeight: 700, marginBottom: 6 }}>Program Turu</div>\r\n                      <div className=\"row\" style={{ gap: 12 }}>\r\n                        {[\r\n                          {\r\n                            key: PROGRAM_TYPES.LOCAL,\r\n                            label: \"Yerel\",\r\n                            hint: \"Yerel kademeleri planlayin\",\r\n                          },\r\n                          {\r\n                            key: PROGRAM_TYPES.INTERNATIONAL,\r\n                            label: \"International\",\r\n                            hint: \"Uluslararasi kademeleri planlayin\",\r\n                          },\r\n                        ].map((option) => (\r\n                          <button\r\n                            key={option.key}\r\n                            type=\"button\"\r\n                            className={`btn ${newScenarioProgramType === option.key ? \"primary\" : \"ghost\"}`}\r\n                            aria-pressed={newScenarioProgramType === option.key}\r\n                            onClick={() => setNewScenarioProgramType(option.key)}\r\n                          >\r\n                            <div style={{ fontWeight: 700 }}>{option.label}</div>\r\n                            <div className=\"small\" style={{ opacity: 0.75 }}>{option.hint}</div>\r\n                          </button>\r\n                        ))}\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n\r\n                  {newScenarioStep === 3 && (\r\n                    <div style={{ marginTop: 10 }}>\r\n                      <div className=\"small\" style={{ fontWeight: 700, marginBottom: 6 }}>Yil</div>\r\n                      {newScenarioPeriod === \"full\" ? (\r\n                        <input\r\n                          className=\"input sm num-spin\"\r\n                          type=\"number\"\r\n                          step=\"1\"\r\n                          placeholder={DEFAULT_START_YEAR}\r\n                          value={newScenarioStartYear}\r\n                          onChange={(e) => handleScenarioStartYearChange(e.target.value)}\r\n                        />\r\n                      ) : (\r\n                        <div className=\"row\" style={{ gap: 8, alignItems: \"center\" }}>\r\n                          <input\r\n                            className=\"input sm num-spin\"\r\n                            type=\"number\"\r\n                            step=\"1\"\r\n                            placeholder={DEFAULT_START_YEAR}\r\n                            value={newScenarioStartYear}\r\n                            onChange={(e) => handleScenarioStartYearChange(e.target.value)}\r\n                          />\r\n                          <span className=\"muted\">-</span>\r\n                          <input\r\n                            className=\"input sm num-spin\"\r\n                            type=\"number\"\r\n                            step=\"1\"\r\n                            placeholder={DEFAULT_END_YEAR}\r\n                            value={newScenarioEndYear}\r\n                            readOnly\r\n                          />\r\n                        </div>\r\n                      )}\r\n                      <div className=\"small muted\" style={{ marginTop: 6 }}>\r\n                        Akademik yil: {draftAcademicYear || \"-\"}\r\n                        {newScenarioPeriod === \"split\" && draftAcademicYear && !draftRangeOk ? (\r\n                          <span style={{ color: \"#b91c1c\", marginLeft: 8 }}>\r\n                            Bitis yili, baslangic yilindan 1 fazla olmali.\r\n                          </span>\r\n                        ) : null}\r\n                        {draftAcademicYear && yearConflict ? (\r\n                          <span style={{ color: \"#b91c1c\", marginLeft: 8 }}>\r\n                            Bu yil turu icin zaten bir senaryo var.\r\n                          </span>\r\n                        ) : null}\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n\r\n                  {newScenarioStep === 4 && (\r\n                    <div style={{ marginTop: 10 }}>\r\n                      <div className=\"small\" style={{ fontWeight: 700, marginBottom: 6 }}>Kademeler</div>\r\n                      <label className=\"row small\" style={{ gap: 8, alignItems: \"center\", marginBottom: 8 }}>\r\n                        <input\r\n                          type=\"checkbox\"\r\n                          checked={newScenarioNoKademe}\r\n                          onChange={(e) => setNoKademeMode(e.target.checked)}\r\n                        />\r\n                        <span>Kademe yok (Merkez / Headquarter)</span>\r\n                      </label>\r\n                      {newScenarioNoKademe ? (\r\n                        <div className=\"small muted\" style={{ marginBottom: 8 }}>\r\n                          Bu senaryo icin kademe secmeye gerek yok. Kademe-bagimli alanlar ilerleme hesabina dahil edilmez.\r\n                        </div>\r\n                      ) : null}\r\n                      <table className=\"table\">\r\n                        <thead>\r\n                          <tr>\r\n                            <th>Kademe</th>\r\n                            <th style={{ width: 120 }}>Aktif</th>\r\n                            <th style={{ width: 160 }}>Baslangic</th>\r\n                            <th style={{ width: 160 }}>Bitis</th>\r\n                          </tr>\r\n                        </thead>\r\n                        <tbody>\r\n                          {kademeDefs.map((def) => {\r\n                            const row = draftKademeConfig[def.key];\r\n                            return (\r\n                              <tr key={def.key}>\r\n                                <td style={{ fontWeight: 700 }}>{def.label}</td>\r\n                                <td>\r\n                                  <input\r\n                                    type=\"checkbox\"\r\n                                    checked={!!row?.enabled}\r\n                                    disabled={newScenarioNoKademe}\r\n                                    onChange={(e) => updateNewKademe(def.key, { enabled: e.target.checked })}\r\n                                  />\r\n                                </td>\r\n                                <td>\r\n                                  <select\r\n                                    className=\"input sm\"\r\n                                    value={row?.from || \"\"}\r\n                                    onChange={(e) => updateNewKademe(def.key, { from: e.target.value })}\r\n                                    disabled={newScenarioNoKademe || !row?.enabled}\r\n                                  >\r\n                                    {gradeOptions.map((g) => (\r\n                                      <option key={g} value={g}>{g}</option>\r\n                                    ))}\r\n                                  </select>\r\n                                </td>\r\n                                <td>\r\n                                  <select\r\n                                    className=\"input sm\"\r\n                                    value={row?.to || \"\"}\r\n                                    onChange={(e) => updateNewKademe(def.key, { to: e.target.value })}\r\n                                    disabled={newScenarioNoKademe || !row?.enabled}\r\n                                  >\r\n                                    {gradeOptions.map((g) => (\r\n                                      <option key={g} value={g}>{g}</option>\r\n                                    ))}\r\n                                  </select>\r\n                                </td>\r\n                              </tr>\r\n                            );\r\n                          })}\r\n                        </tbody>\r\n                      </table>\r\n                      {!newScenarioNoKademe && !hasEnabledKademe ? (\r\n                        <div className=\"small\" style={{ color: \"#b91c1c\" }}>En az bir kademe secmelisiniz.</div>\r\n                      ) : null}\r\n                    </div>\r\n                  )}\r\n\r\n                  {newScenarioStep === 5 && (\r\n                    <div style={{ marginTop: 10 }}>\r\n                      <div className=\"small\" style={{ fontWeight: 700, marginBottom: 6 }}>Senaryo Adi</div>\r\n                      <div className=\"row\">\r\n                        <input\r\n                          className=\"input\"\r\n                          placeholder=\"Senaryo adi\"\r\n                          value={newScenarioName}\r\n                          onChange={(e) => setNewScenarioName(e.target.value)}\r\n                        />\r\n                      </div>\r\n                      {!newScenarioName.trim() ? (\r\n                        <div className=\"small\" style={{ color: \"#b91c1c\", marginTop: 6 }}>Senaryo adi zorunludur.</div>\r\n                      ) : null}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              )}\r\n            </div>\r\n            {!scenarioWizardLoading ? (\r\n              <div className=\"scenario-wizard-footer\">\r\n                <button\r\n                  className=\"btn\"\r\n                  onClick={goScenarioBack}\r\n                  disabled={newScenarioStep === 0 || scenarioWizardSaving}\r\n                >\r\n                  Geri\r\n                </button>\r\n                <button\r\n                  className=\"btn primary\"\r\n                  onClick={goScenarioNext}\r\n                  disabled={scenarioWizardSaving || !scenarioStepOk[newScenarioStep]}\r\n                >\r\n                  {scenarioWizardSaving ? (\r\n                    <span style={{ display: \"inline-flex\", gap: 6, alignItems: \"center\" }}>\r\n                      <InlineSpinner />\r\n                      <span>{scenarioWizardMode === \"edit\" ? \"Kaydediliyor...\" : \"Olusturuluyor...\"}</span>\r\n                    </span>\r\n                  ) : (\r\n                    newScenarioStep < scenarioStepTotal - 1\r\n                      ? \"Ileri\"\r\n                      : scenarioWizardMode === \"edit\"\r\n                        ? \"Kaydet\"\r\n                        : \"Bitir\"\r\n                  )}\r\n                </button>\r\n              </div>\r\n            ) : null}\r\n          </div>\r\n        </div>\r\n      ) : null}\r\n\r\n      <div\r\n        className=\"row select-page-tables\"\r\n        style={{ gap: 12, alignItems: \"stretch\", flexWrap: \"wrap\" }}\r\n      >\r\n        <div className=\"card select-table-card\" style={{ flex: \"1 1 320px\", minWidth: 280 }}>\r\n          <div style={{ fontWeight: 700, marginBottom: 8 }}>Okullar</div>\r\n          {loadingSchools ? (\r\n            <div className=\"small\">Yukleniyor...</div>\r\n          ) : (\r\n            <div className=\"select-table-body\">\r\n              <table className=\"table select-school-table\">\r\n                <colgroup>\r\n                  <col style={{ width: 32 }} />\r\n                  <col />\r\n                  <col style={{ width: 180 }} />\r\n                </colgroup>\r\n              <thead>\r\n                <tr>\r\n                  <th></th>\r\n                  <th>Okul</th>\r\n                  <th>lerleme</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody>\r\n                {schools.length === 0 ? (\r\n                  <tr>\r\n                    <td colSpan=\"3\" className=\"small\">Okul bulunamadi.</td>\r\n                  </tr>\r\n                ) : (\r\n                  schools.map((s) => {\r\n                    const isSelected = String(selectedSchoolId) === String(s.id);\r\n                    const progress = schoolProgress[s.id];\r\n                    return (\r\n                      <tr\r\n                        key={s.id}\r\n                        className={isSelected ? \"scenario-row is-selected\" : \"scenario-row\"}\r\n                        // Provide a pointer cursor for the whole row to indicate interactivity. Clicking the row or any\r\n                        // cell will select the school.\r\n                        style={{ cursor: isSelected ? \"default\" : \"pointer\" }}\r\n                        onClick={() => {\r\n                          if (isSelected) return;\r\n                          handleSelectSchool(s.id);\r\n                        }}\r\n                      >\r\n                        <td\r\n                          onClick={(e) => {\r\n                            e.stopPropagation();\r\n                          }}\r\n                        >\r\n                          <input\r\n                            type=\"checkbox\"\r\n                            className=\"select-checkbox\"\r\n                            checked={isSelected}\r\n                            aria-label={`${s.name} okulunu se`}\r\n                            onChange={(e) => {\r\n                              e.stopPropagation();\r\n                              if (isSelected) {\r\n                                clearSchoolSelection();\r\n                                return;\r\n                              }\r\n                              handleSelectSchool(s.id);\r\n                            }}\r\n                          />\r\n                        </td>\r\n                        <td\r\n                          onClick={(e) => {\r\n                            e.stopPropagation();\r\n                            if (isSelected) return;\r\n                            handleSelectSchool(s.id);\r\n                          }}\r\n                          style={{ cursor: \"pointer\" }}\r\n                        >\r\n                          <b>{s.name}</b>\r\n                        </td>\r\n                        <td style={{ minWidth: 180 }}>\r\n                          {progress ? (\r\n                            progress.state === \"active\" ? (\r\n                              <ProgressBar value={progress.pct} tooltipLines={progress.tooltipLines} />\r\n                            ) : (\r\n                              <div className=\"small\">{progress.label || \"-\"}</div>\r\n                            )\r\n                          ) : (\r\n                            <div className=\"small\">{schoolProgressLoading ? \"Hesaplanyor...\" : \"-\"}</div>\r\n                          )}\r\n                        </td>\r\n                      </tr>\r\n                    );\r\n                  })\r\n                )}\r\n              </tbody>\r\n              </table>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        <div className=\"card select-table-card\" style={{ flex: \"2 1 420px\", minWidth: 320 }}>\r\n          {/* Header for the scenarios list. The \"Yeni Senaryo\" button has been moved into the scenario toolbar\r\n              below so it appears alongside the other scenario actions. */}\r\n          <div className=\"row\" style={{ justifyContent: \"space-between\", alignItems: \"center\", gap: 12 }}>\r\n            <div style={{ fontWeight: 700 }}>Senaryolar</div>\r\n          </div>\r\n\r\n          {!selectedSchoolId ? (\r\n            <div className=\"small muted\" style={{ marginTop: 10 }}>Once okul secin.</div>\r\n          ) : (\r\n            <>\r\n              <div className=\"scenario-toolbar\" style={{ marginTop: 10 }}>\r\n                {/* Yeni Senaryo button moved here to be the first action in the toolbar. It remains disabled when\r\n                    no school is selected or an operation is in progress. */}\r\n                {canCreateScenario ? (\r\n                  <button\r\n                    type=\"button\"\r\n                    className=\"btn primary\"\r\n                    onClick={openScenarioWizardCreate}\r\n                    disabled={!selectedSchoolId || scenarioOpsBusy}\r\n                    title=\"Yeni Senaryo\"\r\n                  >\r\n                    <span className=\"btn-inner\">\r\n                      <FaPlus aria-hidden=\"true\" />\r\n                      <span>Yeni Senaryo</span>\r\n                    </span>\r\n                  </button>\r\n                ) : null}\r\n                {canEditScenarioPlan ? (\r\n                  <button\r\n                    type=\"button\"\r\n                    className=\"btn\"\r\n                    onClick={() => {\r\n                      if (!selectedRowScenario) return;\r\n                      openScenarioWizardEdit(selectedRowScenario.id);\r\n                    }}\r\n                    disabled={!canEditToolbar || scenarioOpsBusy}\r\n                    title=\"Planlamayi Duzenle\"\r\n                  >\r\n                    <span className=\"btn-inner\">\r\n                      <FaEdit aria-hidden=\"true\" />\r\n                      <span>Planlamayi Duzenle</span>\r\n                    </span>\r\n                  </button>\r\n                ) : null}\r\n                {canCopyScenario ? (\r\n                  <button\r\n                    type=\"button\"\r\n                    className=\"btn\"\r\n                    onClick={openCopyScenarioModal}\r\n                    disabled={!canCopyToolbar || calculating || scenarioOpsBusy}\r\n                    title=\"Kopyala\"\r\n                  >\r\n                    <span className=\"btn-inner\">\r\n                      {toolbarIsCopying ? <InlineSpinner /> : <FaCopy aria-hidden=\"true\" />}\r\n                      <span>Kopyala</span>\r\n                    </span>\r\n                  </button>\r\n                ) : null}\r\n                {canExpenseSplit ? (\r\n                  <button\r\n                    type=\"button\"\r\n                    className=\"btn\"\r\n                    onClick={() => setExpenseSplitOpen(true)}\r\n                    disabled={!selectedRowScenario || scenarioOpsBusy}\r\n                    title=\"Gider Paylatr\"\r\n                  >\r\n                    <span className=\"btn-inner\">\r\n                      <FaBalanceScale aria-hidden=\"true\" />\r\n                      <span>Gider Paylatr</span>\r\n                    </span>\r\n                  </button>\r\n                ) : null}\r\n                {canForwardScenario && isForwardStage ? (\r\n                  <button\r\n                    type=\"button\"\r\n                    className=\"btn primary\"\r\n                    onClick={() => {\r\n                      if (!selectedRowScenario) return;\r\n                      sendScenarioForApproval(selectedRowScenario.id);\r\n                    }}\r\n                    disabled={!canForwardToolbar || calculating || scenarioOpsBusy}\r\n                    title=\"Merkeze ilet\"\r\n                  >\r\n                    <span className=\"btn-inner\">\r\n                      {toolbarIsSubmitting ? <InlineSpinner /> : <FaPaperPlane style={{ marginRight: 4 }} />}\r\n                      <span>Merkeze ilet</span>\r\n                    </span>\r\n                  </button>\r\n                ) : null}\r\n                {canSubmitScenario && isSubmitStage ? (\r\n                  <button\r\n                    type=\"button\"\r\n                    className=\"btn primary\"\r\n                    onClick={() => {\r\n                      if (!selectedRowScenario) return;\r\n                      submitScenarioForApproval(selectedRowScenario.id);\r\n                    }}\r\n                    disabled={!canSubmitToolbar || calculating || scenarioOpsBusy}\r\n                    title=\"Onaya Gonder\"\r\n                  >\r\n                    <span className=\"btn-inner\">\r\n                      {/* Show a spinner while submitting; otherwise show an approval icon. */}\r\n                      {toolbarIsSubmitting ? <InlineSpinner /> : <FaCheckCircle style={{ marginRight: 4 }} />}\r\n                      <span>Onaya Gonder</span>\r\n                    </span>\r\n                  </button>\r\n                ) : null}\r\n                {canDeleteScenario ? (\r\n                  <button\r\n                    type=\"button\"\r\n                    className=\"btn danger\"\r\n                    onClick={() => {\r\n                      if (!selectedRowScenario) return;\r\n                      openDeleteScenarioModal(selectedRowScenario.id);\r\n                    }}\r\n                    disabled={!canDeleteToolbar || calculating || scenarioOpsBusy}\r\n                    title=\"Sil\"\r\n                  >\r\n                    <span className=\"btn-inner\">\r\n                      {/* Show a spinner while deleting; otherwise show a trash icon. */}\r\n                      {toolbarIsDeleting ? <InlineSpinner /> : <FaTrash style={{ marginRight: 4 }} />}\r\n                      <span>Sil</span>\r\n                    </span>\r\n                  </button>\r\n                ) : null}\r\n              </div>\r\n              <div className=\"select-table-body select-table-body-gap\">\r\n                <table className=\"table scenario-table\">\r\n                <thead>\r\n                  <tr>\r\n                    <th></th>\r\n                    <th aria-sort={getSortAria(\"name\")}>\r\n                      <button\r\n                        type=\"button\"\r\n                        className=\"sort-th\"\r\n                        onClick={() => toggleScenarioSort(\"name\")}\r\n                        aria-label=\"Sirala: Ad\"\r\n                      >\r\n                        <span>Ad</span>\r\n                        {sortIcon(\"name\")}\r\n                      </button>\r\n                    </th>\r\n                    <th aria-sort={getSortAria(\"year\")}>\r\n                      <button\r\n                        type=\"button\"\r\n                        className=\"sort-th\"\r\n                        onClick={() => toggleScenarioSort(\"year\")}\r\n                        aria-label=\"Sirala: Yil\"\r\n                      >\r\n                        <span>Yil</span>\r\n                        {sortIcon(\"year\")}\r\n                      </button>\r\n                    </th>\r\n                    <th aria-sort={getSortAria(\"currency\")}>\r\n                      <button\r\n                        type=\"button\"\r\n                        className=\"sort-th\"\r\n                        onClick={() => toggleScenarioSort(\"currency\")}\r\n                        aria-label=\"Sirala: Para Birimi\"\r\n                      >\r\n                        <span>Para Birimi</span>\r\n                        {sortIcon(\"currency\")}\r\n                      </button>\r\n                    </th>\r\n                    <th aria-sort={getSortAria(\"status\")}>\r\n                      <button\r\n                        type=\"button\"\r\n                        className=\"sort-th\"\r\n                        onClick={() => toggleScenarioSort(\"status\")}\r\n                        aria-label=\"Sirala: Durum\"\r\n                      >\r\n                        <span>Durum</span>\r\n                        {sortIcon(\"status\")}\r\n                      </button>\r\n                    </th>\r\n                    <th>lerleme</th>\r\n                    <th aria-sort={getSortAria(\"date\")}>\r\n                      <button\r\n                        type=\"button\"\r\n                        className=\"sort-th\"\r\n                        onClick={() => toggleScenarioSort(\"date\")}\r\n                        aria-label=\"Sirala: Tarih\"\r\n                      >\r\n                        <span>Tarih</span>\r\n                        {sortIcon(\"date\")}\r\n                      </button>\r\n                    </th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody>\r\n                  {loadingScenarios ? (\r\n                    <tr>\r\n                      <td colSpan=\"7\" className=\"small\">Yukleniyor...</td>\r\n                    </tr>\r\n                  ) : sortedScenarios.length === 0 ? (\r\n                    <tr>\r\n                      <td colSpan=\"7\" className=\"small\">Gosterilecek senaryo yok.</td>\r\n                    </tr>\r\n                  ) : (\r\n                    sortedScenarios.map((s) => {\r\n                      const statusMeta = getScenarioStatusMeta(s);\r\n                      const isSelected = String(selectedScenarioIdLocal) === String(s.id);\r\n                      const isThisRowBusy = String(s.id) === String(busyRowId);\r\n                      const isOtherRowDisabled = scenarioOpsBusy && busyRowId && !isThisRowBusy;\r\n                      const disableThisRowActions = scenarioOpsBusy;\r\n                      const currencyLabel =\r\n                        s.input_currency === \"LOCAL\"\r\n                          ? `${s.local_currency_code || \"LOCAL\"} (LOCAL)`\r\n                          : \"USD\";\r\n                      return (\r\n                        <tr\r\n                          key={s.id}\r\n                          className={isSelected ? \"scenario-row is-selected\" : \"scenario-row\"}\r\n                          // Apply opacity and pointer-event rules as before. Also set cursor to pointer when\r\n                          // selection is possible. When another row is busy or this row is disabled/selected, the\r\n                          // cursor remains default and clicking does nothing.\r\n                          style={{\r\n                            opacity: isOtherRowDisabled ? 0.5 : 1,\r\n                            pointerEvents: isOtherRowDisabled ? \"none\" : \"auto\",\r\n                            cursor:\r\n                              isSelected || disableThisRowActions || isOtherRowDisabled ? \"default\" : \"pointer\",\r\n                          }}\r\n                          onClick={() => {\r\n                            if (isSelected || disableThisRowActions || isOtherRowDisabled) return;\r\n                            setSelectedScenarioIdLocal(s.id);\r\n                          }}\r\n                        >\r\n                          <td>\r\n                            <input\r\n                              type=\"checkbox\"\r\n                              className=\"select-checkbox\"\r\n                              checked={isSelected}\r\n                              disabled={disableThisRowActions || isOtherRowDisabled}\r\n                              aria-label={`${s.name} senaryosunu se`}\r\n                              onChange={(e) => {\r\n                                e.stopPropagation();\r\n                                if (disableThisRowActions || isOtherRowDisabled) return;\r\n                                if (isSelected) {\r\n                                  clearScenarioSelection();\r\n                                  return;\r\n                                }\r\n                                setSelectedScenarioIdLocal(s.id);\r\n                              }}\r\n                            />\r\n                          </td>\r\n                          <td>\r\n                            <b className=\"scenario-name\" title={s.name}>\r\n                              {s.name}\r\n                            </b>\r\n                          </td>\r\n                          <td>{s.academic_year}</td>\r\n                          <td>{currencyLabel}</td>\r\n                          <td>\r\n                            <span className={`status-badge ${statusMeta.cls}`} title={statusMeta.help}>\r\n                              {statusMeta.label}\r\n                            </span>\r\n                          </td>\r\n                          <td style={{ minWidth: 160 }}>\r\n                            {scenarioProgressMap[s.id] && !scenarioProgressMap[s.id].error ? (\r\n                              <ProgressBar\r\n                                value={scenarioProgressMap[s.id].pct}\r\n                                tooltipLines={scenarioProgressMap[s.id].tooltipLines}\r\n                              />\r\n                            ) : (\r\n                              <span className=\"small\">\r\n                                {scenarioProgressLoading ? \"Hesaplanyor...\" : \"-\"}\r\n                              </span>\r\n                            )}\r\n                          </td>\r\n                          <td className=\"small\">{new Date(s.created_at).toLocaleString()}</td>\r\n                        </tr>\r\n                      );\r\n                    })\r\n                  )}\r\n                </tbody>\r\n                </table>\r\n              </div>\r\n            </>\r\n          )}\r\n          <div className=\"row select-table-footer\" style={{ justifyContent: \"flex-end\" }}>\r\n            <button\r\n              className=\"btn primary\"\r\n              onClick={handleApply}\r\n              disabled={!selectedSchoolId || !selectedScenarioIdLocal}\r\n            >\r\n              Uygula\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","const PROGRAM_TYPES = {\r\n  LOCAL: \"local\",\r\n  INTERNATIONAL: \"international\",\r\n};\r\n\r\nconst ALLOWED_PROGRAM_TYPES = new Set(Object.values(PROGRAM_TYPES));\r\n\r\nfunction normalizeProgramType(value) {\r\n  const raw = String(value || \"\").trim().toLowerCase();\r\n  if (ALLOWED_PROGRAM_TYPES.has(raw)) return raw;\r\n  return PROGRAM_TYPES.LOCAL;\r\n}\r\n\r\nfunction getProgramType(inputs = {}, scenario = null) {\r\n  const programFromInputs =\r\n    inputs?.temelBilgiler?.programType ?? inputs?.programType ?? inputs?.program_type;\r\n  if (programFromInputs) {\r\n    return normalizeProgramType(programFromInputs);\r\n  }\r\n  const programFromScenario = scenario?.program_type || scenario?.programType;\r\n  if (programFromScenario) return normalizeProgramType(programFromScenario);\r\n  return PROGRAM_TYPES.LOCAL;\r\n}\r\n\r\nfunction isKademeKeyVisible(key, programType = PROGRAM_TYPES.LOCAL) {\r\n  const type = normalizeProgramType(programType);\r\n  if (!key) return true;\r\n  if (key === \"okulOncesi\") return true;\r\n  if (key.endsWith(\"Yerel\")) return type === PROGRAM_TYPES.LOCAL;\r\n  if (key.endsWith(\"Int\")) return type === PROGRAM_TYPES.INTERNATIONAL;\r\n  return true;\r\n}\r\n\r\nfunction mapBaseKademeToVariant(baseKademe, programType = PROGRAM_TYPES.LOCAL) {\r\n  const type = normalizeProgramType(programType);\r\n  if (baseKademe === \"okulOncesi\") return \"okulOncesi\";\r\n  const suffix = type === PROGRAM_TYPES.INTERNATIONAL ? \"Int\" : \"Yerel\";\r\n  return `${baseKademe}${suffix}`;\r\n}\r\n\r\nfunction getVariantKeysForProgramType(programType = PROGRAM_TYPES.LOCAL) {\r\n  const type = normalizeProgramType(programType);\r\n  return new Set([\r\n    \"okulOncesi\",\r\n    `ilkokul${type === PROGRAM_TYPES.INTERNATIONAL ? \"Int\" : \"Yerel\"}`,\r\n    `ortaokul${type === PROGRAM_TYPES.INTERNATIONAL ? \"Int\" : \"Yerel\"}`,\r\n    `lise${type === PROGRAM_TYPES.INTERNATIONAL ? \"Int\" : \"Yerel\"}`,\r\n  ]);\r\n}\r\n\r\nexport {\r\n  PROGRAM_TYPES,\r\n  ALLOWED_PROGRAM_TYPES,\r\n  getProgramType,\r\n  normalizeProgramType,\r\n  isKademeKeyVisible,\r\n  mapBaseKademeToVariant,\r\n  getVariantKeysForProgramType,\r\n};\r\n"],"names":["Tooltip","_ref","text","lines","children","className","resolved","Array","isArray","map","line","String","filter","trim","length","split","Boolean","normalizeLines","_jsxs","concat","_jsx","role","idx","GRADES","KADEME_DEFS","key","label","defaultFrom","defaultTo","normalizeGrade","value","v","toUpperCase","test","n","Number","isFinite","gradeIndex","g","indexOf","getKademeDefinitions","d","_objectSpread","getDefaultKademeConfig","out","forEach","enabled","from","to","normalizeKademeConfig","config","cfg","row","range","fromValue","toValue","def","_normalizeGrade","_normalizeGrade2","fromIdx","toIdx","normalizeRange","formatKademeLabel","find","getKademeRangeLabel","getKademeForGrade","grade","summarizeGradesByKademe","grades","rows","okulOncesi","ilkokul","ortaokul","lise","total","r","students","studentsPerBranch","Object","prototype","hasOwnProperty","call","getGradeOptions","ProgressBar","tooltipLines","numeric","pct","Math","max","min","track","style","width","round","KADEME_BASE_KEYS","isHeadquarterScenario","inputs","_inputs$temelBilgiler","kademeler","temelBilgiler","every","_kademeler$key","EXPENSE_ITEMS","EXPENSE_KEYS","it","EXPENSE_ITEM_MAP","Map","EXPENSE_LABELS","EXPENSE_SECTIONS","id","groups","keys","section","group","flatMap","fmtNum","fractionDigits","arguments","undefined","toLocaleString","maximumFractionDigits","ExpenseSplitModal","_sourceScenario$schoo","open","onClose","sourceScenario","sourceSchoolId","sourceSchoolName","targets","setTargets","useState","loadingTargets","setLoadingTargets","targetSearch","setTargetSearch","selectedTargets","setSelectedTargets","Set","basis","setBasis","basisYearKey","setBasisYearKey","selectedExpenseKeys","setSelectedExpenseKeys","preview","setPreview","previewLoading","setPreviewLoading","applyLoading","setApplyLoading","showPools","setShowPools","expandedTargets","setExpandedTargets","showTargets","setShowTargets","showExpenses","setShowExpenses","compactControlStyle","fontSize","height","padding","lineHeight","boxSizing","selectedTargetsKey","useMemo","sort","join","selectedExpenseKeyStr","useEffect","active","async","academic_year","data","api","expenseSplitTargets","filtered","scenarioId","e","toast","error","message","loadTargets","filteredTargets","term","toLowerCase","schoolName","scenarioName","includes","toggleTarget","prev","next","has","delete","add","toggleExpenseKey","setExpenseKeys","checked","previewTargets","previewPools","pools","previewAllocations","allocations","previewWarnings","warnings","sourceLabel","school","name","allocationsByTarget","targetScenarioId","list","get","push","expenseLabel","expenseKey","amount","allocatedAmount","set","totalExpenseCount","selectedExpenseCount","size","allExpensesSelected","someExpensesSelected","previewDisabled","isletmeSection","s","otherSections","renderSectionCard","selected","reduce","sum","allSelected","someSelected","background","justifyContent","alignItems","gap","fontWeight","type","ref","el","indeterminate","onChange","target","onClick","disabled","marginTop","marginBottom","item","maxHeight","overflowY","position","stopPropagation","top","right","borderColor","color","_Fragment","flexWrap","minWidth","flex","placeholder","cursor","FaChevronDown","FaChevronRight","colSpan","currencyLabel","input_currency","local_currency_code","display","payload","targetScenarioIds","expenseKeys","previewExpenseSplit","applyExpenseSplit","success","w","p","poolAmount","margin","t","targetKey","isExpanded","allocRows","React","toggleTargetAllocations","textAlign","basisValue","weight","toFixed","COPY_SELECT_TABS","sections","COPY_SECTION_RESOURCES","isScenarioLocked","scenario","status","submittedAt","submitted_at","sentAt","sent_at","DEFAULT_START_YEAR","DEFAULT_END_YEAR","CURRENCY_CODE_REGEX","LOCAL_CURRENCY_OPTIONS","normalizeYearInput","incrementAcademicYearString","academicYear","raw","single","match","start","end","getAllCopySectionIds","tab","enforceIkGiderlerPair","selection","ikSelected","giderlerSelected","nextValue","buildDefaultCopySelection","presetKey","sectionIds","fromEntries","buildEmptyNormCurriculum","empty","buildEmptyNormYear","maxHours","teacherWeeklyMaxHours","curriculumWeeklyHours","convertInputsUsdToLocalForCopy","fx","_inputs$ik","rate","mulMoney","gelirler","_g$tuition","_g$nonEducationFees","_g$dormitory","_g$otherInstitutionIn","convertRows","unitFee","tuition","nonEducationFees","dormitory","otherInstitutionIncome","governmentIncentives","giderler","values","grp","items","k","ik","years","yearObj","unitCosts","discounts","mode","tb","_tb$inflation","_tb$performans","inflation","currentSeasonAvgFee","rakipAnalizi","obj","performans","gerceklesen","InlineSpinner","_ref2","borderRadius","border","borderTopColor","animation","normalizeCapacityInputs","src","_cap$years","_cap$years2","_cap$years3","safeNum","legacy","schoolCapacity","cap","kapasite","y1","y2","y3","currentStudents","byKademe","structuredClone","normalizeTemelBilgilerInputs","inf","toFinite","expenseDeviationPct","y2023","y2024","y2025","yetkililer","mudur","ulkeTemsilcisi","raporuHazirlayan","okulEgitimBilgileri","egitimBaslamaTarihi","zorunluEgitimDonemleri","birDersSuresiDakika","gunlukDersSaati","haftalikDersSaatiToplam","sabahciOglenci","ogretmenHaftalikDersOrt","gecisSinaviBilgisi","uygulananProgram","programType","normalizeProgramType","okulUcretleriHesaplama","ucretArtisOranlari","ilkokulYerel","ilkokulInt","ortaokulYerel","ortaokulInt","liseYerel","liseInt","ikMevcut","turkPersonelYoneticiEgitimci","turkPersonelTemsilcilik","yerelKadroluEgitimci","yerelUcretliVakaterEgitimci","yerelDestek","yerelTemsilcilik","international","bursIndirimOgrenciSayilari","magisBasariBursu","maarifYetenekBursu","ihtiyacBursu","okulBasariBursu","tamEgitimBursu","barinmaBursu","turkceBasariBursu","uluslararasiYukumlulukIndirimi","vakifCalisaniIndirimi","kardesIndirimi","erkenKayitIndirimi","pesinOdemeIndirimi","kademeGecisIndirimi","temsilIndirimi","kurumIndirimi","istisnaiIndirim","yerelMevzuatIndirimi","a","b","c","ogrenciSayisi","karZarar","bursVeIndirimler","degerlendirme","normalizeGradesInputs","defaultGrades","branchCount","baseGrades","gradesYears","toMap","m","_row$grade","_row$branchCount","_row$studentsPerBranc","normalizeRow","areGradesEqual","ma","mb","ra","entries","rb","SelectPage","_ref3","_ref4","_inputs$temelBilgiler2","_auth$user2","_auth$user3","navigate","useNavigate","outlet","useOutletContext","searchParams","setSearchParams","useSearchParams","auth","useAuth","schools","setSchools","scenarios","setScenarios","scenariosSchoolId","setScenariosSchoolId","selectedSchoolId","setSelectedSchoolId","selectedScenarioIdLocal","setSelectedScenarioIdLocal","selectedScenario","setSelectedScenario","setInputs","setReport","err","setErr","loadingSchools","setLoadingSchools","loadingScenarios","setLoadingScenarios","schoolProgress","setSchoolProgress","schoolProgressLoading","setSchoolProgressLoading","scenarioProgressMap","setScenarioProgressMap","scenarioProgressLoading","setScenarioProgressLoading","newScenarioName","setNewScenarioName","newScenarioPeriod","setNewScenarioPeriod","newScenarioStartYear","setNewScenarioStartYear","newScenarioEndYear","setNewScenarioEndYear","newScenarioKademeler","setNewScenarioKademeler","newScenarioNoKademe","setNewScenarioNoKademe","newScenarioInputCurrency","setNewScenarioInputCurrency","newScenarioLocalCurrencyCode","setNewScenarioLocalCurrencyCode","newScenarioFxUsdToLocal","setNewScenarioFxUsdToLocal","newScenarioProgramType","setNewScenarioProgramType","newScenarioStep","setNewScenarioStep","scenarioWizardOpen","setScenarioWizardOpen","scenarioWizardMode","setScenarioWizardMode","scenarioWizardScenario","setScenarioWizardScenario","scenarioWizardLoading","setScenarioWizardLoading","scenarioWizardSaving","setScenarioWizardSaving","scenarioSort","setScenarioSort","dir","submittingScenarioId","setSubmittingScenarioId","copyingScenarioId","setCopyingScenarioId","deletingScenarioId","setDeletingScenarioId","deleteConfirmScenarioId","setDeleteConfirmScenarioId","copyModalOpen","setCopyModalOpen","expenseSplitOpen","setExpenseSplitOpen","copyModalError","setCopyModalError","copySelection","setCopySelection","copySelectionMsg","setCopySelectionMsg","copyTargetCurrency","setCopyTargetCurrency","copyLocalCurrencyCode","setCopyLocalCurrencyCode","copyPlannedFxUsdToLocal","setCopyPlannedFxUsdToLocal","copyFxUsdToLocal","setCopyFxUsdToLocal","calculating","setCalculating","copySelectionMsgTimerRef","useRef","kademeBeforeNoKademeRef","setHeaderMeta","title","subtitle","centered","_outlet$clearHeaderMe","clearHeaderMeta","loadSchools","useCallback","listSchools","limit","offset","fields","order","loadSchoolProgress","ids","getSchoolsProgressBulk","progressBySchoolId","_","fallback","state","paramId","some","handleSelectSchool","schoolId","isDifferent","URLSearchParams","clearSchoolSelection","clearScenarioSelection","sc","listScenarios","stored","readSelectedScenarioId","loadScenarios","results","Promise","all","_progress$pct","getScenarioProgress","progress","missingLines","missingDetailsLines","loadScenarioProgress","getScenarioInputs","normalized","isHQ","writeScenarioFlags","isHeadquarter","loadScenario","refreshScenarios","kademeDefs","gradeOptions","draftStartYear","draftEndYear","draftAcademicYear","periodType","startYearValue","endYearValue","formatAcademicYear","draftRangeOk","yearConflict","excludeId","draftKademeConfig","hasEnabledKademe","kademeStepOk","normalizedLocalCode","localCodeOk","fxValue","fxOk","currencyStepOk","draftReady","scenarioStepOk","scenarioOpsBusy","busyRowId","selectedRowScenario","selectedSchoolName","sortedScenarios","indexed","dirMul","getYearParts","ay","getCurrencyCode","getStatusLabel","A","B","res","localeCompare","sensitivity","a1","a2","b1","b2","Date","created_at","getTime","toggleScenarioSort","getSortAria","sortIcon","FaSort","FaSortUp","FaSortDown","copySectionIds","selectedCopyCount","isIkGiderlerValid","sourceCurrency","inputCurrencyCode","isLocalScenario","prevRealFxValue","prevYearRealizedFxUsdToLocal","prevRealFxMissing","permissionScope","_auth$user$country_id","_auth$user","countryId","user","country_id","canCreateScenario","can","canEditScenarioPlan","canCopyScenario","canExpenseSplit","canSubmitScenario","canForwardScenario","canDeleteScenario","toolbarLocked","canEditToolbar","canDeleteToolbar","isSubmitStage","isForwardStage","canSubmitToolbar","canForwardToolbar","canCopyToolbar","toolbarIsCopying","toolbarIsSubmitting","toolbarIsDeleting","handleScenarioCurrencyChange","handleScenarioPeriodChange","nextPeriod","handleScenarioStartYearChange","openScenarioWizardEdit","targetScenario","_data$inputs","_data$inputs$temelBil","Error","startYear","endYear","parseAcademicYear","existingKademe","normalizedKademe","hasAnyEnabled","current","scenarioCurrency","fx_usd_to_local","program_type","PROGRAM_TYPES","LOCAL","updateNewKademe","patch","base","parseFxInput","NaN","replace","num","parseFloat","applyPresetSelection","toggleCopySelection","clearTimeout","setTimeout","setCopyTabSelectionAll","tabKey","entry","closeCopyScenarioModal","sumPlannedStudents","_row$studentsPerBranc2","showBlockingToast","toastId","warn","autoClose","closeOnClick","draggable","icon","boxShadow","ensurePlanningStudentsForY2Y3","actionLabel","totals","srcInputs","getPlannedStudentTotalsByYear","missing","msg","ensurePrevRealFxForLocal","calculate","options","skipPlanValidation","ok","calculateScenario","deleteConfirmScenario","deleteConfirmLabel","deleteConfirmMessage","ToastContainer","newestOnTop","pauseOnFocusLoss","pauseOnHover","hideProgressBar","theme","deleteScenario","slice","code","step","gridTemplateColumns","flexDirection","targetCurrency","localCurrencyCodeValue","plannedFxUsdToLocalValue","copyFxUsdToLocalValue","plannedFxNumber","copyFxNumber","_copyOptions$localCur","_copyOptions$plannedF","_copyOptions$copyFxUs","copyOptions","localCurrencyCode","plannedFxUsdToLocal","plannedFxParsed","copyFxParsed","_ref8","_localCurrencyCode","_plannedFxUsdToLocal","_copyFxUsdToLocal","_inputs$temelBilgiler3","baseName","copyName","candidateYear","guard","hasAcademicYear","yearStr","shouldCopyCore","kademeConfig","fxForCreate","created","createScenario","inputCurrency","fxUsdToLocal","clonedInputs","_next$temelBilgiler","sel","keep","buildDefaultGrades","srcGradesYears","srcGrades","y1Source","keepPlanned","keepLessonY1","y2Source","y3Source","gradesCurrent","filterInputsForCopyBySelection","inInputs","_ik$years","_src$giderler","_src$giderler$isletme","yearIK","headcountsByLevel","roles","levels","roleAnnual","count","lvl","_headcountsByLevel$lv","turkPersonelMaas","turk_mudur","turk_mdyard","turk_egitimci","turkDestekPersonelMaas","turk_temsil","yerelPersonelMaas","yerel_yonetici_egitimci","yerelDestekPersonelMaas","yerel_destek","yerel_ulke_temsil_destek","internationalPersonelMaas","int_yonetici_egitimci","prevItems","isletme","changed","abs","applyIkSalariesToGiderler","convertInputsLocalToUsdForCopy","modifiedResources","resources","buildModifiedResourcesFromCopySelection","saveScenarioInputs","sourceNorm","getNormConfig","_ref9","_sourceYears$y1$teach","_sourceYears$y","sourceYears","baseHours","saveNormConfig","console","copySelectedScenario","hint","INTERNATIONAL","option","opacity","readOnly","marginLeft","nextEnabled","_ref7","restored","setNoKademeMode","getScenarioStepError","scenarioStepTotal","scenarioProgramType","baseKademe","_ref6","updateScenario","_ref5","submitScenarioWizard","isSelected","FaPlus","FaEdit","FaCopy","FaBalanceScale","keepTab","sendForApproval","sendScenarioForApproval","FaPaperPlane","marginRight","submitScenario","submitScenarioForApproval","FaCheckCircle","FaTrash","statusMeta","scenarioOrStatus","cls","help","getScenarioStatusMeta","isThisRowBusy","isOtherRowDisabled","disableThisRowActions","pointerEvents","handleApply","writeSelectedScenarioId","writeLastActiveSchoolId","seg","readGlobalLastRouteSegment","ALLOWED_PROGRAM_TYPES","getProgramType","programFromInputs","programFromScenario","isKademeKeyVisible","endsWith","mapBaseKademeToVariant","suffix"],"ignoreList":[],"sourceRoot":""}