"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[100],{4405(e,i,l){l.d(i,{A:()=>n});l(5043);var r=l(579);function n(e){let{text:i,lines:l,children:n,className:a=""}=e;const t=function(e,i){return Array.isArray(e)?e.map(e=>String(e)).filter(e=>e.trim().length>0):"string"===typeof i?i.split("\n").map(e=>e.trim()).filter(Boolean):[]}(l,i);return t.length?(0,r.jsxs)("span",{className:"tooltip-wrap ".concat(a).trim(),children:[n,(0,r.jsx)("span",{className:"tooltip-bubble",role:"tooltip",children:t.map((e,i)=>(0,r.jsx)("div",{className:"tooltip-line",children:e},"".concat(i,"-").concat(e)))})]}):n}},6037(e,i,l){l.d(i,{Ds:()=>d,In:()=>m,VJ:()=>u,aW:()=>o,jc:()=>c,oP:()=>p,qV:()=>y});var r=l(2555);const n=["KG","1","2","3","4","5","6","7","8","9","10","11","12"],a=[{key:"okulOncesi",label:"Okul \xd6ncesi",defaultFrom:"KG",defaultTo:"KG"},{key:"ilkokul",label:"\u0130lkokul",defaultFrom:"1",defaultTo:"5"},{key:"ortaokul",label:"Ortaokul",defaultFrom:"6",defaultTo:"9"},{key:"lise",label:"Lise",defaultFrom:"10",defaultTo:"12"}];function t(e){const i=String(e||"").trim().toUpperCase();if("KG"===i)return"KG";if(!/^\d{1,2}$/.test(i))return null;const l=Number(i);return!Number.isFinite(l)||l<1||l>12?null:String(l)}function s(e){const i=t(e);return i?n.indexOf(i):-1}function o(){return a.map(e=>(0,r.A)({},e))}function c(){const e={};return a.forEach(i=>{e[i.key]={enabled:!0,from:i.defaultFrom,to:i.defaultTo}}),e}function d(e){const i=e&&"object"===typeof e?e:{},l={};return a.forEach(e=>{const n=i[e.key]&&"object"===typeof i[e.key]?i[e.key]:{},a=!1!==n.enabled,o=function(e,i,l){var r,n;const a=null!==(r=t(e))&&void 0!==r?r:l.defaultFrom,o=null!==(n=t(i))&&void 0!==n?n:l.defaultTo,c=s(a),d=s(o);return c<0||d<0?{from:l.defaultFrom,to:l.defaultTo}:c<=d?{from:a,to:o}:{from:o,to:a}}(n.from,n.to,e);l[e.key]=(0,r.A)({enabled:a},o)}),l}function u(e,i,l){const r=function(e,i){if(!a.find(e=>e.key===i))return"";const l=d(e)[i];return null!==l&&void 0!==l&&l.enabled?l.from===l.to?l.from:"".concat(l.from,"-").concat(l.to):""}(i,l);return r?"".concat(e," (").concat(r,")"):e}function m(e,i){const l=s(e);if(l<0)return null;const r=d(i);for(const n of a){const e=r[n.key];if(null===e||void 0===e||!e.enabled)continue;const i=s(e.from),a=s(e.to);if(i<=l&&l<=a)return n.key}return null}function y(e,i){const l=Array.isArray(e)?e:[],r={okulOncesi:0,ilkokul:0,ortaokul:0,lise:0,total:0};for(const n of l){const e=Number((null===n||void 0===n?void 0:n.studentsPerBranch)||0);if(!Number.isFinite(e))continue;r.total+=e;const l=m(null===n||void 0===n?void 0:n.grade,i);l&&Object.prototype.hasOwnProperty.call(r,l)&&(r[l]+=e)}return r}function p(){return n.map(e=>e)}},7452(e,i,l){l.d(i,{A:()=>a});l(5043);var r=l(4405),n=l(579);function a(e){let{value:i=0,label:l="",tooltipLines:a}=e;const t=Number(i),s=Number.isFinite(t)?Math.max(0,Math.min(100,t)):0,o=function(e){return e?Array.isArray(e)?e.map(e=>String(e)):"string"===typeof e?e.split("\n"):[]:[]}(a).filter(e=>String(e).trim().length>0),c=(0,n.jsx)("div",{className:"progress-track",children:(0,n.jsx)("div",{className:"progress-bar",role:"progressbar","aria-valuenow":s,"aria-valuemin":0,"aria-valuemax":100,children:(0,n.jsx)("div",{className:"progress-bar-fill",style:{width:"".concat(s,"%")}})})});return(0,n.jsxs)("div",{className:"progress-row",children:[l?(0,n.jsx)("div",{className:"progress-label",children:l}):null,o.length?(0,n.jsx)(r.A,{lines:o,className:"progress-tooltip",children:c}):c,(0,n.jsxs)("div",{className:"progress-value",children:[Math.round(s),"%"]})]})}},9100(e,i,l){l.r(i),l.d(i,{default:()=>P});var r=l(2555),n=l(5043),a=l(5685),t=l(2115),s=l(3204),o=l(7559),c=l(3182),d=l(7452),u=l(579);const m=[{key:"ulkeTemsilciligi",label:"\xdclke Temsilciligi Giderleri"},{key:"genelYonetim",label:"Genel Y\xf6netim Giderleri"},{key:"kira",label:"Isletme Giderleri (Kira)"},{key:"emsalKira",label:"Isletme Giderleri (Emsal Kira)"},{key:"enerjiKantin",label:"Isletme Giderleri (Elektrik, Su, vb.)"},{key:"turkPersonelMaas",label:"Yurt disi T\xdcRK Personel Maas Giderleri"},{key:"turkDestekPersonelMaas",label:"Yurt disi T\xdcRK DESTEK Personel Maas Giderleri"},{key:"yerelPersonelMaas",label:"Yurt disi YEREL Personel Maas Giderleri"},{key:"yerelDestekPersonelMaas",label:"Yurt disi YEREL DESTEK Personel Maas Giderleri"},{key:"internationalPersonelMaas",label:"Yurt disi INTERNATIONAL Personel Maas Giderleri"},{key:"disaridanHizmet",label:"Disaridan Saglanan Mal ve Hizmet Alimlari"},{key:"egitimAracGerec",label:"Egitim Ara\xe7 ve Gere\xe7leri"},{key:"finansalGiderler",label:"Finansal Giderler"},{key:"egitimAmacliHizmet",label:"Egitim Ama\xe7li Hizmet Alimlari"},{key:"temsilAgirlama",label:"Temsil ve Agirlama"},{key:"ulkeIciUlasim",label:"\xdclke I\xe7i Ulasim ve Konaklama"},{key:"ulkeDisiUlasim",label:"\xdclke Disi Ulasim ve Konaklama"},{key:"vergilerResmiIslemler",label:"Vergiler Resmi Islemler"},{key:"vergiler",label:"Vergiler"},{key:"demirbasYatirim",label:"Demirbas ve Yatirimlar"},{key:"rutinBakim",label:"Rutin Bakim ve Onarim"},{key:"pazarlamaOrganizasyon",label:"Pazarlama Organizasyon"},{key:"reklamTanitim",label:"Reklam ve Tanitim"},{key:"tahsilEdilemeyenGelirler",label:"Tahsil Edilemeyen Gelirler"},{key:"yemek",label:"Yemek"},{key:"uniforma",label:"\xdcniforma"},{key:"kitapKirtasiye",label:"Kitap-K\u0131rtasiye"},{key:"ulasimServis",label:"Servis / Ula\u015f\u0131m"},{key:"yurtGiderleri",label:"Yurt Giderleri (Kampus giderleri i\xe7inde g\xf6sterilmeyecek)"},{key:"digerYurt",label:"Di\u011fer (Yaz okulu giderleri vb.)"},{key:"discountsTotal",label:"Burs ve \u0130ndirimler (Toplam)"}],y=m.map(e=>e.key),p=new Map(m.map(e=>[e.key,e])),g=new Map(m.map(e=>[e.key,e.label])),h=[{id:"isletme",label:"\u0130\u015fletme Giderleri",groups:[{label:"\u0130\u015fletme Giderleri",keys:["ulkeTemsilciligi","genelYonetim","temsilAgirlama","ulkeIciUlasim","ulkeDisiUlasim","vergilerResmiIslemler","vergiler","demirbasYatirim","rutinBakim","pazarlamaOrganizasyon","reklamTanitim","tahsilEdilemeyenGelirler"]},{label:"E\u011fitim Maliyetleri",keys:["kira","emsalKira","enerjiKantin","turkPersonelMaas","turkDestekPersonelMaas","yerelPersonelMaas","yerelDestekPersonelMaas","internationalPersonelMaas","disaridanHizmet","egitimAracGerec","finansalGiderler","egitimAmacliHizmet"]}]},{id:"ogrenimDisi",label:"\xd6\u011frenim D\u0131\u015f\u0131 Hizmetler",keys:["yemek","uniforma","kitapKirtasiye","ulasimServis"]},{id:"yurtKonaklama",label:"Yurt / Konaklama",keys:["yurtGiderleri","digerYurt"]},{id:"bursIndirim",label:"Burs ve \u0130ndirimler",keys:["discountsTotal"]}].map(e=>{if(Array.isArray(e.groups)){const i=e.groups.filter(e=>e.keys.length),l=i.flatMap(e=>e.keys);return(0,r.A)((0,r.A)({},e),{},{groups:i,keys:l})}return(0,r.A)((0,r.A)({},e),{},{keys:e.keys})}).filter(e=>e.keys.length),b=function(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return Number.isFinite(Number(e))?Number(e).toLocaleString(void 0,{maximumFractionDigits:i}):"-"};function v(e){let{open:i,onClose:l,sourceScenario:r,sourceSchoolId:a}=e;const[s,c]=(0,n.useState)([]),[d,m]=(0,n.useState)(!1),[v,f]=(0,n.useState)(""),[x,k]=(0,n.useState)(new Set),[j,N]=(0,n.useState)("students"),[S,C]=(0,n.useState)("y1"),[A,w]=(0,n.useState)(new Set),[L,T]=(0,n.useState)(null),[O,B]=(0,n.useState)(!1),[I,_]=(0,n.useState)(!1),z={fontSize:12,height:30,padding:"4px 8px",lineHeight:"20px",boxSizing:"border-box"},Y=(0,n.useMemo)(()=>Array.from(x).sort().join(","),[x]),D=(0,n.useMemo)(()=>Array.from(A).sort().join(","),[A]);(0,n.useEffect)(()=>{i&&(f(""),k(new Set),w(new Set),N("students"),C("y1"),T(null))},[i,null===r||void 0===r?void 0:r.id]),(0,n.useEffect)(()=>{T(null)},[j,S,Y,D]),(0,n.useEffect)(()=>{let e=!0;return async function(){if(i&&null!==r&&void 0!==r&&r.academic_year){m(!0);try{const i=await o.FH.expenseSplitTargets(r.academic_year);if(!e)return;const l=(Array.isArray(i)?i:[]).filter(e=>String(e.scenarioId)!==String(null===r||void 0===r?void 0:r.id));c(l)}catch(l){e&&t.oR.error(l.message||"Hedef senaryolar alinamadi")}finally{e&&m(!1)}}}(),()=>{e=!1}},[i,null===r||void 0===r?void 0:r.academic_year,null===r||void 0===r?void 0:r.id]);const F=(0,n.useMemo)(()=>{const e=v.trim().toLowerCase();return e?s.filter(i=>{const l=String((null===i||void 0===i?void 0:i.schoolName)||"").toLowerCase(),r=String((null===i||void 0===i?void 0:i.scenarioName)||"").toLowerCase();return l.includes(e)||r.includes(e)}):s},[s,v]),E=e=>{w(i=>{const l=new Set(i);return l.has(e)?l.delete(e):l.add(e),l})},K=(e,i)=>{Array.isArray(e)&&e.length&&w(l=>{const r=new Set(l);return e.forEach(e=>{i?r.add(e):r.delete(e)}),r})},M=(0,n.useMemo)(()=>Array.isArray(null===L||void 0===L?void 0:L.targets)?L.targets:[],[L]),U=(0,n.useMemo)(()=>Array.isArray(null===L||void 0===L?void 0:L.pools)?L.pools:[],[L]),P=(0,n.useMemo)(()=>Array.isArray(null===L||void 0===L?void 0:L.allocations)?L.allocations:[],[L]),H=(0,n.useMemo)(()=>Array.isArray(null===L||void 0===L?void 0:L.warnings)?L.warnings:[],[L]),R=(0,n.useMemo)(()=>{const e=new Map;return M.forEach(i=>e.set(String(i.targetScenarioId),i)),e},[M]),G=(0,n.useMemo)(()=>P.map(e=>{const i=R.get(String(e.targetScenarioId));return{targetLabel:i?"".concat(i.schoolName||""," \u2022 ").concat(i.scenarioName||""):String(e.targetScenarioId),expenseLabel:g.get(e.expenseKey)||e.expenseKey,amount:e.allocatedAmount}}),[P,R]),W=y.length,$=A.size,V=W>0&&$===W,Z=$>0&&!V,q=!x.size||!A.size||O||I,J=h.find(e=>"isletme"===e.id)||null,X=h.filter(e=>"isletme"!==e.id),Q=e=>{if(!e)return null;const i=e.keys.length,l=e.keys.reduce((e,i)=>e+(A.has(i)?1:0),0),r=i>0&&l===i,n=l>0&&!r;return(0,u.jsxs)("div",{className:"card",style:{padding:"10px 12px",background:"#f8fafc"},children:[(0,u.jsxs)("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center"},children:[(0,u.jsxs)("label",{className:"row small",style:{gap:6,alignItems:"center",fontWeight:700},children:[(0,u.jsx)("input",{type:"checkbox",checked:r,ref:e=>{e&&(e.indeterminate=n)},onChange:i=>K(e.keys,i.target.checked)}),(0,u.jsx)("span",{children:e.label})]}),(0,u.jsxs)("div",{className:"row",style:{gap:6},children:[(0,u.jsx)("button",{className:"btn",type:"button",style:{padding:"4px 10px"},onClick:()=>K(e.keys,!0),disabled:!i,children:"Sec"}),(0,u.jsx)("button",{className:"btn",type:"button",style:{padding:"4px 10px"},onClick:()=>K(e.keys,!1),disabled:!l,children:"Temizle"})]})]}),(0,u.jsxs)("div",{className:"small muted",style:{marginTop:4},children:["Secili: ",l,"/",i]}),Array.isArray(e.groups)?(0,u.jsx)("div",{style:{marginTop:8},children:e.groups.map(e=>(0,u.jsxs)("div",{style:{marginTop:8},children:[(0,u.jsx)("div",{className:"small",style:{fontWeight:700,marginBottom:6},children:e.label}),(0,u.jsx)("div",{className:"grid2",style:{gap:8},children:e.keys.map(e=>{const i=p.get(e),l=(null===i||void 0===i?void 0:i.label)||e;return(0,u.jsxs)("label",{className:"row",style:{gap:6,alignItems:"center"},children:[(0,u.jsx)("input",{type:"checkbox",checked:A.has(e),onChange:()=>E(e)}),(0,u.jsx)("span",{className:"small",children:l})]},e)})})]},e.label))}):(0,u.jsx)("div",{className:"grid2",style:{gap:8,marginTop:8},children:e.keys.map(e=>{const i=p.get(e),l=(null===i||void 0===i?void 0:i.label)||e;return(0,u.jsxs)("label",{className:"row",style:{gap:6,alignItems:"center"},children:[(0,u.jsx)("input",{type:"checkbox",checked:A.has(e),onChange:()=>E(e)}),(0,u.jsx)("span",{className:"small",children:l})]},e)})})]},e.id)};return i?(0,u.jsx)("div",{className:"modal-backdrop",role:"dialog","aria-modal":"true",onClick:l,children:(0,u.jsxs)("div",{className:"modal",style:{width:"min(980px, 96vw)",maxHeight:"86vh",overflowY:"auto",position:"relative"},onClick:e=>e.stopPropagation(),children:[(0,u.jsx)("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center"},children:(0,u.jsx)("button",{className:"btn",onClick:l,disabled:I||O,style:{position:"absolute",top:10,right:10,background:"#111827",borderColor:"#111827",color:"#fff"},children:"Kapat"})}),r?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("div",{style:{marginTop:2},children:(0,u.jsxs)("div",{className:"row",style:{gap:12,alignItems:"flex-end",flexWrap:"wrap"},children:[(0,u.jsxs)("div",{style:{minWidth:170},children:[(0,u.jsx)("div",{className:"small",style:{fontWeight:700,marginBottom:6},children:"Basis"}),(0,u.jsxs)("select",{className:"input sm",style:z,value:j,onChange:e=>N(e.target.value),children:[(0,u.jsx)("option",{value:"students",children:"Students"}),(0,u.jsx)("option",{value:"revenue",children:"Revenue"})]})]}),(0,u.jsxs)("div",{style:{minWidth:160},children:[(0,u.jsx)("div",{className:"small",style:{fontWeight:700,marginBottom:6},children:"Basis Yil"}),(0,u.jsxs)("select",{className:"input sm",style:z,value:S,onChange:e=>C(e.target.value),children:[(0,u.jsx)("option",{value:"y1",children:"Y1"}),(0,u.jsx)("option",{value:"y2",children:"Y2"}),(0,u.jsx)("option",{value:"y3",children:"Y3"})]})]}),(0,u.jsxs)("div",{style:{flex:"1 1 220px"},children:[(0,u.jsx)("div",{className:"small",style:{fontWeight:700,marginBottom:6},children:"Hedef Ara"}),(0,u.jsx)("input",{className:"input sm",style:z,placeholder:"Okul veya senaryo ara",value:v,onChange:e=>f(e.target.value)})]})]})}),(0,u.jsxs)("div",{style:{marginTop:5},children:[(0,u.jsx)("div",{className:"small",style:{fontWeight:700,marginBottom:6},children:"Hedef Senaryolar"}),d?(0,u.jsx)("div",{className:"small",children:"Y\xfckleniyor..."}):(0,u.jsx)("div",{className:"table-scroll",style:{maxHeight:260},children:(0,u.jsxs)("table",{className:"table",style:{fontSize:12},children:[(0,u.jsx)("thead",{children:(0,u.jsxs)("tr",{children:[(0,u.jsx)("th",{style:{width:40}}),(0,u.jsx)("th",{style:{fontSize:12,padding:"6px 8px"},children:"Okul"}),(0,u.jsx)("th",{style:{fontSize:12,padding:"6px 8px"},children:"Senaryo"}),(0,u.jsx)("th",{style:{fontSize:12,padding:"6px 8px"},children:"Yil"}),(0,u.jsx)("th",{style:{fontSize:12,padding:"6px 8px"},children:"Para Birimi"})]})}),(0,u.jsx)("tbody",{children:0===F.length?(0,u.jsx)("tr",{children:(0,u.jsx)("td",{colSpan:"5",className:"small",style:{padding:"6px 8px"},children:"Hedef bulunamadi."})}):F.map(e=>{const i=String(e.scenarioId),l=x.has(i),r="LOCAL"===String(e.input_currency||"USD")?"".concat(e.input_currency,"/").concat(e.local_currency_code||"LOCAL"):e.input_currency||"USD";return(0,u.jsxs)("tr",{children:[(0,u.jsx)("td",{style:{padding:"6px 8px"},children:(0,u.jsx)("input",{type:"checkbox",checked:l,onChange:()=>(e=>{k(i=>{const l=new Set(i),r=String(e);return l.has(r)?l.delete(r):l.add(r),l})})(i)})}),(0,u.jsx)("td",{style:{padding:"6px 8px"},children:e.schoolName}),(0,u.jsx)("td",{style:{padding:"6px 8px"},children:e.scenarioName}),(0,u.jsx)("td",{style:{padding:"6px 8px"},children:e.academic_year}),(0,u.jsx)("td",{style:{padding:"6px 8px"},children:r})]},e.scenarioId)})})]})})]}),(0,u.jsxs)("div",{style:{marginTop:16},children:[(0,u.jsxs)("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center"},children:[(0,u.jsx)("div",{className:"small",style:{fontWeight:700},children:"Gider Kalemleri"}),(0,u.jsxs)("div",{className:"row",style:{gap:6},children:[(0,u.jsx)("button",{className:"btn",type:"button",style:{padding:"4px 10px"},onClick:()=>K(y,!0),disabled:!W,children:"Tumunu Sec"}),(0,u.jsx)("button",{className:"btn",type:"button",style:{padding:"4px 10px"},onClick:()=>K(y,!1),disabled:!$,children:"Temizle"})]})]}),(0,u.jsx)("div",{className:"row",style:{gap:10,alignItems:"center",marginTop:8},children:(0,u.jsxs)("label",{className:"row small",style:{gap:6,alignItems:"center"},children:[(0,u.jsx)("input",{type:"checkbox",checked:V,ref:e=>{e&&(e.indeterminate=Z)},onChange:e=>K(y,e.target.checked)}),(0,u.jsxs)("span",{children:["Toplam Secili: ",$,"/",W]})]})}),(0,u.jsxs)("div",{className:"row",style:{alignItems:"flex-start",gap:12,marginTop:10},children:[(0,u.jsx)("div",{style:{flex:"1 1 0",minWidth:320},children:Q(J)}),(0,u.jsx)("div",{style:{flex:"1 1 0",minWidth:320,display:"grid",gap:12},children:X.map(e=>Q(e))})]})]}),(0,u.jsxs)("div",{className:"row",style:{justifyContent:"flex-end",marginTop:16,gap:8},children:[(0,u.jsx)("button",{className:"btn",onClick:async()=>{if(null===r||void 0===r||!r.id||!a)return;const e={targetScenarioIds:Array.from(x).map(e=>Number(e)),basis:j,basisYearKey:S,expenseKeys:Array.from(A)};B(!0);try{const i=await o.FH.previewExpenseSplit(a,r.id,e);T(i||null)}catch(i){t.oR.error(i.message||"\xd6nizleme alinamadi")}finally{B(!1)}},disabled:q,children:O?"\xd6nizleme...":"\xd6nizle"}),(0,u.jsx)("button",{className:"btn primary",onClick:async()=>{if(null===r||void 0===r||!r.id||!a)return;const e={targetScenarioIds:Array.from(x).map(e=>Number(e)),basis:j,basisYearKey:S,expenseKeys:Array.from(A)};_(!0);try{await o.FH.applyExpenseSplit(a,r.id,e),t.oR.success("Gider dagitimi kaydedildi."),null===l||void 0===l||l()}catch(i){t.oR.error(i.message||"Dagitim uygulanamadi")}finally{_(!1)}},disabled:I||O||!x.size||!A.size,children:I?"Uygulaniyor...":"Uygula"})]}),H.length>0?(0,u.jsxs)("div",{className:"card",style:{marginTop:12,background:"#fff7ed",borderColor:"#fed7aa"},children:[(0,u.jsx)("div",{style:{fontWeight:700,marginBottom:6},children:"Uyarilar"}),H.map((e,i)=>(0,u.jsxs)("div",{className:"small",children:["\u2022 ",e]},i))]}):null,L?(0,u.jsxs)("div",{style:{marginTop:16},children:[U.length>0?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("div",{className:"small",style:{fontWeight:700,marginBottom:6},children:"Havuz Tutarlari"}),(0,u.jsx)("div",{className:"table-scroll",children:(0,u.jsxs)("table",{className:"table",children:[(0,u.jsx)("thead",{children:(0,u.jsxs)("tr",{children:[(0,u.jsx)("th",{children:"Gider"}),(0,u.jsx)("th",{children:"Havuz Tutari"})]})}),(0,u.jsx)("tbody",{children:U.map(e=>(0,u.jsxs)("tr",{children:[(0,u.jsx)("td",{children:g.get(e.expenseKey)||e.expenseKey}),(0,u.jsx)("td",{children:b(e.poolAmount)})]},e.expenseKey))})]})})]}):null,M.length>0?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("div",{className:"small",style:{fontWeight:700,margin:"12px 0 6px"},children:"Agirliklar"}),(0,u.jsx)("div",{className:"table-scroll",children:(0,u.jsxs)("table",{className:"table",children:[(0,u.jsx)("thead",{children:(0,u.jsxs)("tr",{children:[(0,u.jsx)("th",{children:"Okul"}),(0,u.jsx)("th",{children:"Senaryo"}),(0,u.jsx)("th",{children:"Basis"}),(0,u.jsx)("th",{children:"Agirlik"})]})}),(0,u.jsx)("tbody",{children:M.map(e=>{return(0,u.jsxs)("tr",{children:[(0,u.jsx)("td",{children:e.schoolName}),(0,u.jsx)("td",{children:e.scenarioName}),(0,u.jsx)("td",{children:b(e.basisValue)}),(0,u.jsx)("td",{children:(i=e.weight,Number.isFinite(Number(i))?"".concat((100*Number(i)).toFixed(2),"%"):"-")})]},e.targetScenarioId);var i})})]})})]}):null,G.length>0?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("div",{className:"small",style:{fontWeight:700,margin:"12px 0 6px"},children:"Dagitimlar"}),(0,u.jsx)("div",{className:"table-scroll",children:(0,u.jsxs)("table",{className:"table",children:[(0,u.jsx)("thead",{children:(0,u.jsxs)("tr",{children:[(0,u.jsx)("th",{children:"Hedef"}),(0,u.jsx)("th",{children:"Gider"}),(0,u.jsx)("th",{children:"Tutar"})]})}),(0,u.jsx)("tbody",{children:G.map((e,i)=>(0,u.jsxs)("tr",{children:[(0,u.jsx)("td",{children:e.targetLabel}),(0,u.jsx)("td",{children:e.expenseLabel}),(0,u.jsx)("td",{children:b(e.amount)})]},"".concat(e.targetLabel,"-").concat(e.expenseLabel,"-").concat(i)))})]})})]}):null]}):null]}):(0,u.jsx)("div",{className:"small",style:{marginTop:10},children:"Kaynak senaryo se\xe7ilmedi."})]})}):null}var f=l(6037),x=l(9322),k=l(5534),j=l(1298);const N=[{key:"temel",label:"Temel Bilgiler",sections:[{id:"temel.core",label:"Kademeler + Program"},{id:"temel.pricing",label:"Enflasyon + Ucret Artis Oranlari + Ucret Hesaplama Ayari"},{id:"temel.schoolInfo",label:"Yetkililer + Okul/Egitim Bilgileri"},{id:"temel.discountsMeta",label:"IK Mevcut + Burs/Indirim Ogrenci Sayilari"},{id:"temel.competitors",label:"Rakip Analizi"},{id:"temel.performance",label:"Performans + Degerlendirme"}]},{key:"kapasite",label:"Kapasite",sections:[{id:"kapasite.all",label:"Kapasite (tumu)"}]},{key:"norm",label:"Norm",sections:[{id:"norm.planned",label:"Planlanan donem bilgileri"},{id:"norm.current",label:"Mevcut donem bilgileri"},{id:"norm.lessonY1",label:"Ders dagilimi (yalnizca Y1)"}]},{key:"hr",label:"IK (HR)",sections:[{id:"hr.ik",label:"IK Plan (tumu)"}]},{key:"gelirler",label:"Gelirler",sections:[{id:"income.gelirler",label:"Gelirler (tumu)"}]},{key:"giderler",label:"Giderler",sections:[{id:"expenses.giderler",label:"Giderler (tumu)"},{id:"expenses.discounts",label:"BURS VE INDIRIMLER / YIL"}]}],S={"temel.core":["page.temel_bilgiler"],"temel.pricing":["section.temel_bilgiler.inflation"],"temel.schoolInfo":["page.temel_bilgiler"],"temel.discountsMeta":["section.temel_bilgiler.ik_mevcut","section.temel_bilgiler.burs_ogr"],"temel.competitors":["section.temel_bilgiler.rakip"],"temel.performance":["section.temel_bilgiler.performans"],"kapasite.all":["section.kapasite.caps"],"norm.planned":["page.norm"],"norm.current":["page.norm"],"norm.lessonY1":["section.norm.ders_dagilimi"],"hr.ik":["section.ik.local_staff"],"income.gelirler":["section.gelirler.unit_fee"],"expenses.giderler":["section.giderler.isletme"],"expenses.discounts":["section.discounts.discounts"]};function C(e){const i=String((null===e||void 0===e?void 0:e.status)||"draft"),l=null!=(null===e||void 0===e?void 0:e.submitted_at),r=null!=(null===e||void 0===e?void 0:e.sent_at);return"sent_for_approval"===i||"submitted"===i||"approved"===i&&r||"in_review"===i&&l}const A="2026",w="2027",L=/^[A-Z0-9]{2,10}$/,T=["USD","EUR","TRY","GBP","JPY","CNY","INR","RUB","AED","SAR","AFN"];function O(e){const i=String(e||"").trim();return/^\d{4}$/.test(i)?Number(i):null}function B(e){const i=String(e||"").trim(),l=i.match(/^(\d{4})$/);if(l){const e=Number(l[1]);return Number.isFinite(e)?String(e+1):""}const r=i.match(/^(\d{4})\s*-\s*(\d{4})$/);if(r){const e=Number(r[1]),i=Number(r[2]);if(Number.isFinite(e)&&Number.isFinite(i))return"".concat(e+1,"-").concat(i+1)}return""}function I(){return N.flatMap(e=>e.sections.map(e=>e.id))}function _(e){const i=(0,r.A)({},e||{}),l=!!i["hr.ik"],n=!!i["expenses.giderler"];if(l!==n){const e=l||n;i["hr.ik"]=e,i["expenses.giderler"]=e}return i}function z(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"all";const i=I(),l=Object.fromEntries(i.map(e=>[e,!1]));return"all"===e?i.forEach(e=>{l[e]=!0}):"structure"===e?["temel.core","kapasite.all","norm.planned","norm.lessonY1"].forEach(e=>{l[e]=!0}):"financial"===e&&["temel.core","income.gelirler","expenses.discounts","hr.ik","expenses.giderler"].forEach(e=>{l[e]=!0}),_(l)}function Y(){const e={};return(0,f.oP)().forEach(i=>{e[i]={}}),e}function D(e){return{teacherWeeklyMaxHours:Number.isFinite(e)&&e>0?e:24,curriculumWeeklyHours:Y()}}function F(e,i){var l;const r=Number(i);if(!Number.isFinite(r)||r<=0)return e;const n=e=>{const i=Number(e);return Number.isFinite(i)?Math.round(i*r*100)/100:e};if(null!==e&&void 0!==e&&e.gelirler){var a,t,s,o;const i=e.gelirler,l=e=>{Array.isArray(e)&&e.forEach(e=>{e&&"object"===typeof e&&("unitFee"in e&&(e.unitFee=n(e.unitFee)),"amount"in e&&(e.amount=n(e.amount)))})};l(null===i||void 0===i||null===(a=i.tuition)||void 0===a?void 0:a.rows),l(null===i||void 0===i||null===(t=i.nonEducationFees)||void 0===t?void 0:t.rows),l(null===i||void 0===i||null===(s=i.dormitory)||void 0===s?void 0:s.rows),l(null===i||void 0===i||null===(o=i.otherInstitutionIncome)||void 0===o?void 0:o.rows),null!=(null===i||void 0===i?void 0:i.governmentIncentives)&&(i.governmentIncentives=n(i.governmentIncentives))}null!==e&&void 0!==e&&e.giderler&&"object"===typeof e.giderler&&Object.values(e.giderler).forEach(e=>{e&&"object"===typeof e&&e.items&&"object"===typeof e.items&&Object.keys(e.items).forEach(i=>{e.items[i]=n(e.items[i])})}),null!==e&&void 0!==e&&null!==(l=e.ik)&&void 0!==l&&l.years&&"object"===typeof e.ik.years&&Object.values(e.ik.years).forEach(e=>{e&&"object"===typeof e&&e.unitCosts&&"object"===typeof e.unitCosts&&Object.keys(e.unitCosts).forEach(i=>{e.unitCosts[i]=n(e.unitCosts[i])})}),Array.isArray(null===e||void 0===e?void 0:e.discounts)&&e.discounts.forEach(e=>{e&&"object"===typeof e&&"amount"===String(e.mode||"").toLowerCase()&&(e.value=n(e.value))});const c=null===e||void 0===e?void 0:e.temelBilgiler;var d,u;c&&(null!=(null===c||void 0===c||null===(d=c.inflation)||void 0===d?void 0:d.currentSeasonAvgFee)&&(c.inflation.currentSeasonAvgFee=n(c.inflation.currentSeasonAvgFee)),null!==c&&void 0!==c&&c.rakipAnalizi&&"object"===typeof c.rakipAnalizi&&Object.values(c.rakipAnalizi).forEach(e=>{e&&"object"===typeof e&&["a","b","c"].forEach(i=>{i in e&&(e[i]=n(e[i]))})}),null!==c&&void 0!==c&&null!==(u=c.performans)&&void 0!==u&&u.gerceklesen&&"object"===typeof c.performans.gerceklesen&&Object.keys(c.performans.gerceklesen).forEach(e=>{c.performans.gerceklesen[e]=n(c.performans.gerceklesen[e])}));return e}function E(e){let{size:i=12}=e;return(0,u.jsx)("span",{"aria-hidden":!0,style:{width:i,height:i,borderRadius:"50%",border:"2px solid rgba(0,0,0,0.18)",borderTopColor:"rgba(0,0,0,0.65)",display:"inline-block",animation:"schoolSpin .8s linear infinite"}})}function K(e){var i,l,n;const a=e=>{const i=Number(e);return Number.isFinite(i)?i:0},t=e||{},s=a(t.schoolCapacity),o=t.kapasite&&"object"===typeof t.kapasite?t.kapasite:{},c=o.years&&"object"===typeof o.years?o.years:{},d=a(null!=c.y1?c.y1:s),u=a(null!=c.y2?c.y2:d),m=a(null!=c.y3?c.y3:d),y=a(o.currentStudents),p=o.byKademe&&"object"===typeof o.byKademe?o.byKademe:{};if(!("schoolCapacity"in t||!t.kapasite||"object"!==typeof t.kapasite||!o.years||"object"!==typeof o.years||a(null===o||void 0===o||null===(i=o.years)||void 0===i?void 0:i.y1)!==d||a(null===o||void 0===o||null===(l=o.years)||void 0===l?void 0:l.y2)!==u||a(null===o||void 0===o||null===(n=o.years)||void 0===n?void 0:n.y3)!==m||a(null===o||void 0===o?void 0:o.currentStudents)!==y||!o.byKademe||"object"!==typeof o.byKademe))return t;const g=structuredClone(t);return g.kapasite=(0,r.A)((0,r.A)({},o||{}),{},{currentStudents:y,years:{y1:d,y2:u,y3:m},byKademe:p}),"schoolCapacity"in g&&delete g.schoolCapacity,g}function M(e){const i=e||{},l=i.temelBilgiler&&"object"===typeof i.temelBilgiler?i.temelBilgiler:{},n=structuredClone(i),a=l.inflation&&"object"===typeof l.inflation?l.inflation:{},t=e=>Number.isFinite(Number(e))?Number(e):0;return n.temelBilgiler={inflation:(0,r.A)((0,r.A)({},a),{},{expenseDeviationPct:t(a.expenseDeviationPct),y2023:t(a.y2023),y2024:t(a.y2024),y2025:t(a.y2025),y1:t(a.y1),y2:t(a.y2),y3:t(a.y3),currentSeasonAvgFee:t(a.currentSeasonAvgFee)}),yetkililer:l.yetkililer||{mudur:"",ulkeTemsilcisi:"",raporuHazirlayan:""},okulEgitimBilgileri:l.okulEgitimBilgileri||{egitimBaslamaTarihi:"",zorunluEgitimDonemleri:"",birDersSuresiDakika:0,gunlukDersSaati:0,haftalikDersSaatiToplam:0,sabahciOglenci:"",ogretmenHaftalikDersOrt:0,gecisSinaviBilgisi:"",uygulananProgram:""},kademeler:(0,f.Ds)(l.kademeler),programType:(0,x.wN)(l.programType),okulUcretleriHesaplama:"boolean"!==typeof l.okulUcretleriHesaplama||l.okulUcretleriHesaplama,ucretArtisOranlari:l.ucretArtisOranlari||{okulOncesi:0,ilkokulYerel:0,ilkokulInt:0,ortaokulYerel:0,ortaokulInt:0,liseYerel:0,liseInt:0},ikMevcut:l.ikMevcut||{turkPersonelYoneticiEgitimci:0,turkPersonelTemsilcilik:0,yerelKadroluEgitimci:0,yerelUcretliVakaterEgitimci:0,yerelDestek:0,yerelTemsilcilik:0,international:0},bursIndirimOgrenciSayilari:l.bursIndirimOgrenciSayilari||{magisBasariBursu:0,maarifYetenekBursu:0,ihtiyacBursu:0,okulBasariBursu:0,tamEgitimBursu:0,barinmaBursu:0,turkceBasariBursu:0,uluslararasiYukumlulukIndirimi:0,vakifCalisaniIndirimi:0,kardesIndirimi:0,erkenKayitIndirimi:0,pesinOdemeIndirimi:0,kademeGecisIndirimi:0,temsilIndirimi:0,kurumIndirimi:0,istisnaiIndirim:0,yerelMevzuatIndirimi:0},rakipAnalizi:l.rakipAnalizi||{okulOncesi:{a:0,b:0,c:0},ilkokul:{a:0,b:0,c:0},ortaokul:{a:0,b:0,c:0},lise:{a:0,b:0,c:0}},performans:l.performans||{gerceklesen:{ogrenciSayisi:0,gelirler:0,giderler:0,karZarar:0,bursVeIndirimler:0}},degerlendirme:"string"===typeof l.degerlendirme?l.degerlendirme:""},n}function U(e){const i=e||{},l=(0,f.oP)().map(e=>({grade:e,branchCount:0,studentsPerBranch:0})),r=Array.isArray(i.grades)?i.grades:l,n=i.gradesYears&&"object"===typeof i.gradesYears?i.gradesYears:{},a=Array.isArray(n.y1)?n.y1:r,t=Array.isArray(n.y2)?n.y2:a,s=Array.isArray(n.y3)?n.y3:a,o=e=>{const i=new Map;return(Array.isArray(e)?e:[]).forEach(e=>{const l=(e=>{var i,l,r;return{grade:String(null!==(i=null===e||void 0===e?void 0:e.grade)&&void 0!==i?i:""),branchCount:Number(null!==(l=null===e||void 0===e?void 0:e.branchCount)&&void 0!==l?l:0),studentsPerBranch:Number(null!==(r=null===e||void 0===e?void 0:e.studentsPerBranch)&&void 0!==r?r:0)}})(e);l.grade&&i.set(l.grade,l)}),i};if(!(!i.gradesYears||!Array.isArray(i.grades)||!Array.isArray(n.y1)||!Array.isArray(n.y2)||!Array.isArray(n.y3)||!((e,i)=>{if(!Array.isArray(e)||!Array.isArray(i))return!1;if(e.length!==i.length)return!1;const l=o(e),r=o(i);if(l.size!==r.size)return!1;for(const[n,a]of l.entries()){const e=r.get(n);if(!e)return!1;if(Number(a.branchCount)!==Number(e.branchCount))return!1;if(Number(a.studentsPerBranch)!==Number(e.studentsPerBranch))return!1}return!0})(i.grades,a)))return i;const c=structuredClone(i);return c.gradesYears={y1:structuredClone(a),y2:structuredClone(t),y3:structuredClone(s)},c.grades=structuredClone(c.gradesYears.y1),c}function P(){var e,i,l,m,y,p;const g=(0,a.Zp)(),h=(0,a.KC)(),[b,P]=(0,a.ok)(),H=(0,c.A)(),[R,G]=(0,n.useState)([]),[W,$]=(0,n.useState)([]),[V,Z]=(0,n.useState)(null),[q,J]=(0,n.useState)(null),[X,Q]=(0,n.useState)(null),[ee,ie]=(0,n.useState)(null),[le,re]=(0,n.useState)(null),[,ne]=(0,n.useState)(null),[ae,te]=(0,n.useState)(""),[se,oe]=(0,n.useState)(!1),[ce,de]=(0,n.useState)(!1),[ue,me]=(0,n.useState)({}),[ye,pe]=(0,n.useState)(!1),[ge,he]=(0,n.useState)({}),[be,ve]=(0,n.useState)(!1),[fe,xe]=(0,n.useState)(""),[ke,je]=(0,n.useState)("split"),[Ne,Se]=(0,n.useState)(A),[Ce,Ae]=(0,n.useState)(w),[we,Le]=(0,n.useState)((0,f.jc)()),[Te,Oe]=(0,n.useState)(!1),[Be,Ie]=(0,n.useState)("USD"),[_e,ze]=(0,n.useState)(""),[Ye,De]=(0,n.useState)(""),[Fe,Ee]=(0,n.useState)(null),[Ke,Me]=(0,n.useState)(0),[Ue,Pe]=(0,n.useState)(!1),[He,Re]=(0,n.useState)("create"),[Ge,We]=(0,n.useState)(null),[$e,Ve]=(0,n.useState)(!1),[Ze,qe]=(0,n.useState)(!1),[Je,Xe]=(0,n.useState)({key:null,dir:"asc"}),[Qe,ei]=(0,n.useState)(null),[ii,li]=(0,n.useState)(null),[ri,ni]=(0,n.useState)(null),[ai,ti]=(0,n.useState)(null),[si,oi]=(0,n.useState)(!1),[ci,di]=(0,n.useState)(!1),[ui,mi]=(0,n.useState)(""),[yi,pi]=(0,n.useState)(null),[gi,hi]=(0,n.useState)(""),[bi,vi]=(0,n.useState)("USD"),[fi,xi]=(0,n.useState)(""),[ki,ji]=(0,n.useState)(""),[Ni,Si]=(0,n.useState)(""),[Ci,Ai]=(0,n.useState)(!1),wi=(0,n.useRef)(null),Li=(0,n.useRef)(null);(0,n.useEffect)(()=>{if(null!==h&&void 0!==h&&h.setHeaderMeta)return h.setHeaderMeta({title:"Okul & Senaryo Sec",subtitle:"Okul ve senaryoyu secip Uygula'ya basin.",centered:!0}),()=>{var e;null===(e=h.clearHeaderMeta)||void 0===e||e.call(h)}},[h]);const Ti=(0,n.useCallback)(async()=>{te(""),oe(!0);try{const e=await o.FH.listSchools({limit:50,offset:0,fields:"brief",order:"name:asc"});G(Array.isArray(null===e||void 0===e?void 0:e.items)?e.items:[])}catch(e){te(e.message||"Okullar yuklenemedi.")}finally{oe(!1)}},[]);(0,n.useEffect)(()=>{Ti()},[Ti]);const Oi=(0,n.useCallback)(async e=>{if(Array.isArray(e)&&e.length){pe(!0);try{const i=e.map(e=>e.id),l=await o.FH.getSchoolsProgressBulk(i),r=null!==l&&void 0!==l&&l.progressBySchoolId&&"object"===typeof l.progressBySchoolId?l.progressBySchoolId:{};me(r)}catch(i){const l={};e.forEach(e=>{l[e.id]={state:"error",label:"\u0130lerleme hesaplanamad\u0131"}}),me(l)}finally{pe(!1)}}else me({})},[]);(0,n.useEffect)(()=>{if(!R.length)return me({}),void pe(!1);Oi(R)},[R,Oi]),(0,n.useEffect)(()=>{const e=b.get("schoolId"),i=Number(e||0);e&&Number.isFinite(i)&&R.length&&R.some(e=>String(e.id)===String(i))&&J(e=>String(e)===String(i)?e:($([]),Z(null),he({}),ve(!1),i))},[b,R]);const Bi=(0,n.useCallback)(e=>{const i=String(q)!==String(e);i&&(Q(null),ie(null),re(null),ne(null),$([]),Z(null),he({}),ve(!1)),J(e),i&&P(i=>{const l=new URLSearchParams(i);return l.set("schoolId",String(e)),l})},[q,P]),Ii=(0,n.useCallback)(()=>{J(null),Q(null),ie(null),re(null),ne(null),$([]),Z(null),he({}),P(e=>{const i=new URLSearchParams(e);return i.delete("schoolId"),i})},[P]),_i=(0,n.useCallback)(()=>{Q(null),ie(null),re(null),ne(null)},[]);(0,n.useEffect)(()=>{if(!q)return $([]),Z(null),Q(null),ie(null),re(null),ne(null),he({}),ve(!1),void de(!1);Q(null),ie(null),re(null),ne(null),$([]),Z(null),he({}),ve(!1);let e=!0;return te(""),de(!0),async function(){try{const i=await o.FH.listScenarios(q,{limit:50,offset:0,fields:"brief",order:"created_at:desc"});if(!e)return;const l=Array.isArray(null===i||void 0===i?void 0:i.items)?i.items:[];$(l),Z(q),Q(e=>{if(l.some(i=>String(i.id)===String(e)))return e;const i=(0,k.Rj)(q);return null!=i&&l.some(e=>String(e.id)===String(i))?i:null})}catch(i){if(!e)return;te(i.message||"Senaryolar yuklenemedi."),$([])}finally{e&&de(!1)}}(),()=>{e=!1}},[q]),(0,n.useEffect)(()=>{if(!q)return he({}),void ve(!1);if(null!=V&&String(V)!==String(q))return he({}),void ve(!1);if(!W.length)return he({}),void ve(!1);let e=!0;return ve(!0),async function(){try{const i=await Promise.all(W.map(async e=>{try{var i;const l=await o.FH.getScenarioProgress(q,e.id),r=null===l||void 0===l?void 0:l.progress;if(!r)return{id:e.id,error:!0};const n=Array.isArray(r.missingDetailsLines)?r.missingDetailsLines:[],a=n.length?["Eksik:",...n]:["T\xfcm tablolar tamamland\u0131"];return{id:e.id,pct:null!==(i=r.pct)&&void 0!==i?i:0,tooltipLines:a}}catch(l){return{id:e.id,error:!0}}}));if(!e)return;const l={};i.forEach(e=>{l[e.id]=e}),he(l)}finally{e&&ve(!1)}}(),()=>{e=!1}},[q,W,V]),(0,n.useEffect)(()=>{if(!q||!X)return ie(null),re(null),void ne(null);let e=!0;return te(""),async function(){try{const i=await o.FH.getScenarioInputs(q,X);if(!e)return;ie((null===i||void 0===i?void 0:i.scenario)||null);const l=null===i||void 0===i?void 0:i.inputs,r=l&&"object"===typeof l?U(M(K(l))):l;re(r),ne(null)}catch(i){if(!e)return;te(i.message||"Senaryo yuklenemedi.")}}(),()=>{e=!1}},[q,X]);const zi=(0,n.useCallback)(async()=>{if(!q)return null;try{const e=await o.FH.listScenarios(q,{limit:50,offset:0,fields:"brief",order:"created_at:desc"}),i=Array.isArray(null===e||void 0===e?void 0:e.items)?e.items:[];return $(i),Z(q),i}catch(e){return null}},[q]),Yi=(0,n.useMemo)(()=>(0,f.aW)(),[]),Di=(0,n.useMemo)(()=>(0,f.oP)(),[]),Fi=O(Ne),Ei=O(Ce),Ki=function(e,i,l){const r=O(i);if(!r)return"";if("full"===e)return String(r);const n=O(l);return n?"".concat(r,"-").concat(n):""}(ke,Ne,Ce),Mi="full"===ke||null!=Fi&&Ei===Fi+1,Ui=(0,n.useMemo)(()=>{if(!Ki)return!1;const e="edit"===He?Number((null===Ge||void 0===Ge?void 0:Ge.id)||X||0):null;return W.some(i=>String((null===i||void 0===i?void 0:i.academic_year)||"").trim()===String(Ki).trim()&&(null==e||Number(null===i||void 0===i?void 0:i.id)!==e))},[Ki,W,He,null===Ge||void 0===Ge?void 0:Ge.id,X]),Pi=(0,n.useMemo)(()=>(0,f.Ds)(we),[we]),Hi=(0,n.useMemo)(()=>Object.values(Pi).some(e=>e&&e.enabled),[Pi]),Ri=Te||Hi,Gi=String(_e||"").trim().toUpperCase(),Wi="LOCAL"!==Be||L.test(Gi),$i=Number(Ye),Vi="LOCAL"!==Be||Number.isFinite($i)&&$i>0,Zi="USD"===Be||Wi&&Vi,qi=Boolean(fe.trim())&&Boolean(Ki)&&Mi&&!Ui&&Ri&&Zi,Ji=[!0,Zi,Boolean(Fe),Boolean(Ki)&&Mi&&!Ui,Ri,qi],Xi=Boolean(ii||Qe||ri||Ze||$e),Qi=null!==(e=null!==(i=null!==ii&&void 0!==ii?ii:Qe)&&void 0!==i?i:ri)&&void 0!==e?e:null,el=(0,n.useMemo)(()=>W.find(e=>String(e.id)===String(X))||null,[W,X]),il=(0,n.useMemo)(()=>{if(!Je.key)return W;const e=W.map((e,i)=>({s:e,idx:i})),i="asc"===Je.dir?1:-1,l=e=>{const i=String(e||"").match(/(\d{4})(?:\s*-\s*(\d{4}))?/),l=i?Number(i[1]):0;return[l||0,(i&&i[2]?Number(i[2]):l)||0]},r=e=>"LOCAL"===String(e.input_currency||"USD").toUpperCase()?String(e.local_currency_code||"LOCAL").toUpperCase():"USD",n=e=>{switch(e){case"in_review":return"\u0130ncelemede";case"sent_for_approval":return"Onaya Gonderildi";case"submitted":return"Gonderildi";case"revision_requested":return"Revizyon Istendi";case"approved":return"Onaylandi";default:return"Taslak"}};return e.sort((e,a)=>{const t=e.s,s=a.s;let o=0;switch(Je.key){case"name":o=String(t.name||"").localeCompare(String(s.name||""),"tr",{sensitivity:"base",numeric:!0});break;case"year":{const[e,i]=l(t.academic_year),[r,n]=l(s.academic_year);o=e-r||i-n;break}case"currency":o=r(t).localeCompare(r(s),"tr",{sensitivity:"base",numeric:!0});break;case"status":o=n(t.status).localeCompare(n(s.status),"tr",{sensitivity:"base",numeric:!0});break;case"date":o=new Date(t.created_at).getTime()-new Date(s.created_at).getTime();break;default:o=0}return 0===o&&(o=e.idx-a.idx),o*i}),e.map(e=>e.s)},[W,Je]),ll=e=>{Xe(i=>i.key===e?{key:e,dir:"asc"===i.dir?"desc":"asc"}:{key:e,dir:"asc"})},rl=e=>Je.key!==e?"none":"asc"===Je.dir?"ascending":"descending",nl=e=>Je.key!==e?(0,u.jsx)("span",{className:"sort-icon is-idle",children:(0,u.jsx)(s.MjW,{"aria-hidden":"true"})}):(0,u.jsx)("span",{className:"sort-icon",children:"asc"===Je.dir?(0,u.jsx)(s.XhJ,{"aria-hidden":"true"}):(0,u.jsx)(s.GOR,{"aria-hidden":"true"})}),al=(0,n.useMemo)(()=>I(),[]),tl=yi?al.reduce((e,i)=>e+(yi[i]?1:0),0):0,sl=!(null===yi||void 0===yi||!yi["hr.ik"])===!(null===yi||void 0===yi||!yi["expenses.giderler"]),ol=String((null===ee||void 0===ee?void 0:ee.input_currency)||"USD").toUpperCase(),cl="LOCAL"===(null===ee||void 0===ee?void 0:ee.input_currency)?ee.local_currency_code||"LOCAL":"USD",dl="LOCAL"===(null===ee||void 0===ee?void 0:ee.input_currency),ul=Number((null===le||void 0===le||null===(l=le.temelBilgiler)||void 0===l||null===(m=l.performans)||void 0===m?void 0:m.prevYearRealizedFxUsdToLocal)||0),ml=dl&&!(Number.isFinite(ul)&&ul>0),yl=(0,n.useMemo)(()=>{var e,i;return{countryId:null!==(e=null===(i=H.user)||void 0===i?void 0:i.country_id)&&void 0!==e?e:null,schoolId:null!=q?Number(q):null}},[null===(y=H.user)||void 0===y?void 0:y.country_id,q]),pl=String((null===(p=H.user)||void 0===p?void 0:p.role)||""),gl=(0,j.$3)(H.user,"scenario.create","write",yl),hl=(0,j.$3)(H.user,"scenario.plan_edit","write",yl),bl=(0,j.$3)(H.user,"scenario.copy","write",yl),vl=(0,j.$3)(H.user,"scenario.expense_split","write",yl),fl=(0,j.$3)(H.user,"scenario.submit","write",yl),xl="manager"===pl||"accountant"===pl||(0,j.$3)(H.user,"scenario.forward","write",yl),kl=(0,j.$3)(H.user,"scenario.delete","write",yl),jl=Boolean(el)&&C(el),Nl=Boolean(el)&&!jl&&hl,Sl=Boolean(el)&&!jl&&kl,Cl=Boolean(el)&&("draft"===el.status||"revision_requested"===el.status),Al=Boolean(el)&&"approved"===el.status&&!el.sent_at,wl=Cl&&fl,Ll=Al&&xl,Tl=Boolean(el)&&le&&bl,Ol=el&&String(ii)===String(el.id),Bl=el&&String(Qe)===String(el.id),Il=el&&String(ri)===String(el.id),_l=e=>{Ie(e),"LOCAL"!==e&&(ze(""),De(""))},zl=e=>{if(je(e),"split"===e){const e=O(Ne);null!=e&&Ae(String(e+1))}},Yl=e=>{if(Se(e),"split"===ke){const i=O(e);null!=i&&Ae(String(i+1))}};async function Dl(e){if(!hl)return;if(!q)return;te("");const i=W.find(i=>String(i.id)===String(e));if(i&&C(i))te("Senaryo onayda veya onaylandi, duzenlenemez.");else{Q(e),Re("edit"),We(null),Pe(!0),Ve(!0),Me(0);try{var l,r;const i=await o.FH.getScenarioInputs(q,e),n=null===i||void 0===i?void 0:i.scenario;if(!n)throw new Error("Senaryo bulunamadi.");We(n),xe(n.name||"");const a=function(e){const i=String(e||"").trim(),l=i.match(/(\d{4})\s*-\s*(\d{4})/);if(l){const e=Number(l[1]),i=Number(l[2]);if(Number.isFinite(e)&&Number.isFinite(i))return{startYear:e,endYear:i}}const r=i.match(/^(\d{4})$/);if(r){const e=Number(r[1]);if(Number.isFinite(e))return{startYear:e,endYear:e}}return{startYear:null,endYear:null}}(n.academic_year);a.startYear&&a.endYear&&a.endYear!==a.startYear?(je("split"),Se(String(a.startYear)),Ae(String(a.endYear))):a.startYear?(je("full"),Se(String(a.startYear)),Ae(String(a.startYear+1))):(je("split"),Se(A),Ae(w));const t=null===i||void 0===i||null===(l=i.inputs)||void 0===l||null===(r=l.temelBilgiler)||void 0===r?void 0:r.kademeler,s=t?(0,f.Ds)(t):(0,f.jc)(),c=Object.values(s).some(e=>e&&e.enabled);Le(s),Oe(!c),Li.current=c?structuredClone(s):null;const d=n.input_currency||"USD";Ie(d),ze(n.local_currency_code||""),De(null!=n.fx_usd_to_local?String(n.fx_usd_to_local):""),Ee(n.program_type||x.Rw.LOCAL)}catch(n){te(n.message||"Senaryo yuklenemedi."),Pe(!1)}finally{Ve(!1)}}}const Fl=(e,i)=>{Le(l=>{const n=(0,f.Ds)(l),a=(0,r.A)((0,r.A)({},n),{},{[e]:(0,r.A)((0,r.A)({},n[e]),i)});return(0,f.Ds)(a)})},El=e=>{const i=String(null!==e&&void 0!==e?e:"").trim();if(!i)return NaN;const l=i.replace(",",".").match(/-?\d+(?:\.\d+)?/);if(!l)return NaN;const r=Number.parseFloat(l[0]);return Number.isFinite(r)?r:NaN},Kl=e=>{pi(z(e)),hi("")},Ml=(e,i)=>{Xi||pi(l=>{const n=l||z("all"),a=(0,r.A)({},n);var t;return"hr.ik"===e||"expenses.giderler"===e?(a["hr.ik"]=i,a["expenses.giderler"]=i,t="IK ve Giderler birlikte ".concat(i?"secildi":"kaldirildi","."),wi.current&&clearTimeout(wi.current),hi(t),wi.current=setTimeout(()=>{hi("")},2e3)):a[e]=i,_(a)})},Ul=(e,i)=>{if(Xi)return;const l=N.find(i=>i.key===e);l&&pi(e=>{const n=e||z("all"),a=(0,r.A)({},n);return l.sections.forEach(e=>{a[e.id]=i}),_(a)})};function Pl(){oi(!1),mi("")}function Hl(e){const i=Array.isArray(e)?e:[];let l=0;for(const n of i){var r;const e=Number(null!==(r=null===n||void 0===n?void 0:n.studentsPerBranch)&&void 0!==r?r:0);Number.isFinite(e)&&(l+=e)}return l}function Rl(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"blocking-toast";t.oR.warn(e,{toastId:i,position:"bottom-right",autoClose:!1,closeOnClick:!1,draggable:!0,icon:"!",style:{background:"rgba(15, 23, 42, 0.96)",color:"#f8fafc",border:"1px solid rgba(251, 191, 36, 0.35)",boxShadow:"0 18px 40px rgba(0,0,0,.28)",borderRadius:14}})}function Gl(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Islem";if(!le)return!0;const i=function(e){const i=e&&"object"===typeof e?e:{},l=i.gradesYears&&"object"===typeof i.gradesYears?i.gradesYears:{};return{y1:Hl(Array.isArray(l.y1)?l.y1:i.grades),y2:Hl(l.y2),y3:Hl(l.y3)}}(le),l=[];if(i.y2>0||l.push("Y2"),i.y3>0||l.push("Y3"),!l.length)return!0;const r="".concat(e," yapilamaz: Norm > Planlanan Donem Bilgileri bolumunde ")+"".concat(l.join(" ve ")," toplam ogrenci 0 gorunuyor. Lutfen Y2/Y3 ogrenci sayilarini girin.");return te(""),Rl(r,"norm-y2y3-missing"),!1}function Wl(){if(!le)return!0;if(!dl)return!0;if(!ml)return!0;const e="".concat(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Islem"," yapilamaz: Temel Bilgiler > Performans alanindaki ")+'"Onceki Donem Ortalama Kur (Gerceklesen)" girilmelidir.';return te(""),Rl(e,"prev-realized-fx-missing"),!1}async function $l(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!q||!X)return!1;if(!Wl("Hesaplama"))return!1;if(!e.skipPlanValidation&&!Gl("Hesaplama"))return!1;Ai(!0),te("");let i=!1;try{const e=await o.FH.calculateScenario(q,X);ne(e.results),i=!0}catch(l){te(l.message||"Calculation failed")}finally{Ai(!1)}return i}const Vl=null!=ai?W.find(e=>String(e.id)===String(ai)):null,Zl=null!==Vl&&void 0!==Vl&&Vl.name?'"'.concat(Vl.name,'"'):"Senaryo",ql=null!=ai&&String(ai)===String(X)&&W.length<=1?"".concat(Zl," son senaryo. Silerseniz senaryo secimi temizlenir."):"".concat(Zl," silinecek. Devam edilsin mi?");return(0,u.jsxs)("div",{className:"container select-page",children:[(0,u.jsx)(t.N9,{position:"bottom-right",autoClose:3500,newestOnTop:!0,closeOnClick:!0,pauseOnFocusLoss:!0,pauseOnHover:!0,hideProgressBar:!0,theme:"dark"}),(0,u.jsx)("style",{children:"@keyframes schoolSpin{to{transform:rotate(360deg)}}"}),ae?(0,u.jsx)("div",{className:"card",style:{marginTop:10,background:"#fff1f2",borderColor:"#fecaca"},children:ae}):null,ai?(0,u.jsx)("div",{className:"modal-backdrop",role:"dialog","aria-modal":"true",children:(0,u.jsxs)("div",{className:"modal",children:[(0,u.jsx)("div",{style:{fontWeight:700,marginBottom:8},children:"Senaryo Sil"}),(0,u.jsx)("div",{className:"small",children:ql}),(0,u.jsxs)("div",{className:"row",style:{justifyContent:"flex-end",marginTop:12},children:[(0,u.jsx)("button",{className:"btn",onClick:()=>ti(null),disabled:Xi,children:"Iptal"}),(0,u.jsx)("button",{className:"btn danger",onClick:async function(){if(!ai)return;const e=ai;ti(null),await async function(e){if(!kl)return;if(!q||!e)return;if(Xi)return;const i=W.find(i=>String(i.id)===String(e));if(!i)return;if(C(i))return void te("Senaryo onayda veya onaylandi, silinemez.");te(""),ni(e);try{await o.FH.deleteScenario(q,e);const i=await zi();Array.isArray(i)&&(i.length?i.some(e=>String(e.id)===String(X))||Q(i[0].id):(Q(null),re(null),ne(null))),t.oR.success("Senaryo silindi.")}catch(l){te(l.message||"Senaryo silinemedi.")}finally{ni(null)}}(e)},disabled:Xi,children:"Sil"})]})]})}):null,si?(0,u.jsx)("div",{className:"modal-backdrop",role:"dialog","aria-modal":"true",children:(0,u.jsxs)("div",{className:"modal",style:{width:"min(980px, 96vw)",maxHeight:"86vh",overflowY:"auto"},children:[(0,u.jsxs)("div",{className:"row",style:{justifyContent:"space-between"},children:[(0,u.jsx)("div",{style:{fontWeight:700},children:"Senaryo Kopyalama"}),(0,u.jsx)("button",{className:"btn",onClick:Pl,disabled:Xi,children:"Kapat"})]}),(0,u.jsx)("div",{className:"small",style:{marginTop:6},children:"Yeni senaryo icin para birimini secin."}),ui?(0,u.jsx)("div",{className:"card",style:{marginTop:10,background:"#fff1f2",borderColor:"#fecaca"},children:ui}):null,(0,u.jsxs)("div",{style:{marginTop:12},children:[(0,u.jsx)("div",{className:"small",style:{fontWeight:700,marginBottom:6},children:"Para Birimi"}),(0,u.jsxs)("div",{className:"row",style:{gap:12,alignItems:"center"},children:[(0,u.jsxs)("label",{className:"row",style:{gap:6,alignItems:"center"},children:[(0,u.jsx)("input",{type:"radio",name:"copy-currency",checked:"USD"===bi,onChange:()=>{vi("USD"),mi("")}}),(0,u.jsx)("span",{children:"USD"})]}),(0,u.jsxs)("label",{className:"row",style:{gap:6,alignItems:"center"},children:[(0,u.jsx)("input",{type:"radio",name:"copy-currency",checked:"LOCAL"===bi,onChange:()=>{vi("LOCAL"),mi("")}}),(0,u.jsx)("span",{children:"LOCAL"})]})]})]}),"USD"===ol&&"LOCAL"===bi?(0,u.jsxs)("div",{style:{marginTop:12},children:[(0,u.jsxs)("div",{className:"row",style:{gap:8,alignItems:"center"},children:[(0,u.jsx)("div",{className:"small",style:{fontWeight:700},children:"Local currency code"}),(0,u.jsx)("input",{className:"input sm",list:"local-currency-codes-copy",placeholder:"TRY",value:fi,onChange:e=>xi(e.target.value.toUpperCase().replace(/[^A-Z0-9]/g,"").slice(0,10))}),(0,u.jsx)("datalist",{id:"local-currency-codes-copy",children:T.map(e=>(0,u.jsx)("option",{value:e},e))})]}),(0,u.jsxs)("div",{className:"row",style:{gap:8,alignItems:"center",marginTop:10},children:[(0,u.jsx)("span",{children:"1 USD ="}),(0,u.jsx)("input",{className:"input sm",type:"number",step:"0.000001",value:ki,onChange:e=>ji(e.target.value)}),(0,u.jsx)("span",{children:fi||"LOCAL"})]}),(0,u.jsx)("div",{className:"small muted",style:{marginTop:6},children:"Planlanan kur (senaryo ayarlari icin)."}),(0,u.jsxs)("div",{className:"row",style:{gap:8,alignItems:"center",marginTop:10},children:[(0,u.jsx)("span",{children:"Kopyalama kuru:"}),(0,u.jsx)("input",{className:"input sm",type:"number",step:"0.000001",value:Ni,onChange:e=>Si(e.target.value)}),(0,u.jsx)("span",{children:fi||"LOCAL"})]}),(0,u.jsx)("div",{className:"small muted",style:{marginTop:6},children:"Kopyalama kuruna gore tum rakamlar cevrilir."})]}):null,"LOCAL"===ol&&"USD"===bi?(0,u.jsxs)("div",{style:{marginTop:12},children:[(0,u.jsxs)("div",{className:"row",style:{gap:8,alignItems:"center"},children:[(0,u.jsx)("span",{children:"1 USD ="}),(0,u.jsx)("input",{className:"input sm",type:"number",step:"0.000001",value:Ni,onChange:e=>Si(e.target.value)}),(0,u.jsx)("span",{children:cl})]}),(0,u.jsx)("div",{className:"small muted",style:{marginTop:6},children:"Kopyalama kuru (LOCAL -> USD)."})]}):null,gi?(0,u.jsx)("div",{className:"small",style:{marginTop:10,color:"#0369a1"},children:gi}):null,(0,u.jsxs)("div",{style:{marginTop:16},children:[(0,u.jsxs)("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center"},children:[(0,u.jsx)("div",{style:{fontWeight:700},children:"Kopyalanacak Bolumler"}),(0,u.jsxs)("div",{className:"row",style:{gap:6,alignItems:"center"},children:[(0,u.jsxs)("div",{className:"small muted",children:["Secili: ",tl]}),(0,u.jsx)("button",{type:"button",className:"btn",onClick:()=>Kl("all"),disabled:Xi,children:"Tumu"}),(0,u.jsx)("button",{type:"button",className:"btn",onClick:()=>Kl("structure"),disabled:Xi,children:"Yapisi"}),(0,u.jsx)("button",{type:"button",className:"btn",onClick:()=>Kl("financial"),disabled:Xi,children:"Finans"})]})]}),(0,u.jsx)("div",{style:{marginTop:10,display:"grid",gap:12,gridTemplateColumns:"repeat(auto-fit, minmax(240px, 1fr))"},children:N.map(e=>(0,u.jsxs)("div",{className:"card",style:{padding:12},children:[(0,u.jsxs)("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center"},children:[(0,u.jsx)("div",{style:{fontWeight:700},children:e.label}),(0,u.jsxs)("div",{className:"row",style:{gap:4},children:[(0,u.jsx)("button",{type:"button",className:"btn",style:{padding:"2px 6px",fontSize:12},onClick:()=>Ul(e.key,!0),disabled:Xi,children:"Tumu"}),(0,u.jsx)("button",{type:"button",className:"btn",style:{padding:"2px 6px",fontSize:12},onClick:()=>Ul(e.key,!1),disabled:Xi,children:"Temizle"})]})]}),(0,u.jsx)("div",{style:{marginTop:8,display:"flex",flexDirection:"column",gap:6},children:e.sections.map(e=>(0,u.jsxs)("label",{className:"row",style:{gap:6,alignItems:"center"},children:[(0,u.jsx)("input",{type:"checkbox",checked:!(null===yi||void 0===yi||!yi[e.id]),onChange:i=>Ml(e.id,i.target.checked),disabled:Xi}),(0,u.jsx)("span",{className:"small",children:e.label})]},e.id))})]},e.key))})]}),(0,u.jsxs)("div",{className:"row",style:{justifyContent:"flex-end",marginTop:14},children:[(0,u.jsx)("button",{className:"btn",onClick:Pl,disabled:Xi,children:"Iptal"}),(0,u.jsx)("button",{className:"btn primary",onClick:async function(){if(!yi)return;if(ii)return;const e=_(yi),i=String(bi||ol).toUpperCase();let l=null,r=null,n=null;if("USD"===ol&&"LOCAL"===i){const e=String(fi||"").toUpperCase().replace(/[^A-Z0-9]/g,"").slice(0,10);if(!L.test(e))return void mi("Local para birimi kodu gecersiz.");const i=El(ki);if(!Number.isFinite(i)||i<=0)return void mi("Gecerli bir kur girilmelidir.");const a=El(Ni);if(!Number.isFinite(a)||a<=0)return void mi("Gecerli bir kopyalama kuru girilmelidir.");l=e,r=i,n=a}if("LOCAL"===ol&&"USD"===i){const e=El(Ni);if(!Number.isFinite(e)||e<=0)return void mi("Gecerli bir kopyalama kuru girilmelidir.");n=e}Pl(),await async function(){var e,i,l;let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!bl)return;if(!X||!ee||!le)return;if(ii)return;if(!ee.academic_year)return void te("Akademik yil bulunamadi.");te("");const n=_((null===r||void 0===r?void 0:r.selection)||z("all"));if(!!n["hr.ik"]!==!!n["expenses.giderler"])return void t.oR.warn("IK ve Giderler birlikte secilmelidir.");const a=String((null===r||void 0===r?void 0:r.targetCurrency)||ol).toUpperCase();let s=null!==(e=null===r||void 0===r?void 0:r.localCurrencyCode)&&void 0!==e?e:null,c=null!==(i=null===r||void 0===r?void 0:r.plannedFxUsdToLocal)&&void 0!==i?i:null,d=null!==(l=null===r||void 0===r?void 0:r.copyFxUsdToLocal)&&void 0!==l?l:null,u=El(c),m=El(d);if("LOCAL"===ol&&"LOCAL"===a){var y,p,g;s=null!==(y=null!==(p=s)&&void 0!==p?p:ee.local_currency_code)&&void 0!==y?y:"",c=null!==(g=c)&&void 0!==g?g:ee.fx_usd_to_local,u=El(c)}if("LOCAL"===ol&&"USD"===a){var h;if(d=null!==(h=d)&&void 0!==h?h:ee.fx_usd_to_local,m=El(d),!Number.isFinite(m)||m<=0)return void t.oR.warn("Gecerli bir kopyalama kuru girilmelidir.")}if("USD"===ol&&"LOCAL"===a){if(!s||!L.test(s))return void t.oR.warn("Local para birimi kodu gecersiz.");if(!Number.isFinite(u)||u<=0)return void t.oR.warn("Gecerli bir kur girilmelidir.");if(!Number.isFinite(m)||m<=0)return void t.oR.warn("Gecerli bir kopyalama kuru girilmelidir.")}li(X);try{var b;const e=ee.name||"Senaryo",i="".concat(e," (Kopya)");let l=B(ee.academic_year);if(!l)throw new Error("Akademik yil formati gecersiz.");let r=0;const c=e=>W.some(i=>String((null===i||void 0===i?void 0:i.academic_year)||"").trim()===String(e).trim());for(;c(l);)if(l=B(l),r+=1,!l||r>20)throw new Error("Uygun yeni akademik yil bulunamadi.");const d=!!n["temel.core"],y=(0,f.Ds)(d&&(null===le||void 0===le||null===(b=le.temelBilgiler)||void 0===b?void 0:b.kademeler)||(0,f.jc)()),p=d&&(null===ee||void 0===ee?void 0:ee.program_type)||x.Rw.LOCAL,g="LOCAL"===a&&Number.isFinite(u)&&u>0?u:null,h=await o.FH.createScenario(q,{name:i,academicYear:l,kademeConfig:y,inputCurrency:a,localCurrencyCode:"LOCAL"===a?s||"":null,fxUsdToLocal:g,programType:p});let N=function(e,i){var l;const r=i||{},n=e=>!!r[e],a=structuredClone(e||{}),t=()=>(0,f.oP)().map(e=>({grade:e,branchCount:0,studentsPerBranch:0})),s=null!==e&&void 0!==e&&e.gradesYears&&"object"===typeof e.gradesYears?e.gradesYears:{},o=Array.isArray(null===e||void 0===e?void 0:e.grades)?e.grades:null,c=Array.isArray(null===s||void 0===s?void 0:s.y1)?s.y1:Array.isArray(o)?o:t(),d=n("norm.planned"),u=n("norm.lessonY1"),m=Array.isArray(null===s||void 0===s?void 0:s.y2)?s.y2:u?c:t(),y=Array.isArray(null===s||void 0===s?void 0:s.y3)?s.y3:u?c:t();if(a.temelBilgiler=a.temelBilgiler||{},n("temel.core")||(delete a.temelBilgiler.kademeler,delete a.temelBilgiler.programType),n("temel.pricing")||(delete a.temelBilgiler.inflation,delete a.temelBilgiler.ucretArtisOranlari,delete a.temelBilgiler.okulUcretleriHesaplama),n("temel.schoolInfo")||(delete a.temelBilgiler.yetkililer,delete a.temelBilgiler.okulEgitimBilgileri),n("temel.discountsMeta")||(delete a.temelBilgiler.ikMevcut,delete a.temelBilgiler.bursIndirimOgrenciSayilari),n("temel.competitors")||delete a.temelBilgiler.rakipAnalizi,n("temel.performance")||(delete a.temelBilgiler.performans,delete a.temelBilgiler.degerlendirme),null!==(l=a.temelBilgiler)&&void 0!==l&&l.performans&&"object"===typeof a.temelBilgiler.performans&&delete a.temelBilgiler.performans.gerceklesen,n("kapasite.all")||(delete a.kapasite,delete a.schoolCapacity),n("norm.current")||delete a.gradesCurrent,d||u){const e=u?structuredClone(c):structuredClone(t()),i=d?structuredClone(m):structuredClone(t()),l=d?structuredClone(y):structuredClone(t());a.gradesYears={y1:e,y2:i,y3:l},u?a.grades=structuredClone(e):delete a.grades}else delete a.gradesYears,delete a.grades;return n("hr.ik")||delete a.ik,n("income.gelirler")||delete a.gelirler,n("expenses.giderler")||delete a.giderler,n("expenses.discounts")||delete a.discounts,a}(le,n);n["hr.ik"]&&n["expenses.giderler"]&&(N=function(e){var i,l,r;const n=e||{},a=n.ik||{},t=null!==a&&void 0!==a&&null!==(i=a.years)&&void 0!==i&&i.y1?a.years.y1:a,s=(null===t||void 0===t?void 0:t.unitCosts)||{},o=(null===t||void 0===t?void 0:t.headcountsByLevel)||{},c=["turk_mudur","turk_mdyard","turk_egitimci","turk_temsil","yerel_yonetici_egitimci","yerel_destek","yerel_ulke_temsil_destek","int_yonetici_egitimci"],d=["okulOncesi","ilkokulYerel","ilkokulInt","ortaokulYerel","ortaokulInt","liseYerel","liseInt"],u={};for(const v of c){let e=0;for(const i of d){var m;e+=Number((null===o||void 0===o||null===(m=o[i])||void 0===m?void 0:m[v])||0)}u[v]=Number((null===s||void 0===s?void 0:s[v])||0)*e}const y={turkPersonelMaas:(u.turk_mudur||0)+(u.turk_mdyard||0)+(u.turk_egitimci||0),turkDestekPersonelMaas:u.turk_temsil||0,yerelPersonelMaas:u.yerel_yonetici_egitimci||0,yerelDestekPersonelMaas:(u.yerel_destek||0)+(u.yerel_ulke_temsil_destek||0),internationalPersonelMaas:u.int_yonetici_egitimci||0},p=(null===n||void 0===n||null===(l=n.giderler)||void 0===l||null===(r=l.isletme)||void 0===r?void 0:r.items)||{},g=Object.keys(y);let h=!1;for(const v of g){const e=Number((null===p||void 0===p?void 0:p[v])||0),i=Number((null===y||void 0===y?void 0:y[v])||0);if(Math.abs(e-i)>1e-6){h=!0;break}}if(!h)return n;const b=structuredClone(n);b.giderler=b.giderler||{},b.giderler.isletme=b.giderler.isletme||{},b.giderler.isletme.items=b.giderler.isletme.items||{};for(const v of g)b.giderler.isletme.items[v]=Number(y[v]||0);return b}(N)),N=M(N),N=K(N),N=U(N),"USD"===ol&&"LOCAL"===a&&(N=F(N,m),N.temelBilgiler=N.temelBilgiler||{},N.temelBilgiler.performans=N.temelBilgiler.performans||{},N.temelBilgiler.performans.prevYearRealizedFxUsdToLocal=Number(m)),"LOCAL"===ol&&"USD"===a&&(N=function(e,i){const l=Number(i);return!Number.isFinite(l)||l<=0?e:F(e,1/l)}(N,m),N.temelBilgiler=N.temelBilgiler||{},N.temelBilgiler.performans=N.temelBilgiler.performans||{},N.temelBilgiler.performans.prevYearRealizedFxUsdToLocal=Number(m));const C=function(e){const i=new Set;return e&&"object"===typeof e?(Object.entries(e).forEach(e=>{let[l,r]=e;if(!r)return;const n=S[l];Array.isArray(n)&&n.forEach(e=>i.add(e))}),Array.from(i)):[]}(n);if(await o.FH.saveScenarioInputs(q,h.id,N,C),n["norm.lessonY1"])try{const e=await o.FH.getNormConfig(q,X);if(e){var v,k,j;const i=null!==e&&void 0!==e&&e.years&&"object"===typeof e.years?e.years:{},l=Number(null!==(v=null!==(k=null===i||void 0===i||null===(j=i.y1)||void 0===j?void 0:j.teacherWeeklyMaxHours)&&void 0!==k?k:null===e||void 0===e?void 0:e.teacherWeeklyMaxHours)&&void 0!==v?v:24),r={years:{y1:null!==i&&void 0!==i&&i.y1?structuredClone(i.y1):{teacherWeeklyMaxHours:Number.isFinite(l)&&l>0?l:24,curriculumWeeklyHours:null!==e&&void 0!==e&&e.curriculumWeeklyHours&&"object"===typeof e.curriculumWeeklyHours?structuredClone(e.curriculumWeeklyHours):Y()},y2:D(l),y3:D(l)}};await o.FH.saveNormConfig(q,h.id,r)}}catch(ae){console.warn("[copyScenario] norm copy skipped",ae)}await zi(),Q(h.id),t.oR.success("Senaryo kopyalandi.")}catch(N){te(N.message||"Scenario copy failed")}finally{li(null)}}({targetCurrency:i,localCurrencyCode:l,plannedFxUsdToLocal:r,copyFxUsdToLocal:n,selection:e})},disabled:Xi||ii||!yi||!sl,children:ii?(0,u.jsxs)("span",{style:{display:"inline-flex",gap:6,alignItems:"center"},children:[(0,u.jsx)(E,{}),(0,u.jsx)("span",{children:"Kopyalaniyor..."})]}):"Tamam"})]})]})}):null,ci?(0,u.jsx)(v,{open:ci,onClose:()=>di(!1),sourceScenario:el,sourceSchoolId:q}):null,Ue?(0,u.jsx)("div",{className:"modal-backdrop",role:"dialog","aria-modal":"true",children:(0,u.jsxs)("div",{className:"modal scenario-wizard-modal",children:[(0,u.jsxs)("div",{className:"scenario-wizard-header",children:[(0,u.jsxs)("div",{className:"row",style:{justifyContent:"space-between"},children:[(0,u.jsx)("div",{style:{fontWeight:700},children:"edit"===He?"Senaryo Kurulumunu Duzenle":"Yeni Senaryo Kurulumu"}),(0,u.jsx)("button",{className:"btn",onClick:function(){te(""),Pe(!1),Ve(!1),qe(!1),Me(0)},disabled:Ze||$e,children:"Kapat"})]}),(0,u.jsx)("div",{className:"small",style:{marginTop:6},children:"edit"===He?"Senaryo ayarlarini guncelleyip kaydedebilirsiniz.":"Adim adim kurulum tamamlayin."})]}),(0,u.jsxs)("div",{className:"scenario-wizard-body",children:[ae?(0,u.jsx)("div",{className:"card",style:{marginTop:10,background:"#fff1f2",borderColor:"#fecaca"},children:ae}):null,$e?(0,u.jsx)("div",{className:"card",style:{marginTop:12},children:"Yukleniyor..."}):(0,u.jsxs)("div",{style:{marginTop:12},children:[(0,u.jsxs)("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center"},children:[(0,u.jsx)("div",{style:{fontWeight:700},children:"Kurulum Adimi"}),(0,u.jsx)("div",{className:"small",children:"Adim ".concat(Ke+1," / ").concat(6,": ").concat(["Donem Turu","Para Birimi","Program Turu","Yil","Kademeler","Senaryo Adi"][Ke])})]}),0===Ke&&(0,u.jsxs)("div",{style:{marginTop:10},children:[(0,u.jsx)("div",{className:"small",style:{fontWeight:700,marginBottom:6},children:"Donem Turu"}),(0,u.jsxs)("div",{className:"row",style:{gap:12,alignItems:"center"},children:[(0,u.jsxs)("label",{className:"row",style:{gap:6,alignItems:"center"},children:[(0,u.jsx)("input",{type:"radio",name:"scenario-period",checked:"full"===ke,onChange:()=>zl("full")}),(0,u.jsx)("span",{children:"Tam Yil (tek yil)"})]}),(0,u.jsxs)("label",{className:"row",style:{gap:6,alignItems:"center"},children:[(0,u.jsx)("input",{type:"radio",name:"scenario-period",checked:"split"===ke,onChange:()=>zl("split")}),(0,u.jsx)("span",{children:"Yil ortasinda baslar, sonraki yil biter"})]})]})]}),1===Ke&&(0,u.jsxs)("div",{style:{marginTop:10},children:[(0,u.jsx)("div",{className:"small",style:{fontWeight:700,marginBottom:6},children:"Para Birimi"}),(0,u.jsxs)("div",{className:"row",style:{gap:12,alignItems:"center"},children:[(0,u.jsxs)("label",{className:"row",style:{gap:6,alignItems:"center"},children:[(0,u.jsx)("input",{type:"radio",name:"scenario-currency",checked:"USD"===Be,onChange:()=>_l("USD"),disabled:"edit"===He}),(0,u.jsx)("span",{children:"USD"})]}),(0,u.jsxs)("label",{className:"row",style:{gap:6,alignItems:"center"},children:[(0,u.jsx)("input",{type:"radio",name:"scenario-currency",checked:"LOCAL"===Be,onChange:()=>_l("LOCAL"),disabled:"edit"===He}),(0,u.jsx)("span",{children:"Local currency"})]})]}),"LOCAL"===Be&&(0,u.jsxs)("div",{style:{marginTop:10},children:[(0,u.jsxs)("div",{className:"row",style:{gap:8,alignItems:"center"},children:[(0,u.jsx)("div",{className:"small",style:{fontWeight:700},children:"Local currency code"}),(0,u.jsx)("input",{className:"input sm",list:"local-currency-codes",placeholder:"TRY",value:_e,onChange:e=>ze(e.target.value.toUpperCase().replace(/[^A-Z0-9]/g,"").slice(0,10))}),(0,u.jsx)("datalist",{id:"local-currency-codes",children:T.map(e=>(0,u.jsx)("option",{value:e},e))})]}),Wi?null:(0,u.jsx)("div",{className:"small",style:{color:"#b91c1c",marginTop:6},children:"Code 2-10 chars, A-Z0-9."}),(0,u.jsxs)("div",{className:"row",style:{gap:8,alignItems:"center",marginTop:10},children:[(0,u.jsx)("span",{children:"1 USD ="}),(0,u.jsx)("input",{className:"input sm",type:"number",step:"0.000001",value:Ye,onChange:e=>De(e.target.value)}),(0,u.jsx)("span",{children:Gi||"LOCAL"})]}),Vi?null:(0,u.jsx)("div",{className:"small",style:{color:"#b91c1c",marginTop:6},children:"FX rate must be > 0."}),(0,u.jsx)("div",{className:"small muted",style:{marginTop:6},children:"Kur formati: 1 USD = X LOCAL"})]})]}),2===Ke&&(0,u.jsxs)("div",{style:{marginTop:10},children:[(0,u.jsx)("div",{className:"small",style:{fontWeight:700,marginBottom:6},children:"Program Turu"}),(0,u.jsx)("div",{className:"row",style:{gap:12},children:[{key:x.Rw.LOCAL,label:"Yerel",hint:"Yerel kademeleri planlayin"},{key:x.Rw.INTERNATIONAL,label:"International",hint:"Uluslararasi kademeleri planlayin"}].map(e=>(0,u.jsxs)("button",{type:"button",className:"btn ".concat(Fe===e.key?"primary":"ghost"),"aria-pressed":Fe===e.key,onClick:()=>Ee(e.key),children:[(0,u.jsx)("div",{style:{fontWeight:700},children:e.label}),(0,u.jsx)("div",{className:"small",style:{opacity:.75},children:e.hint})]},e.key))})]}),3===Ke&&(0,u.jsxs)("div",{style:{marginTop:10},children:[(0,u.jsx)("div",{className:"small",style:{fontWeight:700,marginBottom:6},children:"Yil"}),"full"===ke?(0,u.jsx)("input",{className:"input sm num-spin",type:"number",step:"1",placeholder:A,value:Ne,onChange:e=>Yl(e.target.value)}):(0,u.jsxs)("div",{className:"row",style:{gap:8,alignItems:"center"},children:[(0,u.jsx)("input",{className:"input sm num-spin",type:"number",step:"1",placeholder:A,value:Ne,onChange:e=>Yl(e.target.value)}),(0,u.jsx)("span",{className:"muted",children:"-"}),(0,u.jsx)("input",{className:"input sm num-spin",type:"number",step:"1",placeholder:w,value:Ce,readOnly:!0})]}),(0,u.jsxs)("div",{className:"small muted",style:{marginTop:6},children:["Akademik yil: ",Ki||"-","split"===ke&&Ki&&!Mi?(0,u.jsx)("span",{style:{color:"#b91c1c",marginLeft:8},children:"Bitis yili, baslangic yilindan 1 fazla olmali."}):null,Ki&&Ui?(0,u.jsx)("span",{style:{color:"#b91c1c",marginLeft:8},children:"Bu yil turu icin zaten bir senaryo var."}):null]})]}),4===Ke&&(0,u.jsxs)("div",{style:{marginTop:10},children:[(0,u.jsx)("div",{className:"small",style:{fontWeight:700,marginBottom:6},children:"Kademeler"}),(0,u.jsxs)("label",{className:"row small",style:{gap:8,alignItems:"center",marginBottom:8},children:[(0,u.jsx)("input",{type:"checkbox",checked:Te,onChange:e=>(e=>{const i=Boolean(e);Oe(i),Le(e=>{const l=(0,f.Ds)(e);if(i)return Li.current=structuredClone(l),Object.fromEntries(Object.entries(l).map(e=>{let[i,l]=e;return[i,(0,r.A)((0,r.A)({},l),{},{enabled:!1})]}));const n=Li.current;return Li.current=null,n?(0,f.Ds)(n):(0,f.jc)()})})(e.target.checked)}),(0,u.jsx)("span",{children:"Kademe yok (Merkez / Headquarter)"})]}),Te?(0,u.jsx)("div",{className:"small muted",style:{marginBottom:8},children:"Bu senaryo icin kademe secmeye gerek yok. Kademe-bagimli alanlar ilerleme hesabina dahil edilmez."}):null,(0,u.jsxs)("table",{className:"table",children:[(0,u.jsx)("thead",{children:(0,u.jsxs)("tr",{children:[(0,u.jsx)("th",{children:"Kademe"}),(0,u.jsx)("th",{style:{width:120},children:"Aktif"}),(0,u.jsx)("th",{style:{width:160},children:"Baslangic"}),(0,u.jsx)("th",{style:{width:160},children:"Bitis"})]})}),(0,u.jsx)("tbody",{children:Yi.map(e=>{const i=Pi[e.key];return(0,u.jsxs)("tr",{children:[(0,u.jsx)("td",{style:{fontWeight:700},children:e.label}),(0,u.jsx)("td",{children:(0,u.jsx)("input",{type:"checkbox",checked:!(null===i||void 0===i||!i.enabled),disabled:Te,onChange:i=>Fl(e.key,{enabled:i.target.checked})})}),(0,u.jsx)("td",{children:(0,u.jsx)("select",{className:"input sm",value:(null===i||void 0===i?void 0:i.from)||"",onChange:i=>Fl(e.key,{from:i.target.value}),disabled:Te||!(null!==i&&void 0!==i&&i.enabled),children:Di.map(e=>(0,u.jsx)("option",{value:e,children:e},e))})}),(0,u.jsx)("td",{children:(0,u.jsx)("select",{className:"input sm",value:(null===i||void 0===i?void 0:i.to)||"",onChange:i=>Fl(e.key,{to:i.target.value}),disabled:Te||!(null!==i&&void 0!==i&&i.enabled),children:Di.map(e=>(0,u.jsx)("option",{value:e,children:e},e))})})]},e.key)})})]}),Te||Hi?null:(0,u.jsx)("div",{className:"small",style:{color:"#b91c1c"},children:"En az bir kademe secmelisiniz."})]}),5===Ke&&(0,u.jsxs)("div",{style:{marginTop:10},children:[(0,u.jsx)("div",{className:"small",style:{fontWeight:700,marginBottom:6},children:"Senaryo Adi"}),(0,u.jsx)("div",{className:"row",children:(0,u.jsx)("input",{className:"input",placeholder:"Senaryo adi",value:fe,onChange:e=>xe(e.target.value)})}),fe.trim()?null:(0,u.jsx)("div",{className:"small",style:{color:"#b91c1c",marginTop:6},children:"Senaryo adi zorunludur."})]})]})]}),$e?null:(0,u.jsxs)("div",{className:"scenario-wizard-footer",children:[(0,u.jsx)("button",{className:"btn",onClick:function(){te(""),Me(e=>Math.max(0,e-1))},disabled:0===Ke||Ze,children:"Geri"}),(0,u.jsx)("button",{className:"btn primary",onClick:function(){if(te(""),Ze)return;const e=function(e){if(1===e&&"LOCAL"===Be){if(!Wi)return"Local currency code zorunludur.";if(!Vi)return"Kur degeri zorunlu ve 0'dan buyuk olmali."}if(2===e&&!Fe)return"Program Turu secilmelidir.";if(3===e){if(!Ki)return"Lutfen gecerli bir akademik yil girin.";if(!Mi)return"Bitis yili, baslangic yilindan 1 fazla olmali.";if(Ui)return"Bu yil turu icin zaten bir senaryo var. Lutfen baska bir yil secin."}return 4!==e||Ri?5!==e||fe.trim()?"":"Senaryo adi zorunludur.":"En az bir kademe secmelisiniz."}(Ke);e?te(e):Ke<5?Me(e=>Math.min(e+1,5)):async function(){if("edit"===He)return void await async function(){if(!q||null===Ge||void 0===Ge||!Ge.id)return;const e=fe.trim();if(!e)return;if(!Ki)return void te("Lutfen gecerli bir akademik yil girin.");if(!Mi)return void te("Bitis yili, baslangic yilindan 1 fazla olmali.");if(Ui)return void te("Bu yil turu icin zaten bir senaryo var. Lutfen baska bir yil secin.");if(!Ri)return void te("En az bir kademe secmelisiniz.");if("LOCAL"===(null===Ge||void 0===Ge?void 0:Ge.input_currency)){if(!Wi)return void te("Local currency code zorunludur.");if(!Vi)return void te("Kur degeri zorunlu ve 0'dan buyuk olmali.")}te(""),qe(!0);try{const i=Fe||x.Rw.LOCAL,l=(0,f.Ds)(we),n=Te?Object.fromEntries(Object.entries(l).map(e=>{let[i,l]=e;return[i,(0,r.A)((0,r.A)({},l),{},{enabled:!1})]})):l;await o.FH.updateScenario(q,Ge.id,{name:e,academicYear:Ki,kademeConfig:n,programType:i,localCurrencyCode:"LOCAL"===(null===Ge||void 0===Ge?void 0:Ge.input_currency)?Gi:void 0,fxUsdToLocal:"LOCAL"===(null===Ge||void 0===Ge?void 0:Ge.input_currency)?Ye:void 0}),await zi(),Q(Ge.id),ie(l=>l&&l.id===Ge.id?(0,r.A)((0,r.A)({},l),{},{name:e,academic_year:Ki,program_type:i},"LOCAL"===(null===Ge||void 0===Ge?void 0:Ge.input_currency)?{local_currency_code:Gi,fx_usd_to_local:$i}:{}):l),re(e=>{if(!e||"object"!==typeof e)return e;const l=structuredClone(e);return l.temelBilgiler=l.temelBilgiler||{},l.temelBilgiler.kademeler=n,l.temelBilgiler.programType=i,l}),Pe(!1),Me(0)}catch(i){te(i.message||"Senaryo guncellenemedi.")}finally{qe(!1)}}();await async function(){if(!q)return;const e=fe.trim();if(!e)return;if(!Ki)return void te("Lutfen gecerli bir akademik yil girin.");if(!Mi)return void te("Bitis yili, baslangic yilindan 1 fazla olmali.");if(Ui)return void te("Bu yil turu icin zaten bir senaryo var. Lutfen baska bir yil secin.");if(!Ri)return void te("En az bir kademe secmelisiniz.");if("LOCAL"===Be){if(!Wi)return void te("Local currency code zorunludur.");if(!Vi)return void te("Kur degeri zorunlu ve 0'dan buyuk olmali.")}te(""),qe(!0);try{const i=Fe||x.Rw.LOCAL,l=(0,f.Ds)(we),n=Te?Object.fromEntries(Object.entries(l).map(e=>{let[i,l]=e;return[i,(0,r.A)((0,r.A)({},l),{},{enabled:!1})]})):l,a=await o.FH.createScenario(q,{name:e,academicYear:Ki,kademeConfig:n,inputCurrency:Be,localCurrencyCode:"LOCAL"===Be?Gi:null,fxUsdToLocal:"LOCAL"===Be?Ye:null,programType:i});await zi(),Q(a.id),Pe(!1),Me(0)}catch(i){te(i.message||"Senaryo olusturulamadi.")}finally{qe(!1)}}()}()},disabled:Ze||!Ji[Ke],children:Ze?(0,u.jsxs)("span",{style:{display:"inline-flex",gap:6,alignItems:"center"},children:[(0,u.jsx)(E,{}),(0,u.jsx)("span",{children:"edit"===He?"Kaydediliyor...":"Olusturuluyor..."})]}):Ke<5?"Ileri":"edit"===He?"Kaydet":"Bitir"})]})]})}):null,(0,u.jsxs)("div",{className:"row select-page-tables",style:{gap:12,alignItems:"stretch",flexWrap:"wrap"},children:[(0,u.jsxs)("div",{className:"card select-table-card",style:{flex:"1 1 320px",minWidth:280},children:[(0,u.jsx)("div",{style:{fontWeight:700,marginBottom:8},children:"Okullar"}),se?(0,u.jsx)("div",{className:"small",children:"Yukleniyor..."}):(0,u.jsx)("div",{className:"select-table-body",children:(0,u.jsxs)("table",{className:"table select-school-table",children:[(0,u.jsxs)("colgroup",{children:[(0,u.jsx)("col",{style:{width:32}}),(0,u.jsx)("col",{}),(0,u.jsx)("col",{style:{width:180}})]}),(0,u.jsx)("thead",{children:(0,u.jsxs)("tr",{children:[(0,u.jsx)("th",{}),(0,u.jsx)("th",{children:"Okul"}),(0,u.jsx)("th",{children:"\u0130lerleme"})]})}),(0,u.jsx)("tbody",{children:0===R.length?(0,u.jsx)("tr",{children:(0,u.jsx)("td",{colSpan:"3",className:"small",children:"Okul bulunamadi."})}):R.map(e=>{const i=String(q)===String(e.id),l=ue[e.id];return(0,u.jsxs)("tr",{className:i?"scenario-row is-selected":"scenario-row",style:{cursor:i?"default":"pointer"},onClick:()=>{i||Bi(e.id)},children:[(0,u.jsx)("td",{onClick:e=>{e.stopPropagation()},children:(0,u.jsx)("input",{type:"checkbox",className:"select-checkbox",checked:i,"aria-label":"".concat(e.name," okulunu se\xe7"),onChange:l=>{l.stopPropagation(),i?Ii():Bi(e.id)}})}),(0,u.jsx)("td",{onClick:l=>{l.stopPropagation(),i||Bi(e.id)},style:{cursor:"pointer"},children:(0,u.jsx)("b",{children:e.name})}),(0,u.jsx)("td",{style:{minWidth:180},children:l?"active"===l.state?(0,u.jsx)(d.A,{value:l.pct,tooltipLines:l.tooltipLines}):(0,u.jsx)("div",{className:"small",children:l.label||"-"}):(0,u.jsx)("div",{className:"small",children:ye?"Hesaplan\u0131yor...":"-"})})]},e.id)})})]})})]}),(0,u.jsxs)("div",{className:"card select-table-card",style:{flex:"2 1 420px",minWidth:320},children:[(0,u.jsx)("div",{className:"row",style:{justifyContent:"space-between",alignItems:"center",gap:12},children:(0,u.jsx)("div",{style:{fontWeight:700},children:"Senaryolar"})}),q?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsxs)("div",{className:"scenario-toolbar",style:{marginTop:10},children:[gl?(0,u.jsx)("button",{type:"button",className:"btn primary",onClick:function(){gl&&(q?(te(""),xe(""),je("split"),Se(A),Ae(w),Le((0,f.jc)()),Oe(!1),Li.current=null,Ie("USD"),ze(""),De(""),Ee(null),Me(0),Re("create"),We(null),Pe(!0)):te("Once okul secin."))},disabled:!q||Xi,title:"Yeni Senaryo",children:(0,u.jsxs)("span",{className:"btn-inner",children:[(0,u.jsx)(s.OiG,{"aria-hidden":"true"}),(0,u.jsx)("span",{children:"Yeni Senaryo"})]})}):null,hl?(0,u.jsx)("button",{type:"button",className:"btn",onClick:()=>{el&&Dl(el.id)},disabled:!Nl||Xi,title:"Planlamayi Duzenle",children:(0,u.jsxs)("span",{className:"btn-inner",children:[(0,u.jsx)(s.uO9,{"aria-hidden":"true"}),(0,u.jsx)("span",{children:"Planlamayi Duzenle"})]})}):null,bl?(0,u.jsx)("button",{type:"button",className:"btn",onClick:function(){bl&&X&&ee&&le&&(ii||(te(""),mi(""),pi(z("all")),hi(""),vi("LOCAL"===ol?"LOCAL":"USD"),xi(""),ji(""),Si(""),oi(!0)))},disabled:!Tl||Ci||Xi,title:"Kopyala",children:(0,u.jsxs)("span",{className:"btn-inner",children:[Ol?(0,u.jsx)(E,{}):(0,u.jsx)(s.paH,{"aria-hidden":"true"}),(0,u.jsx)("span",{children:"Kopyala"})]})}):null,vl?(0,u.jsx)("button",{type:"button",className:"btn",onClick:()=>di(!0),disabled:!el||Xi,title:"Gider Payla\u015ft\u0131r",children:(0,u.jsxs)("span",{className:"btn-inner",children:[(0,u.jsx)(s.CbL,{"aria-hidden":"true"}),(0,u.jsx)("span",{children:"Gider Payla\u015ft\u0131r"})]})}):null,xl&&Al?(0,u.jsx)("button",{type:"button",className:"btn primary",onClick:()=>{el&&async function(e){if(!xl)return;if(!q||!e||e!==X)return;if("approved"!==String((null===ee||void 0===ee?void 0:ee.status)||"draft")||null!==ee&&void 0!==ee&&ee.sent_at)te("Senaryo merkeze iletilemez.");else if(Wl("Merkeze iletme")&&Gl("Merkeze iletme")&&!Qe){te(""),ei(e);try{if(!await $l({keepTab:!0}))return;const i=await o.FH.sendForApproval(q,e);t.oR.success("Merkeze iletildi"),null!==i&&void 0!==i&&i.scenario&&ie(e=>(0,r.A)((0,r.A)({},e||{}),i.scenario)),await zi()}catch(i){te(i.message||"Gonderme basarisiz")}finally{ei(null)}}}(el.id)},disabled:!Ll||Ci||Xi,title:"Merkeze ilet",children:(0,u.jsxs)("span",{className:"btn-inner",children:[Bl?(0,u.jsx)(E,{}):(0,u.jsx)(s.Cer,{style:{marginRight:4}}),(0,u.jsx)("span",{children:"Merkeze ilet"})]})}):null,fl&&Cl?(0,u.jsx)("button",{type:"button",className:"btn primary",onClick:()=>{el&&async function(e){if(!fl)return;if(!q||!e||e!==X)return;const i=String((null===ee||void 0===ee?void 0:ee.status)||"draft");if(["draft","revision_requested"].includes(i)){if(Wl("Onaya gonderme")&&Gl("Onaya gonderme")&&!Qe){te(""),ei(e);try{if(!await $l({keepTab:!0}))return;const i=await o.FH.submitScenario(q,e);t.oR.success("Senaryo onaya gonderildi."),null!==i&&void 0!==i&&i.scenario&&ie(e=>(0,r.A)((0,r.A)({},e||{}),i.scenario)),await zi()}catch(l){te(l.message||"Submit failed")}finally{ei(null)}}}else te("Senaryo onayda veya onaylandi, gonderilemez.")}(el.id)},disabled:!wl||Ci||Xi,title:"Onaya Gonder",children:(0,u.jsxs)("span",{className:"btn-inner",children:[Bl?(0,u.jsx)(E,{}):(0,u.jsx)(s.A7C,{style:{marginRight:4}}),(0,u.jsx)("span",{children:"Onaya Gonder"})]})}):null,kl?(0,u.jsx)("button",{type:"button",className:"btn danger",onClick:()=>{var e;el&&(e=el.id,kl&&e&&!Xi&&ti(e))},disabled:!Sl||Ci||Xi,title:"Sil",children:(0,u.jsxs)("span",{className:"btn-inner",children:[Il?(0,u.jsx)(E,{}):(0,u.jsx)(s.qbC,{style:{marginRight:4}}),(0,u.jsx)("span",{children:"Sil"})]})}):null]}),(0,u.jsx)("div",{className:"select-table-body select-table-body-gap",children:(0,u.jsxs)("table",{className:"table scenario-table",children:[(0,u.jsx)("thead",{children:(0,u.jsxs)("tr",{children:[(0,u.jsx)("th",{}),(0,u.jsx)("th",{"aria-sort":rl("name"),children:(0,u.jsxs)("button",{type:"button",className:"sort-th",onClick:()=>ll("name"),"aria-label":"Sirala: Ad",children:[(0,u.jsx)("span",{children:"Ad"}),nl("name")]})}),(0,u.jsx)("th",{"aria-sort":rl("year"),children:(0,u.jsxs)("button",{type:"button",className:"sort-th",onClick:()=>ll("year"),"aria-label":"Sirala: Yil",children:[(0,u.jsx)("span",{children:"Yil"}),nl("year")]})}),(0,u.jsx)("th",{"aria-sort":rl("currency"),children:(0,u.jsxs)("button",{type:"button",className:"sort-th",onClick:()=>ll("currency"),"aria-label":"Sirala: Para Birimi",children:[(0,u.jsx)("span",{children:"Para Birimi"}),nl("currency")]})}),(0,u.jsx)("th",{"aria-sort":rl("status"),children:(0,u.jsxs)("button",{type:"button",className:"sort-th",onClick:()=>ll("status"),"aria-label":"Sirala: Durum",children:[(0,u.jsx)("span",{children:"Durum"}),nl("status")]})}),(0,u.jsx)("th",{children:"\u0130lerleme"}),(0,u.jsx)("th",{"aria-sort":rl("date"),children:(0,u.jsxs)("button",{type:"button",className:"sort-th",onClick:()=>ll("date"),"aria-label":"Sirala: Tarih",children:[(0,u.jsx)("span",{children:"Tarih"}),nl("date")]})})]})}),(0,u.jsx)("tbody",{children:ce?(0,u.jsx)("tr",{children:(0,u.jsx)("td",{colSpan:"7",className:"small",children:"Yukleniyor..."})}):0===il.length?(0,u.jsx)("tr",{children:(0,u.jsx)("td",{colSpan:"7",className:"small",children:"Gosterilecek senaryo yok."})}):il.map(e=>{const i=function(e){const i=e&&"object"===typeof e?e:{status:e},l=i.status,r=i.sent_at;switch(l){case"revision_requested":return{label:"Revize istendi",cls:"is-revision",help:"Revize istendi: senaryoda d\xfczeltme gerekiyor."};case"sent_for_approval":case"submitted":return{label:"Merkeze iletildi",cls:"is-submitted",help:"Merkeze iletildi: admin onay\u0131 bekleniyor."};case"approved":return r?{label:"Onayland\u0131",cls:"is-approved",help:"Onayland\u0131: admin taraf\u0131ndan onayland\u0131."}:{label:"Kontrol edildi",cls:"is-approved",help:"Kontrol edildi: y\xf6netici taraf\u0131ndan kontrol edildi."};case"in_review":return{label:"\u0130ncelemede",cls:"is-submitted",help:"\u0130ncelemede: y\xf6netici incelemesinde."};case"draft":return{label:"Taslak",cls:"is-draft",help:"Taslak: senaryo \xfczerinde \xe7al\u0131\u015f\u0131l\u0131yor."};default:return{label:l||"-",cls:"is-unknown",help:""}}}(e),l=String(X)===String(e.id),r=String(e.id)===String(Qi),n=Xi&&Qi&&!r,a=Xi,t="LOCAL"===e.input_currency?"".concat(e.local_currency_code||"LOCAL"," (LOCAL)"):"USD";return(0,u.jsxs)("tr",{className:l?"scenario-row is-selected":"scenario-row",style:{opacity:n?.5:1,pointerEvents:n?"none":"auto",cursor:l||a||n?"default":"pointer"},onClick:()=>{l||a||n||Q(e.id)},children:[(0,u.jsx)("td",{children:(0,u.jsx)("input",{type:"checkbox",className:"select-checkbox",checked:l,disabled:a||n,"aria-label":"".concat(e.name," senaryosunu se\xe7"),onChange:i=>{i.stopPropagation(),a||n||(l?_i():Q(e.id))}})}),(0,u.jsx)("td",{children:(0,u.jsx)("b",{className:"scenario-name",title:e.name,children:e.name})}),(0,u.jsx)("td",{children:e.academic_year}),(0,u.jsx)("td",{children:t}),(0,u.jsx)("td",{children:(0,u.jsx)("span",{className:"status-badge ".concat(i.cls),title:i.help,children:i.label})}),(0,u.jsx)("td",{style:{minWidth:160},children:ge[e.id]&&!ge[e.id].error?(0,u.jsx)(d.A,{value:ge[e.id].pct,tooltipLines:ge[e.id].tooltipLines}):(0,u.jsx)("span",{className:"small",children:be?"Hesaplan\u0131yor...":"-"})}),(0,u.jsx)("td",{className:"small",children:new Date(e.created_at).toLocaleString()})]},e.id)})})]})})]}):(0,u.jsx)("div",{className:"small muted",style:{marginTop:10},children:"Once okul secin."}),(0,u.jsx)("div",{className:"row select-table-footer",style:{justifyContent:"flex-end"},children:(0,u.jsx)("button",{className:"btn primary",onClick:()=>{if(!q||!X)return;(0,k.sE)(q,X),(0,k.f)(q);const e=(0,k.Mf)()||"temel-bilgiler";g("/schools/".concat(q,"/").concat(e),{replace:!0})},disabled:!q||!X,children:"Uygula"})})]})]})]})}},9322(e,i,l){l.d(i,{Rw:()=>r,Z4:()=>o,ZG:()=>t,pb:()=>s,wN:()=>a});const r={LOCAL:"local",INTERNATIONAL:"international"},n=new Set(Object.values(r));function a(e){const i=String(e||"").trim().toLowerCase();return n.has(i)?i:r.LOCAL}function t(){var e,i,l;let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const s=null!==(e=null!==(i=null===n||void 0===n||null===(l=n.temelBilgiler)||void 0===l?void 0:l.programType)&&void 0!==i?i:null===n||void 0===n?void 0:n.programType)&&void 0!==e?e:null===n||void 0===n?void 0:n.program_type;if(s)return a(s);const o=(null===t||void 0===t?void 0:t.program_type)||(null===t||void 0===t?void 0:t.programType);return o?a(o):r.LOCAL}function s(e){const i=a(arguments.length>1&&void 0!==arguments[1]?arguments[1]:r.LOCAL);return!e||("okulOncesi"===e||(e.endsWith("Yerel")?i===r.LOCAL:!e.endsWith("Int")||i===r.INTERNATIONAL))}function o(e){const i=a(arguments.length>1&&void 0!==arguments[1]?arguments[1]:r.LOCAL);if("okulOncesi"===e)return"okulOncesi";const l=i===r.INTERNATIONAL?"Int":"Yerel";return"".concat(e).concat(l)}}}]);
//# sourceMappingURL=100.27896008.chunk.js.map