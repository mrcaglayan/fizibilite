"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[703],{1998(e,s,r){r.d(s,{F2:()=>d,al:()=>a,dq:()=>c,te:()=>o});var l=r(2555),i=r(2532),n=r(7559);const t={staleTime:6e4};function a(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,i.I)((0,l.A)((0,l.A)({queryKey:["countries"],queryFn:()=>n.FH.listCountries()},t),e))}function o(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,i.I)((0,l.A)((0,l.A)({queryKey:["schools",e],queryFn:()=>n.FH.listSchools(e)},t),s))}function d(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,i.I)((0,l.A)((0,l.A)({queryKey:["adminUsers",e],queryFn:()=>n.FH.listUsers(e)},t),s))}function c(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,i.I)((0,l.A)((0,l.A)({queryKey:["managerUsers",e],queryFn:()=>n.FH.managerListUsers(e)},t),s))}},2894(e,s,r){r.d(s,{A:()=>d});var l=r(2555),i=r(3986),n=r(5043),t=r(579);const a=["variant","size","loading","disabled","className","as","onClick","type","children"],o=n.forwardRef((e,s)=>{let{variant:r="primary",size:n="md",loading:o=!1,disabled:d=!1,className:c="",as:u="button",onClick:m,type:h,children:v}=e,p=(0,i.A)(e,a);const y="button"===u,f=d||o,g=["btn","btn-".concat(r),"btn-".concat(n),c].filter(Boolean).join(" "),x=o?"Yukleniyor...":v;return y?(0,t.jsx)(u,(0,l.A)((0,l.A)({ref:s,type:h||"button",className:g,disabled:f,onClick:m},p),{},{children:x})):(0,t.jsx)(u,(0,l.A)((0,l.A)({ref:s,className:g,"aria-disabled":!!f||void 0,onClick:e=>{if(f)return e.preventDefault(),void e.stopPropagation();null===m||void 0===m||m(e)}},p),{},{children:x}))});o.displayName="Button";const d=o},8703(e,s,r){r.r(s),r.d(s,{default:()=>c});var l=r(5043),i=r(5685),n=r(7559),t=r(1998),a=r(3182),o=r(2894),d=r(579);function c(){var e,s,r,c,u,m,h,v,p;const y=(0,a.A)(),f=(0,i.Zp)(),g=(0,i.KC)(),[x,j]=(0,l.useState)(""),[b,N]=(0,l.useState)(""),[w,_]=(0,l.useState)(""),[A,C]=(0,l.useState)(null),[k,S]=(0,l.useState)(!1),[F,B]=(0,l.useState)([]),M=(0,t.te)({limit:50,offset:0,fields:"brief",order:"name:asc"}),q=(0,l.useMemo)(()=>{var e,s;const r=Array.isArray(F)?F:[],l=null===(e=y.user)||void 0===e?void 0:e.principalSchoolIds;if("principal"===(null===(s=y.user)||void 0===s?void 0:s.role)&&Array.isArray(l)&&l.length>0){const e=new Set(l.map(e=>Number(e)));return r.filter(s=>e.has(Number(s.id)))}return r},[F,null===(e=y.user)||void 0===e?void 0:e.role,null===(s=y.user)||void 0===s?void 0:s.principalSchoolIds]),P=(0,l.useMemo)(()=>{var e;const s=Array.isArray(null===(e=y.user)||void 0===e?void 0:e.permissions)?y.user.permissions:[],r=new Map;s.forEach(e=>{const s=String(e.resource||""),l=String(e.action||"").toLowerCase(),i=null!=e.scope_school_id?Number(e.scope_school_id):null,n=null!=e.scope_country_id?Number(e.scope_country_id):null,t="".concat(s,"::").concat(null!==i&&void 0!==i?i:"null","::").concat(null!==n&&void 0!==n?n:"null");r.has(t)||r.set(t,{resource:s,scope_school_id:i,scope_country_id:n,read:!1,write:!1});const a=r.get(t);"read"===l&&(a.read=!0),"write"===l&&(a.write=!0)});const l=Array.from(r.values());return l.sort((e,s)=>{var r,l,i,n;if(e.resource!==s.resource)return e.resource.localeCompare(s.resource,"tr",{sensitivity:"base"});const t=null!==(r=e.scope_school_id)&&void 0!==r?r:-1,a=null!==(l=s.scope_school_id)&&void 0!==l?l:-1;if(t!==a)return t-a;return(null!==(i=e.scope_country_id)&&void 0!==i?i:-1)-(null!==(n=s.scope_country_id)&&void 0!==n?n:-1)}),l},[null===(r=y.user)||void 0===r?void 0:r.permissions]),H=(0,l.useMemo)(()=>{const e=new Map;return(Array.isArray(F)?F:[]).forEach(s=>{s&&null!=s.id&&e.set(Number(s.id),s.name)}),e},[F]);(0,l.useEffect)(()=>{document.title="Profile \xb7 Feasibility Studio"},[]),(0,l.useEffect)(()=>{if(null!==g&&void 0!==g&&g.setHeaderMeta)return g.setHeaderMeta({title:"Profil",subtitle:"\u015eifre ve hesap bilgileri",centered:!0}),()=>{var e;return null===(e=g.clearHeaderMeta)||void 0===e?void 0:e.call(g)}},[g]),(0,l.useEffect)(()=>{var e;const s=null===(e=M.data)||void 0===e?void 0:e.items;Array.isArray(s)&&B(s)},[M.data]);const T=(0,l.useMemo)(()=>{var e;return Boolean(null===(e=y.user)||void 0===e?void 0:e.must_reset_password)},[null===(c=y.user)||void 0===c?void 0:c.must_reset_password]),W=e=>(0,d.jsx)("span",{className:"perm-mark ".concat(e?"is-yes":"is-no"),role:"img","aria-label":e?"Allowed":"Not allowed",title:e?"Allowed":"Not allowed",children:e?(0,d.jsx)("svg",{viewBox:"0 0 24 24","aria-hidden":"true",className:"perm-mark-icon",children:(0,d.jsx)("path",{d:"M5 13l4 4L19 7"})}):(0,d.jsx)("svg",{viewBox:"0 0 24 24","aria-hidden":"true",className:"perm-mark-icon",children:(0,d.jsx)("path",{d:"M6 6l12 12M18 6l-12 12"})})});return(0,d.jsxs)("div",{className:"container",children:[T?(0,d.jsxs)("div",{className:"card",style:{marginTop:12,borderColor:"#f59e0b",background:"#fffbeb"},children:[(0,d.jsx)("div",{style:{fontWeight:700},children:"\u015eifre de\u011fi\u015ftirme gerekli"}),(0,d.jsx)("div",{className:"small",style:{marginTop:6},children:"Bu ilk giri\u015finiz. Devam etmek i\xe7in yeni bir \u015fifre belirleyin."})]}):null,A?(0,d.jsx)("div",{className:"card",style:{marginTop:12,borderColor:"error"===A.type?"#fecaca":"#bbf7d0",background:"error"===A.type?"#fff1f2":"#f0fdf4"},children:A.message}):null,(0,d.jsxs)("div",{className:"card",style:{marginTop:12},children:[(0,d.jsx)("div",{style:{fontWeight:700,marginBottom:8},children:"Hesap"}),(0,d.jsxs)("div",{className:"row",children:[(0,d.jsx)("input",{className:"input",value:(null===(u=y.user)||void 0===u?void 0:u.full_name)||"",disabled:!0,placeholder:"Full name"}),(0,d.jsx)("input",{className:"input",value:(null===(m=y.user)||void 0===m?void 0:m.email)||"",disabled:!0,placeholder:"Email"}),(0,d.jsx)("input",{className:"input sm",value:(null===(h=y.user)||void 0===h?void 0:h.role)||"",disabled:!0,placeholder:"Role"})]})]}),(0,d.jsxs)("div",{className:"card",style:{marginTop:12},children:[(0,d.jsx)("div",{style:{fontWeight:700,marginBottom:8},children:"Assignments"}),(0,d.jsxs)("div",{className:"row",style:{marginBottom:8},children:[(0,d.jsxs)("div",{style:{flex:1},children:[(0,d.jsx)("div",{className:"small",style:{fontWeight:600},children:"Country"}),(0,d.jsx)("div",{children:(null===(v=y.user)||void 0===v?void 0:v.country_name)||(null===(p=y.user)||void 0===p?void 0:p.country_code)||"-"})]}),(0,d.jsxs)("div",{style:{flex:2},children:[(0,d.jsx)("div",{className:"small",style:{fontWeight:600},children:"Responsible Schools"}),q&&q.length>0?(0,d.jsx)("ul",{style:{margin:0,paddingLeft:16},children:q.map(e=>(0,d.jsx)("li",{children:e.name},e.id))}):(0,d.jsx)("div",{children:"-"})]})]})]}),(0,d.jsxs)("div",{className:"card",style:{marginTop:12},children:[(0,d.jsx)("div",{style:{fontWeight:700,marginBottom:8},children:"Permissions"}),0===P.length?(0,d.jsx)("div",{className:"small",children:"No permissions assigned."}):(0,d.jsxs)("table",{className:"table",children:[(0,d.jsx)("thead",{children:(0,d.jsxs)("tr",{children:[(0,d.jsx)("th",{children:"Resource"}),(0,d.jsx)("th",{style:{textAlign:"center"},children:"Read"}),(0,d.jsx)("th",{style:{textAlign:"center"},children:"Write"}),(0,d.jsx)("th",{children:"Scope"})]})}),(0,d.jsx)("tbody",{children:P.map((e,s)=>{const r=null!=e.scope_school_id?Number(e.scope_school_id):null,l=null!=e.scope_country_id?Number(e.scope_country_id):null;let i="Global";if(null!=r&&Number.isFinite(r)){const e=H.get(r);i=e?"School: ".concat(e):"School: #".concat(r)}else if(null!=l&&Number.isFinite(l)){var n,t;const e=(null===(n=y.user)||void 0===n?void 0:n.country_code)||(null===(t=y.user)||void 0===t?void 0:t.country_name)||"";i=e?"Country: ".concat(e):"Country: #".concat(l)}return(0,d.jsxs)("tr",{children:[(0,d.jsx)("td",{children:e.resource}),(0,d.jsx)("td",{style:{textAlign:"center"},children:W(e.read)}),(0,d.jsx)("td",{style:{textAlign:"center"},children:W(e.write)}),(0,d.jsx)("td",{children:i})]},"".concat(e.resource,"-").concat(null!==r&&void 0!==r?r:"global","-").concat(null!==l&&void 0!==l?l:"global","-").concat(s))})})]})]}),(0,d.jsxs)("div",{className:"card",style:{marginTop:12},children:[(0,d.jsx)("div",{style:{fontWeight:700,marginBottom:8},children:"\u015eifre De\u011fi\u015ftir"}),(0,d.jsxs)("form",{onSubmit:async function(e){if(e.preventDefault(),C(null),!x||!b)return void C({type:"error",message:"Current and new password are required."});if(b.length<8)return void C({type:"error",message:"New password must be at least 8 characters."});if(b!==w)return void C({type:"error",message:"New password and confirmation do not match."});S(!0);const s=T;try{const e=await n.FH.changePassword({currentPassword:x,newPassword:b});y.setSession(e),j(""),N(""),_(""),C({type:"success",message:"Password updated successfully."}),s&&f("/schools",{replace:!0})}catch(r){C({type:"error",message:r.message||"Password update failed."})}finally{S(!1)}},children:[(0,d.jsxs)("div",{className:"row",children:[(0,d.jsx)("input",{className:"input",type:"password",placeholder:"Current password",value:x,onChange:e=>j(e.target.value)}),(0,d.jsx)("input",{className:"input",type:"password",placeholder:"New password",value:b,onChange:e=>N(e.target.value)}),(0,d.jsx)("input",{className:"input",type:"password",placeholder:"Confirm new password",value:w,onChange:e=>_(e.target.value)}),(0,d.jsx)(o.A,{type:"submit",variant:"primary",loading:k,children:"Update Password"})]}),(0,d.jsx)("div",{className:"small",style:{marginTop:8},children:"En az 8 karakter kullan\u0131n. Bu i\u015flemi daha sonra herhangi bir zamanda de\u011fi\u015ftirebilirsiniz."})]})]})]})}}}]);
//# sourceMappingURL=703.699a9e7f.chunk.js.map